/**
 * Copyright Croquet Labs 2025
 * Bundle of @croquet/croquet
 * Date: 2025-06-05
 * Version: 2.0.3
 */

var Croquet=function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if("function"==typeof e){var s=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(s,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})})),s}var i,o={exports:{}};i||(i=1,function(t){var e=function(t){var e,s=Object.prototype,n=s.hasOwnProperty,i=Object.defineProperty||function(t,e,s){t[e]=s.value},o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(t,e,s){return Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,s){return t[e]=s}}function d(t,e,s,n){var o=e&&e.prototype instanceof y?e:y,r=Object.create(o.prototype),a=new C(n||[]);return i(r,"_invoke",{value:G(t,s,a)}),r}function h(t,e,s){try{return{type:"normal",arg:t.call(e,s)}}catch(t){return{type:"throw",arg:t}}}t.wrap=d;var u="suspendedStart",m="suspendedYield",p="executing",f="completed",b={};function y(){}function g(){}function w(){}var Z={};c(Z,r,(function(){return this}));var v=Object.getPrototypeOf,X=v&&v(v(P([])));X&&X!==s&&n.call(X,r)&&(Z=X);var x=w.prototype=y.prototype=Object.create(Z);function L(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function s(i,o,r,a){var l=h(t[i],t,o);if("throw"!==l.type){var c=l.arg,d=c.value;return d&&"object"==typeof d&&n.call(d,"__await")?e.resolve(d.__await).then((function(t){s("next",t,r,a)}),(function(t){s("throw",t,r,a)})):e.resolve(d).then((function(t){c.value=t,r(c)}),(function(t){return s("throw",t,r,a)}))}a(l.arg)}var o;i(this,"_invoke",{value:function(t,n){function i(){return new e((function(e,i){s(t,n,e,i)}))}return o=o?o.then(i,i):i()}})}function G(t,s,n){var i=u;return function(o,r){if(i===p)throw new Error("Generator is already running");if(i===f){if("throw"===o)throw r;return{value:e,done:!0}}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var l=T(a,n);if(l){if(l===b)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===u)throw i=f,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=p;var c=h(t,s,n);if("normal"===c.type){if(i=n.done?f:m,c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=f,n.method="throw",n.arg=c.arg)}}}function T(t,s){var n=s.method,i=t.iterator[n];if(i===e)return s.delegate=null,"throw"===n&&t.iterator.return&&(s.method="return",s.arg=e,T(t,s),"throw"===s.method)||"return"!==n&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=h(i,t.iterator,s.arg);if("throw"===o.type)return s.method="throw",s.arg=o.arg,s.delegate=null,b;var r=o.arg;return r?r.done?(s[t.resultName]=r.value,s.next=t.nextLoc,"return"!==s.method&&(s.method="next",s.arg=e),s.delegate=null,b):r:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,b)}function W(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function C(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(W,this),this.reset(!0)}function P(t){if(null!=t){var s=t[r];if(s)return s.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function s(){for(;++i<t.length;)if(n.call(t,i))return s.value=t[i],s.done=!1,s;return s.value=e,s.done=!0,s};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return g.prototype=w,i(x,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:g,configurable:!0}),g.displayName=c(w,l,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,c(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},t.awrap=function(t){return{__await:t}},L(S.prototype),c(S.prototype,a,(function(){return this})),t.AsyncIterator=S,t.async=function(e,s,n,i,o){void 0===o&&(o=Promise);var r=new S(d(e,s,n,i),o);return t.isGeneratorFunction(s)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},L(x),c(x,l,"Generator"),c(x,r,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),s=[];for(var n in e)s.push(n);return s.reverse(),function t(){for(;s.length;){var n=s.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=P,C.prototype={constructor:C,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(k),!t)for(var s in this)"t"===s.charAt(0)&&n.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var s=this;function i(n,i){return a.type="throw",a.arg=t,s.next=n,i&&(s.method="next",s.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o],a=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var l=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(t,e){for(var s=this.tryEntries.length-1;s>=0;--s){var i=this.tryEntries[s];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(r)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var s=this.tryEntries[e];if(s.finallyLoc===t)return this.complete(s.completion,s.afterLoc),k(s),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var s=this.tryEntries[e];if(s.tryLoc===t){var n=s.completion;if("throw"===n.type){var i=n.arg;k(s)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,s,n){return this.delegate={iterator:P(t),resultName:s,nextLoc:n},"next"===this.method&&(this.arg=e),b}},t}(t.exports);try{globalThis.regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}(o));const r={CROQUET_VERSION:"2.0.3"},a=window&&window.location.hostname.endsWith("croquet.studio");let l="",c="";function d(t,e){if(e)for(const s of e.split("&")){const e=s.split("="),n=e[0];let i=!0;if(e.length>1&&(i=decodeURIComponent(e.slice(1).join("=")),i.match(/^(true|false|null|[0-9.]*|["[{].*)$/)))try{i=JSON.parse(i)}catch(t){"["===i[0]&&(i=i.slice(1,-1).split(","))}t[n]=i}}const h=new class{constructor(){this.getSession(),d(this,window.location.search.slice(1)),d(this,a?window.location.hash.slice(1):c),window.location.pathname.indexOf("/ar.html")>=0&&(this.ar=!0)}has(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"string"==typeof s&&(s=this.isHost(s));const n=this[t];if("string"!=typeof n)return s;const i=n.split(",");return!0===s&&(e=`no${e}`),e.endsWith("s")&&(e=e.slice(0,-1)),i.includes(e)||i.includes(`${e}s`)?!s:s}getSession(){if(a){const t=/^\/([^/]+)\/(.*)$/,e=window.location.pathname.match(t);if(e)return l=e[1],e[2]}else{const t=/^#([^&]+)&?(.*)$/,e=window.location.hash.match(t);if(e)return e[1].includes("=")?(c=`${e[1]}&${e[2]}`,""):(c=e[2],e[1])}return"string"==typeof this.session?(c=window.location.hash.slice(1),this.session):""}setSession(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null==a&&this.getSession();const{search:s,hash:n}=window.location,i=a?`/${l}/${t}${s}${n}`:`#${t}${c?"&"+c:""}`;e?window.history.replaceState({},"",i):window.history.pushState({},"",i)}isHost(t){const e=window.location.hostname;if(e===t)return!0;if("localhost"!==t)return!1;if(e.endsWith(".ngrok.io"))return!0;if("croquet.io"===e){if(window.location.pathname.match(/^\/(dev|files)\//))return!0}return"file:"===window.location.protocol||["127.0.0.1","[::1]"].includes(e)}isLocalhost(){return this.isHost("localhost")}};var u,m={exports:{}};var p,f,b,y,g=(u||(u=1,f=m.exports,b=function(t){var e=function(t){return new e.lib.init(t)};function s(t,e){return e.offset[t]?isNaN(e.offset[t])?e.offset[t]:e.offset[t]+"px":"0px"}function n(t,e){return!(!t||"string"!=typeof e||!(t.className&&t.className.trim().split(/\s+/gi).indexOf(e)>-1))}return e.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},e.lib=e.prototype={toastify:"1.12.0",constructor:e,init:function(t){return t||(t={}),this.options={},this.toastElement=null,this.options.text=t.text||e.defaults.text,this.options.node=t.node||e.defaults.node,this.options.duration=0===t.duration?0:t.duration||e.defaults.duration,this.options.selector=t.selector||e.defaults.selector,this.options.callback=t.callback||e.defaults.callback,this.options.destination=t.destination||e.defaults.destination,this.options.newWindow=t.newWindow||e.defaults.newWindow,this.options.close=t.close||e.defaults.close,this.options.gravity="bottom"===t.gravity?"toastify-bottom":e.defaults.gravity,this.options.positionLeft=t.positionLeft||e.defaults.positionLeft,this.options.position=t.position||e.defaults.position,this.options.backgroundColor=t.backgroundColor||e.defaults.backgroundColor,this.options.avatar=t.avatar||e.defaults.avatar,this.options.className=t.className||e.defaults.className,this.options.stopOnFocus=void 0===t.stopOnFocus?e.defaults.stopOnFocus:t.stopOnFocus,this.options.onClick=t.onClick||e.defaults.onClick,this.options.offset=t.offset||e.defaults.offset,this.options.escapeMarkup=void 0!==t.escapeMarkup?t.escapeMarkup:e.defaults.escapeMarkup,this.options.ariaLive=t.ariaLive||e.defaults.ariaLive,this.options.style=t.style||e.defaults.style,t.backgroundColor&&(this.options.style.background=t.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var t=document.createElement("div");for(var e in t.className="toastify on "+this.options.className,this.options.position?t.className+=" toastify-"+this.options.position:!0===this.options.positionLeft?(t.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):t.className+=" toastify-right",t.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.'),this.options.style)t.style[e]=this.options.style[e];if(this.options.ariaLive&&t.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)t.appendChild(this.options.node);else if(this.options.escapeMarkup?t.innerText=this.options.text:t.innerHTML=this.options.text,""!==this.options.avatar){var n=document.createElement("img");n.src=this.options.avatar,n.className="toastify-avatar","left"==this.options.position||!0===this.options.positionLeft?t.appendChild(n):t.insertAdjacentElement("afterbegin",n)}if(!0===this.options.close){var i=document.createElement("button");i.type="button",i.setAttribute("aria-label","Close"),i.className="toast-close",i.innerHTML="&#10006;",i.addEventListener("click",function(t){t.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var o=window.innerWidth>0?window.innerWidth:screen.width;("left"==this.options.position||!0===this.options.positionLeft)&&o>360?t.insertAdjacentElement("afterbegin",i):t.appendChild(i)}if(this.options.stopOnFocus&&this.options.duration>0){var r=this;t.addEventListener("mouseover",(function(e){window.clearTimeout(t.timeOutValue)})),t.addEventListener("mouseleave",(function(){t.timeOutValue=window.setTimeout((function(){r.removeElement(t)}),r.options.duration)}))}if(void 0!==this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),!0===this.options.newWindow?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),"function"==typeof this.options.onClick&&void 0===this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),this.options.onClick()}.bind(this)),"object"==typeof this.options.offset){var a=s("x",this.options),l=s("y",this.options),c="left"==this.options.position?a:"-"+a,d="toastify-top"==this.options.gravity?l:"-"+l;t.style.transform="translate("+c+","+d+")"}return t},showToast:function(){var t;if(this.toastElement=this.buildToast(),!(t="string"==typeof this.options.selector?document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||"undefined"!=typeof ShadowRoot&&this.options.selector instanceof ShadowRoot?this.options.selector:document.body))throw"Root element is not defined";var s=e.defaults.oldestFirst?t.firstChild:t.lastChild;return t.insertBefore(this.toastElement,s),e.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(t){t.className=t.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),t.parentNode&&t.parentNode.removeChild(t),this.options.callback.call(t),e.reposition()}.bind(this),400)}},e.reposition=function(){for(var t,e={top:15,bottom:15},s={top:15,bottom:15},i={top:15,bottom:15},o=document.getElementsByClassName("toastify"),r=0;r<o.length;r++){t=!0===n(o[r],"toastify-top")?"toastify-top":"toastify-bottom";var a=o[r].offsetHeight;t=t.substr(9,t.length-1),(window.innerWidth>0?window.innerWidth:screen.width)<=360?(o[r].style[t]=i[t]+"px",i[t]+=a+15):!0===n(o[r],"toastify-left")?(o[r].style[t]=e[t]+"px",e[t]+=a+15):(o[r].style[t]=s[t]+"px",s[t]+=a+15)}return this},e.lib.init.prototype=e.lib,e},(p=m).exports?p.exports=b():f.Toastify=b()),m.exports),w=s(g),Z={exports:{}},v=n(Object.freeze({__proto__:null})),X=Z.exports;var x,L=(y||(y=1,function(t){!function(e,s,n){var i,o=256,r="random",a=n.pow(o,6),l=n.pow(2,52),c=2*l,d=255;function h(t,d,h){var y=[],g=f(p((d=1==d?{entropy:!0}:d||{}).entropy?[t,b(s)]:null==t?function(){try{var t;return i&&(t=i.randomBytes)?t=t(o):(t=new Uint8Array(o),(e.crypto||e.msCrypto).getRandomValues(t)),b(t)}catch(t){var n=e.navigator,r=n&&n.plugins;return[+new Date,e,r,e.screen,b(s)]}}():t,3),y),w=new u(y),Z=function(){for(var t=w.g(6),e=a,s=0;t<l;)t=(t+s)*o,e*=o,s=w.g(1);for(;t>=c;)t/=2,e/=2,s>>>=1;return(t+s)/e};return Z.int32=function(){return 0|w.g(4)},Z.quick=function(){return w.g(4)/4294967296},Z.double=Z,f(b(w.S),s),(d.pass||h||function(t,e,s,i){return i&&(i.S&&m(i,w),t.state=function(){return m(w,{})}),s?(n[r]=t,e):t})(Z,g,"global"in d?d.global:this==n,d.state)}function u(t){var e,s=t.length,n=this,i=0,r=n.i=n.j=0,a=n.S=[];for(s||(t=[s++]);i<o;)a[i]=i++;for(i=0;i<o;i++)a[i]=a[r=d&r+t[i%s]+(e=a[i])],a[r]=e;(n.g=function(t){for(var e,s=0,i=n.i,r=n.j,a=n.S;t--;)e=a[i=d&i+1],s=s*o+a[d&(a[i]=a[r=d&r+e])+(a[r]=e)];return n.i=i,n.j=r,s})(o)}function m(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function p(t,e){var s,n=[],i=typeof t;if(e&&"object"==i)for(s in t)try{n.push(p(t[s],e-1))}catch(t){}return n.length?n:"string"==i?t:t+"\0"}function f(t,e){for(var s,n=t+"",i=0;i<n.length;)e[d&i]=d&(s^=19*e[d&i])+n.charCodeAt(i++);return b(e)}function b(t){return String.fromCharCode.apply(0,t)}if(f(n.random(),s),t.exports){t.exports=h;try{i=v}catch(t){}}else n["seed"+r]=h}("undefined"!=typeof self?self:X,[],Math)}(Z)),Z.exports),S=s(L);!function(){function t(t){this.mode=s.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,n=this.data.length;e<n;e++){var i=[],o=this.data.charCodeAt(e);o>65536?(i[0]=240|(1835008&o)>>>18,i[1]=128|(258048&o)>>>12,i[2]=128|(4032&o)>>>6,i[3]=128|63&o):o>2048?(i[0]=224|(61440&o)>>>12,i[1]=128|(4032&o)>>>6,i[2]=128|63&o):o>128?(i[0]=192|(1984&o)>>>6,i[1]=128|63&o):i[0]=o,this.parsedData.push(i)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}t.prototype={getLength:function(t){return this.parsedData.length},write:function(t){for(var e=0,s=this.parsedData.length;e<s;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var s=new t(e);this.dataList.push(s),this.dataCache=null},isDark:function(t,e){if(t<0||this.moduleCount<=t||e<0||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,s){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,s),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,s)},setupPositionProbePattern:function(t,e){for(var s=-1;s<=7;s++)if(!(t+s<=-1||this.moduleCount<=t+s))for(var n=-1;n<=7;n++)e+n<=-1||this.moduleCount<=e+n||(this.modules[t+s][e+n]=0<=s&&s<=6&&(0==n||6==n)||0<=n&&n<=6&&(0==s||6==s)||2<=s&&s<=4&&2<=n&&n<=4)},getBestMaskPattern:function(){for(var t=0,e=0,s=0;s<8;s++){this.makeImpl(!0,s);var n=u.getLostPoint(this);(0==s||t>n)&&(t=n,e=s)}return e},createMovieClip:function(t,e,s){var n=t.createEmptyMovieClip(e,s);this.make();for(var i=0;i<this.modules.length;i++)for(var o=1*i,r=0;r<this.modules[i].length;r++){var a=1*r;this.modules[i][r]&&(n.beginFill(0,100),n.moveTo(a,o),n.lineTo(a+1,o),n.lineTo(a+1,o+1),n.lineTo(a,o+1),n.endFill())}return n},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=u.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var s=0;s<t.length;s++){var n=t[e],i=t[s];if(null==this.modules[n][i])for(var o=-2;o<=2;o++)for(var r=-2;r<=2;r++)this.modules[n+o][i+r]=-2==o||2==o||-2==r||2==r||0==o&&0==r}},setupTypeNumber:function(t){for(var e=u.getBCHTypeNumber(this.typeNumber),s=0;s<18;s++){var n=!t&&1==(e>>s&1);this.modules[Math.floor(s/3)][s%3+this.moduleCount-8-3]=n}for(s=0;s<18;s++){n=!t&&1==(e>>s&1);this.modules[s%3+this.moduleCount-8-3][Math.floor(s/3)]=n}},setupTypeInfo:function(t,e){for(var s=this.errorCorrectLevel<<3|e,n=u.getBCHTypeInfo(s),i=0;i<15;i++){var o=!t&&1==(n>>i&1);i<6?this.modules[i][8]=o:i<8?this.modules[i+1][8]=o:this.modules[this.moduleCount-15+i][8]=o}for(i=0;i<15;i++){o=!t&&1==(n>>i&1);i<8?this.modules[8][this.moduleCount-i-1]=o:i<9?this.modules[8][15-i-1+1]=o:this.modules[8][15-i-1]=o}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var s=-1,n=this.moduleCount-1,i=7,o=0,r=this.moduleCount-1;r>0;r-=2)for(6==r&&r--;;){for(var a=0;a<2;a++)if(null==this.modules[n][r-a]){var l=!1;o<t.length&&(l=1==(t[o]>>>i&1)),u.getMask(e,n,r-a)&&(l=!l),this.modules[n][r-a]=l,-1==--i&&(o++,i=7)}if((n+=s)<0||this.moduleCount<=n){n-=s,s=-s;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,s,n){for(var i=b.getRSBlocks(t,s),o=new y,r=0;r<n.length;r++){var a=n[r];o.put(a.mode,4),o.put(a.getLength(),u.getLengthInBits(a.mode,t)),a.write(o)}var l=0;for(r=0;r<i.length;r++)l+=i[r].dataCount;if(o.getLengthInBits()>8*l)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*l+")");for(o.getLengthInBits()+4<=8*l&&o.put(0,4);o.getLengthInBits()%8!=0;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*l||(o.put(e.PAD0,8),o.getLengthInBits()>=8*l));)o.put(e.PAD1,8);return e.createBytes(o,i)},e.createBytes=function(t,e){for(var s=0,n=0,i=0,o=new Array(e.length),r=new Array(e.length),a=0;a<e.length;a++){var l=e[a].dataCount,c=e[a].totalCount-l;n=Math.max(n,l),i=Math.max(i,c),o[a]=new Array(l);for(var d=0;d<o[a].length;d++)o[a][d]=255&t.buffer[d+s];s+=l;var h=u.getErrorCorrectPolynomial(c),m=new f(o[a],h.getLength()-1).mod(h);r[a]=new Array(h.getLength()-1);for(d=0;d<r[a].length;d++){var p=d+m.getLength()-r[a].length;r[a][d]=p>=0?m.get(p):0}}var b=0;for(d=0;d<e.length;d++)b+=e[d].totalCount;var y=new Array(b),g=0;for(d=0;d<n;d++)for(a=0;a<e.length;a++)d<o[a].length&&(y[g++]=o[a][d]);for(d=0;d<i;d++)for(a=0;a<e.length;a++)d<r[a].length&&(y[g++]=r[a][d]);return y};for(var s={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},i=0,o=1,r=2,a=3,l=4,c=5,d=6,h=7,u={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;u.getBCHDigit(e)-u.getBCHDigit(u.G15)>=0;)e^=u.G15<<u.getBCHDigit(e)-u.getBCHDigit(u.G15);return(t<<10|e)^u.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;u.getBCHDigit(e)-u.getBCHDigit(u.G18)>=0;)e^=u.G18<<u.getBCHDigit(e)-u.getBCHDigit(u.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return u.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,s){switch(t){case i:return(e+s)%2==0;case o:return e%2==0;case r:return s%3==0;case a:return(e+s)%3==0;case l:return(Math.floor(e/2)+Math.floor(s/3))%2==0;case c:return e*s%2+e*s%3==0;case d:return(e*s%2+e*s%3)%2==0;case h:return(e*s%3+(e+s)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new f([1],0),s=0;s<t;s++)e=e.multiply(new f([1,m.gexp(s)],0));return e},getLengthInBits:function(t,e){if(1<=e&&e<10)switch(t){case s.MODE_NUMBER:return 10;case s.MODE_ALPHA_NUM:return 9;case s.MODE_8BIT_BYTE:case s.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(e<27)switch(t){case s.MODE_NUMBER:return 12;case s.MODE_ALPHA_NUM:return 11;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(e<41))throw new Error("type:"+e);switch(t){case s.MODE_NUMBER:return 14;case s.MODE_ALPHA_NUM:return 13;case s.MODE_8BIT_BYTE:return 16;case s.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),s=0,n=0;n<e;n++)for(var i=0;i<e;i++){for(var o=0,r=t.isDark(n,i),a=-1;a<=1;a++)if(!(n+a<0||e<=n+a))for(var l=-1;l<=1;l++)i+l<0||e<=i+l||0==a&&0==l||r==t.isDark(n+a,i+l)&&o++;o>5&&(s+=3+o-5)}for(n=0;n<e-1;n++)for(i=0;i<e-1;i++){var c=0;t.isDark(n,i)&&c++,t.isDark(n+1,i)&&c++,t.isDark(n,i+1)&&c++,t.isDark(n+1,i+1)&&c++,0!=c&&4!=c||(s+=3)}for(n=0;n<e;n++)for(i=0;i<e-6;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(s+=40);for(i=0;i<e;i++)for(n=0;n<e-6;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(s+=40);var d=0;for(i=0;i<e;i++)for(n=0;n<e;n++)t.isDark(n,i)&&d++;return s+=10*(Math.abs(100*d/e/e-50)/5)}},m={glog:function(t){if(t<1)throw new Error("glog("+t+")");return m.LOG_TABLE[t]},gexp:function(t){for(;t<0;)t+=255;for(;t>=256;)t-=255;return m.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},p=0;p<8;p++)m.EXP_TABLE[p]=1<<p;for(p=8;p<256;p++)m.EXP_TABLE[p]=m.EXP_TABLE[p-4]^m.EXP_TABLE[p-5]^m.EXP_TABLE[p-6]^m.EXP_TABLE[p-8];for(p=0;p<255;p++)m.LOG_TABLE[m.EXP_TABLE[p]]=p;function f(t,e){if(null==t.length)throw new Error(t.length+"/"+e);for(var s=0;s<t.length&&0==t[s];)s++;this.num=new Array(t.length-s+e);for(var n=0;n<t.length-s;n++)this.num[n]=t[n+s]}function b(t,e){this.totalCount=t,this.dataCount=e}function y(){this.buffer=[],this.length=0}f.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),s=0;s<this.getLength();s++)for(var n=0;n<t.getLength();n++)e[s+n]^=m.gexp(m.glog(this.get(s))+m.glog(t.get(n)));return new f(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=m.glog(this.get(0))-m.glog(t.get(0)),s=new Array(this.getLength()),n=0;n<this.getLength();n++)s[n]=this.get(n);for(n=0;n<t.getLength();n++)s[n]^=m.gexp(m.glog(t.get(n))+e);return new f(s,0).mod(t)}},b.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b.getRSBlocks=function(t,e){var s=b.getRsBlockTable(t,e);if(null==s)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=s.length/3,i=[],o=0;o<n;o++)for(var r=s[3*o+0],a=s[3*o+1],l=s[3*o+2],c=0;c<r;c++)i.push(new b(a,l));return i},b.getRsBlockTable=function(t,e){switch(e){case n.L:return b.RS_BLOCK_TABLE[4*(t-1)+0];case n.M:return b.RS_BLOCK_TABLE[4*(t-1)+1];case n.Q:return b.RS_BLOCK_TABLE[4*(t-1)+2];case n.H:return b.RS_BLOCK_TABLE[4*(t-1)+3];default:return}},y.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var s=0;s<e;s++)this.putBit(1==(t>>>e-s-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var g=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],w=function(){var t=function(t,e){this._bIsPainted=!1,this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._bSupportDataURI=null};return t.prototype.draw=function(t){var e=this._oContext,s=this._htOption,n=t.getModuleCount(),i=s.width/n,o=s.height/n,r=Math.round(i),a=Math.round(o);this.clear();for(var l=0;l<n;l++)for(var c=0;c<n;c++){var d=t.isDark(l,c),h=c*i,u=l*o;e.strokeStyle=d?s.colorDark:s.colorLight,e.lineWidth=1,e.fillStyle=d?s.colorDark:s.colorLight,e.fillRect(h,u,i,o),e.strokeRect(Math.floor(h)+.5,Math.floor(u)+.5,r,a),e.strokeRect(Math.ceil(h)-.5,Math.ceil(u)-.5,r,a)}this._bIsPainted=!0},t.prototype.isPainted=function(){return this._bIsPainted},t.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},t.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},t}();function Z(t,e){for(var s=1,i=function(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}(t),o=0,r=g.length;o<=r;o++){var a=0;switch(e){case n.L:a=g[o][0];break;case n.M:a=g[o][1];break;case n.Q:a=g[o][2];break;case n.H:a=g[o][3]}if(i<=a)break;s++}if(s>g.length)throw new Error("Too long data");return s}x=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:n.H},"string"==typeof e&&(e={text:e}),e)for(var s in e)this._htOption[s]=e[s];"string"==typeof t&&(t=document.getElementById(t)),this._htOption.useSVG&&(w=svgDrawer),this._el=t,this._oQRCode=null,this._oDrawing=new w(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},x.prototype.makeCode=function(t){this._oQRCode=new e(Z(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._oDrawing.draw(this._oQRCode)},x.prototype.clear=function(){this._oDrawing.clear()},x.prototype.getCanvas=function(){for(let t=0;t<this._el.children.length;t++){const e=this._el.children[t];if("CANVAS"===e.tagName)return e}return null},x.CorrectLevel=n}();var G,T,W=x;var k=s(T?G:(T=1,G=function(t,e){e||(e={}),"function"==typeof e&&(e={cmp:e});var s,n="boolean"==typeof e.cycles&&e.cycles,i=e.cmp&&(s=e.cmp,function(t){return function(e,n){var i={key:e,value:t[e]},o={key:n,value:t[n]};return s(i,o)}}),o=[];return function t(e){if(e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),void 0!==e){if("number"==typeof e)return isFinite(e)?""+e:"null";if("object"!=typeof e)return JSON.stringify(e);var s,r;if(Array.isArray(e)){for(r="[",s=0;s<e.length;s++)s&&(r+=","),r+=t(e[s])||"null";return r+"]"}if(null===e)return"null";if(-1!==o.indexOf(e)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=o.push(e)-1,l=Object.keys(e).sort(i&&i(e));for(r="",s=0;s<l.length;s++){var c=l[s],d=t(e[c]);d&&(r&&(r+=","),r+=JSON.stringify(c)+":"+d)}return o.splice(a,1),"{"+r+"}"}}(t)})),C={exports:{}};var P,R={exports:{}};function I(){return P||(P=1,function(t){var s;t.exports=(s=s||function(t,s){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==e&&e.crypto&&(n=e.crypto),!n)try{n=v}catch(t){}var i=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(e){var s;return t.prototype=e,s=new t,t.prototype=null,s}}(),r={},a=r.lib={},l=a.Base={extend:function(t){var e=o(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=e!=s?e:4*t.length},toString:function(t){return(t||h).stringify(this)},concat:function(t){var e=this.words,s=t.words,n=this.sigBytes,i=t.sigBytes;if(this.clamp(),n%4)for(var o=0;o<i;o++){var r=s[o>>>2]>>>24-o%4*8&255;e[n+o>>>2]|=r<<24-(n+o)%4*8}else for(var a=0;a<i;a+=4)e[n+a>>>2]=s[a>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,s=this.sigBytes;e[s>>>2]&=4294967295<<32-s%4*8,e.length=t.ceil(s/4)},clone:function(){var t=l.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var e=[],s=0;s<t;s+=4)e.push(i());return new c.init(e,t)}}),d=r.enc={},h=d.Hex={stringify:function(t){for(var e=t.words,s=t.sigBytes,n=[],i=0;i<s;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push((o>>>4).toString(16)),n.push((15&o).toString(16))}return n.join("")},parse:function(t){for(var e=t.length,s=[],n=0;n<e;n+=2)s[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(s,e/2)}},u=d.Latin1={stringify:function(t){for(var e=t.words,s=t.sigBytes,n=[],i=0;i<s;i++){var o=e[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(o))}return n.join("")},parse:function(t){for(var e=t.length,s=[],n=0;n<e;n++)s[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(s,e)}},m=d.Utf8={stringify:function(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return u.parse(unescape(encodeURIComponent(t)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=m.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var s,n=this._data,i=n.words,o=n.sigBytes,r=this.blockSize,a=o/(4*r),l=(a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*r,d=t.min(4*l,o);if(l){for(var h=0;h<l;h+=r)this._doProcessBlock(i,h);s=i.splice(0,l),n.sigBytes-=d}return new c.init(s,d)},clone:function(){var t=l.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});a.Hasher=p.extend({cfg:l.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,s){return new t.init(s).finalize(e)}},_createHmacHelper:function(t){return function(e,s){return new f.HMAC.init(t,s).finalize(e)}}});var f=r.algo={};return r}(Math),s)}(R)),R.exports}var V;var Y,M=(V||(V=1,function(t){var e;t.exports=(e=I(),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,s=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],i=0;i<e;i++)n[i>>>2]|=t[i]<<24-i%4*8;s.call(this,n,e)}else s.apply(this,arguments)};n.prototype=t}}(),e.lib.WordArray)}(C)),C.exports),H=s(M),K={exports:{}};function z(){return Y||(Y=1,function(t){var e;t.exports=(e=I(),function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[],l=[];!function(){function e(e){for(var s=t.sqrt(e),n=2;n<=s;n++)if(!(e%n))return!1;return!0}function s(t){return 4294967296*(t-(0|t))|0}for(var n=2,i=0;i<64;)e(n)&&(i<8&&(a[i]=s(t.pow(n,.5))),l[i]=s(t.pow(n,1/3)),i++),n++}();var c=[],d=r.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(t,e){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],r=s[3],a=s[4],d=s[5],h=s[6],u=s[7],m=0;m<64;m++){if(m<16)c[m]=0|t[e+m];else{var p=c[m-15],f=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=c[m-2],y=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;c[m]=f+c[m-7]+y+c[m-16]}var g=n&i^n&o^i&o,w=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),Z=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[m]+c[m];u=h,h=d,d=a,a=r+Z|0,r=o,o=i,i=n,n=Z+(w+g)|0}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+r|0,s[4]=s[4]+a|0,s[5]=s[5]+d|0,s[6]=s[6]+h|0,s[7]=s[7]+u|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;return s[i>>>5]|=128<<24-i%32,s[14+(i+64>>>9<<4)]=t.floor(n/4294967296),s[15+(i+64>>>9<<4)]=n,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});s.SHA256=o._createHelper(d),s.HmacSHA256=o._createHmacHelper(d)}(Math),e.SHA256)}(K)),K.exports}var N=s(z());const _="node"===r.CROQUET_PLATFORM;let F;function E(t){const e=t.sigBytes,s=t.words,n=new Uint8Array(e);let i=0,o=0;for(;i<e;){const t=s[o++];if(n[i++]=(4278190080&t)>>>24,i===e)break;if(n[i++]=(16711680&t)>>>16,i===e)break;if(n[i++]=(65280&t)>>>8,i===e)break;n[i++]=255&t}return n}function J(t){function e(t){const e=t.indexOf("{"),s=t.lastIndexOf("}");if(-1===e||-1===s||s<e)return t;const n=t.slice(0,e).replace(/\s+/g," ").replace(/\s\(/,"("),i=t.slice(e+1,s);return`${n.trim()}{${i.trim()}}`}let s=e(""+t);if(!s.startsWith("class")){const n=t.prototype;n&&(s+=Object.getOwnPropertyNames(n).map((t=>`${t}:${e(""+n[t])}`)).join(""))}return s}function Q(t){return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function j(){return h.has("debug","hashing",!1)}F=globalThis.crypto&&globalThis.crypto.subtle&&"function"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(t,e)=>{if("SHA-256"!==t)throw Error(`${Ot.libName}: only SHA-256 available`);const s=H.create(e);return E(N(s)).buffer};let U={};const D=new TextEncoder;async function O(t){const e=D.encode(t),s=await async function(t){return 0===t.length?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":Q(await F("SHA-256",t))}(e);return U[s]={string:t,buffer:e},s}const B=[],A={};const $=new Set;const q=Date.now();"undefined"==typeof performance&&(window.performance={now:()=>Date.now()-q});const tt=["simulate","update","render","snapshot"],et={total:"black",update:"blue",render:"magenta",simulate:"yellow",snapshot:"green",backlog:"red",network:"lightgray"};let st,nt,it=null,ot=null,rt=null,at=0,lt=null,ct=null;function dt(t){for(it=t;t.firstChild;)t.removeChild(t.firstChild);t.style.background="#faf0dc",lt=document.createElement("canvas"),ct=lt.getContext("2d"),lt.id="text_stats",lt.width=Math.min(140,window.innerWidth),lt.height=36,lt.style.width=lt.width,lt.style.height=lt.height,ct.font="9.5pt sans-serif",t.appendChild(lt),t.title=Object.entries(et).map((t=>{let[e,s]=t;return`${s}: ${e}`})).join("\n"),ot=document.createElement("canvas"),ot.width=Math.min(125,window.innerWidth),ot.height=125,ot.style.width="100%";const e=document.createElement("div");e.id="innerDiv",t.appendChild(e),e.appendChild(ot),rt=ot.getContext("2d")}const ht=[];let ut=0,mt=!1,pt=gt(0);const ft=1e3/60;function bt(t){return 20*(1-t/ft)+60}function yt(t){st=function(t){const e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.style.width="100%",e.style.position="absolute",e.style.left="0px",it.querySelector("#innerDiv").appendChild(e),e}(t),nt=st.getContext("2d"),nt.strokeStyle="rgba(255, 255, 255, 0.5)";for(let t=0;t<60;t+=ft){const e=bt(t);nt.moveTo(0,e),nt.lineTo(st.width,e),nt.stroke()}}function gt(t){return{start:t,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:mt}}function wt(t){pt.total=t-pt.start;const e=Math.min(120,window.innerWidth);if(ht.length>=e&&ht.splice(0,ht.length-e+1),ht.push(pt),ht.length<=1)return;if(!it)return;if(0===it.offsetHeight)return;const s=ht.slice(1).filter((t=>t.total)),n=s.map((t=>t.total)).reduce(((t,e)=>t+e),0)/s.length,i=Math.max(...s.map((t=>t.total)));Math.max(...s.map((t=>Math.max(t.backlog,t.network)))),ut=1e3,function(t,e){ct.globalCompositeOperation="copy",ct.fillStyle="rgb(255, 255, 255, 0)",ct.fillRect(0,0,lt.width,lt.height),ct.fillStyle="rgb(0, 0, 0, 1)",ct.globalCompositeOperation="source-over";let s=`${pt.users} users, ${Math.round(1e3/t)} fps`;e>70&&(s+=` ${Math.ceil(e).toLocaleString()}ms`),ct.fillText(s,2,15),s=pt.backlog<100&&pt.activity<1e3?`latency: ${pt.latency} ms`:`backlog: ${pt.backlog<100?"0.0":(pt.backlog/1e3).toFixed(1)} s`,ct.fillText(s,2,33)}(n,i),st||yt(ot),at===ot.width?(rt.globalCompositeOperation="copy",rt.drawImage(ot,1,0,ot.width-1,ot.height,0,0,ot.width-1,ot.height),rt.globalCompositeOperation="source-over",rt.fillStyle="transparent",rt.fillRect(ot.width-1,0,1,ot.height)):at++;const o=t=>bt(t/ut*-2*ft)+5;{const t=ht[ht.length-1],e=at-.5;let s=bt(0);rt.beginPath(),rt.moveTo(e,s),rt.lineTo(e,bt(t.total)),rt.strokeStyle=et[t.connected?"total":"network"],rt.stroke(),rt.beginPath(),rt.moveTo(e,s),s=bt(t.total);let n=0;for(const i of tt)t.items[i]&&(n+=t.items[i],s=bt(n),rt.lineTo(e,s),rt.strokeStyle=et[i],rt.stroke(),rt.beginPath(),rt.moveTo(e,s));t.network&&(rt.beginPath(),rt.moveTo(e,o(0)),rt.lineTo(e,o(t.network)),rt.strokeStyle=et.network,rt.stroke())}}const Zt=[],vt={};let Xt={};const xt={frames:ht,animationFrame(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};wt(t),pt=gt(t);for(const[t,s]of Object.entries(e))this[t](s)},begin(t){const e=performance.now();pt.items[t]=(pt.items[t]||0)-e;const s=Zt[Zt.length-1];return s&&(pt.items[s]+=e),Zt.push(t),e},end(t){const e=performance.now();pt.items[t]+=e;const s=Zt.pop();if(s!==t)throw Error(`Unmatched stats calls: expected end("${s}"), got end("${t}")`);const n=Zt[Zt.length-1];return n&&(pt.items[n]-=e),e},backlog(t){pt.backlog=Math.max(t,pt.backlog)},starvation(t){pt.network=t},latency(t){pt.latency=t},activity(t){pt.activity=t},users(t){pt.users=t},connected(t){const e=mt;pt.connected=mt=t,e&&!mt&&st&&(st.remove(),nt=null)},networkTraffic:vt,addNetworkTraffic(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];vt[t]=(vt[t]||0)+e,s&&(vt[`audit_${t}`]=(vt[`audit_${t}`]||0)+e)},resetAuditStats(){for(const t in vt)t.startsWith("audit_")&&(vt[t]=0)},perSecondTally(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(window.logMessageStats)for(const[e,s]of Object.entries(t))Xt[e]=(Xt[e]||0)+s},stepSession(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=Math.floor(Date.now()/1e3);if(!window.logMessageStats)return Xt={second:s},null;let n=null;if(s!==Xt.second){if(Xt.second&&e&&(Xt.requestedMessages||Xt.sentMessagesTotal)){n={...Xt};const t=s-Xt.second;1!==t&&(n.sampleSeconds=t),n.sentBundles&&(n.averageDelay=Math.round(10*n.sendDelay/n.sentMessagesTotal)/10,n.averageBundlePayload=Math.round(n.sentBundlePayload/n.sentBundles)),delete n.second,delete n.sendDelay,delete n.sentBundlePayload}Xt={second:s}}return n}};globalThis.CROQUETSTATS=xt;const Lt="ontouchstart"in document.documentElement,St=window&&window.parent!==window,Gt=Lt?20:12,Tt=Lt?0:15;let Wt=!1;let kt=!1;let Ct,Pt=!1;function Rt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Ot.showMessage(t,{...e,level:"warning"})}function It(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Ot.showMessage(t,{...e,level:"status"})}function Vt(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";console.error(`Error during ${t}`,e);const n=(e.stack||"").split("\n").filter((t=>!t.match(/croquet-.*\.min.js/))).join("\n");Ot.showMessage(`Error during ${t}: ${e.message}\n\n${n}`,{level:s,duration:"error"===s?1e4:void 0,stopOnFocus:!0})}try{if(Ct=window.localStorage,Ct["croquet-debug-persist-allowed"]="true","true"!==Ct["croquet-debug-persist-allowed"])throw Error("localStorage not persisted");delete Ct["croquet-debug-persist-allowed"]}catch(Br){console.warn("localStorage not allowed"),Ct={}}const Yt={get pinned(){return"true"===Ct[window.location.pathname+"/croquet-debug-ui-pinned"]},set pinned(t){Ct[window.location.pathname+"/croquet-debug-ui-pinned"]=!!t},get activePage(){return Ct[window.location.pathname+"/croquet-debug-ui-activePage"]},set activePage(t){Ct[window.location.pathname+"/croquet-debug-ui-activePage"]=t}},Mt=t=>{t.preventDefault(),t.stopPropagation()};function Ht(t,e,s){const n=document.createElement("canvas"),i=n.width=40*Gt/12,o=n.height=60,r=n.getContext("2d");r.font="36px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(t,i/2,.55*o);const a=document.createElement("button");a.id=e,a.className="croquet_dock_button";const l=t=>{t.preventDefault(),t.stopPropagation(),s()};return Lt?(a.ontouchstart=l,a.ontouchend=Mt,a.onpointerdown=Mt,a.onpointerup=Mt):(a.onclick=l,a.onpointerdown=Mt,a.onpointerup=Mt),a.appendChild(n),a}function Kt(t,e){if(!1===Ot.badge)return;const s=function(t){const e=new S(t),s=["bcdfghjklmnpqrstvwxyz","aeiou"];let n="";for(let t=0;t<5;t++)n+=s[t%2][e.quick()*s[t%2].length|0];return n}(e);for(document.title=document.title.replace(/:.*/,""),document.title+=":"+s;t.firstChild;)t.removeChild(t.firstChild);const n=document.createElement("canvas"),i=n.width=120,o=n.height=40;n.style.width="100%",t.appendChild(n);const r=n.getContext("2d"),a=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const s=new S(t),n=[];for(let t=0;t<e;t++)n.push(`hsl(${360*s.quick()}, 50%, 70%)`);return n}(e,2);r.fillStyle=a[0],r.beginPath(),r.moveTo(0,0),r.lineTo(0,o),r.lineTo(i,0),r.closePath(),r.fill(),r.fillStyle=a[1],r.beginPath(),r.moveTo(i,o),r.lineTo(i,0),r.lineTo(0,o),r.closePath(),r.fill(),r.font="30px Arial",r.textAlign="center",r.textBaseline="middle",r.fillStyle="black",r.fillText(s,i/2,o/2)}function zt(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};for(;t.firstChild;)t.removeChild(t.firstChild);return new W(t,{text:e,width:128,height:128,colorDark:"#000000",colorLight:"#ffffff",correctLevel:W.CorrectLevel.L,...s})}function Nt(){if(!1===Ot.root||!1===Ot.qrcode)return;if(h.noqr)return;const t=Ot.sessionURL;if(!t)return void console.warn("App.sessionURL is not set");const e=Qt(Ot.qrcode);if(!e)return;Lt||(e.onclick=e=>{e.preventDefault(),e.stopPropagation(),e.shiftKey?function(){const t=document.getElementById("croquet_dock");t&&t.classList.toggle("debug")}():window.open(t)});zt(e,t).getCanvas().style.width="100%"}let _t,Ft,Et=0;function Jt(){!function(){if(kt)return;kt=!0;const t=`\n        ${St?"body { min-height: 100vh }":""}\n        #croquet_spinnerOverlay {\n            z-index: 1000;\n            position: fixed;\n            left: 0;\n            top: 0;\n            width: 100%;\n            height: 100%;\n            background-color:#333;\n            opacity:0.9;\n            display:flex;\n            align-items:center;\n            justify-content:center;\n            transition: opacity 1.0s ease-out;\n        }\n        /* https://github.com/lukehaas/css-loaders */\n        @keyframes croquet_dots {\n            0%, 80%, 100% { box-shadow: 0 2.5em 0 -1.3em; }\n            40% { box-shadow: 0 2.5em 0 0; }\n        }\n        #croquet_loader,\n        #croquet_loader::before,\n        #croquet_loader::after {\n          border-radius: 50%;\n          width: 2.5em;\n          height: 2.5em;\n          animation: croquet_dots 1.8s infinite ease-in-out;\n        }\n        #croquet_loader {\n          color: #fff;\n          font-size: 10px;\n          margin: 80px auto;\n          position: relative;\n          text-indent: -9999em;\n          animation-delay: -0.16s;\n        }\n        #croquet_loader::before,\n        #croquet_loader::after {\n          content: '';\n          position: absolute;\n          top: 0;\n        }\n        #croquet_loader::before { left: -3.5em; animation-delay: -0.32s; }\n        #croquet_loader::after { left: 3.5em; }\n        #croquet_spinnerOverlay.croquet_error>*,\n        #croquet_spinnerOverlay.croquet_error>*::before,\n        #croquet_spinnerOverlay.croquet_error>*::after {\n            color: #f00;\n        }\n        #croquet_spinnerOverlay.croquet_fatal>*,\n        #croquet_spinnerOverlay.croquet_fatal>*::before,\n        #croquet_spinnerOverlay.croquet_fatal>*::after {\n            color: #f00;\n            box-shadow: 0 2.5em 0 0 !important;\n            animation: none !important;\n        }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const t=document.createElement("div");t.id="croquet_spinnerOverlay";const e=document.createElement("div");return e.id="croquet_loader",e.innerText="Catching up...",t.appendChild(e),t}function Qt(t,e){if(!1===t)return!1;if(t instanceof Element)return t;if("string"==typeof t){const e=document.getElementById(t);if(e)return e}return e?e():null}function jt(){const t=new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16);return window.crypto.getRandomValues(t),Q(t.buffer)}const Ut=new Set;let Dt=function(){let t=null;const e=document.getElementsByTagName("link");for(const s of e)if("canonical"===s.getAttribute("rel")){t=s.getAttribute("href");break}return t||window.location.href}();const Ot={get libName(){return globalThis.__MULTISYNQ__?"Multisynq":"Croquet"},get sessionURL(){return Dt},set sessionURL(t){Dt=t,Nt()},root:null,sync:!0,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(h.nodock)return;const e=t.debug||h.debug,s=document.getElementById("croquet_dock");s&&s.parentElement.removeChild(s);const n=Qt(Ot.root,(()=>document.body));if(!n)return;!function(){if(Wt)return;Wt=!0;const t=`\n        #croquet_dock { position: fixed; z-index: 2; border: 3px solid white; bottom: 6px; left: 6px; width: 36px; height: 36px; box-sizing: border-box; background: white; opacity: 0.4; transition: all 0.3s ease; }\n        #croquet_dock.active { opacity: 0.95; border-radius: 12px; }\n        #croquet_dock.debug { width: 84px; }\n        #croquet_dock_bar { position: absolute; border: 3px solid white; width: 100%; height: 30px; box-sizing: border-box; background: white; }\n\n        #croquet_badge { position: absolute; width: 72px; height: 24px; top: 50%; transform: translate(0px, -50%); cursor: none; }\n        #croquet_dock.active #croquet_badge { left: 2%; }\n        #croquet_dock:not(.debug) #croquet_badge { display: none; }\n\n        .croquet_dock_button { position: absolute; width: ${Gt}%; height: 90%; top: 50%; transform: translate(0px, -50%); border-radius: 20%; }\n        .croquet_dock_button:focus { outline: 0; }\n        .croquet_dock_button canvas { position: absolute; width: 100%; height: 100%; top: 0px; left: 0px; }\n        #croquet_dock:not(.active) .croquet_dock_button { display: none; }\n        #croquet_dock_left { right: ${2+Tt+Gt+2}% }\n        #croquet_dock:not(.debug) #croquet_dock_left { display: none; }\n        #croquet_dock_right { right: ${2+Tt}%; }\n        #croquet_dock:not(.debug) #croquet_dock_right { display: none; }\n        #croquet_dock_pin { right: 2%; }\n        #croquet_dock_pin.pinned { background: #cce6ff; }\n\n        #croquet_dock_content { position: absolute; left: 2px; top: 2px; right: 2px; bottom: 2px; background: white; overflow: hidden; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content { display: none; }\n        #croquet_dock.debug:not(.active) #croquet_dock_content div { display: none; }\n\n        #croquet_qrcode { position: absolute; width: 100%; height: 100%;box-sizing: border-box; cursor: crosshair; }\n        #croquet_dock.active #croquet_qrcode { border: 6px solid white; }\n        #croquet_dock.debug #croquet_qrcode:not(.active) { display: none; }\n        #croquet_qrcode canvas { image-rendering: pixelated; }\n\n        #croquet_stats { position: absolute; width: 70%; height: 90%; left: 15%; top: 5%; opacity: 0.8; font-family: sans-serif; }\n        #croquet_stats:not(.active) { display: none; }\n`,e=document.createElement("style");e.innerHTML=t,document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const i=document.createElement("div");i.id="croquet_dock",e&&i.classList.add("debug"),St&&!1===t.iframe&&(i.style.display="none"),n.appendChild(i);const o=document.createElement("div");let r;o.id="croquet_dock_bar",i.appendChild(o),!1!==t.badge&&(r=document.createElement("div"),r.id="croquet_badge",o.appendChild(r),Ot.badge=r);const a=document.createElement("div");a.id="croquet_dock_content",i.appendChild(a);const l=[];let c,d;if(!1!==t.qrcode){Ot.sessionURL&&(c=document.createElement("div"),c.id="croquet_qrcode",a.appendChild(c),l.push(c.id),Ot.qrcode=c,e||(Yt.activePage=c.id))}if(!1!==t.stats&&(d=document.createElement("div"),d.id="croquet_stats",a.appendChild(d),l.push(d.id),Ot.stats=d),l.length){function b(t){const e=l.length;let s,n=0;if(Yt.activePage){const t=l.indexOf(Yt.activePage);t>=0?(n=t,s=document.getElementById(Yt.activePage)):Yt.activePage=null}const i=l[(n+e+t)%e];let o;i===Yt.activePage?o=s:(s&&s.classList.remove("active"),o=document.getElementById(i)),o&&o.classList.add("active"),Yt.activePage=i}l.length>1&&(o.appendChild(Ht("<","croquet_dock_left",(()=>b(-1)))),o.appendChild(Ht(">","croquet_dock_right",(()=>b(1))))),b(0)}if(!Lt&&!t.alwaysPinned){const y=Ht("","croquet_dock_pin",(()=>{Yt.pinned=!Yt.pinned,g()})),g=()=>{Yt.pinned?y.classList.add("pinned"):y.classList.remove("pinned")};g(),o.appendChild(y)}const u=t=>{i.style.width=`${t}px`;const e=1.18*t;i.style.height=`${e}px`;const s=18*t/100;o.style.height=`${s}px`,a.style.top=`${s+2}px`,r&&(r.style.height=.9*s+"px",r.style.width=.9*s*3+"px"),c&&(c.style.border=8*t/200+"px solid white")};let m=t.fixedSize||200;const p=()=>{i.classList.add("active"),u(m),setTimeout((()=>i.style.transition="none"),300)},f=()=>{i.style.transition="",i.classList.remove("active"),i.style.width=i.style.height="",o.style.height="",a.style.top="",r&&(r.style.height=r.style.width=""),c&&(c.style.border="")};if(Lt)f(),i.ontouchstart=t=>{t.preventDefault(),t.stopPropagation(),i.classList.contains("active")?f():p()},i.ontouchend=Mt,i.onpointerdown=Mt,i.onpointerup=Mt;else if(t.alwaysPinned?p():(Yt.pinned?p():f(),i.onmouseenter=p,i.onmouseleave=()=>{Yt.pinned||f()}),!t.fixedSize){let w=0;i.addEventListener("wheel",(t=>{t.stopPropagation();const e=Date.now();if(e-w<100)return;w=e;let{deltaY:s}=t;s=Math.sign(s)*Math.min(5,Math.abs(s));const n=.8*Math.min(window.innerWidth,window.innerHeight);m=Math.max(166,Math.min(n,i.offsetWidth/1.05**s)),u(m)}),{passive:!0})}},makeSessionWidgets:function(t){!function(t){if(!t||!1===Ot.root)return;const e=Qt(Ot.badge);e&&Kt(e,t)}(t),Nt(),function(){if(!1===Ot.root)return;if(h.nostats)return;const t=Qt(Ot.stats);t&&dt(t)}()},makeQRCanvas(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!Ot.sessionURL)return null;const e=zt(document.createElement("div"),Ot.sessionURL,t);return e&&e.getCanvas()},clearSessionMoniker:function(){!1!==Ot.badge&&(document.title=document.title.replace(/:.*/,""))},showSyncWait(t){!1===Ot.root?t=!1:_t||(_t=Jt()),function(t){if(Ft!==t&&("string"!=typeof Ft||!0!==t))if(!1===Ot.sync&&(t=!1),Ft=t,t)clearTimeout(Et),Et=setTimeout((()=>{Ft&&(Qt(Ot.root,(()=>document.body)).appendChild(_t),_t.style.opacity=.9,_t.className="error"===Ft?"croquet_error":"fatal"===Ft?"croquet_fatal":"")}),500);else{if(!_t)return;clearTimeout(Et),_t.style.opacity=0,_t.className="",Et=setTimeout((()=>{Ft||_t.parentElement&&_t.parentElement.removeChild(_t)}),500)}}(t)},messageFunction:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=e.level;let n;return"error"===s?(n="orangered,red",console.error(t)):"warning"===s?(n="gold,orange",console.warn(t)):n="silver,gray",function(t,e){const s=Qt(Ot.root,(()=>document.body));if(!1===s)return null;!function(){if(Pt)return;Pt=!0;let t="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n";t+="\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n";const e=document.createElement("style");e.innerHTML="/*!\n        * Toastify js 1.5.0\n        * https://github.com/apvarun/toastify-js\n        * @license MIT licensed\n        *\n        * Copyright (C) 2018 Varun A P\n        */\n        .toastify {\n            padding: 12px 20px;\n            color: #ffffff;\n            display: inline-block;\n            box-shadow: 0 3px 6px -1px rgba(0, 0, 0, 0.12), 0 10px 36px -4px rgba(77, 96, 232, 0.3);\n            background: -webkit-linear-gradient(315deg, #73a5ff, #5477f5);\n            background: linear-gradient(135deg, #73a5ff, #5477f5);\n            position: fixed;\n            opacity: 0;\n            transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);\n            border-radius: 2px;\n            cursor: pointer;\n            text-decoration: none;\n            max-width: calc(50% - 20px);\n            z-index: 2147483647;\n        }\n        .toastify.on {\n            opacity: 1;\n        }\n        .toast-close {\n            opacity: 0.4;\n            padding: 0 5px;\n        }\n        .toastify-right {\n            right: 15px;\n        }\n        .toastify-left {\n            left: 15px;\n        }\n        .toastify-top {\n            top: -150px;\n        }\n        .toastify-bottom {\n            bottom: -150px;\n        }\n        .toastify-rounded {\n            border-radius: 25px;\n        }\n        .toastify-avatar {\n            width: 1.5em;\n            height: 1.5em;\n            margin: 0 5px;\n            border-radius: 2px;\n        }\n        @media only screen and (max-width: 360px) {\n            .toastify-right, .toastify-left {\n                margin-left: auto;\n                margin-right: auto;\n                left: 0;\n                right: 0;\n                max-width: fit-content;\n            }\n        }\n\n        .toastify {\n            font-family: sans-serif;\n            border-radius: 8px;\n        }\n\n        .toastify-center {\n            margin-left: auto;\n            margin-right: auto;\n            left: 0;\n            right: 0;\n            max-width: fit-content;\n            max-width: -moz-fit-content;\n        }\n",document.head.insertBefore(e,document.head.querySelector("style,link[rel=stylesheet]"))}();const n={text:t,duration:3e3,gravity:"bottom",position:"right",stopOnFocus:!0,...e};let i;s instanceof Element&&s!==document.body?(i=s.id,i||(s.id=i="_croquetToastParent")):"string"==typeof s&&(i=s);i&&(n.selector=i);return w(n).showToast()}(t,{style:{background:`linear-gradient(90deg,${n})`},...e})},showMessage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("once"===e.only){if(Ut.has(t))return null;Ut.add(t)}return"fatal"===e.level&&(e.level="error",e.showSyncWait="fatal"),e.showSyncWait&&("fatal"!==e.showSyncWait||e.duration||(e.duration=-1),Ot.showSyncWait(e.showSyncWait)),h.nomessages||!1===Ot.root||!1===Ot.messages||!Ot.messageFunction?("warning"===e.level&&console.warn(t),"error"===e.level&&console.error(t),null):Ot.messageFunction(t,e)},isCroquetHost:t=>t.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(t)||t.endsWith("ngrok.io"),referrerURL(){const t=new URL(Ot.sessionURL),e=this.isCroquetHost(t.hostname);return`${t.protocol}//${t.host}${t.pathname}${e?t.search:""}`},autoSession(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:"q",force:!1,default:"",keyless:!1};"string"==typeof t&&(t={key:t}),t||(t={});const e=t.key||"q",s=new URL(Ot.sessionURL);let n="";if(!t.force){const i=s.search.slice(1).split("&"),o=i.find((t=>t.split("=")[0]===e));o?n=o.replace(/[^=]*=/,""):t.keyless&&(n=i.find((t=>!t.includes("="))),n||(n=s.hash.slice(1),n&&(s.hash="",s.search?s.searchParams.set(e,n):s.search=n)))}if(n)try{n=decodeURIComponent(n)}catch(t){}else n=t.default?t.default:this.randomSession(),s.searchParams.set(e,n);if(Ot.sessionURL=s.href,window.location.href!==s.href)try{window.history.replaceState({},"",s.href)}catch(t){Ot.showMessage(`Setting address bar to ${s.href}`,{only:"once"}),Ot.showMessage(`Failed to change address bar: ${t.message}`,{level:"warning",only:"once"})}h.has("debug","session")&&console.log(`${Ot.libName}.App.autoSession: "${n}"`);const i=Promise.resolve(n);return i[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${Ot.libName}.App.autoSession() return value used directly. It returns a promise now!`),n),i},autoPassword(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:"pw",default:"",force:!1,scrub:!1,keyless:!1};"string"==typeof t&&(t={key:t});const e=t.key||"pw",s=t.scrub&&!h.has("debug","password"),n=t.keyless,i=new URL(Ot.sessionURL);let o="";const r=t.force?"":i.hash.slice(1);if(r){const t=r.split("&"),a=t.find((t=>t.split("=")[0]===e));a?(o=a.replace(/[^=]*=/,""),o&&s&&(i.hash=t.filter((t=>t.split("=")[0]!==e)).join("&"))):n&&(o=t.find((t=>!t.includes("="))),o&&s&&(i.hash=t.filter((t=>t!==o)).join("&")))}if(o||(o=t.default?t.default:this.randomPassword(),i.hash=r?`${r}&${e}=${o}`:n?o:`${e}=${o}`,Ot.sessionURL=i.href,s&&(i.hash=n?"":r)),h.has("debug","session")&&console.log(`${Ot.libName}.App.sessionUrl: ${Ot.sessionURL}`),window.location.href!==i.href)try{window.history.replaceState({},"",i.href)}catch(t){Ot.showMessage(`Setting address bar to ${i.href}`,{only:"once"}),Ot.showMessage(`Failed to change address bar: ${t.message}`,{level:"warning",only:"once"})}if(o)try{o=decodeURIComponent(o)}catch(t){}h.has("debug","session")&&console.log(`${Ot.libName}.App.autoPassword: "${o}"`);const a=Promise.resolve(o);return a[Symbol.toPrimitive]=()=>(console.warn(`Deprecated: ${Ot.libName}.App.autoPassword() return value used directly. It returns a promise now!`),o),a},randomSession(){return jt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:10)},randomPassword(){return jt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:16)}},Bt="#__vote";function At(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="none";for(const i of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const o of t[i])o.for===e?null===s||o.unbound===s?t[i].delete(o):n="subscriber":"none"===n&&(n="others");return n}const $t=globalThis.CROQUETVD=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=!1,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0,this.currentEvent=void 0,this.currentEventFromModel=!1}register(t){return"V"+ ++this.subscriberIds}deregister(t){}addSubscription(t,e,s,n,i){if(t.includes(":"))throw Error(`Invalid subscription scope "${t}" (must not contain ':')`);if("vote"===i)return void this.addSubscription(t,e+Bt,s,n,"immediate");"*"!==t&&"*"!==e||(this.genericSubscriptions=!0);const o=t+":"+e,r=n;r.for=s;let a=this.subscriptions[o];if(a||(a=this.subscriptions[o]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[i])throw Error(`Unknown subscribe() option: handling="${i}"`);a[i].add(r);let l=this.subscribers.get(s);l||this.subscribers.set(s,l=new Set),l.add(o)}removeSubscription(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const i=t+":"+e,o=this.subscriptions[i];if(o){const t=At(o,s,n);if("none"===t&&delete this.subscriptions[i],"subscriber"!==t){const t=this.subscribers.get(s);t&&(t.delete(i),0===t.size&&this.subscribers.delete(s))}}e.endsWith(Bt)||this.removeSubscription(t,e+Bt,s)}removeAllSubscriptionsFor(t){const e=this.subscribers.get(t);if(e){for(const s of e){const e=this.subscriptions[s];if(e){"none"===At(e,t)&&delete this.subscriptions[s]}else console.error(`${Ot.libName}: topic ${s} not found in subscriptions table for ${t} during removeAllSubscriptionsFor()`)}this.subscribers.delete(t)}}subscriptionsFor(t){const e=this.subscriptions[t];if(!e&&!this.genericSubscriptions)return null;const s=[];let n=!!e;if(this.genericSubscriptions){const[e,i]=t.split(":");if(!(e.startsWith("__")&&e.endsWith("__")||i.startsWith("__")&&i.endsWith("__")))for(const t of["*:*",e+":*","*:"+i]){const e=this.subscriptions[t];e&&(s.push([e,t]),!n&&this.hasUserSubcription(e)&&(n=!0))}const o=!n;if(o)for(const t of s)t.push(o)}return e&&s.push([e,t]),0===s.length?null:s}hasUserSubcription(t){for(const e of["immediate","queued","oncePerFrame","oncePerFrameWhileSynced"])for(const s of t[e])if(!s.unbound.__CROQUET__)return!0;return!1}handleEvent(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const n=this.subscriptionsFor(t);if(!n)return;const i=!!s;let o=0,r=0,a=0;for(const[l,c,d]of n)o+=l.queued.size,r+=l.oncePerFrame.size,a+=l.oncePerFrameWhileSynced.size,l.immediate.size>0&&(s||(s=t=>t()),s((()=>{for(const s of l.immediate){const n=this.currentEvent,o=this.currentEventFromModel,r=this.currentEventOnlyGeneric;this.currentEvent=t,this.currentEventFromModel=i,this.currentEventOnlyGeneric=d;try{s(e)}catch(t){console.error(t),console.warn(`${Ot.libName}: error "${t.message}" in "immediate" subscription ${c}`)}this.currentEvent=n,this.currentEventFromModel=o,this.currentEventOnlyGeneric=r}})));o>0&&this.queuedEvents.push({topic:t,data:e,fromModel:i}),r>0&&this.perFrameEvents.set(t,{data:e,fromModel:i}),a>0&&this.perSyncedFrameEvents.set(t,{data:e,fromModel:i})}processFrameEvents(t,e){let s=0;const n=(t,e,n,i)=>{const o=this.subscriptionsFor(e);if(!o)return;const r=this.currentEvent,a=this.currentEventFromModel;this.currentEvent=e,this.currentEventFromModel=i;for(const[i,r,a]of o){const o=this.currentEventOnlyGeneric;this.currentEventOnlyGeneric=a;for(const o of i[t]){try{o(n)}catch(s){console.error(s),console.warn(`${Ot.libName}: error "${s.message}" in "${t}" subscription ${e}`)}s++}this.currentEventOnlyGeneric=o}this.currentEvent=r,this.currentEventFromModel=a};for(const{topic:t,data:e,fromModel:s}of this.queuedEvents)n("queued",t,e,s);if(this.queuedEvents.length=0,t){for(const[t,{data:e,fromModel:s}]of this.perFrameEvents)n("oncePerFrame",t,e,s);if(this.perFrameEvents.clear(),e){for(const[t,{data:e,fromModel:s}]of this.perSyncedFrameEvents)n("oncePerFrameWhileSynced",t,e,s);this.perSyncedFrameEvents.clear()}for(const{topic:t,data:e,fromModel:s}of this.queuedEvents)n("queued",t,e,s);this.queuedEvents.length=0}return s}};let qt={get subscribe(){return qt={subscribe:h.has("debug","subscribe",!1)},qt.subscribe}};class te{constructor(t){this.vm=t}register(t){return this.vm.registerModel(t)}deregister(t){this.vm.deregisterModel(t.id)}publish(t,e,s){this.vm.publishFromModel(s,t,e)}subscribe(t,e,s,n){return qt.subscribe&&console.log(`Model.subscribe("${e}:${s}", ${t} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(t,e,s,n)}unsubscribe(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";qt.subscribe&&console.log(`Model.unsubscribe(${e}:${s}", ${t} ${(""+n).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(t,e,s,n)}unsubscribeAll(t){qt.subscribe&&console.log(`Model.unsubscribeAll(${t} ${t.id})`),this.vm.removeAllSubscriptionsFor(t)}future(t,e,s,n){if(se&&se.equal(this))return this.vm.future(t,e,s,n);throw Error(`Model.future() called from outside: ${t}`)}cancelFuture(t,e){if(se&&se.equal(this))return this.vm.cancelFuture(t,e);throw Error(`Model.cancelFuture() called from outside: ${t}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(t){return t instanceof te&&t.vm===this.vm}isViewRealm(){return!1}}class ee{constructor(t){this.vd=$t,this.vm=t,this.controller=t.controller}valid(){return this.vm===this.controller.vm}register(t){return $t.register(t)}deregister(t){$t.deregister(t)}publish(t,e,s){this.vm.publishFromView(s,t,e)}subscribe(t,e,s,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"queued";qt.subscribe&&console.log(`View[${e}].subscribe("${n}:${t}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):""+s} [${i}])`),$t.addSubscription(n,t,e,s,i)}unsubscribe(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;qt.subscribe&&console.log(`View[${e}].unsubscribe("${n}:${t}" ${s?s.name||(""+s).replace(/\([\s\S]*/,""):"*"})`),$t.removeSubscription(n,t,e,s)}unsubscribeAll(t){qt.subscribe&&console.log(`View[${t}].unsubscribeAll()`),$t.removeAllSubscriptionsFor(t)}future(t,e){const s=this.vm;return new Proxy(t,{get(n,i){if("function"==typeof t[i]){return new Proxy(t[i],{apply(n,o,r){setTimeout((()=>{t.id&&oe(s,(()=>t[i](...r)),!0)}),e)}})}throw Error("Tried to call "+i+"() on future of "+Object.getPrototypeOf(t).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.controller.reflectorTime}extrapolatedNow(){return this.controller.extrapolatedTime}isSynced(){return!!this.controller.synced}equal(t){return t instanceof ee&&t.vm===this.vm}isViewRealm(){return!0}}let se=null;function ne(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Tried to execute code that requires realm outside of realm.";if(!se&&t)throw Error(t);return se}function ie(t,e){if(null!==se)throw Error("Can't switch realms from inside realm");try{return se=new te(t),e()}finally{se=null}}function oe(t,e){if(null!==se&&!(arguments.length>2&&void 0!==arguments[2]&&arguments[2]))throw Error("Can't switch realms from inside realm");const s=se;try{return se=new ee(t),e()}finally{se=s}}var re=function(t){return t!=t},ae=Math.sqrt,le=.7853981633974483;var ce=function(t){var e,s;return 0===t?.16666666666666713:((t<0?-t:t)<=1?(e=t*(19.562619833175948+t*(t*(5.444622390564711+t*(.004253011369004428*t-.6019598008014124))-16.262479672107002))-8.198089802484825,s=t*(139.51056146574857+t*(t*(70.49610280856842+t*(1*t-14.740913729888538))-147.1791292232726))-49.18853881490881):(e=.004253011369004428+(t=1/t)*(t*(5.444622390564711+t*(t*(19.562619833175948+-8.198089802484825*t)-16.262479672107002))-.6019598008014124),s=1+t*(t*(70.49610280856842+t*(t*(139.51056146574857+-49.18853881490881*t)-147.1791292232726))-14.740913729888538)),e/s)};var de=function(t){var e,s;return 0===t?.08333333333333809:((t<0?-t:t)<=1?(e=28.536655482610616+t*(t*(6.968710824104713+t*(.002967721961301243*t-.5634242780008963))-25.56901049652825),s=342.43986579130785+t*(t*(147.0656354026815+t*(1*t-21.947795316429207))-383.8770957603691)):(e=.002967721961301243+(t=1/t)*(t*(6.968710824104713+t*(28.536655482610616*t-25.56901049652825))-.5634242780008963),s=1+t*(t*(147.0656354026815+t*(342.43986579130785*t-383.8770957603691))-21.947795316429207)),e/s)};var he=function(t){var e,s,n,i,o;if(re(t))return NaN;if(t>0?n=t:(e=!0,n=-t),n>1)return NaN;if(n>.625)i=(s=1-n)*de(s),s=ae(s+s),o=le-s,o-=s=s*i-6123233995736766e-32,o+=le;else{if(n<1e-8)return t;o=n*(o=(s=n*n)*ce(s))+n}return e?-o:o};var ue=function(t){var e;return re(t)||t<-1||t>1?NaN:t>.5?2*he(ae(.5-.5*t)):(e=le-he(t),e+=6123233995736766e-32,e+=le)};var me=function(){return"function"==typeof Symbol&&"symbol"==typeof Symbol("foo")}();var pe=function(){return me&&"symbol"==typeof Symbol.toStringTag},fe=Object.prototype.toString;var be=function(t){return fe.call(t)},ye=Object.prototype.hasOwnProperty;var ge=function(t,e){return null!=t&&ye.call(t,e)},we="function"==typeof Symbol?Symbol.toStringTag:"";var Ze=function(t){var e,s,n;if(null==t)return fe.call(t);s=t[we],e=ge(t,we);try{t[we]=void 0}catch(e){return fe.call(t)}return n=fe.call(t),e?t[we]=s:delete t[we],n},ve=pe()?Ze:be,Xe="function"==typeof Uint32Array;var xe=function(t){return Xe&&t instanceof Uint32Array||"[object Uint32Array]"===ve(t)},Le=4294967295,Se="function"==typeof Uint32Array?Uint32Array:null;var Ge=function(){var t,e;if("function"!=typeof Se)return!1;try{e=new Se(e=[1,3.14,-3.14,Le+1,Le+2]),t=xe(e)&&1===e[0]&&3===e[1]&&e[2]===Le-2&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},Te="function"==typeof Uint32Array?Uint32Array:null;var We=function(){throw new Error("not implemented")},ke=Ge()?Te:We,Ce="function"==typeof Float64Array;var Pe=function(t){return Ce&&t instanceof Float64Array||"[object Float64Array]"===ve(t)},Re="function"==typeof Float64Array?Float64Array:null;var Ie=function(){var t,e;if("function"!=typeof Re)return!1;try{e=new Re([1,3.14,-3.14,NaN]),t=Pe(e)&&1===e[0]&&3.14===e[1]&&-3.14===e[2]&&e[3]!=e[3]}catch(e){t=!1}return t},Ve="function"==typeof Float64Array?Float64Array:null;var Ye=function(){throw new Error("not implemented")},Me=Ie()?Ve:Ye,He="function"==typeof Uint8Array;var Ke=function(t){return He&&t instanceof Uint8Array||"[object Uint8Array]"===ve(t)},ze="function"==typeof Uint8Array?Uint8Array:null;var Ne=function(){var t,e;if("function"!=typeof ze)return!1;try{e=new ze(e=[1,3.14,-3.14,256,257]),t=Ke(e)&&1===e[0]&&3===e[1]&&253===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},_e="function"==typeof Uint8Array?Uint8Array:null;var Fe=function(){throw new Error("not implemented")},Ee=Ne()?_e:Fe,Je="function"==typeof Uint16Array;var Qe=function(t){return Je&&t instanceof Uint16Array||"[object Uint16Array]"===ve(t)},je="function"==typeof Uint16Array?Uint16Array:null;var Ue=function(){var t,e;if("function"!=typeof je)return!1;try{e=new je(e=[1,3.14,-3.14,65536,65537]),t=Qe(e)&&1===e[0]&&3===e[1]&&65533===e[2]&&0===e[3]&&1===e[4]}catch(e){t=!1}return t},De="function"==typeof Uint16Array?Uint16Array:null;var Oe,Be=function(){throw new Error("not implemented")},Ae={uint16:Ue()?De:Be,uint8:Ee};(Oe=new Ae.uint16(1))[0]=4660;var $e=52===new Ae.uint8(Oe.buffer)[0],qe=!0===$e?1:0,ts=new Me(1),es=new ke(ts.buffer);var ss=function(t){return ts[0]=t,es[qe]},ns=!0===$e?1:0,is=new Me(1),os=new ke(is.buffer);var rs=function(t,e){return is[0]=t,os[ns]=e>>>0,is[0]},as=rs,ls=Number.POSITIVE_INFINITY,cs=Number.NEGATIVE_INFINITY,ds=1023;var hs=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.3999999999940942+t*(.2857142874366239+t*(.22222198432149784+t*(.1818357216161805+t*(.15313837699209373+.14798198605116586*t)))))},us=.6931471803691238,ms=1.9082149292705877e-10;var ps=function(t){var e,s,n,i,o,r,a,l,c,d;if(t<-1||re(t))return NaN;if(-1===t)return cs;if(t===ls)return t;if(0===t)return t;if(d=1,(n=t<0?-t:t)<.41421356237309503){if(n<1.862645149230957e-9)return n<5551115123125783e-32?t:t-t*t*.5;t>-.2928932188134525&&(d=0,i=t,s=1)}return 0!==d&&(n<9007199254740992?(o=(d=((s=ss(c=1+t))>>20)-ds)>0?1-(c-t):t-(c-1),o/=c):(d=((s=ss(c=t))>>20)-ds,o=0),(s&=1048575)<434334?c=as(c,1072693248|s):(d+=1,c=as(c,1071644672|s),s=1048576-s>>2),i=c-1),e=.5*i*i,0===s?0===i?d*us+(o+=d*ms):d*us-((l=e*(1-.6666666666666666*i))-(d*ms+o)-i):(l=(a=(r=i/(2+i))*r)*hs(a),0===d?i-(e-r*(e+l)):d*us-(e-(r*(e+l)+(d*ms+o))-i))},fs=.6931471805599453;var bs=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var ys=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},gs=.6931471803691238,ws=1.9082149292705877e-10,Zs=1048575;var vs=function(t){var e,s,n,i,o,r,a,l,c,d,h;return 0===t?cs:re(t)||t<0?NaN:(i=0,(s=ss(t))<1048576&&(i-=54,s=ss(t*=0x40000000000000)),s>=2146435072?t+t:(i+=(s>>20)-ds|0,i+=(a=(s&=Zs)+614244&1048576)>>20,r=(t=as(t,s|1072693248^a))-1,(Zs&2+s)<3?0===r?0===i?0:i*gs+i*ws:(o=r*r*(.5-.3333333333333333*r),0===i?r-o:i*gs-(o-i*ws-r)):(a=s-398458|0,l=440401-s|0,n=(d=(h=(c=r/(2+r))*c)*h)*bs(d),o=h*ys(d)+n,(a|=l)>0?(e=.5*r*r,0===i?r-(e-c*(e+o)):i*gs-(e-(c*(e+o)+i*ws)-r)):0===i?r-c*(r-o):i*gs-(c*(r-o)-i*ws-r))))};var Xs=function(t){var e;return re(t)||t<1?NaN:1===t?0:t>=268435456?vs(t)+fs:t>2?vs(2*t-1/(t+ae(t*t-1))):ps((e=t-1)+ae(2*e+e*e))};var xs=function(t){return t===ls||t===cs},Ls=1/(1<<28);var Ss=function(t){var e,s,n;return re(t)||xs(t)?t:(t<0&&(t=-t,e=!0),n=t<Ls?t:t>268435456?vs(t)+fs:t>2?vs(2*t+1/(ae(t*t+1)+t)):ps(t+(s=t*t)/(1+ae(1+s))),e?-n:n)},Gs=1.5707963267948966;var Ts=function(t){return 0===t?-64.85021904942025:t*(t*(t*(-.8750608600031904*t-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var Ws=function(t){return 0===t?194.5506571482614:194.5506571482614+t*(485.3903996359137+t*(432.88106049129027+t*(165.02700983169885+t*(24.858464901423062+1*t))))},ks=6123233995736766e-32;var Cs=function(t){var e,s,n,i;return re(t)||0===t?t:t===ls?Gs:t===cs?-1.5707963267948966:(t<0&&(s=!0,t=-t),e=0,t>2.414213562373095?(n=Gs,e=1,t=-1/t):t<=.66?n=0:(n=le,e=2,t=(t-1)/(t+1)),i=t*(i=(i=t*t)*Ts(i)/Ws(i))+t,2===e?i+=.5*ks:1===e&&(i+=ks),n+=i,s?-n:n)},Ps=1/(1<<28);var Rs,Is,Vs=function(t){var e,s;return re(t)||t<-1||t>1?NaN:1===t?ls:-1===t?cs:(t<0&&(e=!0,t=-t),t<Ps?e?-t:t:(s=t<.5?.5*ps((s=t+t)+s*t/(1-t)):.5*ps((t+t)/(1-t)),e?-s:s))};!0===$e?(Rs=1,Is=0):(Rs=0,Is=1);var Ys={HIGH:Rs,LOW:Is},Ms=new Me(1),Hs=new ke(Ms.buffer),Ks=Ys.HIGH,zs=Ys.LOW;var Ns=function(t,e){return Ms[0]=e,t[0]=Hs[Ks],t[1]=Hs[zs],t};var _s,Fs,Es=function(t,e){return 1===arguments.length?Ns([0,0],t):Ns(t,e)},Js=Es;!0===$e?(_s=1,Fs=0):(_s=0,Fs=1);var Qs={HIGH:_s,LOW:Fs},js=new Me(1),Us=new ke(js.buffer),Ds=Qs.HIGH,Os=Qs.LOW;var Bs=function(t,e){return Us[Ds]=t,Us[Os]=e,js[0]},As=Bs,$s=[0,0];var qs=function(t,e){var s,n;return Js($s,t),s=$s[0],s&=2147483647,n=ss(e),As(s|=n&=2147483648,$s[1])};var tn=function(t){return!!(ss(t)>>>31)},en=3.141592653589793;var sn=function(t,e){var s;return re(e)||re(t)?NaN:xs(e)?e===ls?xs(t)?qs(en/4,t):qs(0,t):xs(t)?qs(3*en/4,t):qs(en,t):xs(t)?qs(en/2,t):0===t?e>=0&&!tn(e)?qs(0,t):qs(en,t):0===e?qs(en/2,t):(s=Cs(t/e),e<0?s<=0?s+en:s-en:s)},nn=22250738585072014e-324;var on=function(t){return 0===t?1.87595182427177:1.87595182427177+t*(t*(1.6214297201053545+t*(.14599619288661245*t-.758397934778766))-1.8849797954337717)},rn=2147483647;var an=function(t){var e,s,n,i,o;return re(t)||xs(t)||0===t?t:(s=-2147483648&(n=ss(t)),n&=rn,o=0,t<nn?(o=0x40000000000000,e=ss(o*=t),o=As(s|(e=(e&rn)/3+696219795),0)):o=as(o,s|(e=n/3+715094163)),o*=on(i=o*o*(o/t)),e=ss(o),o=As(e+1,0),o+=o*(i=((i=t/(o*o))-o)/(o+o+i)))},ln=an;var cn=function(t){return 0===t?.0416666666666666:.0416666666666666+t*(2480158728947673e-20*t-.001388888888887411)};var dn=function(t){return 0===t?-2.7557314351390663e-7:t*(2.087572321298175e-9+-11359647557788195e-27*t)-2.7557314351390663e-7};var hn=function(t,e){var s,n,i,o;return i=(o=t*t)*o,n=o*cn(o),n+=i*i*dn(o),(i=1-(s=.5*o))+(1-i-s+(o*n-t*e))},un=-.16666666666666632;var mn=function(t,e){var s,n,i;return s=.00833333333332249+(i=t*t)*(27557313707070068e-22*i-.0001984126982985795)+i*(i*i)*(1.58969099521155e-10*i-2.5050760253406863e-8),n=i*t,0===e?t+n*(un+i*s):t-(i*(.5*e-n*s)-e-n*un)},pn=!0===$e?0:1,fn=new Me(1),bn=new ke(fn.buffer);var yn=function(t){return fn[0]=t,bn[pn]},gn=Math.floor;var wn=function(t){return t<0?-t:0===t?0:t};var Zn=function(t,e){return re(e)||xs(e)?(t[0]=e,t[1]=0,t):0!==e&&wn(e)<nn?(t[0]=4503599627370496*e,t[1]=-52,t):(t[0]=e,t[1]=0,t)};var vn=function(t,e){return 1===arguments.length?Zn([0,0],t):Zn(t,e)},Xn=vn;var xn=function(t){var e=ss(t);return(e=(2146435072&e)>>>20)-ds|0},Ln=xn,Sn=[0,0],Gn=[0,0];var Tn=function(t,e){var s,n;return 0===t||re(t)||xs(t)?t:(Xn(Sn,t),e+=Sn[1],(e+=Ln(t=Sn[0]))<-1074?qs(0,t):e>1023?t<0?cs:ls:(e<=-1023?(e+=52,n=2220446049250313e-31):n=1,Js(Gn,t),s=Gn[0],s&=2148532223,n*As(s|=e+ds<<20,Gn[1])))},Wn=Tn,kn=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Cn=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],Pn=16777216,Rn=5.960464477539063e-8,In=Hn(new Array(20)),Vn=Hn(new Array(20)),Yn=Hn(new Array(20)),Mn=Hn(new Array(20));function Hn(t){var e,s=t.length;for(e=0;e<s;e++)t[e]=0;return t}function Kn(t,e,s,n,i,o,r,a,l){var c,d,h,u,m,p,f,b,y;for(u=o,y=n[s],b=s,m=0;b>0;m++)d=Rn*y|0,Mn[m]=y-Pn*d|0,y=n[b-1]+d,b-=1;if(y=Wn(y,i),y-=8*gn(.125*y),y-=f=0|y,h=0,i>0?(f+=m=Mn[s-1]>>24-i,Mn[s-1]-=m<<24-i,h=Mn[s-1]>>23-i):0===i?h=Mn[s-1]>>23:y>=.5&&(h=2),h>0){for(f+=1,c=0,m=0;m<s;m++)b=Mn[m],0===c?0!==b&&(c=1,Mn[m]=16777216-b):Mn[m]=16777215-b;if(i>0)switch(i){case 1:Mn[s-1]&=8388607;break;case 2:Mn[s-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=Wn(1,i)))}if(0===y){for(b=0,m=s-1;m>=o;m--)b|=Mn[m];if(0===b){for(p=1;0===Mn[o-p];p++);for(m=s+1;m<=s+p;m++){for(l[a+m]=kn[r+m],d=0,b=0;b<=a;b++)d+=t[b]*l[a+(m-b)];n[m]=d}return Kn(t,e,s+=p,n,i,o,r,a,l)}}if(0===y)for(s-=1,i-=24;0===Mn[s];)s-=1,i-=24;else(y=Wn(y,-i))>=Pn?(d=Rn*y|0,Mn[s]=y-Pn*d|0,i+=24,Mn[s+=1]=d):Mn[s]=0|y;for(d=Wn(1,i),m=s;m>=0;m--)n[m]=d*Mn[m],d*=Rn;for(m=s;m>=0;m--){for(d=0,p=0;p<=u&&p<=s-m;p++)d+=Cn[p]*n[m+p];Yn[s-m]=d}for(d=0,m=s;m>=0;m--)d+=Yn[m];for(e[0]=0===h?d:-d,d=Yn[0]-d,m=1;m<=s;m++)d+=Yn[m];return e[1]=0===h?d:-d,7&f}var zn=function(t,e,s,n){var i,o,r,a,l,c,d;for((o=(s-3)/24|0)<0&&(o=0),a=s-24*(o+1),c=o-(r=n-1),d=r+4,l=0;l<=d;l++)In[l]=c<0?0:kn[c],c+=1;for(l=0;l<=4;l++){for(i=0,c=0;c<=r;c++)i+=t[c]*In[r+(l-c)];Vn[l]=i}return Kn(t,e,4,Vn,a,4,o,r,In)},Nn=Math.round;var _n=function(t,e,s){var n,i,o,r,a;return o=t-1.5707963267341256*(n=Nn(.6366197723675814*t)),r=6077100506506192e-26*n,a=e>>20,s[0]=o-r,a-(ss(s[0])>>20&2047)>16&&(r=20222662487959506e-37*n-((i=o)-(o=i-(r=6077100506303966e-26*n))-r),s[0]=o-r,a-(ss(s[0])>>20&2047)>49&&(r=84784276603689e-45*n-((i=o)-(o=i-(r=20222662487111665e-37*n))-r),s[0]=o-r)),s[1]=o-s[0]-r,n},Fn=1.5707963267341256,En=6077100506506192e-26,Jn=2*En,Qn=3*En,jn=4*En,Un=new Array(3),Dn=new Array(2);var On=function(t,e){var s,n,i,o,r,a,l;if((i=2147483647&ss(t))<=1072243195)return e[0]=t,e[1]=0,0;if(i<=1074752122)return 598523==(1048575&i)?_n(t,i,e):i<=1073928572?t>0?(l=t-Fn,e[0]=l-En,e[1]=l-e[0]-En,1):(l=t+Fn,e[0]=l+En,e[1]=l-e[0]+En,-1):t>0?(l=t-2*Fn,e[0]=l-Jn,e[1]=l-e[0]-Jn,2):(l=t+2*Fn,e[0]=l+Jn,e[1]=l-e[0]+Jn,-2);if(i<=1075594811)return i<=1075183036?1074977148===i?_n(t,i,e):t>0?(l=t-3*Fn,e[0]=l-Qn,e[1]=l-e[0]-Qn,3):(l=t+3*Fn,e[0]=l+Qn,e[1]=l-e[0]+Qn,-3):1075388923===i?_n(t,i,e):t>0?(l=t-4*Fn,e[0]=l-jn,e[1]=l-e[0]-jn,4):(l=t+4*Fn,e[0]=l+jn,e[1]=l-e[0]+jn,-4);if(i<1094263291)return _n(t,i,e);if(i>=2146435072)return e[0]=NaN,e[1]=NaN,0;for(s=yn(t),l=As(i-((n=(i>>20)-1046)<<20),s),r=0;r<2;r++)Un[r]=0|l,l=16777216*(l-Un[r]);for(Un[2]=l,o=3;0===Un[o-1];)o-=1;return a=zn(Un,Dn,n,o),t<0?(e[0]=-Dn[0],e[1]=-Dn[1],-a):(e[0]=Dn[0],e[1]=Dn[1],a)},Bn=On,An=[0,0];var $n=function(t){var e;if(e=ss(t),(e&=2147483647)<=1072243195)return e<1044381696?1:hn(t,0);if(e>=2146435072)return NaN;switch(3&Bn(t,An)){case 0:return hn(An[0],An[1]);case 1:return-mn(An[0],An[1]);case 2:return-hn(An[0],An[1]);default:return mn(An[0],An[1])}},qn=Math.ceil;var ti=function(t){return t<0?qn(t):gn(t)};var ei=function(t){return 0===t?.16666666666666602:.16666666666666602+t*(t*(6613756321437934e-20+t*(4.1381367970572385e-8*t-16533902205465252e-22))-.0027777777777015593)};var si=function(t,e,s){var n,i,o;return o=(n=t-e)-(i=n*n)*ei(i),Wn(1-(e-n*o/(2-o)-t),s)},ni=1.4426950408889634,ii=1/(1<<28);var oi=function(t){var e;return re(t)||t===ls?t:t===cs?0:t>709.782712893384?ls:t<-745.1332191019411?0:t>-3.725290298461914e-9&&t<ii?1+t:(e=ti(t<0?ni*t-.5:ni*t+.5),si(t-.6931471803691238*e,1.9082149292705877e-10*e,e))};var ri=function(t){return re(t)?t:(t<0&&(t=-t),t>21?oi(t)/2:(oi(t)+oi(-t))/2)};var ai=function(t){return 0===t?-.03333333333333313:t*(.0015873015872548146+t*(t*(4008217827329362e-21+-2.0109921818362437e-7*t)-793650757867488e-19))-.03333333333333313},li=.6931471803691238,ci=1.9082149292705877e-10,di=1.4426950408889634;var hi=function(t){var e,s,n,i,o,r,a,l,c,d,h,u;if(t===ls||re(t))return t;if(t===cs)return-1;if(0===t)return t;if(t<0?(s=!0,a=-t):(s=!1,a=t),a>=38.816242111356935){if(s)return-1;if(a>=709.782712893384)return ls}if(o=0|ss(a),a>.34657359027997264)a<1.0397207708399179?s?(n=t+li,i=-1.9082149292705877e-10,u=-1):(n=t-li,i=ci,u=1):(u=s?di*t-.5:di*t+.5,n=t-(d=u|=0)*li,i=d*ci),c=n-(t=n-i)-i;else{if(o<1016070144)return t;u=0}return h=(l=t*(e=.5*t))*(((r=1+l*ai(l))-(d=3-r*e))/(6-t*d)),0===u?t-(t*h-l):(h=t*(h-c)-c,h-=l,-1===u?.5*(t-h)-.5:1===u?t<-.25?-2*(h-(t+.5)):1+2*(t-h):u<=-2||u>56?(n=ss(a=1-(h-t))+(u<<20)|0,(a=as(a,n))-1):(d=1,u<20?a=(d=as(d,n=1072693248-(2097152>>u)|0))-(h-t):(a=t-(h+(d=as(d,n=ds-u<<20))),a+=1),n=ss(a)+(u<<20)|0,as(a,n)))},ui=!0===$e?0:1,mi=new Me(1),pi=new ke(mi.buffer);var fi=function(t,e){return mi[0]=t,pi[ui]=e>>>0,mi[0]},bi=fi;var yi=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var gi=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},wi=1048575;var Zi=function(t){var e,s,n,i,o,r,a,l,c,d;return n=ss(t),i=t-1,(wi&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=wi)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*yi(l),a=r*gi(l)+s,(c|=d)>0?o*((e=.5*i*i)+a)-e:o*(a-i))},vi=.4342944818781689;var Xi=function(t){var e,s,n,i,o,r,a;return re(t)||t<0?NaN:0===t?cs:(o=0,(s=ss(t))<1048576&&(o-=54,s=ss(t*=0x40000000000000)),s>=2146435072?t+t:(o+=(s>>20)-ds|0,t=as(t,(s&=1048575)|1072693248^(i=s+614244&1048576)),r=o+=i>>20,n=Zi(t),a=3694239077158931e-28*r+25082946711645275e-27*((t-=1)+n),(a+=(t-(e=bi(t,0))+n)*vi+e*vi)+.30102999566361177*r))};var xi=function(t){return 0===t?.3999999999940942:.3999999999940942+t*(.22222198432149784+.15313837699209373*t)};var Li=function(t){return 0===t?.6666666666666735:.6666666666666735+t*(.2857142874366239+t*(.1818357216161805+.14798198605116586*t))},Si=1048575;var Gi=function(t){var e,s,n,i,o,r,a,l,c,d;return n=ss(t),i=t-1,(Si&2+n)<3?0===i?0:i*i*(.3333333333333333*i-.5):(c=(n&=Si)-398458|0,d=440401-n|0,s=(l=(r=(o=i/(2+i))*o)*r)*xi(l),a=r*Li(l)+s,(c|=d)>0?o*((e=.5*i*i)+a)-e:o*(a-i))},Ti=1.4426950407214463,Wi=[0,0];var ki=function(t){var e,s,n,i,o;if(re(t)||t<0)return NaN;if(Js(Wi,t),o=0,(s=Wi[0])<1048576){if(!(2147483647&s|Wi[1]))return cs;o-=54,s=ss(t*=0x40000000000000)}return s>=2146435072?t+t:(o+=(s>>20)-ds|0,t=as(t,(s&=1048575)|1072693248^(i=s+614244&1048576)),o+=i>>20,n=Gi(t),1.6751713164886512e-10*((t-=1)+n)+(t-(e=bi(t,0))+n)*Ti+e*Ti+o)},Ci=[0,0];var Pi=function(t){var e;if(e=ss(t),(e&=2147483647)<=1072243195)return e<1045430272?t:mn(t,0);if(e>=2146435072)return NaN;switch(3&Bn(t,Ci)){case 0:return mn(Ci[0],Ci[1]);case 1:return hn(Ci[0],Ci[1]);case 2:return-mn(Ci[0],Ci[1]);default:return-hn(Ci[0],Ci[1])}};var Ri=function(t){var e,s;return 0===t?.16666666666666666:((t<0?-t:t)<=1?(e=t*(t*(-.789474443963537*t-163.72585752598383)-11561.443576500522)-351754.9648081514,s=t*(36157.827983443196+t*(1*t-277.7110814206028))-2110529.7888489086):(e=(t=1/t)*(t*(-351754.9648081514*t-11561.443576500522)-163.72585752598383)-.789474443963537,s=1+t*(t*(36157.827983443196+-2110529.7888489086*t)-277.7110814206028)),e/s)},Ii=709.782712893384,Vi=Ii+fs,Yi=Ii-fs;var Mi=function(t){var e;return 0===t?t:(e=wn(t),t>Vi||t<-709.089565712824?t>0?ls:cs:e>1?e>=Yi?(e=oi(.5*e),e*=.5*e,t<0&&(e=-e),e):(e=.5*(e=oi(e))-.5/e,t<0&&(e=-e),e):t+t*(e*=e)*Ri(e))};var Hi=function(t){return 0===t?.13333333333320124:.13333333333320124+t*(.021869488294859542+t*(.0035920791075913124+t*(.0005880412408202641+t*(7817944429395571e-20+-18558637485527546e-21*t))))};var Ki=function(t){return 0===t?.05396825397622605:.05396825397622605+t*(.0088632398235993+t*(.0014562094543252903+t*(.0002464631348184699+t*(7140724913826082e-20+2590730518636337e-20*t))))};var zi=function(t,e,s){var n,i,o,r,a,l,c,d,h;return(i=2147483647&(n=ss(t)))>=1072010280&&(t<0&&(t=-t,e=-e),t=(h=.7853981633974483-t)+(d=3061616997868383e-32-e),e=0),r=e+(h=t*t)*((a=h*t)*((r=Hi(d=h*h))+(c=h*Ki(d)))+e),d=t+(r+=.3333333333333341*a),i>=1072010280?(1-(n>>30&2))*((c=s)-2*(t-(d*d/(d+c)-r))):1===s?d:(bi(h=d,0),c=r-(h-t),bi(l=o=-1/d,0),l+o*((a=1+l*h)+l*c))},Ni=[0,0];var _i=function(t){var e,s;return e=ss(t),(e&=2147483647)<=1072243195?e<1044381696?t:zi(t,0,1):e>=2146435072?NaN:(s=Bn(t,Ni),zi(Ni[0],Ni[1],1-((1&s)<<1)))};var Fi=function(t){var e,s;return 0===t?-.3333333333333332:((t<0?-t:t)<=1?(e=t*(t*(0*t-.9643991794250523)-99.28772310019185)-1614.6876844170845,s=4844.063053251255+t*(2235.4883906010045+t*(112.81167849163293+1*t))):(e=0+(t=1/t)*(t*(-1614.6876844170845*t-99.28772310019185)-.9643991794250523),s=1+t*(112.81167849163293+t*(2235.4883906010045+4844.063053251255*t))),e/s)};var Ei=function(t){var e,s;if((s=wn(t))>44.014845965556525)return t<0?-1:1;if(s>=.625)s=1-2/((e=oi(2*s))+1),t<0&&(s=-s);else{if(0===t)return t;s=t+t*(e=t*t)*Fi(e)}return s};void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:ue,acosh:Xs,asin:he,asinh:Ss,atan:Cs,atanh:Vs,atan2:sn,cbrt:ln,cos:$n,cosh:ri,exp:oi,expm1:hi,log:vs,log1p:ps,log10:Xi,log2:ki,sin:Pi,sinh:Mi,tan:_i,tanh:Ei});const Ji=Math.pow;function Qi(t){return t===1/0||t===-1/0}var ji,Ui;globalThis.CroquetMath.pow=(t,e)=>{if(isNaN(t)||isNaN(e))return NaN;if(Qi(t)||Qi(e))return Ji(t,e);if(0===t||0===e)return Ji(t,e);if(t<0&&!function(t){return Number.isInteger(t)}(e))return NaN;if(1===e)return t;if(2===e)return t*t;if(3===e)return t*t*t;if(4===e)return t*t*t*t;let s=1;t<0&&(t*=-1,s=Ji(-1,e));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(t)*e)*s};var Di=function(){if(Ui)return ji;Ui=1;var t=function(t,e){return t<e};function e(s){if(!(this instanceof e))return new e(s);this.array=[],this.size=0,this.compare=s||t}return e.prototype.clone=function(){var t=new e(this.compare);return t.size=this.size,t.array=this.array.slice(0,this.size),t},e.prototype.add=function(t){var e,s,n=this.size;for(this.array[this.size]=t,this.size+=1;n>0&&(e=n-1>>1,s=this.array[e],this.compare(t,s));)this.array[n]=s,n=e;this.array[n]=t},e.prototype.heapify=function(t){var e;for(this.array=t,this.size=t.length,e=this.size>>1;e>=0;e--)this._percolateDown(e)},e.prototype._percolateUp=function(t,e){for(var s,n,i=this.array[t];t>0&&(s=t-1>>1,n=this.array[s],e||this.compare(i,n));)this.array[t]=n,t=s;this.array[t]=i},e.prototype._percolateDown=function(t){for(var e,s,n,i=this.size,o=this.size>>>1,r=this.array[t];t<o&&(s=(e=1+(t<<1))+1,n=this.array[e],s<i&&this.compare(this.array[s],n)&&(e=s,n=this.array[s]),this.compare(n,r));)this.array[t]=n,t=e;this.array[t]=r},e.prototype._removeAt=function(t){if(!(t>this.size-1||t<0))return this._percolateUp(t,!0),this.poll()},e.prototype.remove=function(t){for(var e=0;e<this.size;e++)if(!this.compare(this.array[e],t)&&!this.compare(t,this.array[e]))return this._removeAt(e),!0;return!1},e.prototype.removeOne=function(t){if("function"==typeof t)for(var e=0;e<this.size;e++)if(t(this.array[e]))return this._removeAt(e)},e.prototype.removeMany=function(t,e){if("function"!=typeof t||this.size<1)return[];e=e?Math.min(e,this.size):this.size;for(var s=0,n=new Array(e),i=0,o=new Array(this.size);s<e&&!this.isEmpty();){var r=this.poll();t(r)?n[s++]=r:o[i++]=r}n.length=s;for(var a=0;a<i;)this.add(o[a++]);return n},e.prototype.peek=function(){if(0!=this.size)return this.array[0]},e.prototype.poll=function(){if(0!=this.size){var t=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,t}},e.prototype.replaceTop=function(t){if(0!=this.size){var e=this.array[0];return this.array[0]=t,this._percolateDown(0),e}},e.prototype.trim=function(){this.array=this.array.slice(0,this.size)},e.prototype.isEmpty=function(){return 0===this.size},e.prototype.forEach=function(t){if(!this.isEmpty()&&"function"==typeof t)for(var e=0,s=this.clone();!s.isEmpty();)t(s.poll(),e++)},e.prototype.kSmallest=function(t){if(0==this.size||t<=0)return[];t=Math.min(this.size,t);const s=Math.min(this.size,2**(t-1)+1);if(s<2)return[this.peek()];const n=new e(this.compare);n.size=s,n.array=this.array.slice(0,s);const i=new Array(t);for(let e=0;e<t;e++)i[e]=n.poll();return i},ji=e}(),Oi=s(Di);class Bi extends Oi{poll(){const t=super.poll();return this.array[this.size]=null,t}asArray(){const t=[];return this.forEach((e=>t.push(e))),t}asUnsortedArray(){return this.array.slice(0,this.size)}}var Ai,$i={exports:{}};function qi(){return Ai||(Ai=1,function(t){var e;t.exports=(e=I(),function(){var t=e,s=t.lib.WordArray;function n(t,e,n){for(var i=[],o=0,r=0;r<e;r++)if(r%4){var a=n[t.charCodeAt(r-1)]<<r%4*2|n[t.charCodeAt(r)]>>>6-r%4*2;i[o>>>2]|=a<<24-o%4*8,o++}return s.create(i,o)}t.enc.Base64={stringify:function(t){var e=t.words,s=t.sigBytes,n=this._map;t.clamp();for(var i=[],o=0;o<s;o+=3)for(var r=(e[o>>>2]>>>24-o%4*8&255)<<16|(e[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|e[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<s;a++)i.push(n.charAt(r>>>6*(3-a)&63));var l=n.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(t){var e=t.length,s=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var o=0;o<s.length;o++)i[s.charCodeAt(o)]=o}var r=s.charAt(64);if(r){var a=t.indexOf(r);-1!==a&&(e=a)}return n(t,e,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)}($i)),$i.exports}var to,eo=s(qi()),so=I(),no={exports:{}};var io,oo=(to||(to=1,function(t){t.exports=I().enc.Utf8}(no)),no.exports),ro=s(oo),ao={exports:{}},lo={exports:{}};function co(){return io||(io=1,function(t){var e;t.exports=(e=I(),void function(){var t=e,s=t.lib.Base,n=t.enc.Utf8;t.algo.HMAC=s.extend({init:function(t,e){t=this._hasher=new t.init,"string"==typeof e&&(e=n.parse(e));var s=t.blockSize,i=4*s;e.sigBytes>i&&(e=t.finalize(e)),e.clamp();for(var o=this._oKey=e.clone(),r=this._iKey=e.clone(),a=o.words,l=r.words,c=0;c<s;c++)a[c]^=1549556828,l[c]^=909522486;o.sigBytes=r.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var e=this._hasher,s=e.finalize(t);return e.reset(),e.finalize(this._oKey.clone().concat(s))}})}())}(lo)),lo.exports}var ho;var uo,mo=(ho||(ho=1,function(t){var e;t.exports=(e=I(),z(),co(),function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.SHA256,a=o.HMAC,l=o.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:25e4}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var s=this.cfg,n=a.create(s.hasher,t),o=i.create(),r=i.create([1]),l=o.words,c=r.words,d=s.keySize,h=s.iterations;l.length<d;){var u=n.update(e).finalize(r);n.reset();for(var m=u.words,p=m.length,f=u,b=1;b<h;b++){f=n.finalize(f),n.reset();for(var y=f.words,g=0;g<p;g++)m[g]^=y[g]}o.concat(u),c[0]++}return o.sigBytes=4*d,o}});t.PBKDF2=function(t,e,s){return l.create(s).compute(t,e)}}(),e.PBKDF2)}(ao)),ao.exports),po=s(mo),fo={exports:{}},bo={exports:{}};function yo(){return uo||(uo=1,function(t){var e;t.exports=(e=I(),function(t){var s=e,n=s.lib,i=n.WordArray,o=n.Hasher,r=s.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=r.MD5=o.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var s=0;s<16;s++){var n=e+s,i=t[n];t[n]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var o=this._hash.words,r=t[e+0],l=t[e+1],m=t[e+2],p=t[e+3],f=t[e+4],b=t[e+5],y=t[e+6],g=t[e+7],w=t[e+8],Z=t[e+9],v=t[e+10],X=t[e+11],x=t[e+12],L=t[e+13],S=t[e+14],G=t[e+15],T=o[0],W=o[1],k=o[2],C=o[3];T=c(T,W,k,C,r,7,a[0]),C=c(C,T,W,k,l,12,a[1]),k=c(k,C,T,W,m,17,a[2]),W=c(W,k,C,T,p,22,a[3]),T=c(T,W,k,C,f,7,a[4]),C=c(C,T,W,k,b,12,a[5]),k=c(k,C,T,W,y,17,a[6]),W=c(W,k,C,T,g,22,a[7]),T=c(T,W,k,C,w,7,a[8]),C=c(C,T,W,k,Z,12,a[9]),k=c(k,C,T,W,v,17,a[10]),W=c(W,k,C,T,X,22,a[11]),T=c(T,W,k,C,x,7,a[12]),C=c(C,T,W,k,L,12,a[13]),k=c(k,C,T,W,S,17,a[14]),T=d(T,W=c(W,k,C,T,G,22,a[15]),k,C,l,5,a[16]),C=d(C,T,W,k,y,9,a[17]),k=d(k,C,T,W,X,14,a[18]),W=d(W,k,C,T,r,20,a[19]),T=d(T,W,k,C,b,5,a[20]),C=d(C,T,W,k,v,9,a[21]),k=d(k,C,T,W,G,14,a[22]),W=d(W,k,C,T,f,20,a[23]),T=d(T,W,k,C,Z,5,a[24]),C=d(C,T,W,k,S,9,a[25]),k=d(k,C,T,W,p,14,a[26]),W=d(W,k,C,T,w,20,a[27]),T=d(T,W,k,C,L,5,a[28]),C=d(C,T,W,k,m,9,a[29]),k=d(k,C,T,W,g,14,a[30]),T=h(T,W=d(W,k,C,T,x,20,a[31]),k,C,b,4,a[32]),C=h(C,T,W,k,w,11,a[33]),k=h(k,C,T,W,X,16,a[34]),W=h(W,k,C,T,S,23,a[35]),T=h(T,W,k,C,l,4,a[36]),C=h(C,T,W,k,f,11,a[37]),k=h(k,C,T,W,g,16,a[38]),W=h(W,k,C,T,v,23,a[39]),T=h(T,W,k,C,L,4,a[40]),C=h(C,T,W,k,r,11,a[41]),k=h(k,C,T,W,p,16,a[42]),W=h(W,k,C,T,y,23,a[43]),T=h(T,W,k,C,Z,4,a[44]),C=h(C,T,W,k,x,11,a[45]),k=h(k,C,T,W,G,16,a[46]),T=u(T,W=h(W,k,C,T,m,23,a[47]),k,C,r,6,a[48]),C=u(C,T,W,k,g,10,a[49]),k=u(k,C,T,W,S,15,a[50]),W=u(W,k,C,T,b,21,a[51]),T=u(T,W,k,C,x,6,a[52]),C=u(C,T,W,k,p,10,a[53]),k=u(k,C,T,W,v,15,a[54]),W=u(W,k,C,T,l,21,a[55]),T=u(T,W,k,C,w,6,a[56]),C=u(C,T,W,k,G,10,a[57]),k=u(k,C,T,W,y,15,a[58]),W=u(W,k,C,T,L,21,a[59]),T=u(T,W,k,C,f,6,a[60]),C=u(C,T,W,k,X,10,a[61]),k=u(k,C,T,W,m,15,a[62]),W=u(W,k,C,T,Z,21,a[63]),o[0]=o[0]+T|0,o[1]=o[1]+W|0,o[2]=o[2]+k|0,o[3]=o[3]+C|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,i=8*e.sigBytes;s[i>>>5]|=128<<24-i%32;var o=t.floor(n/4294967296),r=n;s[15+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),s[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),e.sigBytes=4*(s.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var t=o.clone.call(this);return t._hash=this._hash.clone(),t}});function c(t,e,s,n,i,o,r){var a=t+(e&s|~e&n)+i+r;return(a<<o|a>>>32-o)+e}function d(t,e,s,n,i,o,r){var a=t+(e&n|s&~n)+i+r;return(a<<o|a>>>32-o)+e}function h(t,e,s,n,i,o,r){var a=t+(e^s^n)+i+r;return(a<<o|a>>>32-o)+e}function u(t,e,s,n,i,o,r){var a=t+(s^(e|~n))+i+r;return(a<<o|a>>>32-o)+e}s.MD5=o._createHelper(l),s.HmacMD5=o._createHmacHelper(l)}(Math),e.MD5)}(bo)),bo.exports}var go,wo={exports:{}},Zo={exports:{}};function vo(){return go||(go=1,function(t){var e;t.exports=(e=I(),function(){var t=e,s=t.lib,n=s.WordArray,i=s.Hasher,o=t.algo,r=[],a=o.SHA1=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var s=this._hash.words,n=s[0],i=s[1],o=s[2],a=s[3],l=s[4],c=0;c<80;c++){if(c<16)r[c]=0|t[e+c];else{var d=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=d<<1|d>>>31}var h=(n<<5|n>>>27)+l+r[c];h+=c<20?1518500249+(i&o|~i&a):c<40?1859775393+(i^o^a):c<60?(i&o|i&a|o&a)-1894007588:(i^o^a)-899497514,l=a,a=o,o=i<<30|i>>>2,i=n,n=h}s[0]=s[0]+n|0,s[1]=s[1]+i|0,s[2]=s[2]+o|0,s[3]=s[3]+a|0,s[4]=s[4]+l|0},_doFinalize:function(){var t=this._data,e=t.words,s=8*this._nDataBytes,n=8*t.sigBytes;return e[n>>>5]|=128<<24-n%32,e[14+(n+64>>>9<<4)]=Math.floor(s/4294967296),e[15+(n+64>>>9<<4)]=s,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});t.SHA1=i._createHelper(a),t.HmacSHA1=i._createHmacHelper(a)}(),e.SHA1)}(Zo)),Zo.exports}var Xo;function xo(){return Xo||(Xo=1,function(t){var e;t.exports=(e=I(),vo(),co(),function(){var t=e,s=t.lib,n=s.Base,i=s.WordArray,o=t.algo,r=o.MD5,a=o.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:r,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var s,n=this.cfg,o=n.hasher.create(),r=i.create(),a=r.words,l=n.keySize,c=n.iterations;a.length<l;){s&&o.update(s),s=o.update(t).finalize(e),o.reset();for(var d=1;d<c;d++)s=o.finalize(s),o.reset();r.concat(s)}return r.sigBytes=4*l,r}});t.EvpKDF=function(t,e,s){return a.create(s).compute(t,e)}}(),e.EvpKDF)}(wo)),wo.exports}var Lo,So={exports:{}};var Go;var To,Wo=(Go||(Go=1,function(t){var e;t.exports=(e=I(),qi(),yo(),xo(),Lo||(Lo=1,function(t){var e;t.exports=(e=I(),xo(),void(e.lib.Cipher||function(t){var s=e,n=s.lib,i=n.Base,o=n.WordArray,r=n.BufferedBlockAlgorithm,a=s.enc;a.Utf8;var l=a.Base64,c=s.algo.EvpKDF,d=n.Cipher=r.extend({cfg:i.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,s){this.cfg=this.cfg.extend(s),this._xformMode=t,this._key=e,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function t(t){return"string"==typeof t?w:y}return function(e){return{encrypt:function(s,n,i){return t(n).encrypt(e,s,n,i)},decrypt:function(s,n,i){return t(n).decrypt(e,s,n,i)}}}}()});n.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=s.mode={},u=n.BlockCipherMode=i.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}}),m=h.CBC=function(){var e=u.extend();function s(e,s,n){var i,o=this._iv;o?(i=o,this._iv=t):i=this._prevBlock;for(var r=0;r<n;r++)e[s+r]^=i[r]}return e.Encryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize;s.call(this,t,e,i),n.encryptBlock(t,e),this._prevBlock=t.slice(e,e+i)}}),e.Decryptor=e.extend({processBlock:function(t,e){var n=this._cipher,i=n.blockSize,o=t.slice(e,e+i);n.decryptBlock(t,e),s.call(this,t,e,i),this._prevBlock=o}}),e}(),p=(s.pad={}).Pkcs7={pad:function(t,e){for(var s=4*e,n=s-t.sigBytes%s,i=n<<24|n<<16|n<<8|n,r=[],a=0;a<n;a+=4)r.push(i);var l=o.create(r,n);t.concat(l)},unpad:function(t){var e=255&t.words[t.sigBytes-1>>>2];t.sigBytes-=e}};n.BlockCipher=d.extend({cfg:d.cfg.extend({mode:m,padding:p}),reset:function(){var t;d.reset.call(this);var e=this.cfg,s=e.iv,n=e.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==t?this._mode.init(this,s&&s.words):(this._mode=t.call(n,this,s&&s.words),this._mode.__creator=t)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t,e=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(e.pad(this._data,this.blockSize),t=this._process(!0)):(t=this._process(!0),e.unpad(t)),t},blockSize:4});var f=n.CipherParams=i.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),b=(s.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext,s=t.salt;return(s?o.create([1398893684,1701076831]).concat(s).concat(e):e).toString(l)},parse:function(t){var e,s=l.parse(t),n=s.words;return 1398893684==n[0]&&1701076831==n[1]&&(e=o.create(n.slice(2,4)),n.splice(0,4),s.sigBytes-=16),f.create({ciphertext:s,salt:e})}},y=n.SerializableCipher=i.extend({cfg:i.extend({format:b}),encrypt:function(t,e,s,n){n=this.cfg.extend(n);var i=t.createEncryptor(s,n),o=i.finalize(e),r=i.cfg;return f.create({ciphertext:o,key:s,iv:r.iv,algorithm:t,mode:r.mode,padding:r.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,s,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(s,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),g=(s.kdf={}).OpenSSL={execute:function(t,e,s,n,i){if(n||(n=o.random(8)),i)r=c.create({keySize:e+s,hasher:i}).compute(t,n);else var r=c.create({keySize:e+s}).compute(t,n);var a=o.create(r.words.slice(e),4*s);return r.sigBytes=4*e,f.create({key:r,iv:a,salt:n})}},w=n.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(t,e,s,n){var i=(n=this.cfg.extend(n)).kdf.execute(s,t.keySize,t.ivSize,n.salt,n.hasher);n.iv=i.iv;var o=y.encrypt.call(this,t,e,i.key,n);return o.mixIn(i),o},decrypt:function(t,e,s,n){n=this.cfg.extend(n),e=this._parse(e,n.format);var i=n.kdf.execute(s,t.keySize,t.ivSize,e.salt,n.hasher);return n.iv=i.iv,y.decrypt.call(this,t,e,i.key,n)}})}()))}(So)),function(){var t=e,s=t.lib.BlockCipher,n=t.algo,i=[],o=[],r=[],a=[],l=[],c=[],d=[],h=[],u=[],m=[];!function(){for(var t=[],e=0;e<256;e++)t[e]=e<128?e<<1:e<<1^283;var s=0,n=0;for(e=0;e<256;e++){var p=n^n<<1^n<<2^n<<3^n<<4;p=p>>>8^255&p^99,i[s]=p,o[p]=s;var f=t[s],b=t[f],y=t[b],g=257*t[p]^16843008*p;r[s]=g<<24|g>>>8,a[s]=g<<16|g>>>16,l[s]=g<<8|g>>>24,c[s]=g,g=16843009*y^65537*b^257*f^16843008*s,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,m[p]=g,s?(s=f^t[t[t[y^f]]],n^=t[t[n]]):s=n=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],f=n.AES=s.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var t=this._keyPriorReset=this._key,e=t.words,s=t.sigBytes/4,n=4*((this._nRounds=s+6)+1),o=this._keySchedule=[],r=0;r<n;r++)r<s?o[r]=e[r]:(c=o[r-1],r%s?s>6&&r%s==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=p[r/s|0]<<24),o[r]=o[r-s]^c);for(var a=this._invKeySchedule=[],l=0;l<n;l++){if(r=n-l,l%4)var c=o[r];else c=o[r-4];a[l]=l<4||r<=4?c:d[i[c>>>24]]^h[i[c>>>16&255]]^u[i[c>>>8&255]]^m[i[255&c]]}}},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,r,a,l,c,i)},decryptBlock:function(t,e){var s=t[e+1];t[e+1]=t[e+3],t[e+3]=s,this._doCryptBlock(t,e,this._invKeySchedule,d,h,u,m,o),s=t[e+1],t[e+1]=t[e+3],t[e+3]=s},_doCryptBlock:function(t,e,s,n,i,o,r,a){for(var l=this._nRounds,c=t[e]^s[0],d=t[e+1]^s[1],h=t[e+2]^s[2],u=t[e+3]^s[3],m=4,p=1;p<l;p++){var f=n[c>>>24]^i[d>>>16&255]^o[h>>>8&255]^r[255&u]^s[m++],b=n[d>>>24]^i[h>>>16&255]^o[u>>>8&255]^r[255&c]^s[m++],y=n[h>>>24]^i[u>>>16&255]^o[c>>>8&255]^r[255&d]^s[m++],g=n[u>>>24]^i[c>>>16&255]^o[d>>>8&255]^r[255&h]^s[m++];c=f,d=b,h=y,u=g}f=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^s[m++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^s[m++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^s[m++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^s[m++],t[e]=f,t[e+1]=b,t[e+2]=y,t[e+3]=g},keySize:8});t.AES=s._createHelper(f)}(),e.AES)}(fo)),fo.exports),ko=s(Wo),Co={exports:{}};var Po=(To||(To=1,function(t){var e;t.exports=(e=I(),z(),co(),e.HmacSHA256)}(Co)),Co.exports),Ro=s(Po);function Io(t){let e=t.length;for(;--e>=0;)t[e]=0}const Vo=256,Yo=286,Mo=30,Ho=15,Ko=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zo=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),No=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),_o=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fo=new Array(576);Io(Fo);const Eo=new Array(60);Io(Eo);const Jo=new Array(512);Io(Jo);const Qo=new Array(256);Io(Qo);const jo=new Array(29);Io(jo);const Uo=new Array(Mo);function Do(t,e,s,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}let Oo,Bo,Ao;function $o(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}Io(Uo);const qo=t=>t<256?Jo[t]:Jo[256+(t>>>7)],tr=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},er=(t,e,s)=>{t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,tr(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)},sr=(t,e,s)=>{er(t,s[2*e],s[2*e+1])},nr=(t,e)=>{let s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1},ir=(t,e,s)=>{const n=new Array(16);let i,o,r=0;for(i=1;i<=Ho;i++)r=r+s[i-1]<<1,n[i]=r;for(o=0;o<=e;o++){let e=t[2*o+1];0!==e&&(t[2*o]=nr(n[e]++,e))}},or=t=>{let e;for(e=0;e<Yo;e++)t.dyn_ltree[2*e]=0;for(e=0;e<Mo;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},rr=t=>{t.bi_valid>8?tr(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},ar=(t,e,s,n)=>{const i=2*e,o=2*s;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[s]},lr=(t,e,s)=>{const n=t.heap[s];let i=s<<1;for(;i<=t.heap_len&&(i<t.heap_len&&ar(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!ar(e,n,t.heap[i],t.depth));)t.heap[s]=t.heap[i],s=i,i<<=1;t.heap[s]=n},cr=(t,e,s)=>{let n,i,o,r,a=0;if(0!==t.sym_next)do{n=255&t.pending_buf[t.sym_buf+a++],n+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],0===n?sr(t,i,e):(o=Qo[i],sr(t,o+Vo+1,e),r=Ko[o],0!==r&&(i-=jo[o],er(t,i,r)),n--,o=qo(n),sr(t,o,s),r=zo[o],0!==r&&(n-=Uo[o],er(t,n,r)))}while(a<t.sym_next);sr(t,256,e)},dr=(t,e)=>{const s=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,o=e.stat_desc.elems;let r,a,l,c=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<o;r++)0!==s[2*r]?(t.heap[++t.heap_len]=c=r,t.depth[r]=0):s[2*r+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,s[2*l]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=n[2*l+1]);for(e.max_code=c,r=t.heap_len>>1;r>=1;r--)lr(t,s,r);l=o;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],lr(t,s,1),a=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=a,s[2*l]=s[2*r]+s[2*a],t.depth[l]=(t.depth[r]>=t.depth[a]?t.depth[r]:t.depth[a])+1,s[2*r+1]=s[2*a+1]=l,t.heap[1]=l++,lr(t,s,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const s=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,o=e.stat_desc.has_stree,r=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,l=e.stat_desc.max_length;let c,d,h,u,m,p,f=0;for(u=0;u<=Ho;u++)t.bl_count[u]=0;for(s[2*t.heap[t.heap_max]+1]=0,c=t.heap_max+1;c<573;c++)d=t.heap[c],u=s[2*s[2*d+1]+1]+1,u>l&&(u=l,f++),s[2*d+1]=u,d>n||(t.bl_count[u]++,m=0,d>=a&&(m=r[d-a]),p=s[2*d],t.opt_len+=p*(u+m),o&&(t.static_len+=p*(i[2*d+1]+m)));if(0!==f){do{for(u=l-1;0===t.bl_count[u];)u--;t.bl_count[u]--,t.bl_count[u+1]+=2,t.bl_count[l]--,f-=2}while(f>0);for(u=l;0!==u;u--)for(d=t.bl_count[u];0!==d;)h=t.heap[--c],h>n||(s[2*h+1]!==u&&(t.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),d--)}})(t,e),ir(s,c,t.bl_count)},hr=(t,e,s)=>{let n,i,o=-1,r=e[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),e[2*(s+1)+1]=65535,n=0;n<=s;n++)i=r,r=e[2*(n+1)+1],++a<l&&i===r||(a<c?t.bl_tree[2*i]+=a:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4))},ur=(t,e,s)=>{let n,i,o=-1,r=e[1],a=0,l=7,c=4;for(0===r&&(l=138,c=3),n=0;n<=s;n++)if(i=r,r=e[2*(n+1)+1],!(++a<l&&i===r)){if(a<c)do{sr(t,i,t.bl_tree)}while(0!=--a);else 0!==i?(i!==o&&(sr(t,i,t.bl_tree),a--),sr(t,16,t.bl_tree),er(t,a-3,2)):a<=10?(sr(t,17,t.bl_tree),er(t,a-3,3)):(sr(t,18,t.bl_tree),er(t,a-11,7));a=0,o=i,0===r?(l=138,c=3):i===r?(l=6,c=3):(l=7,c=4)}};let mr=!1;const pr=(t,e,s,n)=>{er(t,0+(n?1:0),3),rr(t),tr(t,s),tr(t,~s),s&&t.pending_buf.set(t.window.subarray(e,e+s),t.pending),t.pending+=s};var fr=(t,e,s,n)=>{let i,o,r=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<Vo;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),dr(t,t.l_desc),dr(t,t.d_desc),r=(t=>{let e;for(hr(t,t.dyn_ltree,t.l_desc.max_code),hr(t,t.dyn_dtree,t.d_desc.max_code),dr(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*_o[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),i=t.opt_len+3+7>>>3,o=t.static_len+3+7>>>3,o<=i&&(i=o)):i=o=s+5,s+4<=i&&-1!==e?pr(t,e,s,n):4===t.strategy||o===i?(er(t,2+(n?1:0),3),cr(t,Fo,Eo)):(er(t,4+(n?1:0),3),((t,e,s,n)=>{let i;for(er(t,e-257,5),er(t,s-1,5),er(t,n-4,4),i=0;i<n;i++)er(t,t.bl_tree[2*_o[i]+1],3);ur(t,t.dyn_ltree,e-1),ur(t,t.dyn_dtree,s-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,r+1),cr(t,t.dyn_ltree,t.dyn_dtree)),or(t),n&&rr(t)},br={_tr_init:t=>{mr||((()=>{let t,e,s,n,i;const o=new Array(16);for(s=0,n=0;n<28;n++)for(jo[n]=s,t=0;t<1<<Ko[n];t++)Qo[s++]=n;for(Qo[s-1]=n,i=0,n=0;n<16;n++)for(Uo[n]=i,t=0;t<1<<zo[n];t++)Jo[i++]=n;for(i>>=7;n<Mo;n++)for(Uo[n]=i<<7,t=0;t<1<<zo[n]-7;t++)Jo[256+i++]=n;for(e=0;e<=Ho;e++)o[e]=0;for(t=0;t<=143;)Fo[2*t+1]=8,t++,o[8]++;for(;t<=255;)Fo[2*t+1]=9,t++,o[9]++;for(;t<=279;)Fo[2*t+1]=7,t++,o[7]++;for(;t<=287;)Fo[2*t+1]=8,t++,o[8]++;for(ir(Fo,287,o),t=0;t<Mo;t++)Eo[2*t+1]=5,Eo[2*t]=nr(t,5);Oo=new Do(Fo,Ko,257,Yo,Ho),Bo=new Do(Eo,zo,0,Mo,Ho),Ao=new Do(new Array(0),No,0,19,7)})(),mr=!0),t.l_desc=new $o(t.dyn_ltree,Oo),t.d_desc=new $o(t.dyn_dtree,Bo),t.bl_desc=new $o(t.bl_tree,Ao),t.bi_buf=0,t.bi_valid=0,or(t)},_tr_stored_block:pr,_tr_flush_block:fr,_tr_tally:(t,e,s)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=s,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(Qo[s]+Vo+1)]++,t.dyn_dtree[2*qo(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{er(t,2,3),sr(t,256,Fo),(t=>{16===t.bi_valid?(tr(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var yr=(t,e,s,n)=>{let i=65535&t,o=t>>>16&65535,r=0;for(;0!==s;){r=s>2e3?2e3:s,s-=r;do{i=i+e[n++]|0,o=o+i|0}while(--r);i%=65521,o%=65521}return i|o<<16};const gr=new Uint32Array((()=>{let t,e=[];for(var s=0;s<256;s++){t=s;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e})());var wr=(t,e,s,n)=>{const i=gr,o=n+s;t^=-1;for(let s=n;s<o;s++)t=t>>>8^i[255&(t^e[s])];return~t},Zr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},vr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Xr,_tr_stored_block:xr,_tr_flush_block:Lr,_tr_tally:Sr,_tr_align:Gr}=br,{Z_NO_FLUSH:Tr,Z_PARTIAL_FLUSH:Wr,Z_FULL_FLUSH:kr,Z_FINISH:Cr,Z_BLOCK:Pr,Z_OK:Rr,Z_STREAM_END:Ir,Z_STREAM_ERROR:Vr,Z_DATA_ERROR:Yr,Z_BUF_ERROR:Mr,Z_DEFAULT_COMPRESSION:Hr,Z_FILTERED:Kr,Z_HUFFMAN_ONLY:zr,Z_RLE:Nr,Z_FIXED:_r,Z_DEFAULT_STRATEGY:Fr,Z_UNKNOWN:Er,Z_DEFLATED:Jr}=vr,Qr=258,jr=262,Ur=42,Dr=113,Or=666,Br=(t,e)=>(t.msg=Zr[e],e),Ar=t=>2*t-(t>4?9:0),$r=t=>{let e=t.length;for(;--e>=0;)t[e]=0},qr=t=>{let e,s,n,i=t.w_size;e=t.hash_size,n=e;do{s=t.head[--n],t.head[n]=s>=i?s-i:0}while(--e);e=i,n=e;do{s=t.prev[--n],t.prev[n]=s>=i?s-i:0}while(--e)};let ta=(t,e,s)=>(e<<t.hash_shift^s)&t.hash_mask;const ea=t=>{const e=t.state;let s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+s),t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))},sa=(t,e)=>{Lr(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ea(t.strm)},na=(t,e)=>{t.pending_buf[t.pending++]=e},ia=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},oa=(t,e,s,n)=>{let i=t.avail_in;return i>n&&(i=n),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),s),1===t.state.wrap?t.adler=yr(t.adler,e,i,s):2===t.state.wrap&&(t.adler=wr(t.adler,e,i,s)),t.next_in+=i,t.total_in+=i,i)},ra=(t,e)=>{let s,n,i=t.max_chain_length,o=t.strstart,r=t.prev_length,a=t.nice_match;const l=t.strstart>t.w_size-jr?t.strstart-(t.w_size-jr):0,c=t.window,d=t.w_mask,h=t.prev,u=t.strstart+Qr;let m=c[o+r-1],p=c[o+r];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(s=e,c[s+r]===p&&c[s+r-1]===m&&c[s]===c[o]&&c[++s]===c[o+1]){o+=2,s++;do{}while(c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&c[++o]===c[++s]&&o<u);if(n=Qr-(u-o),o=u-Qr,n>r){if(t.match_start=e,r=n,n>=a)break;m=c[o+r-1],p=c[o+r]}}}while((e=h[e&d])>l&&0!=--i);return r<=t.lookahead?r:t.lookahead},aa=t=>{const e=t.w_size;let s,n,i;do{if(n=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-jr)&&(t.window.set(t.window.subarray(e,e+e-n),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),qr(t),n+=e),0===t.strm.avail_in)break;if(s=oa(t.strm,t.window,t.strstart+t.lookahead,n),t.lookahead+=s,t.lookahead+t.insert>=3)for(i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=ta(t,t.ins_h,t.window[i+1]);t.insert&&(t.ins_h=ta(t,t.ins_h,t.window[i+3-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<jr&&0!==t.strm.avail_in)},la=(t,e)=>{let s,n,i,o=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,r=0,a=t.strm.avail_in;do{if(s=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,n=t.strstart-t.block_start,s>n+t.strm.avail_in&&(s=n+t.strm.avail_in),s>i&&(s=i),s<o&&(0===s&&e!==Cr||e===Tr||s!==n+t.strm.avail_in))break;r=e===Cr&&s===n+t.strm.avail_in?1:0,xr(t,0,0,r),t.pending_buf[t.pending-4]=s,t.pending_buf[t.pending-3]=s>>8,t.pending_buf[t.pending-2]=~s,t.pending_buf[t.pending-1]=~s>>8,ea(t.strm),n&&(n>s&&(n=s),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+n),t.strm.next_out),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n,t.block_start+=n,s-=n),s&&(oa(t.strm,t.strm.output,t.strm.next_out,s),t.strm.next_out+=s,t.strm.avail_out-=s,t.strm.total_out+=s)}while(0===r);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),r?4:e!==Tr&&e!==Cr&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(oa(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,o=i>t.w_size?t.w_size:i,n=t.strstart-t.block_start,(n>=o||(n||e===Cr)&&e!==Tr&&0===t.strm.avail_in&&n<=i)&&(s=n>i?i:n,r=e===Cr&&0===t.strm.avail_in&&s===n?1:0,xr(t,t.block_start,s,r),t.block_start+=s,ea(t.strm)),r?3:1)},ca=(t,e)=>{let s,n;for(;;){if(t.lookahead<jr){if(aa(t),t.lookahead<jr&&e===Tr)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=ta(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-jr&&(t.match_length=ra(t,s)),t.match_length>=3)if(n=Sr(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=ta(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=ta(t,t.ins_h,t.window[t.strstart+1]);else n=Sr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(sa(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===Cr?(sa(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(sa(t,!1),0===t.strm.avail_out)?1:2},da=(t,e)=>{let s,n,i;for(;;){if(t.lookahead<jr){if(aa(t),t.lookahead<jr&&e===Tr)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=ta(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-jr&&(t.match_length=ra(t,s),t.match_length<=5&&(t.strategy===Kr||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,n=Sr(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=ta(t,t.ins_h,t.window[t.strstart+3-1]),s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,n&&(sa(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(n=Sr(t,0,t.window[t.strstart-1]),n&&sa(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=Sr(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===Cr?(sa(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(sa(t,!1),0===t.strm.avail_out)?1:2};function ha(t,e,s,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=n,this.func=i}const ua=[new ha(0,0,0,0,la),new ha(4,4,8,4,ca),new ha(4,5,16,8,ca),new ha(4,6,32,32,ca),new ha(4,4,16,16,da),new ha(8,16,32,32,da),new ha(8,16,128,128,da),new ha(8,32,128,256,da),new ha(32,128,258,1024,da),new ha(32,258,258,4096,da)];function ma(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Jr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),$r(this.dyn_ltree),$r(this.dyn_dtree),$r(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),$r(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),$r(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const pa=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Ur&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==Dr&&e.status!==Or?1:0},fa=t=>{if(pa(t))return Br(t,Vr);t.total_in=t.total_out=0,t.data_type=Er;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?Ur:Dr,t.adler=2===e.wrap?0:1,e.last_flush=-2,Xr(e),Rr},ba=t=>{const e=fa(t);var s;return e===Rr&&((s=t.state).window_size=2*s.w_size,$r(s.head),s.max_lazy_match=ua[s.level].max_lazy,s.good_match=ua[s.level].good_length,s.nice_match=ua[s.level].nice_length,s.max_chain_length=ua[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),e},ya=(t,e,s,n,i,o)=>{if(!t)return Vr;let r=1;if(e===Hr&&(e=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),i<1||i>9||s!==Jr||n<8||n>15||e<0||e>9||o<0||o>_r||8===n&&1!==r)return Br(t,Vr);8===n&&(n=9);const a=new ma;return t.state=a,a.strm=t,a.status=Ur,a.wrap=r,a.gzhead=null,a.w_bits=n,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=o,a.method=s,ba(t)};var ga={deflateInit:(t,e)=>ya(t,e,Jr,15,8,Fr),deflateInit2:ya,deflateReset:ba,deflateResetKeep:fa,deflateSetHeader:(t,e)=>pa(t)||2!==t.state.wrap?Vr:(t.state.gzhead=e,Rr),deflate:(t,e)=>{if(pa(t)||e>Pr||e<0)return t?Br(t,Vr):Vr;const s=t.state;if(!t.output||0!==t.avail_in&&!t.input||s.status===Or&&e!==Cr)return Br(t,0===t.avail_out?Mr:Vr);const n=s.last_flush;if(s.last_flush=e,0!==s.pending){if(ea(t),0===t.avail_out)return s.last_flush=-1,Rr}else if(0===t.avail_in&&Ar(e)<=Ar(n)&&e!==Cr)return Br(t,Mr);if(s.status===Or&&0!==t.avail_in)return Br(t,Mr);if(s.status===Ur&&0===s.wrap&&(s.status=Dr),s.status===Ur){let e=Jr+(s.w_bits-8<<4)<<8,n=-1;if(n=s.strategy>=zr||s.level<2?0:s.level<6?1:6===s.level?2:3,e|=n<<6,0!==s.strstart&&(e|=32),e+=31-e%31,ia(s,e),0!==s.strstart&&(ia(s,t.adler>>>16),ia(s,65535&t.adler)),t.adler=1,s.status=Dr,ea(t),0!==s.pending)return s.last_flush=-1,Rr}if(57===s.status)if(t.adler=0,na(s,31),na(s,139),na(s,8),s.gzhead)na(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),na(s,255&s.gzhead.time),na(s,s.gzhead.time>>8&255),na(s,s.gzhead.time>>16&255),na(s,s.gzhead.time>>24&255),na(s,9===s.level?2:s.strategy>=zr||s.level<2?4:0),na(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(na(s,255&s.gzhead.extra.length),na(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(t.adler=wr(t.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(na(s,0),na(s,0),na(s,0),na(s,0),na(s,0),na(s,9===s.level?2:s.strategy>=zr||s.level<2?4:0),na(s,3),s.status=Dr,ea(t),0!==s.pending)return s.last_flush=-1,Rr;if(69===s.status){if(s.gzhead.extra){let e=s.pending,n=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+n>s.pending_buf_size;){let i=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>e&&(t.adler=wr(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex+=i,ea(t),0!==s.pending)return s.last_flush=-1,Rr;e=0,n-=i}let i=new Uint8Array(s.gzhead.extra);s.pending_buf.set(i.subarray(s.gzindex,s.gzindex+n),s.pending),s.pending+=n,s.gzhead.hcrc&&s.pending>e&&(t.adler=wr(t.adler,s.pending_buf,s.pending-e,e)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let e,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(t.adler=wr(t.adler,s.pending_buf,s.pending-n,n)),ea(t),0!==s.pending)return s.last_flush=-1,Rr;n=0}e=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,na(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>n&&(t.adler=wr(t.adler,s.pending_buf,s.pending-n,n)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let e,n=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>n&&(t.adler=wr(t.adler,s.pending_buf,s.pending-n,n)),ea(t),0!==s.pending)return s.last_flush=-1,Rr;n=0}e=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,na(s,e)}while(0!==e);s.gzhead.hcrc&&s.pending>n&&(t.adler=wr(t.adler,s.pending_buf,s.pending-n,n))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(ea(t),0!==s.pending))return s.last_flush=-1,Rr;na(s,255&t.adler),na(s,t.adler>>8&255),t.adler=0}if(s.status=Dr,ea(t),0!==s.pending)return s.last_flush=-1,Rr}if(0!==t.avail_in||0!==s.lookahead||e!==Tr&&s.status!==Or){let n=0===s.level?la(s,e):s.strategy===zr?((t,e)=>{let s;for(;;){if(0===t.lookahead&&(aa(t),0===t.lookahead)){if(e===Tr)return 1;break}if(t.match_length=0,s=Sr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(sa(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Cr?(sa(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(sa(t,!1),0===t.strm.avail_out)?1:2})(s,e):s.strategy===Nr?((t,e)=>{let s,n,i,o;const r=t.window;for(;;){if(t.lookahead<=Qr){if(aa(t),t.lookahead<=Qr&&e===Tr)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=t.strstart-1,n=r[i],n===r[++i]&&n===r[++i]&&n===r[++i])){o=t.strstart+Qr;do{}while(n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&n===r[++i]&&i<o);t.match_length=Qr-(o-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=Sr(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=Sr(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(sa(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===Cr?(sa(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(sa(t,!1),0===t.strm.avail_out)?1:2})(s,e):ua[s.level].func(s,e);if(3!==n&&4!==n||(s.status=Or),1===n||3===n)return 0===t.avail_out&&(s.last_flush=-1),Rr;if(2===n&&(e===Wr?Gr(s):e!==Pr&&(xr(s,0,0,!1),e===kr&&($r(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),ea(t),0===t.avail_out))return s.last_flush=-1,Rr}return e!==Cr?Rr:s.wrap<=0?Ir:(2===s.wrap?(na(s,255&t.adler),na(s,t.adler>>8&255),na(s,t.adler>>16&255),na(s,t.adler>>24&255),na(s,255&t.total_in),na(s,t.total_in>>8&255),na(s,t.total_in>>16&255),na(s,t.total_in>>24&255)):(ia(s,t.adler>>>16),ia(s,65535&t.adler)),ea(t),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Rr:Ir)},deflateEnd:t=>{if(pa(t))return Vr;const e=t.state.status;return t.state=null,e===Dr?Br(t,Yr):Rr},deflateSetDictionary:(t,e)=>{let s=e.length;if(pa(t))return Vr;const n=t.state,i=n.wrap;if(2===i||1===i&&n.status!==Ur||n.lookahead)return Vr;if(1===i&&(t.adler=yr(t.adler,e,s,0)),n.wrap=0,s>=n.w_size){0===i&&($r(n.head),n.strstart=0,n.block_start=0,n.insert=0);let t=new Uint8Array(n.w_size);t.set(e.subarray(s-n.w_size,s),0),e=t,s=n.w_size}const o=t.avail_in,r=t.next_in,a=t.input;for(t.avail_in=s,t.next_in=0,t.input=e,aa(n);n.lookahead>=3;){let t=n.strstart,e=n.lookahead-2;do{n.ins_h=ta(n,n.ins_h,n.window[t+3-1]),n.prev[t&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=t,t++}while(--e);n.strstart=t,n.lookahead=2,aa(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,t.next_in=r,t.input=a,t.avail_in=o,n.wrap=i,Rr},deflateInfo:"pako deflate (from Nodeca project)"};const wa=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Za=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const e in s)wa(s,e)&&(t[e]=s[e])}}return t},va=t=>{let e=0;for(let s=0,n=t.length;s<n;s++)e+=t[s].length;const s=new Uint8Array(e);for(let e=0,n=0,i=t.length;e<i;e++){let i=t[e];s.set(i,n),n+=i.length}return s};let Xa=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Xa=!1}const xa=new Uint8Array(256);for(let t=0;t<256;t++)xa[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;xa[254]=xa[254]=1;var La=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,s,n,i,o,r=t.length,a=0;for(i=0;i<r;i++)s=t.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),a+=s<128?1:s<2048?2:s<65536?3:4;for(e=new Uint8Array(a),o=0,i=0;o<a;i++)s=t.charCodeAt(i),55296==(64512&s)&&i+1<r&&(n=t.charCodeAt(i+1),56320==(64512&n)&&(s=65536+(s-55296<<10)+(n-56320),i++)),s<128?e[o++]=s:s<2048?(e[o++]=192|s>>>6,e[o++]=128|63&s):s<65536?(e[o++]=224|s>>>12,e[o++]=128|s>>>6&63,e[o++]=128|63&s):(e[o++]=240|s>>>18,e[o++]=128|s>>>12&63,e[o++]=128|s>>>6&63,e[o++]=128|63&s);return e},Sa=(t,e)=>{const s=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let n,i;const o=new Array(2*s);for(i=0,n=0;n<s;){let e=t[n++];if(e<128){o[i++]=e;continue}let r=xa[e];if(r>4)o[i++]=65533,n+=r-1;else{for(e&=2===r?31:3===r?15:7;r>1&&n<s;)e=e<<6|63&t[n++],r--;r>1?o[i++]=65533:e<65536?o[i++]=e:(e-=65536,o[i++]=55296|e>>10&1023,o[i++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Xa)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let s="";for(let n=0;n<e;n++)s+=String.fromCharCode(t[n]);return s})(o,i)},Ga=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let s=e-1;for(;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+xa[t[s]]>e?s:e};var Ta=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Wa=Object.prototype.toString,{Z_NO_FLUSH:ka,Z_SYNC_FLUSH:Ca,Z_FULL_FLUSH:Pa,Z_FINISH:Ra,Z_OK:Ia,Z_STREAM_END:Va,Z_DEFAULT_COMPRESSION:Ya,Z_DEFAULT_STRATEGY:Ma,Z_DEFLATED:Ha}=vr;function Ka(t){this.options=Za({level:Ya,method:Ha,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ma},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ta,this.strm.avail_out=0;let s=ga.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(s!==Ia)throw new Error(Zr[s]);if(e.header&&ga.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?La(e.dictionary):"[object ArrayBuffer]"===Wa.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,s=ga.deflateSetDictionary(this.strm,t),s!==Ia)throw new Error(Zr[s]);this._dict_set=!0}}function za(t,e){const s=new Ka(e);if(s.push(t,!0),s.err)throw s.msg||Zr[s.err];return s.result}Ka.prototype.push=function(t,e){const s=this.strm,n=this.options.chunkSize;let i,o;if(this.ended)return!1;for(o=e===~~e?e:!0===e?Ra:ka,"string"==typeof t?s.input=La(t):"[object ArrayBuffer]"===Wa.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),(o===Ca||o===Pa)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=ga.deflate(s,o),i===Va)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=ga.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Ia;if(0!==s.avail_out){if(o>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Ka.prototype.onData=function(t){this.chunks.push(t)},Ka.prototype.onEnd=function(t){t===Ia&&(this.result=va(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Na={Deflate:Ka,deflate:za,deflateRaw:function(t,e){return(e=e||{}).raw=!0,za(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,za(t,e)}};const _a=16209;var Fa=function(t,e){let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,x,L,S;const G=t.state;s=t.next_in,L=t.input,n=s+(t.avail_in-5),i=t.next_out,S=t.output,o=i-(e-t.avail_out),r=i+(t.avail_out-257),a=G.dmax,l=G.wsize,c=G.whave,d=G.wnext,h=G.window,u=G.hold,m=G.bits,p=G.lencode,f=G.distcode,b=(1<<G.lenbits)-1,y=(1<<G.distbits)-1;t:do{m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=p[u&b];e:for(;;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,0===w)S[i++]=65535&g;else{if(!(16&w)){if(64&w){if(32&w){G.mode=16191;break t}t.msg="invalid literal/length code",G.mode=_a;break t}g=p[(65535&g)+(u&(1<<w)-1)];continue e}for(Z=65535&g,w&=15,w&&(m<w&&(u+=L[s++]<<m,m+=8),Z+=u&(1<<w)-1,u>>>=w,m-=w),m<15&&(u+=L[s++]<<m,m+=8,u+=L[s++]<<m,m+=8),g=f[u&y];;){if(w=g>>>24,u>>>=w,m-=w,w=g>>>16&255,16&w){if(v=65535&g,w&=15,m<w&&(u+=L[s++]<<m,m+=8,m<w&&(u+=L[s++]<<m,m+=8)),v+=u&(1<<w)-1,v>a){t.msg="invalid distance too far back",G.mode=_a;break t}if(u>>>=w,m-=w,w=i-o,v>w){if(w=v-w,w>c&&G.sane){t.msg="invalid distance too far back",G.mode=_a;break t}if(X=0,x=h,0===d){if(X+=l-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}}else if(d<w){if(X+=l+d-w,w-=d,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);if(X=0,d<Z){w=d,Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}}}else if(X+=d-w,w<Z){Z-=w;do{S[i++]=h[X++]}while(--w);X=i-v,x=S}for(;Z>2;)S[i++]=x[X++],S[i++]=x[X++],S[i++]=x[X++],Z-=3;Z&&(S[i++]=x[X++],Z>1&&(S[i++]=x[X++]))}else{X=i-v;do{S[i++]=S[X++],S[i++]=S[X++],S[i++]=S[X++],Z-=3}while(Z>2);Z&&(S[i++]=S[X++],Z>1&&(S[i++]=S[X++]))}break}if(64&w){t.msg="invalid distance code",G.mode=_a;break t}g=f[(65535&g)+(u&(1<<w)-1)]}}break}}while(s<n&&i<r);Z=m>>3,s-=Z,m-=Z<<3,u&=(1<<m)-1,t.next_in=s,t.next_out=i,t.avail_in=s<n?n-s+5:5-(s-n),t.avail_out=i<r?r-i+257:257-(i-r),G.hold=u,G.bits=m};const Ea=15,Ja=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Qa=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ja=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ua=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Da=(t,e,s,n,i,o,r,a)=>{const l=a.bits;let c,d,h,u,m,p,f=0,b=0,y=0,g=0,w=0,Z=0,v=0,X=0,x=0,L=0,S=null;const G=new Uint16Array(16),T=new Uint16Array(16);let W,k,C,P=null;for(f=0;f<=Ea;f++)G[f]=0;for(b=0;b<n;b++)G[e[s+b]]++;for(w=l,g=Ea;g>=1&&0===G[g];g--);if(w>g&&(w=g),0===g)return i[o++]=20971520,i[o++]=20971520,a.bits=1,0;for(y=1;y<g&&0===G[y];y++);for(w<y&&(w=y),X=1,f=1;f<=Ea;f++)if(X<<=1,X-=G[f],X<0)return-1;if(X>0&&(0===t||1!==g))return-1;for(T[1]=0,f=1;f<Ea;f++)T[f+1]=T[f]+G[f];for(b=0;b<n;b++)0!==e[s+b]&&(r[T[e[s+b]]++]=b);if(0===t?(S=P=r,p=20):1===t?(S=Ja,P=Qa,p=257):(S=ja,P=Ua,p=0),L=0,b=0,f=y,m=o,Z=w,v=0,h=-1,x=1<<w,u=x-1,1===t&&x>852||2===t&&x>592)return 1;for(;;){W=f-v,r[b]+1<p?(k=0,C=r[b]):r[b]>=p?(k=P[r[b]-p],C=S[r[b]-p]):(k=96,C=0),c=1<<f-v,d=1<<Z,y=d;do{d-=c,i[m+(L>>v)+d]=W<<24|k<<16|C}while(0!==d);for(c=1<<f-1;L&c;)c>>=1;if(0!==c?(L&=c-1,L+=c):L=0,b++,0==--G[f]){if(f===g)break;f=e[s+r[b]]}if(f>w&&(L&u)!==h){for(0===v&&(v=w),m+=y,Z=f-v,X=1<<Z;Z+v<g&&(X-=G[Z+v],!(X<=0));)Z++,X<<=1;if(x+=1<<Z,1===t&&x>852||2===t&&x>592)return 1;h=L&u,i[h]=w<<24|Z<<16|m-o}}return 0!==L&&(i[m+L]=f-v<<24|64<<16),a.bits=w,0};const{Z_FINISH:Oa,Z_BLOCK:Ba,Z_TREES:Aa,Z_OK:$a,Z_STREAM_END:qa,Z_NEED_DICT:tl,Z_STREAM_ERROR:el,Z_DATA_ERROR:sl,Z_MEM_ERROR:nl,Z_BUF_ERROR:il,Z_DEFLATED:ol}=vr,rl=16180,al=16190,ll=16191,cl=16192,dl=16194,hl=16199,ul=16200,ml=16206,pl=16209,fl=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function bl(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const yl=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<rl||e.mode>16211?1:0},gl=t=>{if(yl(t))return el;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=rl,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,$a},wl=t=>{if(yl(t))return el;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,gl(t)},Zl=(t,e)=>{let s;if(yl(t))return el;const n=t.state;return e<0?(s=0,e=-e):(s=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?el:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=s,n.wbits=e,wl(t))},vl=(t,e)=>{if(!t)return el;const s=new bl;t.state=s,s.strm=t,s.window=null,s.mode=rl;const n=Zl(t,e);return n!==$a&&(t.state=null),n};let Xl,xl,Ll=!0;const Sl=t=>{if(Ll){Xl=new Int32Array(512),xl=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Da(1,t.lens,0,288,Xl,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Da(2,t.lens,0,32,xl,0,t.work,{bits:5}),Ll=!1}t.lencode=Xl,t.lenbits=9,t.distcode=xl,t.distbits=5},Gl=(t,e,s,n)=>{let i;const o=t.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(e.subarray(s-o.wsize,s),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(e.subarray(s-n,s-n+i),o.wnext),(n-=i)?(o.window.set(e.subarray(s-n,s),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var Tl=(t,e)=>{let s,n,i,o,r,a,l,c,d,h,u,m,p,f,b,y,g,w,Z,v,X,x,L=0;const S=new Uint8Array(4);let G,T;const W=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(yl(t)||!t.output||!t.input&&0!==t.avail_in)return el;s=t.state,s.mode===ll&&(s.mode=cl),r=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=s.hold,d=s.bits,h=a,u=l,x=$a;t:for(;;)switch(s.mode){case rl:if(0===s.wrap){s.mode=cl;break}for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,S[0]=255&c,S[1]=c>>>8&255,s.check=wr(s.check,S,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){t.msg="incorrect header check",s.mode=pl;break}if((15&c)!==ol){t.msg="unknown compression method",s.mode=pl;break}if(c>>>=4,d-=4,X=8+(15&c),0===s.wbits&&(s.wbits=X),X>15||X>s.wbits){t.msg="invalid window size",s.mode=pl;break}s.dmax=1<<s.wbits,s.flags=0,t.adler=s.check=1,s.mode=512&c?16189:ll,c=0,d=0;break;case 16181:for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==ol){t.msg="unknown compression method",s.mode=pl;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=pl;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=wr(s.check,S,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,S[2]=c>>>16&255,S[3]=c>>>24&255,s.check=wr(s.check,S,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=wr(s.check,S,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(S[0]=255&c,S[1]=c>>>8&255,s.check=wr(s.check,S,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(m=s.length,m>a&&(m=a),m&&(s.head&&(X=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(n.subarray(o,o+m),X)),512&s.flags&&4&s.wrap&&(s.check=wr(s.check,n,m,o)),a-=m,o+=m,s.length-=m),s.length))break t;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===a)break t;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.name+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=wr(s.check,n,m,o)),a-=m,o+=m,X)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===a)break t;m=0;do{X=n[o+m++],s.head&&X&&s.length<65536&&(s.head.comment+=String.fromCharCode(X))}while(X&&m<a);if(512&s.flags&&4&s.wrap&&(s.check=wr(s.check,n,m,o)),a-=m,o+=m,X)break t}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){t.msg="header crc mismatch",s.mode=pl;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=ll;break;case 16189:for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}t.adler=s.check=fl(c),c=0,d=0,s.mode=al;case al:if(0===s.havedict)return t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,tl;t.adler=s.check=1,s.mode=ll;case ll:if(e===Ba||e===Aa)break t;case cl:if(s.last){c>>>=7&d,d-=7&d,s.mode=ml;break}for(;d<3;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(Sl(s),s.mode=hl,e===Aa){c>>>=2,d-=2;break t}break;case 2:s.mode=16196;break;case 3:t.msg="invalid block type",s.mode=pl}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){t.msg="invalid stored block lengths",s.mode=pl;break}if(s.length=65535&c,c=0,d=0,s.mode=dl,e===Aa)break t;case dl:s.mode=16195;case 16195:if(m=s.length,m){if(m>a&&(m=a),m>l&&(m=l),0===m)break t;i.set(n.subarray(o,o+m),r),a-=m,o+=m,l-=m,r+=m,s.length-=m;break}s.mode=ll;break;case 16196:for(;d<14;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=pl;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.lens[W[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[W[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,G={bits:s.lenbits},x=Da(0,s.lens,0,19,s.lencode,0,s.work,G),s.lenbits=G.bits,x){t.msg="invalid code lengths set",s.mode=pl;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;L=s.lencode[c&(1<<s.lenbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(g<16)c>>>=b,d-=b,s.lens[s.have++]=g;else{if(16===g){for(T=b+2;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(c>>>=b,d-=b,0===s.have){t.msg="invalid bit length repeat",s.mode=pl;break}X=s.lens[s.have-1],m=3+(3&c),c>>>=2,d-=2}else if(17===g){for(T=b+3;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=3+(7&c),c>>>=3,d-=3}else{for(T=b+7;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=b,d-=b,X=0,m=11+(127&c),c>>>=7,d-=7}if(s.have+m>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=pl;break}for(;m--;)s.lens[s.have++]=X}}if(s.mode===pl)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=pl;break}if(s.lenbits=9,G={bits:s.lenbits},x=Da(1,s.lens,0,s.nlen,s.lencode,0,s.work,G),s.lenbits=G.bits,x){t.msg="invalid literal/lengths set",s.mode=pl;break}if(s.distbits=6,s.distcode=s.distdyn,G={bits:s.distbits},x=Da(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,G),s.distbits=G.bits,x){t.msg="invalid distances set",s.mode=pl;break}if(s.mode=hl,e===Aa)break t;case hl:s.mode=ul;case ul:if(a>=6&&l>=258){t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,Fa(t,u),r=t.next_out,i=t.output,l=t.avail_out,o=t.next_in,n=t.input,a=t.avail_in,c=s.hold,d=s.bits,s.mode===ll&&(s.back=-1);break}for(s.back=0;L=s.lencode[c&(1<<s.lenbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(y&&!(240&y)){for(w=b,Z=y,v=g;L=s.lencode[v+((c&(1<<w+Z)-1)>>w)],b=L>>>24,y=L>>>16&255,g=65535&L,!(w+b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,s.length=g,0===y){s.mode=16205;break}if(32&y){s.back=-1,s.mode=ll;break}if(64&y){t.msg="invalid literal/length code",s.mode=pl;break}s.extra=15&y,s.mode=16201;case 16201:if(s.extra){for(T=s.extra;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;L=s.distcode[c&(1<<s.distbits)-1],b=L>>>24,y=L>>>16&255,g=65535&L,!(b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(!(240&y)){for(w=b,Z=y,v=g;L=s.distcode[v+((c&(1<<w+Z)-1)>>w)],b=L>>>24,y=L>>>16&255,g=65535&L,!(w+b<=d);){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}c>>>=w,d-=w,s.back+=w}if(c>>>=b,d-=b,s.back+=b,64&y){t.msg="invalid distance code",s.mode=pl;break}s.offset=g,s.extra=15&y,s.mode=16203;case 16203:if(s.extra){for(T=s.extra;d<T;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=pl;break}s.mode=16204;case 16204:if(0===l)break t;if(m=u-l,s.offset>m){if(m=s.offset-m,m>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=pl;break}m>s.wnext?(m-=s.wnext,p=s.wsize-m):p=s.wnext-m,m>s.length&&(m=s.length),f=s.window}else f=i,p=r-s.offset,m=s.length;m>l&&(m=l),l-=m,s.length-=m;do{i[r++]=f[p++]}while(--m);0===s.length&&(s.mode=ul);break;case 16205:if(0===l)break t;i[r++]=s.length,l--,s.mode=ul;break;case ml:if(s.wrap){for(;d<32;){if(0===a)break t;a--,c|=n[o++]<<d,d+=8}if(u-=l,t.total_out+=u,s.total+=u,4&s.wrap&&u&&(t.adler=s.check=s.flags?wr(s.check,i,u,r-u):yr(s.check,i,u,r-u)),u=l,4&s.wrap&&(s.flags?c:fl(c))!==s.check){t.msg="incorrect data check",s.mode=pl;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===a)break t;a--,c+=n[o++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=pl;break}c=0,d=0}s.mode=16208;case 16208:x=qa;break t;case pl:x=sl;break t;case 16210:return nl;default:return el}return t.next_out=r,t.avail_out=l,t.next_in=o,t.avail_in=a,s.hold=c,s.bits=d,(s.wsize||u!==t.avail_out&&s.mode<pl&&(s.mode<ml||e!==Oa))&&Gl(t,t.output,t.next_out,u-t.avail_out),h-=t.avail_in,u-=t.avail_out,t.total_in+=h,t.total_out+=u,s.total+=u,4&s.wrap&&u&&(t.adler=s.check=s.flags?wr(s.check,i,u,t.next_out-u):yr(s.check,i,u,t.next_out-u)),t.data_type=s.bits+(s.last?64:0)+(s.mode===ll?128:0)+(s.mode===hl||s.mode===dl?256:0),(0===h&&0===u||e===Oa)&&x===$a&&(x=il),x},Wl={inflateReset:wl,inflateReset2:Zl,inflateResetKeep:gl,inflateInit:t=>vl(t,15),inflateInit2:vl,inflate:Tl,inflateEnd:t=>{if(yl(t))return el;let e=t.state;return e.window&&(e.window=null),t.state=null,$a},inflateGetHeader:(t,e)=>{if(yl(t))return el;const s=t.state;return 2&s.wrap?(s.head=e,e.done=!1,$a):el},inflateSetDictionary:(t,e)=>{const s=e.length;let n,i,o;return yl(t)?el:(n=t.state,0!==n.wrap&&n.mode!==al?el:n.mode===al&&(i=1,i=yr(i,e,s,0),i!==n.check)?sl:(o=Gl(t,e,s,s),o?(n.mode=16210,nl):(n.havedict=1,$a)))},inflateInfo:"pako inflate (from Nodeca project)"};var kl=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Cl=Object.prototype.toString,{Z_NO_FLUSH:Pl,Z_FINISH:Rl,Z_OK:Il,Z_STREAM_END:Vl,Z_NEED_DICT:Yl,Z_STREAM_ERROR:Ml,Z_DATA_ERROR:Hl,Z_MEM_ERROR:Kl}=vr;function zl(t){this.options=Za({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ta,this.strm.avail_out=0;let s=Wl.inflateInit2(this.strm,e.windowBits);if(s!==Il)throw new Error(Zr[s]);if(this.header=new kl,Wl.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=La(e.dictionary):"[object ArrayBuffer]"===Cl.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=Wl.inflateSetDictionary(this.strm,e.dictionary),s!==Il)))throw new Error(Zr[s])}function Nl(t,e){const s=new zl(e);if(s.push(t),s.err)throw s.msg||Zr[s.err];return s.result}zl.prototype.push=function(t,e){const s=this.strm,n=this.options.chunkSize,i=this.options.dictionary;let o,r,a;if(this.ended)return!1;for(r=e===~~e?e:!0===e?Rl:Pl,"[object ArrayBuffer]"===Cl.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(n),s.next_out=0,s.avail_out=n),o=Wl.inflate(s,r),o===Yl&&i&&(o=Wl.inflateSetDictionary(s,i),o===Il?o=Wl.inflate(s,r):o===Hl&&(o=Yl));s.avail_in>0&&o===Vl&&s.state.wrap>0&&0!==t[s.next_in];)Wl.inflateReset(s),o=Wl.inflate(s,r);switch(o){case Ml:case Hl:case Yl:case Kl:return this.onEnd(o),this.ended=!0,!1}if(a=s.avail_out,s.next_out&&(0===s.avail_out||o===Vl))if("string"===this.options.to){let t=Ga(s.output,s.next_out),e=s.next_out-t,i=Sa(s.output,t);s.next_out=e,s.avail_out=n-e,e&&s.output.set(s.output.subarray(t,t+e),0),this.onData(i)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(o!==Il||0!==a){if(o===Vl)return o=Wl.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},zl.prototype.onData=function(t){this.chunks.push(t)},zl.prototype.onEnd=function(t){t===Il&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=va(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var _l={Inflate:zl,inflate:Nl,inflateRaw:function(t,e){return(e=e||{}).raw=!0,Nl(t,e)},ungzip:Nl};const{Deflate:Fl,deflate:El,deflateRaw:Jl,gzip:Ql}=Na,{Inflate:jl,inflate:Ul,inflateRaw:Dl,ungzip:Ol}=_l;var Bl={Deflate:Fl,deflate:El,deflateRaw:Jl,gzip:Ql,Inflate:jl,inflate:Ul,inflateRaw:Dl,ungzip:Ol,constants:vr};class Al{constructor(){this.url="(offline)",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout((()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()}),50),this.start=Date.now()}send(t){const{id:e,action:s,args:n}=JSON.parse(t);switch(s){case"JOIN":return this.id=e,this.ticks=n.ticks.tick,this.seq=-16>>>0,this.reply("SYNC",{messages:[],time:this.time,seq:this.seq,tove:n.tove,reflector:"offline"}),this.reply("RECV",[this.time,++this.seq,{what:"users",joined:[n.user],active:1,total:1}]),void this.tick();case"SEND":{const t=[...n];return t[0]=this.time,t[1]=++this.seq,void this.reply("RECV",t)}case"PULSE":return;default:throw Error("Offline unhandled "+s)}}close(t,e){this.readyState=WebSocket.CLOSING,setTimeout((()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:t,reason:e})}),50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval((()=>{this.reply("TICK",{time:this.time})}),this.ticks)}reply(t,e){setTimeout((()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:t,args:e})})}),50)}}const $l=!!globalThis.navigator?.userAgent.toLowerCase().includes("firefox");let ql={get connection(){return ql={connection:h.has("debug","connection",!1)},ql.connection}};class tc{static get name(){return`${Ot.libName}WebRTCConnection`}constructor(t){var e;this.clientId=(e=4,Math.random().toString(36).substring(2,2+e)),ql.connection&&console.log(`${this.clientId} WebRTCConnection created`),this.pc=null,this.dataChannel=null,this.signaling=null,this.connectionTypes={},this.onopen=null,this.onmessage=null,this.onerror=null,this.onclose=null,this.onconnected=null,this.twoStageConnection=!0,this.url="synchronizer",this.bufferedAmount=0,this.openConnection(t)}isConnecting(){return this.signaling?.readyState===WebSocket.OPEN}async openConnection(t){try{await this.openSignalingChannel(t),ql.connection&&console.log(`${this.clientId} signaling ready`),this.onopen&&this.onopen(),await this.createPeerConnection(),ql.connection&&console.log(`${this.clientId} peer connection created`),this.dataChannel=this.pc.createDataChannel(`client-${this.clientId}`),ql.connection&&console.log(`${this.clientId} data channel created`),this.dataChannel.onopen=t=>this.onDataChannelOpen(t),this.dataChannel.onmessage=t=>this.onDataChannelMessage(t),this.dataChannel.onclosing=t=>this.onDataChannelClosing(t),this.dataChannel.onclose=t=>this.onDataChannelClose(t),this.dataChannel.onerror=t=>this.onDataChannelError(t);const e=await this.pc.createOffer();if(this.signaling?.readyState!==WebSocket.OPEN)return;if(this.negotiationTimeout=setTimeout((()=>{delete this.negotiationTimeout,this.dataChannelFlowing?this.signalingCloseScheduled||(ql.connection&&console.log(`${this.clientId} ICE negotiation timed out but appears to have succeeded`),this.scheduleSignalingClose()):this.synchronizerDisconnected(4003,"ICE negotiation timed out")}),15e3),this.signalToSessionRunner({type:"offer",sdp:e.sdp}),await this.pc.setLocalDescription(e),!this.pc.sctp)return;const s=this.pc.sctp.transport.iceTransport;s.onselectedcandidatepairchange=t=>{ql.connection&&console.log(`${this.clientId} ICE candidate pair changed`);const e=s.getSelectedCandidatePair();this.connectionTypes.local=e.local.type,this.connectionTypes.remote=e.remote.type,this.logConnectionState()}}catch(t){this.synchronizerDisconnected(t.code||4003,t.message)}}openSignalingChannel(t){return this.signaling?(console.warn(`${this.clientId} signaling channel already open`),Promise.resolve()):(this.synchronizerGatheringComplete=!1,this.localGatheringComplete=!1,this.dataChannelFlowing=!1,this.signalingCloseScheduled=!1,this.signalingKey=Math.random(),new Promise((e=>{this.signaling=new WebSocket(t),this.signaling.onopen=()=>{ql.connection&&console.log(`${this.clientId} signaling socket opened`)},this.signaling.onmessage=t=>{const s=JSON.parse(t.data);if("READY"===s.what)return this.clientId+=`_${s.id}`,this.iceServers=s.iceServers,void e();if("ERROR"!==s.what)if(s.type)switch(ql.connection&&console.log(`${this.clientId} received signal of type "${s.type}"`),s.type){case"answer":this.handleAnswer(s);break;case"candidate":this.handleCandidate(s);break;case"gathering-complete":this.synchronizerGatheringComplete=!0;break;default:ql.connection&&console.log(`${this.clientId} unhandled: ${s.type}`)}else console.error(`${this.clientId} unexpected message: ${t.data}`);else console.error(`${this.clientId} registry error: ${s.reason}`)},this.signaling.onclose=t=>{ql.connection&&console.log(`${this.clientId} signaling socket closed unexpectedly (${t.code})`),this.synchronizerDisconnected(t.code,t.reason)},this.signaling.onerror=t=>{ql.connection&&console.log(`${this.clientId} signaling socket error`,t),this.synchronizerError()}})))}clearNegotiationTimeout(){this.negotiationTimeout&&(clearTimeout(this.negotiationTimeout),delete this.negotiationTimeout)}signalToSessionRunner(t){const e=JSON.stringify(t);try{this.signaling.send(e)}catch(t){console.error(`${this.clientId} WebRTC signaling send error`,t)}}async logConnectionState(){if($l&&this.pc)try{const t=await this.pc.getStats();if(t){let e=null;for(const s of t.values())if("transport"===s.type){e=s.selectedCandidatePairId;break}let s=t.get(e);if(!s)for(const e of t.values())if("candidate-pair"===e.type&&e.selected){s=e;break}s&&(this.connectionTypes.local=t.get(s.localCandidateId).candidateType,this.connectionTypes.remote=t.get(s.remoteCandidateId).candidateType)}}catch(t){}const t=this.connectionTypes.local||"",e=this.connectionTypes.remote||"";if(ql.connection&&console.log(`${this.clientId} RTCDataChannel connection state: "${this.dataChannel.readyState}" (client connection="${t}"; synchronizer connection="${e}")`),this.signaling?.readyState===WebSocket.OPEN){const s={type:"selectedCandidatePair",clientType:t,syncType:e};this.signalToSessionRunner(s)}}close(t,e){this.cleanUpConnection()}synchronizerDisconnected(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1006,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"connection to synchronizer lost";this.synchronizerCloseReason&&(t=this.synchronizerCloseReason[0],e=this.synchronizerCloseReason[1]),this.cleanUpConnection(),this.onclose&&this.onclose({code:t,reason:e})}synchronizerError(t){this.onerror&&this.onerror(),this.synchronizerDisconnected(void 0,t)}cleanUpConnection(){this.closeSignalingChannel();const{pc:t}=this;t&&(this.pc=null,t.close(),clearInterval(this.peerConnectionStatsInterval)),this.dataChannel=null}closeSignalingChannel(){this.clearNegotiationTimeout(),this.signaling&&(this.signaling.onclose=null,this.signaling.onerror=null,this.signaling.close(),this.signaling=null)}async createPeerConnection(){const{iceServers:t}=this,e=new Set,s=this.pc=new globalThis.RTCPeerConnection({iceServers:t});s.onnegotiationneeded=t=>{s===this.pc&&ql.connection&&console.log(`${this.clientId} negotiationneeded event fired`)},s.onsignalingstatechange=t=>{s===this.pc&&ql.connection&&console.log(`${this.clientId} signaling state: "${s.signalingState}"`)},s.onconnectionstatechange=t=>{if(s!==this.pc)return;const{connectionState:e,iceConnectionState:n}=s;ql.connection&&console.log(`${this.clientId} connection state: "${e}" (cf. ICE connection state: "${n}")`),"disconnected"!==e&&"failed"!==e||this.synchronizerDisconnected()},s.oniceconnectionstatechange=t=>{if(s!==this.pc)return;const e=s.iceConnectionState,n=this.dataChannel.readyState;ql.connection&&console.log(`${this.clientId} ICE connection state: "${e}"; data channel: "${n}"`),"failed"===e&&this.synchronizerDisconnected(4003,"ICE negotiation failed")},s.onicegatheringstatechange=t=>{if(s!==this.pc)return;const e=s.iceGatheringState;ql.connection&&console.log(`${this.clientId} ICE gathering state: "${e}"`),"complete"===e&&(this.localGatheringComplete=!0)},s.onicecandidate=t=>{if(s===this.pc)if(t.candidate){if(this.signaling?.readyState===WebSocket.OPEN){const e={type:"candidate",candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};this.signalToSessionRunner(e)}}else this.localGatheringComplete=!0},s.onicecandidateerror=t=>{if(s===this.pc&&ql.connection){const s=`${t.errorCode}|${t.url}`;e.has(s)||(701===t.errorCode?console.log(`${this.clientId} ICE 701 warning on ${t.url}`):console.log(`${this.clientId} ICE error from ${t.url}: ${t.errorCode} ${t.errorText}`),e.add(s))}}}async handleAnswer(t){this.pc?await this.pc.setRemoteDescription(t):console.error("no peerconnection")}async handleCandidate(t){this.pc?t.candidate?await this.pc.addIceCandidate(t):await this.pc.addIceCandidate(null):console.error("no peerconnection")}send(t){this.dataChannel?this.dataChannel.send(t):console.warn(`${this.clientId} no data channel to send: ${t}`)}onDataChannelOpen(t){ql.connection&&console.log(`${this.clientId} RTCDataChannel open`),this.onconnected&&this.onconnected(),this.logConnectionState()}onDataChannelMessage(t){if(!this.onmessage)return;this.dataChannelFlowing=!0,!this.signalingCloseScheduled&&this.synchronizerGatheringComplete&&this.localGatheringComplete&&(this.clearNegotiationTimeout(),this.scheduleSignalingClose());const e=t.data;if(e.startsWith("!ping"))this.send(e.replace("ping","pong"));else if(e.startsWith("!close")){const t=e.split("|");this.synchronizerCloseReason=[Number(t[1]),t[2]]}else this.onmessage(t)}onDataChannelError(t){console.error(`${this.clientId} RTCDataChannel error`,t),this.synchronizerError(t.errorDetail)}onDataChannelClosing(t){this.pc&&(ql.connection&&console.log(`${this.clientId} data channel closing`),this.synchronizerDisconnected())}onDataChannelClose(t){this.pc&&(ql.connection&&console.log(`${this.clientId} data channel closed`),this.synchronizerDisconnected())}scheduleSignalingClose(){this.signalingCloseScheduled=!0,ql.connection&&console.log(`${this.clientId} signaling channel closure scheduled`);const{signalingKey:t}=this;setTimeout((()=>{t===this.signalingKey&&(ql.connection&&console.log(`${this.clientId} closing signaling channel`),this.closeSignalingChannel())}),1e3)}async defunct_readConnectionType(){const t=await this.pc.getStats();if(t){let e=null;for(const[s,n]of t)if("transport"===n.type){e=n.selectedCandidatePairId;break}let s=t.get(e);if(!s)for(const[e,n]of t)if("candidate-pair"===n.type&&n.selected){s=n;break}if(s)for(const[e,n]of t)if(e===s.remoteCandidateId)return n.candidateType}return""}}function ec(t,e,s){var n=function(t){return atob(t)}(t),i=n.indexOf("\n",10)+1,o=n.substring(i)+"",r=new Blob([o],{type:"application/javascript"});return URL.createObjectURL(r)}function sc(t,e,s){var n;return function(e){return n=n||ec(t),new Worker(n,e)}}var nc=sc("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgTGFicyAyMDI1CiAqIEJ1bmRsZSBvZiBAY3JvcXVldC9jcm9xdWV0CiAqIERhdGU6IDIwMjUtMDYtMDUKICogVmVyc2lvbjogMi4wLjMKICovCgohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7dmFyIHQ9InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjp7fTtmdW5jdGlvbiBlKHQpe3JldHVybiB0JiZ0Ll9fZXNNb2R1bGUmJk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0LCJkZWZhdWx0Iik/dC5kZWZhdWx0OnR9ZnVuY3Rpb24gcih0KXtpZihPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCwiX19lc01vZHVsZSIpKXJldHVybiB0O3ZhciBlPXQuZGVmYXVsdDtpZigiZnVuY3Rpb24iPT10eXBlb2YgZSl7dmFyIHI9ZnVuY3Rpb24gdCgpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgdD9SZWZsZWN0LmNvbnN0cnVjdChlLGFyZ3VtZW50cyx0aGlzLmNvbnN0cnVjdG9yKTplLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07ci5wcm90b3R5cGU9ZS5wcm90b3R5cGV9ZWxzZSByPXt9O3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksT2JqZWN0LmtleXModCkuZm9yRWFjaCgoZnVuY3Rpb24oZSl7dmFyIG49T2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0LGUpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShyLGUsbi5nZXQ/bjp7ZW51bWVyYWJsZTohMCxnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdFtlXX19KX0pKSxyfXZhciBuLGk9e2V4cG9ydHM6e319O258fChuPTEsZnVuY3Rpb24odCl7dmFyIGU9ZnVuY3Rpb24odCl7dmFyIGUscj1PYmplY3QucHJvdG90eXBlLG49ci5oYXNPd25Qcm9wZXJ0eSxpPU9iamVjdC5kZWZpbmVQcm9wZXJ0eXx8ZnVuY3Rpb24odCxlLHIpe3RbZV09ci52YWx1ZX0sYT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxzPWEuaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixvPWEuYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIsbD1hLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gaCh0LGUscil7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KSx0W2VdfXRyeXtoKHt9LCIiKX1jYXRjaCh0KXtoPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdFtlXT1yfX1mdW5jdGlvbiBjKHQsZSxyLG4pe3ZhciBhPWUmJmUucHJvdG90eXBlIGluc3RhbmNlb2YgeT9lOnkscz1PYmplY3QuY3JlYXRlKGEucHJvdG90eXBlKSxvPW5ldyBMKG58fFtdKTtyZXR1cm4gaShzLCJfaW52b2tlIix7dmFsdWU6RSh0LHIsbyl9KSxzfWZ1bmN0aW9uIHUodCxlLHIpe3RyeXtyZXR1cm57dHlwZToibm9ybWFsIixhcmc6dC5jYWxsKGUscil9fWNhdGNoKHQpe3JldHVybnt0eXBlOiJ0aHJvdyIsYXJnOnR9fX10LndyYXA9Yzt2YXIgXz0ic3VzcGVuZGVkU3RhcnQiLGQ9InN1c3BlbmRlZFlpZWxkIixmPSJleGVjdXRpbmciLHA9ImNvbXBsZXRlZCIsZz17fTtmdW5jdGlvbiB5KCl7fWZ1bmN0aW9uIHcoKXt9ZnVuY3Rpb24gdigpe312YXIgbT17fTtoKG0scywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKTt2YXIgYj1PYmplY3QuZ2V0UHJvdG90eXBlT2YseD1iJiZiKGIoUihbXSkpKTt4JiZ4IT09ciYmbi5jYWxsKHgscykmJihtPXgpO3ZhciBrPXYucHJvdG90eXBlPXkucHJvdG90eXBlPU9iamVjdC5jcmVhdGUobSk7ZnVuY3Rpb24geih0KXtbIm5leHQiLCJ0aHJvdyIsInJldHVybiJdLmZvckVhY2goKGZ1bmN0aW9uKGUpe2godCxlLChmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faW52b2tlKGUsdCl9KSl9KSl9ZnVuY3Rpb24gQSh0LGUpe2Z1bmN0aW9uIHIoaSxhLHMsbyl7dmFyIGw9dSh0W2ldLHQsYSk7aWYoInRocm93IiE9PWwudHlwZSl7dmFyIGg9bC5hcmcsYz1oLnZhbHVlO3JldHVybiBjJiYib2JqZWN0Ij09dHlwZW9mIGMmJm4uY2FsbChjLCJfX2F3YWl0Iik/ZS5yZXNvbHZlKGMuX19hd2FpdCkudGhlbigoZnVuY3Rpb24odCl7cigibmV4dCIsdCxzLG8pfSksKGZ1bmN0aW9uKHQpe3IoInRocm93Iix0LHMsbyl9KSk6ZS5yZXNvbHZlKGMpLnRoZW4oKGZ1bmN0aW9uKHQpe2gudmFsdWU9dCxzKGgpfSksKGZ1bmN0aW9uKHQpe3JldHVybiByKCJ0aHJvdyIsdCxzLG8pfSkpfW8obC5hcmcpfXZhciBhO2kodGhpcywiX2ludm9rZSIse3ZhbHVlOmZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gaSgpe3JldHVybiBuZXcgZSgoZnVuY3Rpb24oZSxpKXtyKHQsbixlLGkpfSkpfXJldHVybiBhPWE/YS50aGVuKGksaSk6aSgpfX0pfWZ1bmN0aW9uIEUodCxyLG4pe3ZhciBpPV87cmV0dXJuIGZ1bmN0aW9uKGEscyl7aWYoaT09PWYpdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYoaT09PXApe2lmKCJ0aHJvdyI9PT1hKXRocm93IHM7cmV0dXJue3ZhbHVlOmUsZG9uZTohMH19Zm9yKG4ubWV0aG9kPWEsbi5hcmc9czs7KXt2YXIgbz1uLmRlbGVnYXRlO2lmKG8pe3ZhciBsPVMobyxuKTtpZihsKXtpZihsPT09Zyljb250aW51ZTtyZXR1cm4gbH19aWYoIm5leHQiPT09bi5tZXRob2Qpbi5zZW50PW4uX3NlbnQ9bi5hcmc7ZWxzZSBpZigidGhyb3ciPT09bi5tZXRob2Qpe2lmKGk9PT1fKXRocm93IGk9cCxuLmFyZztuLmRpc3BhdGNoRXhjZXB0aW9uKG4uYXJnKX1lbHNlInJldHVybiI9PT1uLm1ldGhvZCYmbi5hYnJ1cHQoInJldHVybiIsbi5hcmcpO2k9Zjt2YXIgaD11KHQscixuKTtpZigibm9ybWFsIj09PWgudHlwZSl7aWYoaT1uLmRvbmU/cDpkLGguYXJnPT09Zyljb250aW51ZTtyZXR1cm57dmFsdWU6aC5hcmcsZG9uZTpuLmRvbmV9fSJ0aHJvdyI9PT1oLnR5cGUmJihpPXAsbi5tZXRob2Q9InRocm93IixuLmFyZz1oLmFyZyl9fX1mdW5jdGlvbiBTKHQscil7dmFyIG49ci5tZXRob2QsaT10Lml0ZXJhdG9yW25dO2lmKGk9PT1lKXJldHVybiByLmRlbGVnYXRlPW51bGwsInRocm93Ij09PW4mJnQuaXRlcmF0b3IucmV0dXJuJiYoci5tZXRob2Q9InJldHVybiIsci5hcmc9ZSxTKHQsciksInRocm93Ij09PXIubWV0aG9kKXx8InJldHVybiIhPT1uJiYoci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciK24rIicgbWV0aG9kIikpLGc7dmFyIGE9dShpLHQuaXRlcmF0b3Isci5hcmcpO2lmKCJ0aHJvdyI9PT1hLnR5cGUpcmV0dXJuIHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9YS5hcmcsci5kZWxlZ2F0ZT1udWxsLGc7dmFyIHM9YS5hcmc7cmV0dXJuIHM/cy5kb25lPyhyW3QucmVzdWx0TmFtZV09cy52YWx1ZSxyLm5leHQ9dC5uZXh0TG9jLCJyZXR1cm4iIT09ci5tZXRob2QmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksci5kZWxlZ2F0ZT1udWxsLGcpOnM6KHIubWV0aG9kPSJ0aHJvdyIsci5hcmc9bmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSxyLmRlbGVnYXRlPW51bGwsZyl9ZnVuY3Rpb24gQih0KXt2YXIgZT17dHJ5TG9jOnRbMF19OzEgaW4gdCYmKGUuY2F0Y2hMb2M9dFsxXSksMiBpbiB0JiYoZS5maW5hbGx5TG9jPXRbMl0sZS5hZnRlckxvYz10WzNdKSx0aGlzLnRyeUVudHJpZXMucHVzaChlKX1mdW5jdGlvbiBPKHQpe3ZhciBlPXQuY29tcGxldGlvbnx8e307ZS50eXBlPSJub3JtYWwiLGRlbGV0ZSBlLmFyZyx0LmNvbXBsZXRpb249ZX1mdW5jdGlvbiBMKHQpe3RoaXMudHJ5RW50cmllcz1be3RyeUxvYzoicm9vdCJ9XSx0LmZvckVhY2goQix0aGlzKSx0aGlzLnJlc2V0KCEwKX1mdW5jdGlvbiBSKHQpe2lmKG51bGwhPXQpe3ZhciByPXRbc107aWYocilyZXR1cm4gci5jYWxsKHQpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB0Lm5leHQpcmV0dXJuIHQ7aWYoIWlzTmFOKHQubGVuZ3RoKSl7dmFyIGk9LTEsYT1mdW5jdGlvbiByKCl7Zm9yKDsrK2k8dC5sZW5ndGg7KWlmKG4uY2FsbCh0LGkpKXJldHVybiByLnZhbHVlPXRbaV0sci5kb25lPSExLHI7cmV0dXJuIHIudmFsdWU9ZSxyLmRvbmU9ITAscn07cmV0dXJuIGEubmV4dD1hfX10aHJvdyBuZXcgVHlwZUVycm9yKHR5cGVvZiB0KyIgaXMgbm90IGl0ZXJhYmxlIil9cmV0dXJuIHcucHJvdG90eXBlPXYsaShrLCJjb25zdHJ1Y3RvciIse3ZhbHVlOnYsY29uZmlndXJhYmxlOiEwfSksaSh2LCJjb25zdHJ1Y3RvciIse3ZhbHVlOncsY29uZmlndXJhYmxlOiEwfSksdy5kaXNwbGF5TmFtZT1oKHYsbCwiR2VuZXJhdG9yRnVuY3Rpb24iKSx0LmlzR2VuZXJhdG9yRnVuY3Rpb249ZnVuY3Rpb24odCl7dmFyIGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQuY29uc3RydWN0b3I7cmV0dXJuISFlJiYoZT09PXd8fCJHZW5lcmF0b3JGdW5jdGlvbiI9PT0oZS5kaXNwbGF5TmFtZXx8ZS5uYW1lKSl9LHQubWFyaz1mdW5jdGlvbih0KXtyZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0LHYpOih0Ll9fcHJvdG9fXz12LGgodCxsLCJHZW5lcmF0b3JGdW5jdGlvbiIpKSx0LnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKGspLHR9LHQuYXdyYXA9ZnVuY3Rpb24odCl7cmV0dXJue19fYXdhaXQ6dH19LHooQS5wcm90b3R5cGUpLGgoQS5wcm90b3R5cGUsbywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSx0LkFzeW5jSXRlcmF0b3I9QSx0LmFzeW5jPWZ1bmN0aW9uKGUscixuLGksYSl7dm9pZCAwPT09YSYmKGE9UHJvbWlzZSk7dmFyIHM9bmV3IEEoYyhlLHIsbixpKSxhKTtyZXR1cm4gdC5pc0dlbmVyYXRvckZ1bmN0aW9uKHIpP3M6cy5uZXh0KCkudGhlbigoZnVuY3Rpb24odCl7cmV0dXJuIHQuZG9uZT90LnZhbHVlOnMubmV4dCgpfSkpfSx6KGspLGgoayxsLCJHZW5lcmF0b3IiKSxoKGsscywoZnVuY3Rpb24oKXtyZXR1cm4gdGhpc30pKSxoKGssInRvU3RyaW5nIiwoZnVuY3Rpb24oKXtyZXR1cm4iW29iamVjdCBHZW5lcmF0b3JdIn0pKSx0LmtleXM9ZnVuY3Rpb24odCl7dmFyIGU9T2JqZWN0KHQpLHI9W107Zm9yKHZhciBuIGluIGUpci5wdXNoKG4pO3JldHVybiByLnJldmVyc2UoKSxmdW5jdGlvbiB0KCl7Zm9yKDtyLmxlbmd0aDspe3ZhciBuPXIucG9wKCk7aWYobiBpbiBlKXJldHVybiB0LnZhbHVlPW4sdC5kb25lPSExLHR9cmV0dXJuIHQuZG9uZT0hMCx0fX0sdC52YWx1ZXM9UixMLnByb3RvdHlwZT17Y29uc3RydWN0b3I6TCxyZXNldDpmdW5jdGlvbih0KXtpZih0aGlzLnByZXY9MCx0aGlzLm5leHQ9MCx0aGlzLnNlbnQ9dGhpcy5fc2VudD1lLHRoaXMuZG9uZT0hMSx0aGlzLmRlbGVnYXRlPW51bGwsdGhpcy5tZXRob2Q9Im5leHQiLHRoaXMuYXJnPWUsdGhpcy50cnlFbnRyaWVzLmZvckVhY2goTyksIXQpZm9yKHZhciByIGluIHRoaXMpInQiPT09ci5jaGFyQXQoMCkmJm4uY2FsbCh0aGlzLHIpJiYhaXNOYU4oK3Iuc2xpY2UoMSkpJiYodGhpc1tyXT1lKX0sc3RvcDpmdW5jdGlvbigpe3RoaXMuZG9uZT0hMDt2YXIgdD10aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZigidGhyb3ciPT09dC50eXBlKXRocm93IHQuYXJnO3JldHVybiB0aGlzLnJ2YWx9LGRpc3BhdGNoRXhjZXB0aW9uOmZ1bmN0aW9uKHQpe2lmKHRoaXMuZG9uZSl0aHJvdyB0O3ZhciByPXRoaXM7ZnVuY3Rpb24gaShuLGkpe3JldHVybiBvLnR5cGU9InRocm93IixvLmFyZz10LHIubmV4dD1uLGkmJihyLm1ldGhvZD0ibmV4dCIsci5hcmc9ZSksISFpfWZvcih2YXIgYT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7YT49MDstLWEpe3ZhciBzPXRoaXMudHJ5RW50cmllc1thXSxvPXMuY29tcGxldGlvbjtpZigicm9vdCI9PT1zLnRyeUxvYylyZXR1cm4gaSgiZW5kIik7aWYocy50cnlMb2M8PXRoaXMucHJldil7dmFyIGw9bi5jYWxsKHMsImNhdGNoTG9jIiksaD1uLmNhbGwocywiZmluYWxseUxvYyIpO2lmKGwmJmgpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX1lbHNlIGlmKGwpe2lmKHRoaXMucHJldjxzLmNhdGNoTG9jKXJldHVybiBpKHMuY2F0Y2hMb2MsITApfWVsc2V7aWYoIWgpdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmKHRoaXMucHJldjxzLmZpbmFsbHlMb2MpcmV0dXJuIGkocy5maW5hbGx5TG9jKX19fX0sYWJydXB0OmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtyPj0wOy0tcil7dmFyIGk9dGhpcy50cnlFbnRyaWVzW3JdO2lmKGkudHJ5TG9jPD10aGlzLnByZXYmJm4uY2FsbChpLCJmaW5hbGx5TG9jIikmJnRoaXMucHJldjxpLmZpbmFsbHlMb2Mpe3ZhciBhPWk7YnJlYWt9fWEmJigiYnJlYWsiPT09dHx8ImNvbnRpbnVlIj09PXQpJiZhLnRyeUxvYzw9ZSYmZTw9YS5maW5hbGx5TG9jJiYoYT1udWxsKTt2YXIgcz1hP2EuY29tcGxldGlvbjp7fTtyZXR1cm4gcy50eXBlPXQscy5hcmc9ZSxhPyh0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5uZXh0PWEuZmluYWxseUxvYyxnKTp0aGlzLmNvbXBsZXRlKHMpfSxjb21wbGV0ZTpmdW5jdGlvbih0LGUpe2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuImJyZWFrIj09PXQudHlwZXx8ImNvbnRpbnVlIj09PXQudHlwZT90aGlzLm5leHQ9dC5hcmc6InJldHVybiI9PT10LnR5cGU/KHRoaXMucnZhbD10aGlzLmFyZz10LmFyZyx0aGlzLm1ldGhvZD0icmV0dXJuIix0aGlzLm5leHQ9ImVuZCIpOiJub3JtYWwiPT09dC50eXBlJiZlJiYodGhpcy5uZXh0PWUpLGd9LGZpbmlzaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci5maW5hbGx5TG9jPT09dClyZXR1cm4gdGhpcy5jb21wbGV0ZShyLmNvbXBsZXRpb24sci5hZnRlckxvYyksTyhyKSxnfX0sY2F0Y2g6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtlPj0wOy0tZSl7dmFyIHI9dGhpcy50cnlFbnRyaWVzW2VdO2lmKHIudHJ5TG9jPT09dCl7dmFyIG49ci5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT1uLnR5cGUpe3ZhciBpPW4uYXJnO08ocil9cmV0dXJuIGl9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iil9LGRlbGVnYXRlWWllbGQ6ZnVuY3Rpb24odCxyLG4pe3JldHVybiB0aGlzLmRlbGVnYXRlPXtpdGVyYXRvcjpSKHQpLHJlc3VsdE5hbWU6cixuZXh0TG9jOm59LCJuZXh0Ij09PXRoaXMubWV0aG9kJiYodGhpcy5hcmc9ZSksZ319LHR9KHQuZXhwb3J0cyk7dHJ5e2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWV9Y2F0Y2godCl7Im9iamVjdCI9PXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXMucmVnZW5lcmF0b3JSdW50aW1lPWU6RnVuY3Rpb24oInIiLCJyZWdlbmVyYXRvclJ1bnRpbWUgPSByIikoZSl9fShpKSk7dmFyIGEscz17ZXhwb3J0czp7fX07dmFyIG89KGF8fChhPTEsZnVuY3Rpb24odCl7Y29uc3QgZT00LHI9MCxuPTEsaT0yO2Z1bmN0aW9uIGEodCl7bGV0IGU9dC5sZW5ndGg7Zm9yKDstLWU+PTA7KXRbZV09MH1jb25zdCBzPTAsbz0xLGw9MixoPTMsYz0yNTgsdT0yOSxfPTI1NixkPV8rMSt1LGY9MzAscD0xOSxnPTIqZCsxLHk9MTUsdz0xNix2PTcsbT0yNTYsYj0xNix4PTE3LGs9MTgsej1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDEsMSwxLDEsMiwyLDIsMiwzLDMsMywzLDQsNCw0LDQsNSw1LDUsNSwwXSksQT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwxLDEsMiwyLDMsMyw0LDQsNSw1LDYsNiw3LDcsOCw4LDksOSwxMCwxMCwxMSwxMSwxMiwxMiwxMywxM10pLEU9bmV3IFVpbnQ4QXJyYXkoWzAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMiwzLDddKSxTPW5ldyBVaW50OEFycmF5KFsxNiwxNywxOCwwLDgsNyw5LDYsMTAsNSwxMSw0LDEyLDMsMTMsMiwxNCwxLDE1XSksQj01MTIsTz1uZXcgQXJyYXkoMiooZCsyKSk7YShPKTtjb25zdCBMPW5ldyBBcnJheSgyKmYpO2EoTCk7Y29uc3QgUj1uZXcgQXJyYXkoQik7YShSKTtjb25zdCBEPW5ldyBBcnJheShjLWgrMSk7YShEKTtjb25zdCBVPW5ldyBBcnJheSh1KTthKFUpO2NvbnN0IEM9bmV3IEFycmF5KGYpO2Z1bmN0aW9uIFQodCxlLHIsbixpKXt0aGlzLnN0YXRpY190cmVlPXQsdGhpcy5leHRyYV9iaXRzPWUsdGhpcy5leHRyYV9iYXNlPXIsdGhpcy5lbGVtcz1uLHRoaXMubWF4X2xlbmd0aD1pLHRoaXMuaGFzX3N0cmVlPXQmJnQubGVuZ3RofWxldCBGLEgsWjtmdW5jdGlvbiBNKHQsZSl7dGhpcy5keW5fdHJlZT10LHRoaXMubWF4X2NvZGU9MCx0aGlzLnN0YXRfZGVzYz1lfWEoQyk7Y29uc3QgTj10PT50PDI1Nj9SW3RdOlJbMjU2Kyh0Pj4+NyldLEk9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTV9LGo9KHQsZSxyKT0+e3QuYmlfdmFsaWQ+dy1yPyh0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSxJKHQsdC5iaV9idWYpLHQuYmlfYnVmPWU+PnctdC5iaV92YWxpZCx0LmJpX3ZhbGlkKz1yLXcpOih0LmJpX2J1Znw9ZTw8dC5iaV92YWxpZCY2NTUzNSx0LmJpX3ZhbGlkKz1yKX0sUD0odCxlLHIpPT57aih0LHJbMiplXSxyWzIqZSsxXSl9LCQ9KHQsZSk9PntsZXQgcj0wO2Rve3J8PTEmdCx0Pj4+PTEscjw8PTF9d2hpbGUoLS1lPjApO3JldHVybiByPj4+MX0sSz10PT57MTY9PT10LmJpX3ZhbGlkPyhJKHQsdC5iaV9idWYpLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wKTp0LmJpX3ZhbGlkPj04JiYodC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JnQuYmlfYnVmLHQuYmlfYnVmPj49OCx0LmJpX3ZhbGlkLT04KX0sWD0odCxlKT0+e2NvbnN0IHI9ZS5keW5fdHJlZSxuPWUubWF4X2NvZGUsaT1lLnN0YXRfZGVzYy5zdGF0aWNfdHJlZSxhPWUuc3RhdF9kZXNjLmhhc19zdHJlZSxzPWUuc3RhdF9kZXNjLmV4dHJhX2JpdHMsbz1lLnN0YXRfZGVzYy5leHRyYV9iYXNlLGw9ZS5zdGF0X2Rlc2MubWF4X2xlbmd0aDtsZXQgaCxjLHUsXyxkLGYscD0wO2ZvcihfPTA7Xzw9eTtfKyspdC5ibF9jb3VudFtfXT0wO2ZvcihyWzIqdC5oZWFwW3QuaGVhcF9tYXhdKzFdPTAsaD10LmhlYXBfbWF4KzE7aDxnO2grKyljPXQuaGVhcFtoXSxfPXJbMipyWzIqYysxXSsxXSsxLF8+bCYmKF89bCxwKyspLHJbMipjKzFdPV8sYz5ufHwodC5ibF9jb3VudFtfXSsrLGQ9MCxjPj1vJiYoZD1zW2Mtb10pLGY9clsyKmNdLHQub3B0X2xlbis9ZiooXytkKSxhJiYodC5zdGF0aWNfbGVuKz1mKihpWzIqYysxXStkKSkpO2lmKDAhPT1wKXtkb3tmb3IoXz1sLTE7MD09PXQuYmxfY291bnRbX107KV8tLTt0LmJsX2NvdW50W19dLS0sdC5ibF9jb3VudFtfKzFdKz0yLHQuYmxfY291bnRbbF0tLSxwLT0yfXdoaWxlKHA+MCk7Zm9yKF89bDswIT09XztfLS0pZm9yKGM9dC5ibF9jb3VudFtfXTswIT09YzspdT10LmhlYXBbLS1oXSx1Pm58fChyWzIqdSsxXSE9PV8mJih0Lm9wdF9sZW4rPShfLXJbMip1KzFdKSpyWzIqdV0sclsyKnUrMV09XyksYy0tKX19LEc9KHQsZSxyKT0+e2NvbnN0IG49bmV3IEFycmF5KHkrMSk7bGV0IGksYSxzPTA7Zm9yKGk9MTtpPD15O2krKylzPXMrcltpLTFdPDwxLG5baV09cztmb3IoYT0wO2E8PWU7YSsrKXtsZXQgZT10WzIqYSsxXTswIT09ZSYmKHRbMiphXT0kKG5bZV0rKyxlKSl9fSxXPSgpPT57bGV0IHQsZSxyLG4saTtjb25zdCBhPW5ldyBBcnJheSh5KzEpO2ZvcihyPTAsbj0wO248dS0xO24rKylmb3IoVVtuXT1yLHQ9MDt0PDE8PHpbbl07dCsrKURbcisrXT1uO2ZvcihEW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihDW25dPWksdD0wO3Q8MTw8QVtuXTt0KyspUltpKytdPW47Zm9yKGk+Pj03O248ZjtuKyspZm9yKENbbl09aTw8Nyx0PTA7dDwxPDxBW25dLTc7dCsrKVJbMjU2K2krK109bjtmb3IoZT0wO2U8PXk7ZSsrKWFbZV09MDtmb3IodD0wO3Q8PTE0MzspT1syKnQrMV09OCx0KyssYVs4XSsrO2Zvcig7dDw9MjU1OylPWzIqdCsxXT05LHQrKyxhWzldKys7Zm9yKDt0PD0yNzk7KU9bMip0KzFdPTcsdCsrLGFbN10rKztmb3IoO3Q8PTI4NzspT1syKnQrMV09OCx0KyssYVs4XSsrO2ZvcihHKE8sZCsxLGEpLHQ9MDt0PGY7dCsrKUxbMip0KzFdPTUsTFsyKnRdPSQodCw1KTtGPW5ldyBUKE8seixfKzEsZCx5KSxIPW5ldyBUKEwsQSwwLGYseSksWj1uZXcgVChuZXcgQXJyYXkoMCksRSwwLHAsdil9LFk9dD0+e2xldCBlO2ZvcihlPTA7ZTxkO2UrKyl0LmR5bl9sdHJlZVsyKmVdPTA7Zm9yKGU9MDtlPGY7ZSsrKXQuZHluX2R0cmVlWzIqZV09MDtmb3IoZT0wO2U8cDtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVsyKm1dPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQuc3ltX25leHQ9dC5tYXRjaGVzPTB9LHE9dD0+e3QuYmlfdmFsaWQ+OD9JKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH0sVj0odCxlLHIsbik9Pntjb25zdCBpPTIqZSxhPTIqcjtyZXR1cm4gdFtpXTx0W2FdfHx0W2ldPT09dFthXSYmbltlXTw9bltyXX0sUT0odCxlLHIpPT57Y29uc3Qgbj10LmhlYXBbcl07bGV0IGk9cjw8MTtmb3IoO2k8PXQuaGVhcF9sZW4mJihpPHQuaGVhcF9sZW4mJlYoZSx0LmhlYXBbaSsxXSx0LmhlYXBbaV0sdC5kZXB0aCkmJmkrKywhVihlLG4sdC5oZWFwW2ldLHQuZGVwdGgpKTspdC5oZWFwW3JdPXQuaGVhcFtpXSxyPWksaTw8PTE7dC5oZWFwW3JdPW59LEo9KHQsZSxyKT0+e2xldCBuLGksYSxzLG89MDtpZigwIT09dC5zeW1fbmV4dClkb3tuPTI1NSZ0LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLG4rPSgyNTUmdC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrbysrXSk8PDgsaT10LnBlbmRpbmdfYnVmW3Quc3ltX2J1ZitvKytdLDA9PT1uP1AodCxpLGUpOihhPURbaV0sUCh0LGErXysxLGUpLHM9elthXSwwIT09cyYmKGktPVVbYV0saih0LGkscykpLG4tLSxhPU4obiksUCh0LGEscikscz1BW2FdLDAhPT1zJiYobi09Q1thXSxqKHQsbixzKSkpfXdoaWxlKG88dC5zeW1fbmV4dCk7UCh0LG0sZSl9LHR0PSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsaT1lLnN0YXRfZGVzYy5oYXNfc3RyZWUsYT1lLnN0YXRfZGVzYy5lbGVtcztsZXQgcyxvLGwsaD0tMTtmb3IodC5oZWFwX2xlbj0wLHQuaGVhcF9tYXg9ZyxzPTA7czxhO3MrKykwIT09clsyKnNdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT1oPXMsdC5kZXB0aFtzXT0wKTpyWzIqcysxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOylsPXQuaGVhcFsrK3QuaGVhcF9sZW5dPWg8Mj8rK2g6MCxyWzIqbF09MSx0LmRlcHRoW2xdPTAsdC5vcHRfbGVuLS0saSYmKHQuc3RhdGljX2xlbi09blsyKmwrMV0pO2ZvcihlLm1heF9jb2RlPWgscz10LmhlYXBfbGVuPj4xO3M+PTE7cy0tKVEodCxyLHMpO2w9YTtkb3tzPXQuaGVhcFsxXSx0LmhlYXBbMV09dC5oZWFwW3QuaGVhcF9sZW4tLV0sUSh0LHIsMSksbz10LmhlYXBbMV0sdC5oZWFwWy0tdC5oZWFwX21heF09cyx0LmhlYXBbLS10LmhlYXBfbWF4XT1vLHJbMipsXT1yWzIqc10rclsyKm9dLHQuZGVwdGhbbF09KHQuZGVwdGhbc10+PXQuZGVwdGhbb10/dC5kZXB0aFtzXTp0LmRlcHRoW29dKSsxLHJbMipzKzFdPXJbMipvKzFdPWwsdC5oZWFwWzFdPWwrKyxRKHQsciwxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sWCh0LGUpLEcocixoLHQuYmxfY291bnQpfSxldD0odCxlLHIpPT57bGV0IG4saSxhPS0xLHM9ZVsxXSxvPTAsbD03LGg9NDtmb3IoMD09PXMmJihsPTEzOCxoPTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrbzxsJiZpPT09c3x8KG88aD90LmJsX3RyZWVbMippXSs9bzowIT09aT8oaSE9PWEmJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzIqYl0rKyk6bzw9MTA/dC5ibF90cmVlWzIqeF0rKzp0LmJsX3RyZWVbMiprXSsrLG89MCxhPWksMD09PXM/KGw9MTM4LGg9Myk6aT09PXM/KGw9NixoPTMpOihsPTcsaD00KSl9LHJ0PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxsPTcsaD00O2ZvcigwPT09cyYmKGw9MTM4LGg9Myksbj0wO248PXI7bisrKWlmKGk9cyxzPWVbMioobisxKSsxXSwhKCsrbzxsJiZpPT09cykpe2lmKG88aClkb3tQKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tbyk7ZWxzZSAwIT09aT8oaSE9PWEmJihQKHQsaSx0LmJsX3RyZWUpLG8tLSksUCh0LGIsdC5ibF90cmVlKSxqKHQsby0zLDIpKTpvPD0xMD8oUCh0LHgsdC5ibF90cmVlKSxqKHQsby0zLDMpKTooUCh0LGssdC5ibF90cmVlKSxqKHQsby0xMSw3KSk7bz0wLGE9aSwwPT09cz8obD0xMzgsaD0zKTppPT09cz8obD02LGg9Myk6KGw9NyxoPTQpfX0sbnQ9dD0+e2xldCBlO2ZvcihldCh0LHQuZHluX2x0cmVlLHQubF9kZXNjLm1heF9jb2RlKSxldCh0LHQuZHluX2R0cmVlLHQuZF9kZXNjLm1heF9jb2RlKSx0dCh0LHQuYmxfZGVzYyksZT1wLTE7ZT49MyYmMD09PXQuYmxfdHJlZVsyKlNbZV0rMV07ZS0tKTtyZXR1cm4gdC5vcHRfbGVuKz0zKihlKzEpKzUrNSs0LGV9LGl0PSh0LGUscixuKT0+e2xldCBpO2ZvcihqKHQsZS0yNTcsNSksaih0LHItMSw1KSxqKHQsbi00LDQpLGk9MDtpPG47aSsrKWoodCx0LmJsX3RyZWVbMipTW2ldKzFdLDMpO3J0KHQsdC5keW5fbHRyZWUsZS0xKSxydCh0LHQuZHluX2R0cmVlLHItMSl9LGF0PXQ9PntsZXQgZSxpPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKyssaT4+Pj0xKWlmKDEmaSYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIHI7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gbjtmb3IoZT0zMjtlPF87ZSsrKWlmKDAhPT10LmR5bl9sdHJlZVsyKmVdKXJldHVybiBuO3JldHVybiByfTtsZXQgc3Q9ITE7Y29uc3Qgb3Q9KHQsZSxyLG4pPT57aih0LChzPDwxKSsobj8xOjApLDMpLHEodCksSSh0LHIpLEkodCx+ciksciYmdC5wZW5kaW5nX2J1Zi5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK3IpLHQucGVuZGluZyksdC5wZW5kaW5nKz1yfSxsdD0odCxyLG4sYSk9PntsZXQgcyxoLGM9MDt0LmxldmVsPjA/KHQuc3RybS5kYXRhX3R5cGU9PT1pJiYodC5zdHJtLmRhdGFfdHlwZT1hdCh0KSksdHQodCx0LmxfZGVzYyksdHQodCx0LmRfZGVzYyksYz1udCh0KSxzPXQub3B0X2xlbiszKzc+Pj4zLGg9dC5zdGF0aWNfbGVuKzMrNz4+PjMsaDw9cyYmKHM9aCkpOnM9aD1uKzUsbis0PD1zJiYtMSE9PXI/b3QodCxyLG4sYSk6dC5zdHJhdGVneT09PWV8fGg9PT1zPyhqKHQsKG88PDEpKyhhPzE6MCksMyksSih0LE8sTCkpOihqKHQsKGw8PDEpKyhhPzE6MCksMyksaXQodCx0LmxfZGVzYy5tYXhfY29kZSsxLHQuZF9kZXNjLm1heF9jb2RlKzEsYysxKSxKKHQsdC5keW5fbHRyZWUsdC5keW5fZHRyZWUpKSxZKHQpLGEmJnEodCl9O3ZhciBodD17X3RyX2luaXQ6dD0+e3N0fHwoVygpLHN0PSEwKSx0LmxfZGVzYz1uZXcgTSh0LmR5bl9sdHJlZSxGKSx0LmRfZGVzYz1uZXcgTSh0LmR5bl9kdHJlZSxIKSx0LmJsX2Rlc2M9bmV3IE0odC5ibF90cmVlLFopLHQuYmlfYnVmPTAsdC5iaV92YWxpZD0wLFkodCl9LF90cl9zdG9yZWRfYmxvY2s6b3QsX3RyX2ZsdXNoX2Jsb2NrOmx0LF90cl90YWxseToodCxlLHIpPT4odC5wZW5kaW5nX2J1Zlt0LnN5bV9idWYrdC5zeW1fbmV4dCsrXT1lLHQucGVuZGluZ19idWZbdC5zeW1fYnVmK3Quc3ltX25leHQrK109ZT4+OCx0LnBlbmRpbmdfYnVmW3Quc3ltX2J1Zit0LnN5bV9uZXh0KytdPXIsMD09PWU/dC5keW5fbHRyZWVbMipyXSsrOih0Lm1hdGNoZXMrKyxlLS0sdC5keW5fbHRyZWVbMiooRFtyXStfKzEpXSsrLHQuZHluX2R0cmVlWzIqTihlKV0rKyksdC5zeW1fbmV4dD09PXQuc3ltX2VuZCksX3RyX2FsaWduOnQ9PntqKHQsbzw8MSwzKSxQKHQsbSxPKSxLKHQpfX0sY3Q9KHQsZSxyLG4pPT57bGV0IGk9NjU1MzUmdCxhPXQ+Pj4xNiY2NTUzNSxzPTA7Zm9yKDswIT09cjspe3M9cj4yZTM/MmUzOnIsci09cztkb3tpPWkrZVtuKytdfDAsYT1hK2l8MH13aGlsZSgtLXMpO2klPTY1NTIxLGElPTY1NTIxfXJldHVybiBpfGE8PDE2fTtjb25zdCB1dD1uZXcgVWludDMyQXJyYXkoKCgpPT57bGV0IHQsZT1bXTtmb3IodmFyIHI9MDtyPDI1NjtyKyspe3Q9cjtmb3IodmFyIG49MDtuPDg7bisrKXQ9MSZ0PzM5ODgyOTIzODRedD4+PjE6dD4+PjE7ZVtyXT10fXJldHVybiBlfSkoKSk7dmFyIF90PSh0LGUscixuKT0+e2NvbnN0IGk9dXQsYT1uK3I7dF49LTE7Zm9yKGxldCByPW47cjxhO3IrKyl0PXQ+Pj44XmlbMjU1Jih0XmVbcl0pXTtyZXR1cm5+dH0sZHQ9ezI6Im5lZWQgZGljdGlvbmFyeSIsMToic3RyZWFtIGVuZCIsMDoiIiwiLTEiOiJmaWxlIGVycm9yIiwiLTIiOiJzdHJlYW0gZXJyb3IiLCItMyI6ImRhdGEgZXJyb3IiLCItNCI6Imluc3VmZmljaWVudCBtZW1vcnkiLCItNSI6ImJ1ZmZlciBlcnJvciIsIi02IjoiaW5jb21wYXRpYmxlIHZlcnNpb24ifSxmdD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX01FTV9FUlJPUjotNCxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTtjb25zdHtfdHJfaW5pdDpwdCxfdHJfc3RvcmVkX2Jsb2NrOmd0LF90cl9mbHVzaF9ibG9jazp5dCxfdHJfdGFsbHk6d3QsX3RyX2FsaWduOnZ0fT1odCx7Wl9OT19GTFVTSDptdCxaX1BBUlRJQUxfRkxVU0g6YnQsWl9GVUxMX0ZMVVNIOnh0LFpfRklOSVNIOmt0LFpfQkxPQ0s6enQsWl9PSzpBdCxaX1NUUkVBTV9FTkQ6RXQsWl9TVFJFQU1fRVJST1I6U3QsWl9EQVRBX0VSUk9SOkJ0LFpfQlVGX0VSUk9SOk90LFpfREVGQVVMVF9DT01QUkVTU0lPTjpMdCxaX0ZJTFRFUkVEOlJ0LFpfSFVGRk1BTl9PTkxZOkR0LFpfUkxFOlV0LFpfRklYRUQ6Q3QsWl9ERUZBVUxUX1NUUkFURUdZOlR0LFpfVU5LTk9XTjpGdCxaX0RFRkxBVEVEOkh0fT1mdCxadD05LE10PTE1LE50PTgsSXQ9Mjg2LGp0PTMwLFB0PTE5LCR0PTIqSXQrMSxLdD0xNSxYdD0zLEd0PTI1OCxXdD1HdCtYdCsxLFl0PTMyLHF0PTQyLFZ0PTU3LFF0PTY5LEp0PTczLHRlPTkxLGVlPTEwMyxyZT0xMTMsbmU9NjY2LGllPTEsYWU9MixzZT0zLG9lPTQsbGU9MyxoZT0odCxlKT0+KHQubXNnPWR0W2VdLGUpLGNlPXQ9PjIqdC0odD40Pzk6MCksdWU9dD0+e2xldCBlPXQubGVuZ3RoO2Zvcig7LS1lPj0wOyl0W2VdPTB9LF9lPXQ9PntsZXQgZSxyLG4saT10Lndfc2l6ZTtlPXQuaGFzaF9zaXplLG49ZTtkb3tyPXQuaGVhZFstLW5dLHQuaGVhZFtuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSk7ZT1pLG49ZTtkb3tyPXQucHJldlstLW5dLHQucHJldltuXT1yPj1pP3ItaTowfXdoaWxlKC0tZSl9O2xldCBkZT0odCxlLHIpPT4oZTw8dC5oYXNoX3NoaWZ0XnIpJnQuaGFzaF9tYXNrO2NvbnN0IGZlPXQ9Pntjb25zdCBlPXQuc3RhdGU7bGV0IHI9ZS5wZW5kaW5nO3I+dC5hdmFpbF9vdXQmJihyPXQuYXZhaWxfb3V0KSwwIT09ciYmKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsZS5wZW5kaW5nX291dCtyKSx0Lm5leHRfb3V0KSx0Lm5leHRfb3V0Kz1yLGUucGVuZGluZ19vdXQrPXIsdC50b3RhbF9vdXQrPXIsdC5hdmFpbF9vdXQtPXIsZS5wZW5kaW5nLT1yLDA9PT1lLnBlbmRpbmcmJihlLnBlbmRpbmdfb3V0PTApKX0scGU9KHQsZSk9Pnt5dCh0LHQuYmxvY2tfc3RhcnQ+PTA/dC5ibG9ja19zdGFydDotMSx0LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsZSksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0LGZlKHQuc3RybSl9LGdlPSh0LGUpPT57dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX0seWU9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JmV9LHdlPSh0LGUscixuKT0+e2xldCBpPXQuYXZhaWxfaW47cmV0dXJuIGk+biYmKGk9biksMD09PWk/MDoodC5hdmFpbF9pbi09aSxlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbix0Lm5leHRfaW4raSksciksMT09PXQuc3RhdGUud3JhcD90LmFkbGVyPWN0KHQuYWRsZXIsZSxpLHIpOjI9PT10LnN0YXRlLndyYXAmJih0LmFkbGVyPV90KHQuYWRsZXIsZSxpLHIpKSx0Lm5leHRfaW4rPWksdC50b3RhbF9pbis9aSxpKX0sdmU9KHQsZSk9PntsZXQgcixuLGk9dC5tYXhfY2hhaW5fbGVuZ3RoLGE9dC5zdHJzdGFydCxzPXQucHJldl9sZW5ndGgsbz10Lm5pY2VfbWF0Y2g7Y29uc3QgbD10LnN0cnN0YXJ0PnQud19zaXplLVd0P3Quc3Ryc3RhcnQtKHQud19zaXplLVd0KTowLGg9dC53aW5kb3csYz10LndfbWFzayx1PXQucHJldixfPXQuc3Ryc3RhcnQrR3Q7bGV0IGQ9aFthK3MtMV0sZj1oW2Erc107dC5wcmV2X2xlbmd0aD49dC5nb29kX21hdGNoJiYoaT4+PTIpLG8+dC5sb29rYWhlYWQmJihvPXQubG9va2FoZWFkKTtkb3tpZihyPWUsaFtyK3NdPT09ZiYmaFtyK3MtMV09PT1kJiZoW3JdPT09aFthXSYmaFsrK3JdPT09aFthKzFdKXthKz0yLHIrKztkb3t9d2hpbGUoaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmhbKythXT09PWhbKytyXSYmaFsrK2FdPT09aFsrK3JdJiZoWysrYV09PT1oWysrcl0mJmE8Xyk7aWYobj1HdC0oXy1hKSxhPV8tR3Qsbj5zKXtpZih0Lm1hdGNoX3N0YXJ0PWUscz1uLG4+PW8pYnJlYWs7ZD1oW2Ercy0xXSxmPWhbYStzXX19fXdoaWxlKChlPXVbZSZjXSk+bCYmMCE9LS1pKTtyZXR1cm4gczw9dC5sb29rYWhlYWQ/czp0Lmxvb2thaGVhZH0sbWU9dD0+e2NvbnN0IGU9dC53X3NpemU7bGV0IHIsbixpO2Rve2lmKG49dC53aW5kb3dfc2l6ZS10Lmxvb2thaGVhZC10LnN0cnN0YXJ0LHQuc3Ryc3RhcnQ+PWUrKGUtV3QpJiYodC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KGUsZStlLW4pLDApLHQubWF0Y2hfc3RhcnQtPWUsdC5zdHJzdGFydC09ZSx0LmJsb2NrX3N0YXJ0LT1lLHQuaW5zZXJ0PnQuc3Ryc3RhcnQmJih0Lmluc2VydD10LnN0cnN0YXJ0KSxfZSh0KSxuKz1lKSwwPT09dC5zdHJtLmF2YWlsX2luKWJyZWFrO2lmKHI9d2UodC5zdHJtLHQud2luZG93LHQuc3Ryc3RhcnQrdC5sb29rYWhlYWQsbiksdC5sb29rYWhlYWQrPXIsdC5sb29rYWhlYWQrdC5pbnNlcnQ+PVh0KWZvcihpPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tpXSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1tpKzFdKTt0Lmluc2VydCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W2krWHQtMV0pLHQucHJldltpJnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPWksaSsrLHQuaW5zZXJ0LS0sISh0Lmxvb2thaGVhZCt0Lmluc2VydDxYdCkpOyk7fXdoaWxlKHQubG9va2FoZWFkPFd0JiYwIT09dC5zdHJtLmF2YWlsX2luKX0sYmU9KHQsZSk9PntsZXQgcixuLGksYT10LnBlbmRpbmdfYnVmX3NpemUtNT50Lndfc2l6ZT90Lndfc2l6ZTp0LnBlbmRpbmdfYnVmX3NpemUtNSxzPTAsbz10LnN0cm0uYXZhaWxfaW47ZG97aWYocj02NTUzNSxpPXQuYmlfdmFsaWQrNDI+PjMsdC5zdHJtLmF2YWlsX291dDxpKWJyZWFrO2lmKGk9dC5zdHJtLmF2YWlsX291dC1pLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LHI+bit0LnN0cm0uYXZhaWxfaW4mJihyPW4rdC5zdHJtLmF2YWlsX2luKSxyPmkmJihyPWkpLHI8YSYmKDA9PT1yJiZlIT09a3R8fGU9PT1tdHx8ciE9PW4rdC5zdHJtLmF2YWlsX2luKSlicmVhaztzPWU9PT1rdCYmcj09PW4rdC5zdHJtLmF2YWlsX2luPzE6MCxndCh0LDAsMCxzKSx0LnBlbmRpbmdfYnVmW3QucGVuZGluZy00XT1yLHQucGVuZGluZ19idWZbdC5wZW5kaW5nLTNdPXI+PjgsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMl09fnIsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmctMV09fnI+PjgsZmUodC5zdHJtKSxuJiYobj5yJiYobj1yKSx0LnN0cm0ub3V0cHV0LnNldCh0LndpbmRvdy5zdWJhcnJheSh0LmJsb2NrX3N0YXJ0LHQuYmxvY2tfc3RhcnQrbiksdC5zdHJtLm5leHRfb3V0KSx0LnN0cm0ubmV4dF9vdXQrPW4sdC5zdHJtLmF2YWlsX291dC09bix0LnN0cm0udG90YWxfb3V0Kz1uLHQuYmxvY2tfc3RhcnQrPW4sci09biksciYmKHdlKHQuc3RybSx0LnN0cm0ub3V0cHV0LHQuc3RybS5uZXh0X291dCxyKSx0LnN0cm0ubmV4dF9vdXQrPXIsdC5zdHJtLmF2YWlsX291dC09cix0LnN0cm0udG90YWxfb3V0Kz1yKX13aGlsZSgwPT09cyk7cmV0dXJuIG8tPXQuc3RybS5hdmFpbF9pbixvJiYobz49dC53X3NpemU/KHQubWF0Y2hlcz0yLHQud2luZG93LnNldCh0LnN0cm0uaW5wdXQuc3ViYXJyYXkodC5zdHJtLm5leHRfaW4tdC53X3NpemUsdC5zdHJtLm5leHRfaW4pLDApLHQuc3Ryc3RhcnQ9dC53X3NpemUsdC5pbnNlcnQ9dC5zdHJzdGFydCk6KHQud2luZG93X3NpemUtdC5zdHJzdGFydDw9byYmKHQuc3Ryc3RhcnQtPXQud19zaXplLHQud2luZG93LnNldCh0LndpbmRvdy5zdWJhcnJheSh0Lndfc2l6ZSx0Lndfc2l6ZSt0LnN0cnN0YXJ0KSwwKSx0Lm1hdGNoZXM8MiYmdC5tYXRjaGVzKyssdC5pbnNlcnQ+dC5zdHJzdGFydCYmKHQuaW5zZXJ0PXQuc3Ryc3RhcnQpKSx0LndpbmRvdy5zZXQodC5zdHJtLmlucHV0LnN1YmFycmF5KHQuc3RybS5uZXh0X2luLW8sdC5zdHJtLm5leHRfaW4pLHQuc3Ryc3RhcnQpLHQuc3Ryc3RhcnQrPW8sdC5pbnNlcnQrPW8+dC53X3NpemUtdC5pbnNlcnQ/dC53X3NpemUtdC5pbnNlcnQ6byksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0KSx0LmhpZ2hfd2F0ZXI8dC5zdHJzdGFydCYmKHQuaGlnaF93YXRlcj10LnN0cnN0YXJ0KSxzP29lOmUhPT1tdCYmZSE9PWt0JiYwPT09dC5zdHJtLmF2YWlsX2luJiZ0LnN0cnN0YXJ0PT09dC5ibG9ja19zdGFydD9hZTooaT10LndpbmRvd19zaXplLXQuc3Ryc3RhcnQsdC5zdHJtLmF2YWlsX2luPmkmJnQuYmxvY2tfc3RhcnQ+PXQud19zaXplJiYodC5ibG9ja19zdGFydC09dC53X3NpemUsdC5zdHJzdGFydC09dC53X3NpemUsdC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KHQud19zaXplLHQud19zaXplK3Quc3Ryc3RhcnQpLDApLHQubWF0Y2hlczwyJiZ0Lm1hdGNoZXMrKyxpKz10Lndfc2l6ZSx0Lmluc2VydD50LnN0cnN0YXJ0JiYodC5pbnNlcnQ9dC5zdHJzdGFydCkpLGk+dC5zdHJtLmF2YWlsX2luJiYoaT10LnN0cm0uYXZhaWxfaW4pLGkmJih3ZSh0LnN0cm0sdC53aW5kb3csdC5zdHJzdGFydCxpKSx0LnN0cnN0YXJ0Kz1pLHQuaW5zZXJ0Kz1pPnQud19zaXplLXQuaW5zZXJ0P3Qud19zaXplLXQuaW5zZXJ0OmkpLHQuaGlnaF93YXRlcjx0LnN0cnN0YXJ0JiYodC5oaWdoX3dhdGVyPXQuc3Ryc3RhcnQpLGk9dC5iaV92YWxpZCs0Mj4+MyxpPXQucGVuZGluZ19idWZfc2l6ZS1pPjY1NTM1PzY1NTM1OnQucGVuZGluZ19idWZfc2l6ZS1pLGE9aT50Lndfc2l6ZT90Lndfc2l6ZTppLG49dC5zdHJzdGFydC10LmJsb2NrX3N0YXJ0LChuPj1hfHwobnx8ZT09PWt0KSYmZSE9PW10JiYwPT09dC5zdHJtLmF2YWlsX2luJiZuPD1pKSYmKHI9bj5pP2k6bixzPWU9PT1rdCYmMD09PXQuc3RybS5hdmFpbF9pbiYmcj09PW4/MTowLGd0KHQsdC5ibG9ja19zdGFydCxyLHMpLHQuYmxvY2tfc3RhcnQrPXIsZmUodC5zdHJtKSkscz9zZTppZSl9LHhlPSh0LGUpPT57bGV0IHIsbjtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PW10KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1YdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksMCE9PXImJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpKSx0Lm1hdGNoX2xlbmd0aD49WHQpaWYobj13dCh0LHQuc3Ryc3RhcnQtdC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aC1YdCksdC5sb29rYWhlYWQtPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPD10Lm1heF9sYXp5X21hdGNoJiZ0Lmxvb2thaGVhZD49WHQpe3QubWF0Y2hfbGVuZ3RoLS07ZG97dC5zdHJzdGFydCsrLHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrWHQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydH13aGlsZSgwIT0tLXQubWF0Y2hfbGVuZ3RoKTt0LnN0cnN0YXJ0Kyt9ZWxzZSB0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wLHQuaW5zX2g9dC53aW5kb3dbdC5zdHJzdGFydF0sdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCsxXSk7ZWxzZSBuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0Kys7aWYobiYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sa2U9KHQsZSk9PntsZXQgcixuLGk7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDxXdCl7aWYobWUodCksdC5sb29rYWhlYWQ8V3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHI9MCx0Lmxvb2thaGVhZD49WHQmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpLHQucHJldl9sZW5ndGg9dC5tYXRjaF9sZW5ndGgsdC5wcmV2X21hdGNoPXQubWF0Y2hfc3RhcnQsdC5tYXRjaF9sZW5ndGg9WHQtMSwwIT09ciYmdC5wcmV2X2xlbmd0aDx0Lm1heF9sYXp5X21hdGNoJiZ0LnN0cnN0YXJ0LXI8PXQud19zaXplLVd0JiYodC5tYXRjaF9sZW5ndGg9dmUodCxyKSx0Lm1hdGNoX2xlbmd0aDw9NSYmKHQuc3RyYXRlZ3k9PT1SdHx8dC5tYXRjaF9sZW5ndGg9PT1YdCYmdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0PjQwOTYpJiYodC5tYXRjaF9sZW5ndGg9WHQtMSkpLHQucHJldl9sZW5ndGg+PVh0JiZ0Lm1hdGNoX2xlbmd0aDw9dC5wcmV2X2xlbmd0aCl7aT10LnN0cnN0YXJ0K3QubG9va2FoZWFkLVh0LG49d3QodCx0LnN0cnN0YXJ0LTEtdC5wcmV2X21hdGNoLHQucHJldl9sZW5ndGgtWHQpLHQubG9va2FoZWFkLT10LnByZXZfbGVuZ3RoLTEsdC5wcmV2X2xlbmd0aC09Mjtkb3srK3Quc3Ryc3RhcnQ8PWkmJih0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0K1h0LTFdKSxyPXQucHJldlt0LnN0cnN0YXJ0JnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXQuc3Ryc3RhcnQpfXdoaWxlKDAhPS0tdC5wcmV2X2xlbmd0aCk7aWYodC5tYXRjaF9hdmFpbGFibGU9MCx0Lm1hdGNoX2xlbmd0aD1YdC0xLHQuc3Ryc3RhcnQrKyxuJiYocGUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1lbHNlIGlmKHQubWF0Y2hfYXZhaWxhYmxlKXtpZihuPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0LTFdKSxuJiZwZSh0LCExKSx0LnN0cnN0YXJ0KyssdC5sb29rYWhlYWQtLSwwPT09dC5zdHJtLmF2YWlsX291dClyZXR1cm4gaWV9ZWxzZSB0Lm1hdGNoX2F2YWlsYWJsZT0xLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tfXJldHVybiB0Lm1hdGNoX2F2YWlsYWJsZSYmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLHQubWF0Y2hfYXZhaWxhYmxlPTApLHQuaW5zZXJ0PXQuc3Ryc3RhcnQ8WHQtMT90LnN0cnN0YXJ0Olh0LTEsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0semU9KHQsZSk9PntsZXQgcixuLGksYTtjb25zdCBzPXQud2luZG93O2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8PUd0KXtpZihtZSh0KSx0Lmxvb2thaGVhZDw9R3QmJmU9PT1tdClyZXR1cm4gaWU7aWYoMD09PXQubG9va2FoZWFkKWJyZWFrfWlmKHQubWF0Y2hfbGVuZ3RoPTAsdC5sb29rYWhlYWQ+PVh0JiZ0LnN0cnN0YXJ0PjAmJihpPXQuc3Ryc3RhcnQtMSxuPXNbaV0sbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSkpe2E9dC5zdHJzdGFydCtHdDtkb3t9d2hpbGUobj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmbj09PXNbKytpXSYmaTxhKTt0Lm1hdGNoX2xlbmd0aD1HdC0oYS1pKSx0Lm1hdGNoX2xlbmd0aD50Lmxvb2thaGVhZCYmKHQubWF0Y2hfbGVuZ3RoPXQubG9va2FoZWFkKX1pZih0Lm1hdGNoX2xlbmd0aD49WHQ/KHI9d3QodCwxLHQubWF0Y2hfbGVuZ3RoLVh0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5zdHJzdGFydCs9dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg9MCk6KHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyksciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX0sQWU9KHQsZSk9PntsZXQgcjtmb3IoOzspe2lmKDA9PT10Lmxvb2thaGVhZCYmKG1lKHQpLDA9PT10Lmxvb2thaGVhZCkpe2lmKGU9PT1tdClyZXR1cm4gaWU7YnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCxyPXd0KHQsMCx0LndpbmRvd1t0LnN0cnN0YXJ0XSksdC5sb29rYWhlYWQtLSx0LnN0cnN0YXJ0KyssciYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KSlyZXR1cm4gaWV9cmV0dXJuIHQuaW5zZXJ0PTAsZT09PWt0PyhwZSh0LCEwKSwwPT09dC5zdHJtLmF2YWlsX291dD9zZTpvZSk6dC5zeW1fbmV4dCYmKHBlKHQsITEpLDA9PT10LnN0cm0uYXZhaWxfb3V0KT9pZTphZX07ZnVuY3Rpb24gRWUodCxlLHIsbixpKXt0aGlzLmdvb2RfbGVuZ3RoPXQsdGhpcy5tYXhfbGF6eT1lLHRoaXMubmljZV9sZW5ndGg9cix0aGlzLm1heF9jaGFpbj1uLHRoaXMuZnVuYz1pfWNvbnN0IFNlPVtuZXcgRWUoMCwwLDAsMCxiZSksbmV3IEVlKDQsNCw4LDQseGUpLG5ldyBFZSg0LDUsMTYsOCx4ZSksbmV3IEVlKDQsNiwzMiwzMix4ZSksbmV3IEVlKDQsNCwxNiwxNixrZSksbmV3IEVlKDgsMTYsMzIsMzIsa2UpLG5ldyBFZSg4LDE2LDEyOCwxMjgsa2UpLG5ldyBFZSg4LDMyLDEyOCwyNTYsa2UpLG5ldyBFZSgzMiwxMjgsMjU4LDEwMjQsa2UpLG5ldyBFZSgzMiwyNTgsMjU4LDQwOTYsa2UpXSxCZT10PT57dC53aW5kb3dfc2l6ZT0yKnQud19zaXplLHVlKHQuaGVhZCksdC5tYXhfbGF6eV9tYXRjaD1TZVt0LmxldmVsXS5tYXhfbGF6eSx0Lmdvb2RfbWF0Y2g9U2VbdC5sZXZlbF0uZ29vZF9sZW5ndGgsdC5uaWNlX21hdGNoPVNlW3QubGV2ZWxdLm5pY2VfbGVuZ3RoLHQubWF4X2NoYWluX2xlbmd0aD1TZVt0LmxldmVsXS5tYXhfY2hhaW4sdC5zdHJzdGFydD0wLHQuYmxvY2tfc3RhcnQ9MCx0Lmxvb2thaGVhZD0wLHQuaW5zZXJ0PTAsdC5tYXRjaF9sZW5ndGg9dC5wcmV2X2xlbmd0aD1YdC0xLHQubWF0Y2hfYXZhaWxhYmxlPTAsdC5pbnNfaD0wfTtmdW5jdGlvbiBPZSgpe3RoaXMuc3RybT1udWxsLHRoaXMuc3RhdHVzPTAsdGhpcy5wZW5kaW5nX2J1Zj1udWxsLHRoaXMucGVuZGluZ19idWZfc2l6ZT0wLHRoaXMucGVuZGluZ19vdXQ9MCx0aGlzLnBlbmRpbmc9MCx0aGlzLndyYXA9MCx0aGlzLmd6aGVhZD1udWxsLHRoaXMuZ3ppbmRleD0wLHRoaXMubWV0aG9kPUh0LHRoaXMubGFzdF9mbHVzaD0tMSx0aGlzLndfc2l6ZT0wLHRoaXMud19iaXRzPTAsdGhpcy53X21hc2s9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMud2luZG93X3NpemU9MCx0aGlzLnByZXY9bnVsbCx0aGlzLmhlYWQ9bnVsbCx0aGlzLmluc19oPTAsdGhpcy5oYXNoX3NpemU9MCx0aGlzLmhhc2hfYml0cz0wLHRoaXMuaGFzaF9tYXNrPTAsdGhpcy5oYXNoX3NoaWZ0PTAsdGhpcy5ibG9ja19zdGFydD0wLHRoaXMubWF0Y2hfbGVuZ3RoPTAsdGhpcy5wcmV2X21hdGNoPTAsdGhpcy5tYXRjaF9hdmFpbGFibGU9MCx0aGlzLnN0cnN0YXJ0PTAsdGhpcy5tYXRjaF9zdGFydD0wLHRoaXMubG9va2FoZWFkPTAsdGhpcy5wcmV2X2xlbmd0aD0wLHRoaXMubWF4X2NoYWluX2xlbmd0aD0wLHRoaXMubWF4X2xhenlfbWF0Y2g9MCx0aGlzLmxldmVsPTAsdGhpcy5zdHJhdGVneT0wLHRoaXMuZ29vZF9tYXRjaD0wLHRoaXMubmljZV9tYXRjaD0wLHRoaXMuZHluX2x0cmVlPW5ldyBVaW50MTZBcnJheSgyKiR0KSx0aGlzLmR5bl9kdHJlZT1uZXcgVWludDE2QXJyYXkoMiooMipqdCsxKSksdGhpcy5ibF90cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKlB0KzEpKSx1ZSh0aGlzLmR5bl9sdHJlZSksdWUodGhpcy5keW5fZHRyZWUpLHVlKHRoaXMuYmxfdHJlZSksdGhpcy5sX2Rlc2M9bnVsbCx0aGlzLmRfZGVzYz1udWxsLHRoaXMuYmxfZGVzYz1udWxsLHRoaXMuYmxfY291bnQ9bmV3IFVpbnQxNkFycmF5KEt0KzEpLHRoaXMuaGVhcD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmhlYXApLHRoaXMuaGVhcF9sZW49MCx0aGlzLmhlYXBfbWF4PTAsdGhpcy5kZXB0aD1uZXcgVWludDE2QXJyYXkoMipJdCsxKSx1ZSh0aGlzLmRlcHRoKSx0aGlzLnN5bV9idWY9MCx0aGlzLmxpdF9idWZzaXplPTAsdGhpcy5zeW1fbmV4dD0wLHRoaXMuc3ltX2VuZD0wLHRoaXMub3B0X2xlbj0wLHRoaXMuc3RhdGljX2xlbj0wLHRoaXMubWF0Y2hlcz0wLHRoaXMuaW5zZXJ0PTAsdGhpcy5iaV9idWY9MCx0aGlzLmJpX3ZhbGlkPTB9Y29uc3QgTGU9dD0+e2lmKCF0KXJldHVybiAxO2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4hZXx8ZS5zdHJtIT09dHx8ZS5zdGF0dXMhPT1xdCYmZS5zdGF0dXMhPT1WdCYmZS5zdGF0dXMhPT1RdCYmZS5zdGF0dXMhPT1KdCYmZS5zdGF0dXMhPT10ZSYmZS5zdGF0dXMhPT1lZSYmZS5zdGF0dXMhPT1yZSYmZS5zdGF0dXMhPT1uZT8xOjB9LFJlPXQ9PntpZihMZSh0KSlyZXR1cm4gaGUodCxTdCk7dC50b3RhbF9pbj10LnRvdGFsX291dD0wLHQuZGF0YV90eXBlPUZ0O2NvbnN0IGU9dC5zdGF0ZTtyZXR1cm4gZS5wZW5kaW5nPTAsZS5wZW5kaW5nX291dD0wLGUud3JhcDwwJiYoZS53cmFwPS1lLndyYXApLGUuc3RhdHVzPTI9PT1lLndyYXA/VnQ6ZS53cmFwP3F0OnJlLHQuYWRsZXI9Mj09PWUud3JhcD8wOjEsZS5sYXN0X2ZsdXNoPS0yLHB0KGUpLEF0fSxEZT10PT57Y29uc3QgZT1SZSh0KTtyZXR1cm4gZT09PUF0JiZCZSh0LnN0YXRlKSxlfSxVZT0odCxlLHIsbixpLGEpPT57aWYoIXQpcmV0dXJuIFN0O2xldCBzPTE7aWYoZT09PUx0JiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+WnR8fHIhPT1IdHx8bjw4fHxuPjE1fHxlPDB8fGU+OXx8YTwwfHxhPkN0fHw4PT09biYmMSE9PXMpcmV0dXJuIGhlKHQsU3QpOzg9PT1uJiYobj05KTtjb25zdCBvPW5ldyBPZTtyZXR1cm4gdC5zdGF0ZT1vLG8uc3RybT10LG8uc3RhdHVzPXF0LG8ud3JhcD1zLG8uZ3poZWFkPW51bGwsby53X2JpdHM9bixvLndfc2l6ZT0xPDxvLndfYml0cyxvLndfbWFzaz1vLndfc2l6ZS0xLG8uaGFzaF9iaXRzPWkrNyxvLmhhc2hfc2l6ZT0xPDxvLmhhc2hfYml0cyxvLmhhc2hfbWFzaz1vLmhhc2hfc2l6ZS0xLG8uaGFzaF9zaGlmdD1+figoby5oYXNoX2JpdHMrWHQtMSkvWHQpLG8ud2luZG93PW5ldyBVaW50OEFycmF5KDIqby53X3NpemUpLG8uaGVhZD1uZXcgVWludDE2QXJyYXkoby5oYXNoX3NpemUpLG8ucHJldj1uZXcgVWludDE2QXJyYXkoby53X3NpemUpLG8ubGl0X2J1ZnNpemU9MTw8aSs2LG8ucGVuZGluZ19idWZfc2l6ZT00Km8ubGl0X2J1ZnNpemUsby5wZW5kaW5nX2J1Zj1uZXcgVWludDhBcnJheShvLnBlbmRpbmdfYnVmX3NpemUpLG8uc3ltX2J1Zj1vLmxpdF9idWZzaXplLG8uc3ltX2VuZD0zKihvLmxpdF9idWZzaXplLTEpLG8ubGV2ZWw9ZSxvLnN0cmF0ZWd5PWEsby5tZXRob2Q9cixEZSh0KX07dmFyIENlPXtkZWZsYXRlSW5pdDoodCxlKT0+VWUodCxlLEh0LE10LE50LFR0KSxkZWZsYXRlSW5pdDI6VWUsZGVmbGF0ZVJlc2V0OkRlLGRlZmxhdGVSZXNldEtlZXA6UmUsZGVmbGF0ZVNldEhlYWRlcjoodCxlKT0+TGUodCl8fDIhPT10LnN0YXRlLndyYXA/U3Q6KHQuc3RhdGUuZ3poZWFkPWUsQXQpLGRlZmxhdGU6KHQsZSk9PntpZihMZSh0KXx8ZT56dHx8ZTwwKXJldHVybiB0P2hlKHQsU3QpOlN0O2NvbnN0IHI9dC5zdGF0ZTtpZighdC5vdXRwdXR8fDAhPT10LmF2YWlsX2luJiYhdC5pbnB1dHx8ci5zdGF0dXM9PT1uZSYmZSE9PWt0KXJldHVybiBoZSh0LDA9PT10LmF2YWlsX291dD9PdDpTdCk7Y29uc3Qgbj1yLmxhc3RfZmx1c2g7aWYoci5sYXN0X2ZsdXNoPWUsMCE9PXIucGVuZGluZyl7aWYoZmUodCksMD09PXQuYXZhaWxfb3V0KXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXR9ZWxzZSBpZigwPT09dC5hdmFpbF9pbiYmY2UoZSk8PWNlKG4pJiZlIT09a3QpcmV0dXJuIGhlKHQsT3QpO2lmKHIuc3RhdHVzPT09bmUmJjAhPT10LmF2YWlsX2luKXJldHVybiBoZSh0LE90KTtpZihyLnN0YXR1cz09PXF0JiYwPT09ci53cmFwJiYoci5zdGF0dXM9cmUpLHIuc3RhdHVzPT09cXQpe2xldCBlPUh0KyhyLndfYml0cy04PDw0KTw8OCxuPS0xO2lmKG49ci5zdHJhdGVneT49RHR8fHIubGV2ZWw8Mj8wOnIubGV2ZWw8Nj8xOjY9PT1yLmxldmVsPzI6MyxlfD1uPDw2LDAhPT1yLnN0cnN0YXJ0JiYoZXw9WXQpLGUrPTMxLWUlMzEseWUocixlKSwwIT09ci5zdHJzdGFydCYmKHllKHIsdC5hZGxlcj4+PjE2KSx5ZShyLDY1NTM1JnQuYWRsZXIpKSx0LmFkbGVyPTEsci5zdGF0dXM9cmUsZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fWlmKHIuc3RhdHVzPT09VnQpaWYodC5hZGxlcj0wLGdlKHIsMzEpLGdlKHIsMTM5KSxnZShyLDgpLHIuZ3poZWFkKWdlKHIsKHIuZ3poZWFkLnRleHQ/MTowKSsoci5nemhlYWQuaGNyYz8yOjApKyhyLmd6aGVhZC5leHRyYT80OjApKyhyLmd6aGVhZC5uYW1lPzg6MCkrKHIuZ3poZWFkLmNvbW1lbnQ/MTY6MCkpLGdlKHIsMjU1JnIuZ3poZWFkLnRpbWUpLGdlKHIsci5nemhlYWQudGltZT4+OCYyNTUpLGdlKHIsci5nemhlYWQudGltZT4+MTYmMjU1KSxnZShyLHIuZ3poZWFkLnRpbWU+PjI0JjI1NSksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLDI1NSZyLmd6aGVhZC5vcyksci5nemhlYWQuZXh0cmEmJnIuZ3poZWFkLmV4dHJhLmxlbmd0aCYmKGdlKHIsMjU1JnIuZ3poZWFkLmV4dHJhLmxlbmd0aCksZ2UocixyLmd6aGVhZC5leHRyYS5sZW5ndGg+PjgmMjU1KSksci5nemhlYWQuaGNyYyYmKHQuYWRsZXI9X3QodC5hZGxlcixyLnBlbmRpbmdfYnVmLHIucGVuZGluZywwKSksci5nemluZGV4PTAsci5zdGF0dXM9UXQ7ZWxzZSBpZihnZShyLDApLGdlKHIsMCksZ2UociwwKSxnZShyLDApLGdlKHIsMCksZ2Uociw5PT09ci5sZXZlbD8yOnIuc3RyYXRlZ3k+PUR0fHxyLmxldmVsPDI/NDowKSxnZShyLGxlKSxyLnN0YXR1cz1yZSxmZSh0KSwwIT09ci5wZW5kaW5nKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7aWYoci5zdGF0dXM9PT1RdCl7aWYoci5nemhlYWQuZXh0cmEpe2xldCBlPXIucGVuZGluZyxuPSg2NTUzNSZyLmd6aGVhZC5leHRyYS5sZW5ndGgpLXIuZ3ppbmRleDtmb3IoO3IucGVuZGluZytuPnIucGVuZGluZ19idWZfc2l6ZTspe2xldCBpPXIucGVuZGluZ19idWZfc2l6ZS1yLnBlbmRpbmc7aWYoci5wZW5kaW5nX2J1Zi5zZXQoci5nemhlYWQuZXh0cmEuc3ViYXJyYXkoci5nemluZGV4LHIuZ3ppbmRleCtpKSxyLnBlbmRpbmcpLHIucGVuZGluZz1yLnBlbmRpbmdfYnVmX3NpemUsci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPmUmJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctZSxlKSksci5nemluZGV4Kz1pLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdDtlPTAsbi09aX1sZXQgaT1uZXcgVWludDhBcnJheShyLmd6aGVhZC5leHRyYSk7ci5wZW5kaW5nX2J1Zi5zZXQoaS5zdWJhcnJheShyLmd6aW5kZXgsci5nemluZGV4K24pLHIucGVuZGluZyksci5wZW5kaW5nKz1uLHIuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5lJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLWUsZSkpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPUp0fWlmKHIuc3RhdHVzPT09SnQpe2lmKHIuZ3poZWFkLm5hbWUpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5uYW1lLmxlbmd0aD8yNTUmci5nemhlYWQubmFtZS5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpLHIuZ3ppbmRleD0wfXIuc3RhdHVzPXRlfWlmKHIuc3RhdHVzPT09dGUpe2lmKHIuZ3poZWFkLmNvbW1lbnQpe2xldCBlLG49ci5wZW5kaW5nO2Rve2lmKHIucGVuZGluZz09PXIucGVuZGluZ19idWZfc2l6ZSl7aWYoci5nemhlYWQuaGNyYyYmci5wZW5kaW5nPm4mJih0LmFkbGVyPV90KHQuYWRsZXIsci5wZW5kaW5nX2J1ZixyLnBlbmRpbmctbixuKSksZmUodCksMCE9PXIucGVuZGluZylyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0O249MH1lPXIuZ3ppbmRleDxyLmd6aGVhZC5jb21tZW50Lmxlbmd0aD8yNTUmci5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KHIuZ3ppbmRleCsrKTowLGdlKHIsZSl9d2hpbGUoMCE9PWUpO3IuZ3poZWFkLmhjcmMmJnIucGVuZGluZz5uJiYodC5hZGxlcj1fdCh0LmFkbGVyLHIucGVuZGluZ19idWYsci5wZW5kaW5nLW4sbikpfXIuc3RhdHVzPWVlfWlmKHIuc3RhdHVzPT09ZWUpe2lmKHIuZ3poZWFkLmhjcmMpe2lmKHIucGVuZGluZysyPnIucGVuZGluZ19idWZfc2l6ZSYmKGZlKHQpLDAhPT1yLnBlbmRpbmcpKXJldHVybiByLmxhc3RfZmx1c2g9LTEsQXQ7Z2UociwyNTUmdC5hZGxlciksZ2Uocix0LmFkbGVyPj44JjI1NSksdC5hZGxlcj0wfWlmKHIuc3RhdHVzPXJlLGZlKHQpLDAhPT1yLnBlbmRpbmcpcmV0dXJuIHIubGFzdF9mbHVzaD0tMSxBdH1pZigwIT09dC5hdmFpbF9pbnx8MCE9PXIubG9va2FoZWFkfHxlIT09bXQmJnIuc3RhdHVzIT09bmUpe2xldCBuPTA9PT1yLmxldmVsP2JlKHIsZSk6ci5zdHJhdGVneT09PUR0P0FlKHIsZSk6ci5zdHJhdGVneT09PVV0P3plKHIsZSk6U2Vbci5sZXZlbF0uZnVuYyhyLGUpO2lmKG4hPT1zZSYmbiE9PW9lfHwoci5zdGF0dXM9bmUpLG49PT1pZXx8bj09PXNlKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihyLmxhc3RfZmx1c2g9LTEpLEF0O2lmKG49PT1hZSYmKGU9PT1idD92dChyKTplIT09enQmJihndChyLDAsMCwhMSksZT09PXh0JiYodWUoci5oZWFkKSwwPT09ci5sb29rYWhlYWQmJihyLnN0cnN0YXJ0PTAsci5ibG9ja19zdGFydD0wLHIuaW5zZXJ0PTApKSksZmUodCksMD09PXQuYXZhaWxfb3V0KSlyZXR1cm4gci5sYXN0X2ZsdXNoPS0xLEF0fXJldHVybiBlIT09a3Q/QXQ6ci53cmFwPD0wP0V0OigyPT09ci53cmFwPyhnZShyLDI1NSZ0LmFkbGVyKSxnZShyLHQuYWRsZXI+PjgmMjU1KSxnZShyLHQuYWRsZXI+PjE2JjI1NSksZ2Uocix0LmFkbGVyPj4yNCYyNTUpLGdlKHIsMjU1JnQudG90YWxfaW4pLGdlKHIsdC50b3RhbF9pbj4+OCYyNTUpLGdlKHIsdC50b3RhbF9pbj4+MTYmMjU1KSxnZShyLHQudG90YWxfaW4+PjI0JjI1NSkpOih5ZShyLHQuYWRsZXI+Pj4xNikseWUociw2NTUzNSZ0LmFkbGVyKSksZmUodCksci53cmFwPjAmJihyLndyYXA9LXIud3JhcCksMCE9PXIucGVuZGluZz9BdDpFdCl9LGRlZmxhdGVFbmQ6dD0+e2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBlPXQuc3RhdGUuc3RhdHVzO3JldHVybiB0LnN0YXRlPW51bGwsZT09PXJlP2hlKHQsQnQpOkF0fSxkZWZsYXRlU2V0RGljdGlvbmFyeToodCxlKT0+e2xldCByPWUubGVuZ3RoO2lmKExlKHQpKXJldHVybiBTdDtjb25zdCBuPXQuc3RhdGUsaT1uLndyYXA7aWYoMj09PWl8fDE9PT1pJiZuLnN0YXR1cyE9PXF0fHxuLmxvb2thaGVhZClyZXR1cm4gU3Q7aWYoMT09PWkmJih0LmFkbGVyPWN0KHQuYWRsZXIsZSxyLDApKSxuLndyYXA9MCxyPj1uLndfc2l6ZSl7MD09PWkmJih1ZShuLmhlYWQpLG4uc3Ryc3RhcnQ9MCxuLmJsb2NrX3N0YXJ0PTAsbi5pbnNlcnQ9MCk7bGV0IHQ9bmV3IFVpbnQ4QXJyYXkobi53X3NpemUpO3Quc2V0KGUuc3ViYXJyYXkoci1uLndfc2l6ZSxyKSwwKSxlPXQscj1uLndfc2l6ZX1jb25zdCBhPXQuYXZhaWxfaW4scz10Lm5leHRfaW4sbz10LmlucHV0O2Zvcih0LmF2YWlsX2luPXIsdC5uZXh0X2luPTAsdC5pbnB1dD1lLG1lKG4pO24ubG9va2FoZWFkPj1YdDspe2xldCB0PW4uc3Ryc3RhcnQsZT1uLmxvb2thaGVhZC0oWHQtMSk7ZG97bi5pbnNfaD1kZShuLG4uaW5zX2gsbi53aW5kb3dbdCtYdC0xXSksbi5wcmV2W3Qmbi53X21hc2tdPW4uaGVhZFtuLmluc19oXSxuLmhlYWRbbi5pbnNfaF09dCx0Kyt9d2hpbGUoLS1lKTtuLnN0cnN0YXJ0PXQsbi5sb29rYWhlYWQ9WHQtMSxtZShuKX1yZXR1cm4gbi5zdHJzdGFydCs9bi5sb29rYWhlYWQsbi5ibG9ja19zdGFydD1uLnN0cnN0YXJ0LG4uaW5zZXJ0PW4ubG9va2FoZWFkLG4ubG9va2FoZWFkPTAsbi5tYXRjaF9sZW5ndGg9bi5wcmV2X2xlbmd0aD1YdC0xLG4ubWF0Y2hfYXZhaWxhYmxlPTAsdC5uZXh0X2luPXMsdC5pbnB1dD1vLHQuYXZhaWxfaW49YSxuLndyYXA9aSxBdH0sZGVmbGF0ZUluZm86InBha28gZGVmbGF0ZSAoZnJvbSBOb2RlY2EgcHJvamVjdCkifTtjb25zdCBUZT0odCxlKT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsZSk7dmFyIEZlPWZ1bmN0aW9uKHQpe2NvbnN0IGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO2Zvcig7ZS5sZW5ndGg7KXtjb25zdCByPWUuc2hpZnQoKTtpZihyKXtpZigib2JqZWN0IiE9dHlwZW9mIHIpdGhyb3cgbmV3IFR5cGVFcnJvcihyKyJtdXN0IGJlIG5vbi1vYmplY3QiKTtmb3IoY29uc3QgZSBpbiByKVRlKHIsZSkmJih0W2VdPXJbZV0pfX1yZXR1cm4gdH0sSGU9e2Fzc2lnbjpGZSxmbGF0dGVuQ2h1bmtzOnQ9PntsZXQgZT0wO2ZvcihsZXQgcj0wLG49dC5sZW5ndGg7cjxuO3IrKyllKz10W3JdLmxlbmd0aDtjb25zdCByPW5ldyBVaW50OEFycmF5KGUpO2ZvcihsZXQgZT0wLG49MCxpPXQubGVuZ3RoO2U8aTtlKyspe2xldCBpPXRbZV07ci5zZXQoaSxuKSxuKz1pLmxlbmd0aH1yZXR1cm4gcn19O2xldCBaZT0hMDt0cnl7U3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLG5ldyBVaW50OEFycmF5KDEpKX1jYXRjaCh0KXtaZT0hMX1jb25zdCBNZT1uZXcgVWludDhBcnJheSgyNTYpO2ZvcihsZXQgdD0wO3Q8MjU2O3QrKylNZVt0XT10Pj0yNTI/Njp0Pj0yNDg/NTp0Pj0yNDA/NDp0Pj0yMjQ/Mzp0Pj0xOTI/MjoxO01lWzI1NF09TWVbMjU0XT0xO2NvbnN0IE5lPSh0LGUpPT57aWYoZTw2NTUzNCYmdC5zdWJhcnJheSYmWmUpcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCx0Lmxlbmd0aD09PWU/dDp0LnN1YmFycmF5KDAsZSkpO2xldCByPSIiO2ZvcihsZXQgbj0wO248ZTtuKyspcis9U3RyaW5nLmZyb21DaGFyQ29kZSh0W25dKTtyZXR1cm4gcn07dmFyIEllPXtzdHJpbmcyYnVmOnQ9PntpZigiZnVuY3Rpb24iPT10eXBlb2YgVGV4dEVuY29kZXImJlRleHRFbmNvZGVyLnByb3RvdHlwZS5lbmNvZGUpcmV0dXJuKG5ldyBUZXh0RW5jb2RlcikuZW5jb2RlKHQpO2xldCBlLHIsbixpLGEscz10Lmxlbmd0aCxvPTA7Zm9yKGk9MDtpPHM7aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxvKz1yPDEyOD8xOnI8MjA0OD8yOnI8NjU1MzY/Mzo0O2ZvcihlPW5ldyBVaW50OEFycmF5KG8pLGE9MCxpPTA7YTxvO2krKylyPXQuY2hhckNvZGVBdChpKSw1NTI5Nj09KDY0NTEyJnIpJiZpKzE8cyYmKG49dC5jaGFyQ29kZUF0KGkrMSksNTYzMjA9PSg2NDUxMiZuKSYmKHI9NjU1MzYrKHItNTUyOTY8PDEwKSsobi01NjMyMCksaSsrKSkscjwxMjg/ZVthKytdPXI6cjwyMDQ4PyhlW2ErK109MTkyfHI+Pj42LGVbYSsrXT0xMjh8NjMmcik6cjw2NTUzNj8oZVthKytdPTIyNHxyPj4+MTIsZVthKytdPTEyOHxyPj4+NiY2MyxlW2ErK109MTI4fDYzJnIpOihlW2ErK109MjQwfHI+Pj4xOCxlW2ErK109MTI4fHI+Pj4xMiY2MyxlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik7cmV0dXJuIGV9LGJ1ZjJzdHJpbmc6KHQsZSk9Pntjb25zdCByPWV8fHQubGVuZ3RoO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RGVjb2RlciYmVGV4dERlY29kZXIucHJvdG90eXBlLmRlY29kZSlyZXR1cm4obmV3IFRleHREZWNvZGVyKS5kZWNvZGUodC5zdWJhcnJheSgwLGUpKTtsZXQgbixpO2NvbnN0IGE9bmV3IEFycmF5KDIqcik7Zm9yKGk9MCxuPTA7bjxyOyl7bGV0IGU9dFtuKytdO2lmKGU8MTI4KXthW2krK109ZTtjb250aW51ZX1sZXQgcz1NZVtlXTtpZihzPjQpYVtpKytdPTY1NTMzLG4rPXMtMTtlbHNle2ZvcihlJj0yPT09cz8zMTozPT09cz8xNTo3O3M+MSYmbjxyOyllPWU8PDZ8NjMmdFtuKytdLHMtLTtzPjE/YVtpKytdPTY1NTMzOmU8NjU1MzY/YVtpKytdPWU6KGUtPTY1NTM2LGFbaSsrXT01NTI5NnxlPj4xMCYxMDIzLGFbaSsrXT01NjMyMHwxMDIzJmUpfX1yZXR1cm4gTmUoYSxpKX0sdXRmOGJvcmRlcjoodCxlKT0+eyhlPWV8fHQubGVuZ3RoKT50Lmxlbmd0aCYmKGU9dC5sZW5ndGgpO2xldCByPWUtMTtmb3IoO3I+PTAmJjEyOD09KDE5MiZ0W3JdKTspci0tO3JldHVybiByPDB8fDA9PT1yP2U6citNZVt0W3JdXT5lP3I6ZX19O2Z1bmN0aW9uIGplKCl7dGhpcy5pbnB1dD1udWxsLHRoaXMubmV4dF9pbj0wLHRoaXMuYXZhaWxfaW49MCx0aGlzLnRvdGFsX2luPTAsdGhpcy5vdXRwdXQ9bnVsbCx0aGlzLm5leHRfb3V0PTAsdGhpcy5hdmFpbF9vdXQ9MCx0aGlzLnRvdGFsX291dD0wLHRoaXMubXNnPSIiLHRoaXMuc3RhdGU9bnVsbCx0aGlzLmRhdGFfdHlwZT0yLHRoaXMuYWRsZXI9MH12YXIgUGU9amU7Y29uc3QgJGU9T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyx7Wl9OT19GTFVTSDpLZSxaX1NZTkNfRkxVU0g6WGUsWl9GVUxMX0ZMVVNIOkdlLFpfRklOSVNIOldlLFpfT0s6WWUsWl9TVFJFQU1fRU5EOnFlLFpfREVGQVVMVF9DT01QUkVTU0lPTjpWZSxaX0RFRkFVTFRfU1RSQVRFR1k6UWUsWl9ERUZMQVRFRDpKZX09ZnQ7ZnVuY3Rpb24gdHIodCl7dGhpcy5vcHRpb25zPUhlLmFzc2lnbih7bGV2ZWw6VmUsbWV0aG9kOkplLGNodW5rU2l6ZToxNjM4NCx3aW5kb3dCaXRzOjE1LG1lbUxldmVsOjgsc3RyYXRlZ3k6UWV9LHR8fHt9KTtsZXQgZT10aGlzLm9wdGlvbnM7ZS5yYXcmJmUud2luZG93Qml0cz4wP2Uud2luZG93Qml0cz0tZS53aW5kb3dCaXRzOmUuZ3ppcCYmZS53aW5kb3dCaXRzPjAmJmUud2luZG93Qml0czwxNiYmKGUud2luZG93Qml0cys9MTYpLHRoaXMuZXJyPTAsdGhpcy5tc2c9IiIsdGhpcy5lbmRlZD0hMSx0aGlzLmNodW5rcz1bXSx0aGlzLnN0cm09bmV3IFBlLHRoaXMuc3RybS5hdmFpbF9vdXQ9MDtsZXQgcj1DZS5kZWZsYXRlSW5pdDIodGhpcy5zdHJtLGUubGV2ZWwsZS5tZXRob2QsZS53aW5kb3dCaXRzLGUubWVtTGV2ZWwsZS5zdHJhdGVneSk7aWYociE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7aWYoZS5oZWFkZXImJkNlLmRlZmxhdGVTZXRIZWFkZXIodGhpcy5zdHJtLGUuaGVhZGVyKSxlLmRpY3Rpb25hcnkpe2xldCB0O2lmKHQ9InN0cmluZyI9PXR5cGVvZiBlLmRpY3Rpb25hcnk/SWUuc3RyaW5nMmJ1ZihlLmRpY3Rpb25hcnkpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKGUuZGljdGlvbmFyeSk/bmV3IFVpbnQ4QXJyYXkoZS5kaWN0aW9uYXJ5KTplLmRpY3Rpb25hcnkscj1DZS5kZWZsYXRlU2V0RGljdGlvbmFyeSh0aGlzLnN0cm0sdCksciE9PVllKXRocm93IG5ldyBFcnJvcihkdFtyXSk7dGhpcy5fZGljdF9zZXQ9ITB9fWZ1bmN0aW9uIGVyKHQsZSl7Y29uc3Qgcj1uZXcgdHIoZSk7aWYoci5wdXNoKHQsITApLHIuZXJyKXRocm93IHIubXNnfHxkdFtyLmVycl07cmV0dXJuIHIucmVzdWx0fWZ1bmN0aW9uIHJyKHQsZSl7cmV0dXJuKGU9ZXx8e30pLnJhdz0hMCxlcih0LGUpfWZ1bmN0aW9uIG5yKHQsZSl7cmV0dXJuKGU9ZXx8e30pLmd6aXA9ITAsZXIodCxlKX10ci5wcm90b3R5cGUucHVzaD1mdW5jdGlvbih0LGUpe2NvbnN0IHI9dGhpcy5zdHJtLG49dGhpcy5vcHRpb25zLmNodW5rU2l6ZTtsZXQgaSxhO2lmKHRoaXMuZW5kZWQpcmV0dXJuITE7Zm9yKGE9ZT09PX5+ZT9lOiEwPT09ZT9XZTpLZSwic3RyaW5nIj09dHlwZW9mIHQ/ci5pbnB1dD1JZS5zdHJpbmcyYnVmKHQpOiJbb2JqZWN0IEFycmF5QnVmZmVyXSI9PT0kZS5jYWxsKHQpP3IuaW5wdXQ9bmV3IFVpbnQ4QXJyYXkodCk6ci5pbnB1dD10LHIubmV4dF9pbj0wLHIuYXZhaWxfaW49ci5pbnB1dC5sZW5ndGg7OylpZigwPT09ci5hdmFpbF9vdXQmJihyLm91dHB1dD1uZXcgVWludDhBcnJheShuKSxyLm5leHRfb3V0PTAsci5hdmFpbF9vdXQ9biksKGE9PT1YZXx8YT09PUdlKSYmci5hdmFpbF9vdXQ8PTYpdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNle2lmKGk9Q2UuZGVmbGF0ZShyLGEpLGk9PT1xZSlyZXR1cm4gci5uZXh0X291dD4wJiZ0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxpPUNlLmRlZmxhdGVFbmQodGhpcy5zdHJtKSx0aGlzLm9uRW5kKGkpLHRoaXMuZW5kZWQ9ITAsaT09PVllO2lmKDAhPT1yLmF2YWlsX291dCl7aWYoYT4wJiZyLm5leHRfb3V0PjApdGhpcy5vbkRhdGEoci5vdXRwdXQuc3ViYXJyYXkoMCxyLm5leHRfb3V0KSksci5hdmFpbF9vdXQ9MDtlbHNlIGlmKDA9PT1yLmF2YWlsX2luKWJyZWFrfWVsc2UgdGhpcy5vbkRhdGEoci5vdXRwdXQpfXJldHVybiEwfSx0ci5wcm90b3R5cGUub25EYXRhPWZ1bmN0aW9uKHQpe3RoaXMuY2h1bmtzLnB1c2godCl9LHRyLnByb3RvdHlwZS5vbkVuZD1mdW5jdGlvbih0KXt0PT09WWUmJih0aGlzLnJlc3VsdD1IZS5mbGF0dGVuQ2h1bmtzKHRoaXMuY2h1bmtzKSksdGhpcy5jaHVua3M9W10sdGhpcy5lcnI9dCx0aGlzLm1zZz10aGlzLnN0cm0ubXNnfTt2YXIgaXI9dHIsYXI9ZXIsc3I9cnIsb3I9bnIsbHI9ZnQsaHI9e0RlZmxhdGU6aXIsZGVmbGF0ZTphcixkZWZsYXRlUmF3OnNyLGd6aXA6b3IsY29uc3RhbnRzOmxyfTt0LkRlZmxhdGU9aXIsdC5jb25zdGFudHM9bHIsdC5kZWZhdWx0PWhyLHQuZGVmbGF0ZT1hcix0LmRlZmxhdGVSYXc9c3IsdC5nemlwPW9yLE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KX0ocy5leHBvcnRzKSkscy5leHBvcnRzKSxsPXtleHBvcnRzOnt9fTt2YXIgaCxjPXtleHBvcnRzOnt9fSx1PXIoT2JqZWN0LmZyZWV6ZSh7X19wcm90b19fOm51bGx9KSk7ZnVuY3Rpb24gXygpe3JldHVybiBofHwoaD0xLGMuZXhwb3J0cz0oZT1lfHxmdW5jdGlvbihlLHIpe3ZhciBuO2lmKCJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cuY3J5cHRvJiYobj13aW5kb3cuY3J5cHRvKSwidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJnNlbGYuY3J5cHRvJiYobj1zZWxmLmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzJiZnbG9iYWxUaGlzLmNyeXB0byYmKG49Z2xvYmFsVGhpcy5jcnlwdG8pLCFuJiYidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93Lm1zQ3J5cHRvJiYobj13aW5kb3cubXNDcnlwdG8pLCFuJiZ2b2lkIDAhPT10JiZ0LmNyeXB0byYmKG49dC5jcnlwdG8pLCFuKXRyeXtuPXV9Y2F0Y2godCl7fXZhciBpPWZ1bmN0aW9uKCl7aWYobil7aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4uZ2V0UmFuZG9tVmFsdWVzKXRyeXtyZXR1cm4gbi5nZXRSYW5kb21WYWx1ZXMobmV3IFVpbnQzMkFycmF5KDEpKVswXX1jYXRjaCh0KXt9aWYoImZ1bmN0aW9uIj09dHlwZW9mIG4ucmFuZG9tQnl0ZXMpdHJ5e3JldHVybiBuLnJhbmRvbUJ5dGVzKDQpLnJlYWRJbnQzMkxFKCl9Y2F0Y2godCl7fX10aHJvdyBuZXcgRXJyb3IoIk5hdGl2ZSBjcnlwdG8gbW9kdWxlIGNvdWxkIG5vdCBiZSB1c2VkIHRvIGdldCBzZWN1cmUgcmFuZG9tIG51bWJlci4iKX0sYT1PYmplY3QuY3JlYXRlfHxmdW5jdGlvbigpe2Z1bmN0aW9uIHQoKXt9cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByO3JldHVybiB0LnByb3RvdHlwZT1lLHI9bmV3IHQsdC5wcm90b3R5cGU9bnVsbCxyfX0oKSxzPXt9LG89cy5saWI9e30sbD1vLkJhc2U9e2V4dGVuZDpmdW5jdGlvbih0KXt2YXIgZT1hKHRoaXMpO3JldHVybiB0JiZlLm1peEluKHQpLGUuaGFzT3duUHJvcGVydHkoImluaXQiKSYmdGhpcy5pbml0IT09ZS5pbml0fHwoZS5pbml0PWZ1bmN0aW9uKCl7ZS4kc3VwZXIuaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9KSxlLmluaXQucHJvdG90eXBlPWUsZS4kc3VwZXI9dGhpcyxlfSxjcmVhdGU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLmV4dGVuZCgpO3JldHVybiB0LmluaXQuYXBwbHkodCxhcmd1bWVudHMpLHR9LGluaXQ6ZnVuY3Rpb24oKXt9LG1peEluOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZSBpbiB0KXQuaGFzT3duUHJvcGVydHkoZSkmJih0aGlzW2VdPXRbZV0pO3QuaGFzT3duUHJvcGVydHkoInRvU3RyaW5nIikmJih0aGlzLnRvU3RyaW5nPXQudG9TdHJpbmcpfSxjbG9uZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmluaXQucHJvdG90eXBlLmV4dGVuZCh0aGlzKX19LGg9by5Xb3JkQXJyYXk9bC5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCxlKXt0PXRoaXMud29yZHM9dHx8W10sdGhpcy5zaWdCeXRlcz1lIT1yP2U6NCp0Lmxlbmd0aH0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fF8pLnN0cmluZ2lmeSh0aGlzKX0sY29uY2F0OmZ1bmN0aW9uKHQpe3ZhciBlPXRoaXMud29yZHMscj10LndvcmRzLG49dGhpcy5zaWdCeXRlcyxpPXQuc2lnQnl0ZXM7aWYodGhpcy5jbGFtcCgpLG4lNClmb3IodmFyIGE9MDthPGk7YSsrKXt2YXIgcz1yW2E+Pj4yXT4+PjI0LWElNCo4JjI1NTtlW24rYT4+PjJdfD1zPDwyNC0obithKSU0Kjh9ZWxzZSBmb3IodmFyIG89MDtvPGk7bys9NCllW24rbz4+PjJdPXJbbz4+PjJdO3JldHVybiB0aGlzLnNpZ0J5dGVzKz1pLHRoaXN9LGNsYW1wOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy53b3JkcyxyPXRoaXMuc2lnQnl0ZXM7dFtyPj4+Ml0mPTQyOTQ5NjcyOTU8PDMyLXIlNCo4LHQubGVuZ3RoPWUuY2VpbChyLzQpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWwuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC53b3Jkcz10aGlzLndvcmRzLnNsaWNlKDApLHR9LHJhbmRvbTpmdW5jdGlvbih0KXtmb3IodmFyIGU9W10scj0wO3I8dDtyKz00KWUucHVzaChpKCkpO3JldHVybiBuZXcgaC5pbml0KGUsdCl9fSksYz1zLmVuYz17fSxfPWMuSGV4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBhPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaCgoYT4+PjQpLnRvU3RyaW5nKDE2KSksbi5wdXNoKCgxNSZhKS50b1N0cmluZygxNikpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rPTIpcltuPj4+M118PXBhcnNlSW50KHQuc3Vic3RyKG4sMiksMTYpPDwyNC1uJTgqNDtyZXR1cm4gbmV3IGguaW5pdChyLGUvMil9fSxkPWMuTGF0aW4xPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49W10saT0wO2k8cjtpKyspe3ZhciBhPWVbaT4+PjJdPj4+MjQtaSU0KjgmMjU1O24ucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKX1yZXR1cm4gbi5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7Zm9yKHZhciBlPXQubGVuZ3RoLHI9W10sbj0wO248ZTtuKyspcltuPj4+Ml18PSgyNTUmdC5jaGFyQ29kZUF0KG4pKTw8MjQtbiU0Kjg7cmV0dXJuIG5ldyBoLmluaXQocixlKX19LGY9Yy5VdGY4PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dHJ5e3JldHVybiBkZWNvZGVVUklDb21wb25lbnQoZXNjYXBlKGQuc3RyaW5naWZ5KHQpKSl9Y2F0Y2godCl7dGhyb3cgbmV3IEVycm9yKCJNYWxmb3JtZWQgVVRGLTggZGF0YSIpfX0scGFyc2U6ZnVuY3Rpb24odCl7cmV0dXJuIGQucGFyc2UodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KHQpKSl9fSxwPW8uQnVmZmVyZWRCbG9ja0FsZ29yaXRobT1sLmV4dGVuZCh7cmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9kYXRhPW5ldyBoLmluaXQsdGhpcy5fbkRhdGFCeXRlcz0wfSxfYXBwZW5kOmZ1bmN0aW9uKHQpeyJzdHJpbmciPT10eXBlb2YgdCYmKHQ9Zi5wYXJzZSh0KSksdGhpcy5fZGF0YS5jb25jYXQodCksdGhpcy5fbkRhdGFCeXRlcys9dC5zaWdCeXRlc30sX3Byb2Nlc3M6ZnVuY3Rpb24odCl7dmFyIHIsbj10aGlzLl9kYXRhLGk9bi53b3JkcyxhPW4uc2lnQnl0ZXMscz10aGlzLmJsb2NrU2l6ZSxvPWEvKDQqcyksbD0obz10P2UuY2VpbChvKTplLm1heCgoMHxvKS10aGlzLl9taW5CdWZmZXJTaXplLDApKSpzLGM9ZS5taW4oNCpsLGEpO2lmKGwpe2Zvcih2YXIgdT0wO3U8bDt1Kz1zKXRoaXMuX2RvUHJvY2Vzc0Jsb2NrKGksdSk7cj1pLnNwbGljZSgwLGwpLG4uc2lnQnl0ZXMtPWN9cmV0dXJuIG5ldyBoLmluaXQocixjKX0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1sLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2RhdGE9dGhpcy5fZGF0YS5jbG9uZSgpLHR9LF9taW5CdWZmZXJTaXplOjB9KTtvLkhhc2hlcj1wLmV4dGVuZCh7Y2ZnOmwuZXh0ZW5kKCksaW5pdDpmdW5jdGlvbih0KXt0aGlzLmNmZz10aGlzLmNmZy5leHRlbmQodCksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3AucmVzZXQuY2FsbCh0aGlzKSx0aGlzLl9kb1Jlc2V0KCl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sYmxvY2tTaXplOjE2LF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUscil7cmV0dXJuIG5ldyB0LmluaXQocikuZmluYWxpemUoZSl9fSxfY3JlYXRlSG1hY0hlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IGcuSE1BQy5pbml0KHQscikuZmluYWxpemUoZSl9fX0pO3ZhciBnPXMuYWxnbz17fTtyZXR1cm4gc30oTWF0aCksZSkpLGMuZXhwb3J0czt2YXIgZX12YXIgZDtmdW5jdGlvbiBmKCl7cmV0dXJuIGR8fChkPTEsbC5leHBvcnRzPSh0PV8oKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYi5Xb3JkQXJyYXk7ZnVuY3Rpb24gbih0LGUsbil7Zm9yKHZhciBpPVtdLGE9MCxzPTA7czxlO3MrKylpZihzJTQpe3ZhciBvPW5bdC5jaGFyQ29kZUF0KHMtMSldPDxzJTQqMnxuW3QuY2hhckNvZGVBdChzKV0+Pj42LXMlNCoyO2lbYT4+PjJdfD1vPDwyNC1hJTQqOCxhKyt9cmV0dXJuIHIuY3JlYXRlKGksYSl9ZS5lbmMuQmFzZTY0PXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj10aGlzLl9tYXA7dC5jbGFtcCgpO2Zvcih2YXIgaT1bXSxhPTA7YTxyO2ErPTMpZm9yKHZhciBzPShlW2E+Pj4yXT4+PjI0LWElNCo4JjI1NSk8PDE2fChlW2ErMT4+PjJdPj4+MjQtKGErMSklNCo4JjI1NSk8PDh8ZVthKzI+Pj4yXT4+PjI0LShhKzIpJTQqOCYyNTUsbz0wO288NCYmYSsuNzUqbzxyO28rKylpLnB1c2gobi5jaGFyQXQocz4+PjYqKDMtbykmNjMpKTt2YXIgbD1uLmNoYXJBdCg2NCk7aWYobClmb3IoO2kubGVuZ3RoJTQ7KWkucHVzaChsKTtyZXR1cm4gaS5qb2luKCIiKX0scGFyc2U6ZnVuY3Rpb24odCl7dmFyIGU9dC5sZW5ndGgscj10aGlzLl9tYXAsaT10aGlzLl9yZXZlcnNlTWFwO2lmKCFpKXtpPXRoaXMuX3JldmVyc2VNYXA9W107Zm9yKHZhciBhPTA7YTxyLmxlbmd0aDthKyspaVtyLmNoYXJDb2RlQXQoYSldPWF9dmFyIHM9ci5jaGFyQXQoNjQpO2lmKHMpe3ZhciBvPXQuaW5kZXhPZihzKTstMSE9PW8mJihlPW8pfXJldHVybiBuKHQsZSxpKX0sX21hcDoiQUJDREVGR0hJSktMTU5PUFFSU1RVVldYWVphYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ejAxMjM0NTY3ODkrLz0ifX0oKSx0LmVuYy5CYXNlNjQpKSxsLmV4cG9ydHM7dmFyIHR9dmFyIHAsZz1lKGYoKSkseT17ZXhwb3J0czp7fX0sdz17ZXhwb3J0czp7fX07ZnVuY3Rpb24gdigpe3JldHVybiBwfHwocD0xLHcuZXhwb3J0cz0odD1fKCksZnVuY3Rpb24oZSl7dmFyIHI9dCxuPXIubGliLGk9bi5Xb3JkQXJyYXksYT1uLkhhc2hlcixzPXIuYWxnbyxvPVtdOyFmdW5jdGlvbigpe2Zvcih2YXIgdD0wO3Q8NjQ7dCsrKW9bdF09NDI5NDk2NzI5NiplLmFicyhlLnNpbih0KzEpKXwwfSgpO3ZhciBsPXMuTUQ1PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChbMTczMjU4NDE5Myw0MDIzMjMzNDE3LDI1NjIzODMxMDIsMjcxNzMzODc4XSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj0wO3I8MTY7cisrKXt2YXIgbj1lK3IsaT10W25dO3Rbbl09MTY3MTE5MzUmKGk8PDh8aT4+PjI0KXw0Mjc4MjU1MzYwJihpPDwyNHxpPj4+OCl9dmFyIGE9dGhpcy5faGFzaC53b3JkcyxzPXRbZSswXSxsPXRbZSsxXSxkPXRbZSsyXSxmPXRbZSszXSxwPXRbZSs0XSxnPXRbZSs1XSx5PXRbZSs2XSx3PXRbZSs3XSx2PXRbZSs4XSxtPXRbZSs5XSxiPXRbZSsxMF0seD10W2UrMTFdLGs9dFtlKzEyXSx6PXRbZSsxM10sQT10W2UrMTRdLEU9dFtlKzE1XSxTPWFbMF0sQj1hWzFdLE89YVsyXSxMPWFbM107Uz1oKFMsQixPLEwscyw3LG9bMF0pLEw9aChMLFMsQixPLGwsMTIsb1sxXSksTz1oKE8sTCxTLEIsZCwxNyxvWzJdKSxCPWgoQixPLEwsUyxmLDIyLG9bM10pLFM9aChTLEIsTyxMLHAsNyxvWzRdKSxMPWgoTCxTLEIsTyxnLDEyLG9bNV0pLE89aChPLEwsUyxCLHksMTcsb1s2XSksQj1oKEIsTyxMLFMsdywyMixvWzddKSxTPWgoUyxCLE8sTCx2LDcsb1s4XSksTD1oKEwsUyxCLE8sbSwxMixvWzldKSxPPWgoTyxMLFMsQixiLDE3LG9bMTBdKSxCPWgoQixPLEwsUyx4LDIyLG9bMTFdKSxTPWgoUyxCLE8sTCxrLDcsb1sxMl0pLEw9aChMLFMsQixPLHosMTIsb1sxM10pLE89aChPLEwsUyxCLEEsMTcsb1sxNF0pLFM9YyhTLEI9aChCLE8sTCxTLEUsMjIsb1sxNV0pLE8sTCxsLDUsb1sxNl0pLEw9YyhMLFMsQixPLHksOSxvWzE3XSksTz1jKE8sTCxTLEIseCwxNCxvWzE4XSksQj1jKEIsTyxMLFMscywyMCxvWzE5XSksUz1jKFMsQixPLEwsZyw1LG9bMjBdKSxMPWMoTCxTLEIsTyxiLDksb1syMV0pLE89YyhPLEwsUyxCLEUsMTQsb1syMl0pLEI9YyhCLE8sTCxTLHAsMjAsb1syM10pLFM9YyhTLEIsTyxMLG0sNSxvWzI0XSksTD1jKEwsUyxCLE8sQSw5LG9bMjVdKSxPPWMoTyxMLFMsQixmLDE0LG9bMjZdKSxCPWMoQixPLEwsUyx2LDIwLG9bMjddKSxTPWMoUyxCLE8sTCx6LDUsb1syOF0pLEw9YyhMLFMsQixPLGQsOSxvWzI5XSksTz1jKE8sTCxTLEIsdywxNCxvWzMwXSksUz11KFMsQj1jKEIsTyxMLFMsaywyMCxvWzMxXSksTyxMLGcsNCxvWzMyXSksTD11KEwsUyxCLE8sdiwxMSxvWzMzXSksTz11KE8sTCxTLEIseCwxNixvWzM0XSksQj11KEIsTyxMLFMsQSwyMyxvWzM1XSksUz11KFMsQixPLEwsbCw0LG9bMzZdKSxMPXUoTCxTLEIsTyxwLDExLG9bMzddKSxPPXUoTyxMLFMsQix3LDE2LG9bMzhdKSxCPXUoQixPLEwsUyxiLDIzLG9bMzldKSxTPXUoUyxCLE8sTCx6LDQsb1s0MF0pLEw9dShMLFMsQixPLHMsMTEsb1s0MV0pLE89dShPLEwsUyxCLGYsMTYsb1s0Ml0pLEI9dShCLE8sTCxTLHksMjMsb1s0M10pLFM9dShTLEIsTyxMLG0sNCxvWzQ0XSksTD11KEwsUyxCLE8saywxMSxvWzQ1XSksTz11KE8sTCxTLEIsRSwxNixvWzQ2XSksUz1fKFMsQj11KEIsTyxMLFMsZCwyMyxvWzQ3XSksTyxMLHMsNixvWzQ4XSksTD1fKEwsUyxCLE8sdywxMCxvWzQ5XSksTz1fKE8sTCxTLEIsQSwxNSxvWzUwXSksQj1fKEIsTyxMLFMsZywyMSxvWzUxXSksUz1fKFMsQixPLEwsayw2LG9bNTJdKSxMPV8oTCxTLEIsTyxmLDEwLG9bNTNdKSxPPV8oTyxMLFMsQixiLDE1LG9bNTRdKSxCPV8oQixPLEwsUyxsLDIxLG9bNTVdKSxTPV8oUyxCLE8sTCx2LDYsb1s1Nl0pLEw9XyhMLFMsQixPLEUsMTAsb1s1N10pLE89XyhPLEwsUyxCLHksMTUsb1s1OF0pLEI9XyhCLE8sTCxTLHosMjEsb1s1OV0pLFM9XyhTLEIsTyxMLHAsNixvWzYwXSksTD1fKEwsUyxCLE8seCwxMCxvWzYxXSksTz1fKE8sTCxTLEIsZCwxNSxvWzYyXSksQj1fKEIsTyxMLFMsbSwyMSxvWzYzXSksYVswXT1hWzBdK1N8MCxhWzFdPWFbMV0rQnwwLGFbMl09YVsyXStPfDAsYVszXT1hWzNdK0x8MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLHI9dC53b3JkcyxuPTgqdGhpcy5fbkRhdGFCeXRlcyxpPTgqdC5zaWdCeXRlcztyW2k+Pj41XXw9MTI4PDwyNC1pJTMyO3ZhciBhPWUuZmxvb3Iobi80Mjk0OTY3Mjk2KSxzPW47clsxNSsoaSs2ND4+Pjk8PDQpXT0xNjcxMTkzNSYoYTw8OHxhPj4+MjQpfDQyNzgyNTUzNjAmKGE8PDI0fGE+Pj44KSxyWzE0KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihzPDw4fHM+Pj4yNCl8NDI3ODI1NTM2MCYoczw8MjR8cz4+PjgpLHQuc2lnQnl0ZXM9NCooci5sZW5ndGgrMSksdGhpcy5fcHJvY2VzcygpO2Zvcih2YXIgbz10aGlzLl9oYXNoLGw9by53b3JkcyxoPTA7aDw0O2grKyl7dmFyIGM9bFtoXTtsW2hdPTE2NzExOTM1JihjPDw4fGM+Pj4yNCl8NDI3ODI1NTM2MCYoYzw8MjR8Yz4+PjgpfXJldHVybiBvfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWEuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtmdW5jdGlvbiBoKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmcnx+ZSZuKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gYyh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlJm58ciZ+bikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIHUodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZV5yXm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBfKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKHJeKGV8fm4pKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ci5NRDU9YS5fY3JlYXRlSGVscGVyKGwpLHIuSG1hY01ENT1hLl9jcmVhdGVIbWFjSGVscGVyKGwpfShNYXRoKSx0Lk1ENSkpLHcuZXhwb3J0czt2YXIgdH12YXIgbSxiPXtleHBvcnRzOnt9fSx4PXtleHBvcnRzOnt9fTtmdW5jdGlvbiBrKCl7cmV0dXJuIG18fChtPTEseC5leHBvcnRzPSh0PV8oKSxmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuV29yZEFycmF5LGk9ci5IYXNoZXIsYT1lLmFsZ28scz1bXSxvPWEuU0hBMT1pLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBuLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OCwzMjg1Mzc3NTIwXSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj10aGlzLl9oYXNoLndvcmRzLG49clswXSxpPXJbMV0sYT1yWzJdLG89clszXSxsPXJbNF0saD0wO2g8ODA7aCsrKXtpZihoPDE2KXNbaF09MHx0W2UraF07ZWxzZXt2YXIgYz1zW2gtM11ec1toLThdXnNbaC0xNF1ec1toLTE2XTtzW2hdPWM8PDF8Yz4+PjMxfXZhciB1PShuPDw1fG4+Pj4yNykrbCtzW2hdO3UrPWg8MjA/MTUxODUwMDI0OSsoaSZhfH5pJm8pOmg8NDA/MTg1OTc3NTM5MysoaV5hXm8pOmg8NjA/KGkmYXxpJm98YSZvKS0xODk0MDA3NTg4OihpXmFebyktODk5NDk3NTE0LGw9byxvPWEsYT1pPDwzMHxpPj4+MixpPW4sbj11fXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStvfDAscls0XT1yWzRdK2x8MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLGU9dC53b3JkcyxyPTgqdGhpcy5fbkRhdGFCeXRlcyxuPTgqdC5zaWdCeXRlcztyZXR1cm4gZVtuPj4+NV18PTEyODw8MjQtbiUzMixlWzE0KyhuKzY0Pj4+OTw8NCldPU1hdGguZmxvb3Ioci80Mjk0OTY3Mjk2KSxlWzE1KyhuKzY0Pj4+OTw8NCldPXIsdC5zaWdCeXRlcz00KmUubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWkuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtlLlNIQTE9aS5fY3JlYXRlSGVscGVyKG8pLGUuSG1hY1NIQTE9aS5fY3JlYXRlSG1hY0hlbHBlcihvKX0oKSx0LlNIQTEpKSx4LmV4cG9ydHM7dmFyIHR9dmFyIHosQT17ZXhwb3J0czp7fX07ZnVuY3Rpb24gRSgpe3JldHVybiB6fHwoej0xLEEuZXhwb3J0cz0odD1fKCkscj0oZT10KS5saWIuQmFzZSxuPWUuZW5jLlV0Zjgsdm9pZChlLmFsZ28uSE1BQz1yLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy5faGFzaGVyPW5ldyB0LmluaXQsInN0cmluZyI9PXR5cGVvZiBlJiYoZT1uLnBhcnNlKGUpKTt2YXIgcj10LmJsb2NrU2l6ZSxpPTQqcjtlLnNpZ0J5dGVzPmkmJihlPXQuZmluYWxpemUoZSkpLGUuY2xhbXAoKTtmb3IodmFyIGE9dGhpcy5fb0tleT1lLmNsb25lKCkscz10aGlzLl9pS2V5PWUuY2xvbmUoKSxvPWEud29yZHMsbD1zLndvcmRzLGg9MDtoPHI7aCsrKW9baF1ePTE1NDk1NTY4MjgsbFtoXV49OTA5NTIyNDg2O2Euc2lnQnl0ZXM9cy5zaWdCeXRlcz1pLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9oYXNoZXI7dC5yZXNldCgpLHQudXBkYXRlKHRoaXMuX2lLZXkpfSx1cGRhdGU6ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMuX2hhc2hlci51cGRhdGUodCksdGhpc30sZmluYWxpemU6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy5faGFzaGVyLHI9ZS5maW5hbGl6ZSh0KTtyZXR1cm4gZS5yZXNldCgpLGUuZmluYWxpemUodGhpcy5fb0tleS5jbG9uZSgpLmNvbmNhdChyKSl9fSkpKSksQS5leHBvcnRzO3ZhciB0LGUscixufXZhciBTO2Z1bmN0aW9uIEIoKXtyZXR1cm4gU3x8KFM9MSxiLmV4cG9ydHM9KHQ9XygpLGsoKSxFKCksZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIsbj1yLkJhc2UsaT1yLldvcmRBcnJheSxhPWUuYWxnbyxzPWEuTUQ1LG89YS5FdnBLREY9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7a2V5U2l6ZTo0LGhhc2hlcjpzLGl0ZXJhdGlvbnM6MX0pLGluaXQ6ZnVuY3Rpb24odCl7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHQpfSxjb21wdXRlOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByLG49dGhpcy5jZmcsYT1uLmhhc2hlci5jcmVhdGUoKSxzPWkuY3JlYXRlKCksbz1zLndvcmRzLGw9bi5rZXlTaXplLGg9bi5pdGVyYXRpb25zO28ubGVuZ3RoPGw7KXtyJiZhLnVwZGF0ZShyKSxyPWEudXBkYXRlKHQpLmZpbmFsaXplKGUpLGEucmVzZXQoKTtmb3IodmFyIGM9MTtjPGg7YysrKXI9YS5maW5hbGl6ZShyKSxhLnJlc2V0KCk7cy5jb25jYXQocil9cmV0dXJuIHMuc2lnQnl0ZXM9NCpsLHN9fSk7ZS5FdnBLREY9ZnVuY3Rpb24odCxlLHIpe3JldHVybiBvLmNyZWF0ZShyKS5jb21wdXRlKHQsZSl9fSgpLHQuRXZwS0RGKSksYi5leHBvcnRzO3ZhciB0fXZhciBPLEw9e2V4cG9ydHM6e319O3ZhciBSO3ZhciBELFUsQz0oUnx8KFI9MSx5LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLkJsb2NrQ2lwaGVyLG49ZS5hbGdvLGk9W10sYT1bXSxzPVtdLG89W10sbD1bXSxoPVtdLGM9W10sdT1bXSxfPVtdLGQ9W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLGU9MDtlPDI1NjtlKyspdFtlXT1lPDEyOD9lPDwxOmU8PDFeMjgzO3ZhciByPTAsbj0wO2ZvcihlPTA7ZTwyNTY7ZSsrKXt2YXIgZj1uXm48PDFebjw8Ml5uPDwzXm48PDQ7Zj1mPj4+OF4yNTUmZl45OSxpW3JdPWYsYVtmXT1yO3ZhciBwPXRbcl0sZz10W3BdLHk9dFtnXSx3PTI1Nyp0W2ZdXjE2ODQzMDA4KmY7c1tyXT13PDwyNHx3Pj4+OCxvW3JdPXc8PDE2fHc+Pj4xNixsW3JdPXc8PDh8dz4+PjI0LGhbcl09dyx3PTE2ODQzMDA5KnleNjU1MzcqZ14yNTcqcF4xNjg0MzAwOCpyLGNbZl09dzw8MjR8dz4+PjgsdVtmXT13PDwxNnx3Pj4+MTYsX1tmXT13PDw4fHc+Pj4yNCxkW2ZdPXcscj8ocj1wXnRbdFt0W3lecF1dXSxuXj10W3Rbbl1dKTpyPW49MX19KCk7dmFyIGY9WzAsMSwyLDQsOCwxNiwzMiw2NCwxMjgsMjcsNTRdLHA9bi5BRVM9ci5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7aWYoIXRoaXMuX25Sb3VuZHN8fHRoaXMuX2tleVByaW9yUmVzZXQhPT10aGlzLl9rZXkpe2Zvcih2YXIgdD10aGlzLl9rZXlQcmlvclJlc2V0PXRoaXMuX2tleSxlPXQud29yZHMscj10LnNpZ0J5dGVzLzQsbj00KigodGhpcy5fblJvdW5kcz1yKzYpKzEpLGE9dGhpcy5fa2V5U2NoZWR1bGU9W10scz0wO3M8bjtzKyspczxyP2Fbc109ZVtzXTooaD1hW3MtMV0scyVyP3I+NiYmcyVyPT00JiYoaD1pW2g+Pj4yNF08PDI0fGlbaD4+PjE2JjI1NV08PDE2fGlbaD4+PjgmMjU1XTw8OHxpWzI1NSZoXSk6KGg9aVsoaD1oPDw4fGg+Pj4yNCk+Pj4yNF08PDI0fGlbaD4+PjE2JjI1NV08PDE2fGlbaD4+PjgmMjU1XTw8OHxpWzI1NSZoXSxoXj1mW3MvcnwwXTw8MjQpLGFbc109YVtzLXJdXmgpO2Zvcih2YXIgbz10aGlzLl9pbnZLZXlTY2hlZHVsZT1bXSxsPTA7bDxuO2wrKyl7aWYocz1uLWwsbCU0KXZhciBoPWFbc107ZWxzZSBoPWFbcy00XTtvW2xdPWw8NHx8czw9ND9oOmNbaVtoPj4+MjRdXV51W2lbaD4+PjE2JjI1NV1dXl9baVtoPj4+OCYyNTVdXV5kW2lbMjU1JmhdXX19fSxlbmNyeXB0QmxvY2s6ZnVuY3Rpb24odCxlKXt0aGlzLl9kb0NyeXB0QmxvY2sodCxlLHRoaXMuX2tleVNjaGVkdWxlLHMsbyxsLGgsaSl9LGRlY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3ZhciByPXRbZSsxXTt0W2UrMV09dFtlKzNdLHRbZSszXT1yLHRoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5faW52S2V5U2NoZWR1bGUsYyx1LF8sZCxhKSxyPXRbZSsxXSx0W2UrMV09dFtlKzNdLHRbZSszXT1yfSxfZG9DcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSxyLG4saSxhLHMsbyl7Zm9yKHZhciBsPXRoaXMuX25Sb3VuZHMsaD10W2VdXnJbMF0sYz10W2UrMV1eclsxXSx1PXRbZSsyXV5yWzJdLF89dFtlKzNdXnJbM10sZD00LGY9MTtmPGw7ZisrKXt2YXIgcD1uW2g+Pj4yNF1eaVtjPj4+MTYmMjU1XV5hW3U+Pj44JjI1NV1ec1syNTUmX11ecltkKytdLGc9bltjPj4+MjRdXmlbdT4+PjE2JjI1NV1eYVtfPj4+OCYyNTVdXnNbMjU1JmhdXnJbZCsrXSx5PW5bdT4+PjI0XV5pW18+Pj4xNiYyNTVdXmFbaD4+PjgmMjU1XV5zWzI1NSZjXV5yW2QrK10sdz1uW18+Pj4yNF1eaVtoPj4+MTYmMjU1XV5hW2M+Pj44JjI1NV1ec1syNTUmdV1ecltkKytdO2g9cCxjPWcsdT15LF89d31wPShvW2g+Pj4yNF08PDI0fG9bYz4+PjE2JjI1NV08PDE2fG9bdT4+PjgmMjU1XTw8OHxvWzI1NSZfXSlecltkKytdLGc9KG9bYz4+PjI0XTw8MjR8b1t1Pj4+MTYmMjU1XTw8MTZ8b1tfPj4+OCYyNTVdPDw4fG9bMjU1JmhdKV5yW2QrK10seT0ob1t1Pj4+MjRdPDwyNHxvW18+Pj4xNiYyNTVdPDwxNnxvW2g+Pj44JjI1NV08PDh8b1syNTUmY10pXnJbZCsrXSx3PShvW18+Pj4yNF08PDI0fG9baD4+PjE2JjI1NV08PDE2fG9bYz4+PjgmMjU1XTw8OHxvWzI1NSZ1XSlecltkKytdLHRbZV09cCx0W2UrMV09Zyx0W2UrMl09eSx0W2UrM109d30sa2V5U2l6ZTo4fSk7ZS5BRVM9ci5fY3JlYXRlSGVscGVyKHApfSgpLHQuQUVTfShfKCksZigpLHYoKSxCKCksT3x8KE89MSxMLmV4cG9ydHM9KEQ9XygpLEIoKSx2b2lkKEQubGliLkNpcGhlcnx8ZnVuY3Rpb24odCl7dmFyIGU9RCxyPWUubGliLG49ci5CYXNlLGk9ci5Xb3JkQXJyYXksYT1yLkJ1ZmZlcmVkQmxvY2tBbGdvcml0aG0scz1lLmVuYztzLlV0Zjg7dmFyIG89cy5CYXNlNjQsbD1lLmFsZ28uRXZwS0RGLGg9ci5DaXBoZXI9YS5leHRlbmQoe2NmZzpuLmV4dGVuZCgpLGNyZWF0ZUVuY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLmNyZWF0ZSh0aGlzLl9FTkNfWEZPUk1fTU9ERSx0LGUpfSxjcmVhdGVEZWNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fREVDX1hGT1JNX01PREUsdCxlKX0saW5pdDpmdW5jdGlvbih0LGUscil7dGhpcy5jZmc9dGhpcy5jZmcuZXh0ZW5kKHIpLHRoaXMuX3hmb3JtTW9kZT10LHRoaXMuX2tleT1lLHRoaXMucmVzZXQoKX0scmVzZXQ6ZnVuY3Rpb24oKXthLnJlc2V0LmNhbGwodGhpcyksdGhpcy5fZG9SZXNldCgpfSxwcm9jZXNzOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXtyZXR1cm4gdCYmdGhpcy5fYXBwZW5kKHQpLHRoaXMuX2RvRmluYWxpemUoKX0sa2V5U2l6ZTo0LGl2U2l6ZTo0LF9FTkNfWEZPUk1fTU9ERToxLF9ERUNfWEZPUk1fTU9ERToyLF9jcmVhdGVIZWxwZXI6ZnVuY3Rpb24oKXtmdW5jdGlvbiB0KHQpe3JldHVybiJzdHJpbmciPT10eXBlb2YgdD93Omd9cmV0dXJuIGZ1bmN0aW9uKGUpe3JldHVybntlbmNyeXB0OmZ1bmN0aW9uKHIsbixpKXtyZXR1cm4gdChuKS5lbmNyeXB0KGUscixuLGkpfSxkZWNyeXB0OmZ1bmN0aW9uKHIsbixpKXtyZXR1cm4gdChuKS5kZWNyeXB0KGUscixuLGkpfX19fSgpfSk7ci5TdHJlYW1DaXBoZXI9aC5leHRlbmQoe19kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3Byb2Nlc3MoITApfSxibG9ja1NpemU6MX0pO3ZhciBjPWUubW9kZT17fSx1PXIuQmxvY2tDaXBoZXJNb2RlPW4uZXh0ZW5kKHtjcmVhdGVFbmNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5FbmNyeXB0b3IuY3JlYXRlKHQsZSl9LGNyZWF0ZURlY3J5cHRvcjpmdW5jdGlvbih0LGUpe3JldHVybiB0aGlzLkRlY3J5cHRvci5jcmVhdGUodCxlKX0saW5pdDpmdW5jdGlvbih0LGUpe3RoaXMuX2NpcGhlcj10LHRoaXMuX2l2PWV9fSksXz1jLkNCQz1mdW5jdGlvbigpe3ZhciBlPXUuZXh0ZW5kKCk7ZnVuY3Rpb24gcihlLHIsbil7dmFyIGksYT10aGlzLl9pdjthPyhpPWEsdGhpcy5faXY9dCk6aT10aGlzLl9wcmV2QmxvY2s7Zm9yKHZhciBzPTA7czxuO3MrKyllW3Irc11ePWlbc119cmV0dXJuIGUuRW5jcnlwdG9yPWUuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZTtyLmNhbGwodGhpcyx0LGUsaSksbi5lbmNyeXB0QmxvY2sodCxlKSx0aGlzLl9wcmV2QmxvY2s9dC5zbGljZShlLGUraSl9fSksZS5EZWNyeXB0b3I9ZS5leHRlbmQoe3Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3ZhciBuPXRoaXMuX2NpcGhlcixpPW4uYmxvY2tTaXplLGE9dC5zbGljZShlLGUraSk7bi5kZWNyeXB0QmxvY2sodCxlKSxyLmNhbGwodGhpcyx0LGUsaSksdGhpcy5fcHJldkJsb2NrPWF9fSksZX0oKSxkPShlLnBhZD17fSkuUGtjczc9e3BhZDpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj00KmUsbj1yLXQuc2lnQnl0ZXMlcixhPW48PDI0fG48PDE2fG48PDh8bixzPVtdLG89MDtvPG47bys9NClzLnB1c2goYSk7dmFyIGw9aS5jcmVhdGUocyxuKTt0LmNvbmNhdChsKX0sdW5wYWQ6ZnVuY3Rpb24odCl7dmFyIGU9MjU1JnQud29yZHNbdC5zaWdCeXRlcy0xPj4+Ml07dC5zaWdCeXRlcy09ZX19O3IuQmxvY2tDaXBoZXI9aC5leHRlbmQoe2NmZzpoLmNmZy5leHRlbmQoe21vZGU6XyxwYWRkaW5nOmR9KSxyZXNldDpmdW5jdGlvbigpe3ZhciB0O2gucmVzZXQuY2FsbCh0aGlzKTt2YXIgZT10aGlzLmNmZyxyPWUuaXYsbj1lLm1vZGU7dGhpcy5feGZvcm1Nb2RlPT10aGlzLl9FTkNfWEZPUk1fTU9ERT90PW4uY3JlYXRlRW5jcnlwdG9yOih0PW4uY3JlYXRlRGVjcnlwdG9yLHRoaXMuX21pbkJ1ZmZlclNpemU9MSksdGhpcy5fbW9kZSYmdGhpcy5fbW9kZS5fX2NyZWF0b3I9PXQ/dGhpcy5fbW9kZS5pbml0KHRoaXMsciYmci53b3Jkcyk6KHRoaXMuX21vZGU9dC5jYWxsKG4sdGhpcyxyJiZyLndvcmRzKSx0aGlzLl9tb2RlLl9fY3JlYXRvcj10KX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dGhpcy5fbW9kZS5wcm9jZXNzQmxvY2sodCxlKX0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdCxlPXRoaXMuY2ZnLnBhZGRpbmc7cmV0dXJuIHRoaXMuX3hmb3JtTW9kZT09dGhpcy5fRU5DX1hGT1JNX01PREU/KGUucGFkKHRoaXMuX2RhdGEsdGhpcy5ibG9ja1NpemUpLHQ9dGhpcy5fcHJvY2VzcyghMCkpOih0PXRoaXMuX3Byb2Nlc3MoITApLGUudW5wYWQodCkpLHR9LGJsb2NrU2l6ZTo0fSk7dmFyIGY9ci5DaXBoZXJQYXJhbXM9bi5leHRlbmQoe2luaXQ6ZnVuY3Rpb24odCl7dGhpcy5taXhJbih0KX0sdG9TdHJpbmc6ZnVuY3Rpb24odCl7cmV0dXJuKHR8fHRoaXMuZm9ybWF0dGVyKS5zdHJpbmdpZnkodGhpcyl9fSkscD0oZS5mb3JtYXQ9e30pLk9wZW5TU0w9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt2YXIgZT10LmNpcGhlcnRleHQscj10LnNhbHQ7cmV0dXJuKHI/aS5jcmVhdGUoWzEzOTg4OTM2ODQsMTcwMTA3NjgzMV0pLmNvbmNhdChyKS5jb25jYXQoZSk6ZSkudG9TdHJpbmcobyl9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBlLHI9by5wYXJzZSh0KSxuPXIud29yZHM7cmV0dXJuIDEzOTg4OTM2ODQ9PW5bMF0mJjE3MDEwNzY4MzE9PW5bMV0mJihlPWkuY3JlYXRlKG4uc2xpY2UoMiw0KSksbi5zcGxpY2UoMCw0KSxyLnNpZ0J5dGVzLT0xNiksZi5jcmVhdGUoe2NpcGhlcnRleHQ6cixzYWx0OmV9KX19LGc9ci5TZXJpYWxpemFibGVDaXBoZXI9bi5leHRlbmQoe2NmZzpuLmV4dGVuZCh7Zm9ybWF0OnB9KSxlbmNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe249dGhpcy5jZmcuZXh0ZW5kKG4pO3ZhciBpPXQuY3JlYXRlRW5jcnlwdG9yKHIsbiksYT1pLmZpbmFsaXplKGUpLHM9aS5jZmc7cmV0dXJuIGYuY3JlYXRlKHtjaXBoZXJ0ZXh0OmEsa2V5OnIsaXY6cy5pdixhbGdvcml0aG06dCxtb2RlOnMubW9kZSxwYWRkaW5nOnMucGFkZGluZyxibG9ja1NpemU6dC5ibG9ja1NpemUsZm9ybWF0dGVyOm4uZm9ybWF0fSl9LGRlY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7cmV0dXJuIG49dGhpcy5jZmcuZXh0ZW5kKG4pLGU9dGhpcy5fcGFyc2UoZSxuLmZvcm1hdCksdC5jcmVhdGVEZWNyeXB0b3IocixuKS5maW5hbGl6ZShlLmNpcGhlcnRleHQpfSxfcGFyc2U6ZnVuY3Rpb24odCxlKXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/ZS5wYXJzZSh0LHRoaXMpOnR9fSkseT0oZS5rZGY9e30pLk9wZW5TU0w9e2V4ZWN1dGU6ZnVuY3Rpb24odCxlLHIsbixhKXtpZihufHwobj1pLnJhbmRvbSg4KSksYSlzPWwuY3JlYXRlKHtrZXlTaXplOmUrcixoYXNoZXI6YX0pLmNvbXB1dGUodCxuKTtlbHNlIHZhciBzPWwuY3JlYXRlKHtrZXlTaXplOmUrcn0pLmNvbXB1dGUodCxuKTt2YXIgbz1pLmNyZWF0ZShzLndvcmRzLnNsaWNlKGUpLDQqcik7cmV0dXJuIHMuc2lnQnl0ZXM9NCplLGYuY3JlYXRlKHtrZXk6cyxpdjpvLHNhbHQ6bn0pfX0sdz1yLlBhc3N3b3JkQmFzZWRDaXBoZXI9Zy5leHRlbmQoe2NmZzpnLmNmZy5leHRlbmQoe2tkZjp5fSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXt2YXIgaT0obj10aGlzLmNmZy5leHRlbmQobikpLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplLG4uc2FsdCxuLmhhc2hlcik7bi5pdj1pLml2O3ZhciBhPWcuZW5jcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pO3JldHVybiBhLm1peEluKGkpLGF9LGRlY3J5cHQ6ZnVuY3Rpb24odCxlLHIsbil7bj10aGlzLmNmZy5leHRlbmQobiksZT10aGlzLl9wYXJzZShlLG4uZm9ybWF0KTt2YXIgaT1uLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplLGUuc2FsdCxuLmhhc2hlcik7cmV0dXJuIG4uaXY9aS5pdixnLmRlY3J5cHQuY2FsbCh0aGlzLHQsZSxpLmtleSxuKX19KX0oKSkpKSkpLHkuZXhwb3J0cyksVD1lKEMpLEY9e2V4cG9ydHM6e319O2Z1bmN0aW9uIEgoKXtyZXR1cm4gVXx8KFU9MSxGLmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LGE9bi5IYXNoZXIscz1yLmFsZ28sbz1bXSxsPVtdOyFmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByPWUuc3FydCh0KSxuPTI7bjw9cjtuKyspaWYoISh0JW4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIHIodCl7cmV0dXJuIDQyOTQ5NjcyOTYqKHQtKDB8dCkpfDB9Zm9yKHZhciBuPTIsaT0wO2k8NjQ7KXQobikmJihpPDgmJihvW2ldPXIoZS5wb3cobiwuNSkpKSxsW2ldPXIoZS5wb3cobiwxLzMpKSxpKyspLG4rK30oKTt2YXIgaD1bXSxjPXMuU0hBMjU2PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChvLnNsaWNlKDApKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0scz1yWzNdLG89cls0XSxjPXJbNV0sdT1yWzZdLF89cls3XSxkPTA7ZDw2NDtkKyspe2lmKGQ8MTYpaFtkXT0wfHRbZStkXTtlbHNle3ZhciBmPWhbZC0xNV0scD0oZjw8MjV8Zj4+PjcpXihmPDwxNHxmPj4+MTgpXmY+Pj4zLGc9aFtkLTJdLHk9KGc8PDE1fGc+Pj4xNyleKGc8PDEzfGc+Pj4xOSleZz4+PjEwO2hbZF09cCtoW2QtN10reStoW2QtMTZdfXZhciB3PW4maV5uJmFeaSZhLHY9KG48PDMwfG4+Pj4yKV4objw8MTl8bj4+PjEzKV4objw8MTB8bj4+PjIyKSxtPV8rKChvPDwyNnxvPj4+NileKG88PDIxfG8+Pj4xMSleKG88PDd8bz4+PjI1KSkrKG8mY15+byZ1KStsW2RdK2hbZF07Xz11LHU9YyxjPW8sbz1zK218MCxzPWEsYT1pLGk9bixuPW0rKHYrdyl8MH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK2F8MCxyWzNdPXJbM10rc3wwLHJbNF09cls0XStvfDAscls1XT1yWzVdK2N8MCxyWzZdPXJbNl0rdXwwLHJbN109cls3XStffDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cmV0dXJuIHJbaT4+PjVdfD0xMjg8PDI0LWklMzIsclsxNCsoaSs2ND4+Pjk8PDQpXT1lLmZsb29yKG4vNDI5NDk2NzI5NiksclsxNSsoaSs2ND4+Pjk8PDQpXT1uLHQuc2lnQnl0ZXM9NCpyLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1hLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ci5TSEEyNTY9YS5fY3JlYXRlSGVscGVyKGMpLHIuSG1hY1NIQTI1Nj1hLl9jcmVhdGVIbWFjSGVscGVyKGMpfShNYXRoKSx0LlNIQTI1Nn0oXygpKSksRi5leHBvcnRzfXZhciBaLE09ZShIKCkpLE49e2V4cG9ydHM6e319O3ZhciBJLGo9KFp8fChaPTEsTi5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBBcnJheUJ1ZmZlcil7dmFyIGU9dC5saWIuV29yZEFycmF5LHI9ZS5pbml0LG49ZS5pbml0PWZ1bmN0aW9uKHQpe2lmKHQgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlciYmKHQ9bmV3IFVpbnQ4QXJyYXkodCkpLCh0IGluc3RhbmNlb2YgSW50OEFycmF5fHwidW5kZWZpbmVkIiE9dHlwZW9mIFVpbnQ4Q2xhbXBlZEFycmF5JiZ0IGluc3RhbmNlb2YgVWludDhDbGFtcGVkQXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgVWludDE2QXJyYXl8fHQgaW5zdGFuY2VvZiBJbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgVWludDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDMyQXJyYXl8fHQgaW5zdGFuY2VvZiBGbG9hdDY0QXJyYXkpJiYodD1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQsdC5ieXRlTGVuZ3RoKSksdCBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpe2Zvcih2YXIgZT10LmJ5dGVMZW5ndGgsbj1bXSxpPTA7aTxlO2krKyluW2k+Pj4yXXw9dFtpXTw8MjQtaSU0Kjg7ci5jYWxsKHRoaXMsbixlKX1lbHNlIHIuYXBwbHkodGhpcyxhcmd1bWVudHMpfTtuLnByb3RvdHlwZT1lfX0oKSx0LmxpYi5Xb3JkQXJyYXl9KF8oKSkpLE4uZXhwb3J0cyksUD1lKGopLCQ9e2V4cG9ydHM6e319O3ZhciBLPShJfHwoST0xLCQuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gdC5IbWFjU0hBMjU2fShfKCksSCgpLEUoKSkpLCQuZXhwb3J0cyksWD1lKEspO2NvbnN0IEc9ITE7bGV0IFcsWT1mZXRjaDtvbm1lc3NhZ2U9ZnVuY3Rpb24odCl7Y29uc3R7am9iOmUsY21kOnIsc2VydmVyOm4scGF0aDppLGJ1ZmZlcjphLGtleUJhc2U2NDpzLGd6aXA6bCxyZWZlcnJlcjpoLGlkOmMsYXBwSWQ6dSxwZXJzaXN0ZW50SWQ6XyxDUk9RVUVUX1ZFUlNJT046ZCxkZWJ1ZzpmLHdoYXQ6cCxvZmZsaW5lOnl9PXQuZGF0YTt5JiYoWT1rKTtzd2l0Y2gocil7Y2FzZSJ1cGxvYWRFbmNyeXB0ZWQiOngoaSk7YnJlYWs7Y2FzZSJnZXRPZmZsaW5lRmlsZSI6eih0LmRhdGEudXJsKTticmVhaztkZWZhdWx0OmNvbnNvbGUuZXJyb3IoIlVua25vd24gd29ya2VyIGNvbW1hbmQiLHIpfWZ1bmN0aW9uIHcodCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9UC5jcmVhdGUodCksbj1nLnBhcnNlKHMpLGk9WChyLG4pLGE9UC5yYW5kb20oMTYpLHtjaXBoZXJ0ZXh0Om99PVQuZW5jcnlwdChyLG4se2l2OmF9KSxsPW5ldyBBcnJheUJ1ZmZlcig0K2Euc2lnQnl0ZXMraS5zaWdCeXRlcytvLnNpZ0J5dGVzKSxoPW5ldyBEYXRhVmlldyhsKTtsZXQgdT0wO2guc2V0VWludDMyKHUsMTEyOTQ2ODIwOSwhMSksdSs9NDtmb3IoY29uc3QgdCBvZlthLGksb10pZm9yKGNvbnN0IGUgb2YgdC53b3JkcyloLnNldEludDMyKHUsZSwhMSksdSs9NDtyZXR1cm4gZiYmY29uc29sZS5sb2coYyxgJHtwfSBlbmNyeXB0ZWQgKCR7bC5ieXRlTGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxsfWZ1bmN0aW9uIHYodCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9by5kZWZsYXRlKHQse2d6aXA6ITAsbGV2ZWw6MX0pO3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IGNvbXByZXNzZWQgKCR7ci5sZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLHJ9ZnVuY3Rpb24gbSh0KXtjb25zdCBlPURhdGUubm93KCkscj1NKFAuY3JlYXRlKHQpKSxuPWcuc3RyaW5naWZ5KHIpLnJlcGxhY2UoLz0vZywiIikucmVwbGFjZSgvXCsvZywiLSIpLnJlcGxhY2UoL1wvL2csIl8iKTtyZXR1cm4gZiYmY29uc29sZS5sb2coYyxgJHtwfSBoYXNoZWQgKCR7dC5ieXRlTGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxufWFzeW5jIGZ1bmN0aW9uIGIodCl7aWYoeSl7Y29uc3QgZT1gb2ZmbGluZTovLy8ke3R9YDtyZXR1cm57dXJsOmUsdXBsb2FkVXJsOmV9fWNvbnN0IGU9RGF0ZS5ub3coKSxyPWAke24udXJsfS8ke3R9YDtpZighbi5hcGlLZXkpcmV0dXJue3VybDpyLHVwbG9hZFVybDpyfTtjb25zdCBpPWF3YWl0IFkocix7aGVhZGVyczp7IlgtQ3JvcXVldC1BdXRoIjpuLmFwaUtleSwiWC1Dcm9xdWV0LUFwcCI6dSwiWC1Dcm9xdWV0LUlkIjpfLCJYLUNyb3F1ZXQtU2Vzc2lvbiI6YywiWC1Dcm9xdWV0LVZlcnNpb24iOmQsIlgtQ3JvcXVldC1QYXRoIjpuZXcgVVJMKGgpLnBhdGhuYW1lfSxyZWZlcnJlcjpofSkse29rOmEsc3RhdHVzOnMsc3RhdHVzVGV4dDpvfT1pO2lmKCFhKXRocm93IEVycm9yKGBFcnJvciBpbiBzaWduaW5nIFVSTDogJHtzfSAtICR7b31gKTtjb25zdHtlcnJvcjpsLHJlYWQ6Zyx3cml0ZTp3fT1hd2FpdCBpLmpzb24oKTtpZihsKXRocm93IEVycm9yKGwpO3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGAke3B9IHVwbG9hZCBhdXRob3JpemVkIGluICR7RGF0ZS5ub3coKS1lfW1zYCkse3VybDpnLHVwbG9hZFVybDp3fX1hc3luYyBmdW5jdGlvbiB4KHQpe3RyeXtsZXQgcj13KGw/dihhKTphKTtHLHQuaW5jbHVkZXMoIiVIQVNIJSIpJiYodD10LnJlcGxhY2UoIiVIQVNIJSIsbShyKSkpO2NvbnN0e3VwbG9hZFVybDpuLHVybDppfT1hd2FpdCBiKHQpLHM9RGF0ZS5ub3coKSx7b2s6byxzdGF0dXM6dSxzdGF0dXNUZXh0Ol99PWF3YWl0IFkobix7bWV0aG9kOiJQVVQiLG1vZGU6ImNvcnMiLGhlYWRlcnM6eyJDb250ZW50LVR5cGUiOiJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0ifSxyZWZlcnJlcjpoLGJvZHk6cn0pO2lmKCFvKXRocm93IEVycm9yKGBzZXJ2ZXIgcmV0dXJuZWQgJHt1fSAke199IGZvciBQVVQgJHtufWApO2YmJmNvbnNvbGUubG9nKGMsYCR7cH0gdXBsb2FkZWQgKCR7dX0pIGluICR7RGF0ZS5ub3coKS1zfW1zICR7aX1gKSxXKHtqb2I6ZSx1cmw6aSxvazpvLHN0YXR1czp1LHN0YXR1c1RleHQ6XyxieXRlczpyLmJ5dGVMZW5ndGh9KX1jYXRjaCh0KXtmJiZjb25zb2xlLmVycm9yKGAke2N9IHVwbG9hZCBlcnJvciAke3QubWVzc2FnZX1gKSxXKHtqb2I6ZSxvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDp0Lm1lc3NhZ2V9KX19ZnVuY3Rpb24gayh0LGUpe3JldHVybiBmJiZjb25zb2xlLmxvZyhjLGBzdG9yaW5nICR7dH1gKSxxLnNldCh0LGUuYm9keSkse29rOiEwLHN0YXR1czoyMDEsc3RhdHVzVGV4dDoiT2ZmbGluZSBjcmVhdGVkIn19ZnVuY3Rpb24geih0KXtjb25zdCByPXEuZ2V0KHQpO2lmKCFyKXJldHVybiBmJiZjb25zb2xlLmVycm9yKGAke2N9IGZpbGUgbm90IGZvdW5kICR7dH1gKSx2b2lkIFcoe2pvYjplLG9rOiExLHN0YXR1czotMSxzdGF0dXNUZXh0OiJPZmZsaW5lIGZpbGUgbm90IGZvdW5kIn0pO2YmJmNvbnNvbGUubG9nKGMsYHJldHJpZXZlZCAke3R9YCksVyh7am9iOmUsb2s6ITAsc3RhdHVzOjIwMCxzdGF0dXNUZXh0OiJPZmZsaW5lIGZpbGUgZm91bmQiLGJvZHk6cixieXRlczpyLmJ5dGVMZW5ndGh9KX19LFc9cG9zdE1lc3NhZ2U7Y29uc3QgcT1uZXcgTWFwfSgpOwovLyMgc291cmNlTWFwcGluZ1VSTD11cGxvYWQuanMubWFwCgo=");const ic=r.CROQUET_VERSION,oc="node"===r.CROQUET_PLATFORM,rc="https://croquet.io/files/v1",ac="https://files.croquet.io",lc=ac;let cc=null;function dc(){globalThis.__MULTISYNQ__||(oc?console.log("Croquet "+ic):console.log("%cCroquet%c %c"+ic,"color:#F0493E","color:inherit","color:"+(ic.includes("+")?"#909":"inherit")));const t=!oc&&window.location.hostname.match(/^(.*\.)?croquet\.io$/i)&&window.location.pathname.startsWith("/dev/"),e=h.dev||!1!==h.dev&&t;if(cc={messages:h.has("debug","messages",!1),sends:h.has("debug","sends",!1),publish:h.has("debug","publish",!1),events:h.has("debug","events",!1),ticks:h.has("debug","ticks",!1),pong:h.has("debug","pong",!1),snapshot:h.has("debug","snapshot",!1),session:h.has("debug","session",!1),initsnapshot:h.has("debug","initsnapshot",!0),reflector:h.has("debug","reflector",e),offline:h.has("debug","offline",!1)},cc.offline&&Ot.showMessage(`${Ot.libName}: offline mode enabled, no multiuser`,{level:"warning"}),h.box){let t=new URL(h.box,window.location).href;t.endsWith("/")||(t+="/"),h.reflector=t+"reflector",h.files=t+"files"}}function hc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};cc||dc(),"string"==typeof t&&(t=Object.fromEntries(t.split(",").map((e=>[e.replace(/^no/,""),!t.startsWith("no")]))));for(const[e,s]of Object.entries(t))e in cc?cc[e]=s:Ot.showMessage(`${Ot.libName}: unknown debug option "${e}"`,{level:"warning",only:"once"});return cc}const uc="wss://api.multisynq.io/depin",mc=uc;let pc,fc,bc="reflector";const yc=h.nocheat,gc=200,wc=[0],Zc=4096;let vc;const Xc=new nc;Xc.onerror=t=>console.error(`UploadWorker error: ${t.message}`);let xc=0;const Lc=new Set;function Sc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=null;for(const s of Lc)if(e||(e=s),s.id===t){e=s;break}if(e){const{appId:t,persistentId:s}=e.sessionSpec;return{appId:t,persistentId:s,key:e.key,uploadEncrypted:t=>e.uploadEncrypted(t),downloadEncrypted:t=>e.downloadEncrypted(t)}}return{}}Object.defineProperty($t,"controller",{get(){return this.controllers.values().next().value}}),$t.controllers=Lc;class Gc{constructor(){cc||dc(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new Tc(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.viewDataEncrypted=this.viewDataEncrypted||null,this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.lastSnapshotRequest=0,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.auditStats={lastUsers:-1,minUsers:-1,maxUsers:-1,payloadTally:0},this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,$t.removeAllSubscriptionsFor(this.viewId),$t.addSubscription(this.viewId,"__views__",this.viewId,(t=>It(`users now ${t}`)),"oncePerFrameWhileSynced"),this.leaving||Ot.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}get migratingOldSnapshot(){if(!this.sessionSpec)return!1;const{codeHash:t,computedCodeHash:e}=this.sessionSpec;return t!==e}checkForConnection(t){this.connection.checkForConnection(t)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(t){const{name:e,optionsFromUrl:s,persistentIdOptions:n,password:i,appId:o,apiKey:r,viewData:a,viewIdDebugSuffix:l,location:c}=t,d=o?`${o}/${e}`:e;this.key=po(i,"",{keySize:8,hasher:so.algo.SHA1,iterations:1}),l&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+l).slice(0,16)).replace(/[^a-z0-9]/gi,(t=>`_${"%"===t?"":t.charCodeAt(0).toString(16).toUpperCase()}`)));const u={...t.options};if(s)for(const t of s)t in h&&(u[t]=h[t]);const m={},p={};for(const[t,e]of Object.entries(u))n?.includes(t)?m[t]=e:p[t]=e;const f=cc.events||cc.publish;f&&(p.__debugEvents=!0),c&&(p.__location=!0);const b=h.hashOverride||t.hashOverride,y=await async function(t,e){return O(t+k(e))}(d,m),{developerId:g,token:w}=await this.verifyApiKey(r,o,y),{id:Z,codeHash:v,computedCodeHash:X}=await async function(t,e,s,n,i){let o,r;const a=A[t];let l="";a?(o=a.codeHashes,r=a.computedCodeHash,l=" (code hashing from cache)"):(o=await Promise.all(B),r=await O([i,...o].join("|")),A[t]={codeHashes:o,computedCodeHash:r});const c=n||r,d=await O(t+"|"+e+k(s)+c);if(j()&&!$.has(d)){(_?"utf-8":[...document.getElementsByTagName("meta")].find((t=>t.getAttribute("charset"))))||console.warn(`${Ot.libName}: Missing <meta charset="..."> declaration. ${Ot.libName} model code hashing might differ between browsers.`),U[r].what="Version ID",U[t].what="Persistent ID",U[d].what="Session ID",c!==r&&(o.push(r),U[r].what="Computed Version ID (replaced by overrideHash)",U[c]={what:"Version ID (as specified by overrideHash)"});const e=[...o,c,t,d].map((t=>({hash:t,...U[t]})));console.log(`${Ot.libName}: Debug Hashing for session ${d}${l}`,e),$.add(d)}return j()||(U={}),{id:d,persistentId:t,codeHash:c,computedCodeHash:r}}(y,g,p,b,ic);this.tove||(this.tove=await this.encrypt(Z)),a&&!this.viewDataEncrypted&&(this.viewDataEncrypted=await this.encryptPayload(a)),cc.session&&console.log(`${Ot.libName} session "${d}":\n        sessionId=${Z}${o?`\n        persistentId=${y}`:""}\n        versionId=${v===X?v:`${v} (specified in hashOverride)\n        versionId=${X} (computed)`}\n        viewId=${this.viewId}`),this.eventRateLimit=t.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...t,options:u,name:d,id:Z,persistentId:y,developerId:g,token:w,codeHash:v,computedCodeHash:X,debugEvents:f};const{msPerTick:x,multiplier:L}=this.getTickAndMultiplier();this.msPerTick=x,this.tickMultiplier=L,this.setUpActivityChecks()}async establishSession(){const{id:t,persistentId:e,codeHash:s}=this.sessionSpec;this.sessionSpec.snapshot={id:t,time:0,meta:{id:t,persistentId:e,codeHash:s,created:(new Date).toISOString()}};const n=new Promise((t=>{this.sessionSpec.sessionJoined=t}));this.checkForConnection(!1),cc.session&&console.log(t,"waiting for join and SYNC"),await n,this.sessionSpec.sessionJoined=()=>{},this.syncCompleted=!0}getBackend(t){if(cc.offline)return{apiKey:"none",signServer:"none",reflector:"none"};if(h.box||h.reflector)return{apiKey:"none",signServer:"none",reflector:h.reflector};const e={};for(const s of t.split(",")){const t=s.lastIndexOf(":"),n=s[-1===t?0:t+1];if(!n?.match(/^[12]$/))throw Error("Invalid API key: "+s);if(n in e)throw Error("Duplicate API key versions");e[n]={key:-1===t?s:s.slice(t+1),backend:-1===t?"":s.slice(0,t)}}let s=!e[1];s&&e[2].backend&&(s=e[2].backend),function(t){void 0===pc&&(pc="depin"in h?h.depin:t,pc&&!cc.offline?(fc=!0===pc?mc:"prod"===pc?uc:"dev"===pc?"wss://api.multisynq.dev/depin":"local"===pc?"ws://localhost:8787":pc,fc.endsWith("/")&&(fc=fc.slice(0,-1)),fc=fc.replace(/^http(s):/,"ws$1:"),fc.startsWith("ws")||(fc=(oc||"https:"!==window.location.protocol?"ws://":"wss://")+fc),bc="synchronizer",cc.session&&console.log(`DEPIN_API=${fc}`)):pc=!1)}(s);const n=e[pc?2:1];if(!n)throw Error(`No ${pc?"Multisynq":"Croquet"} API key provided`);const i=n.key,o=h.backend||n.backend,r=h.reflector?.includes("/");if("none"===o)return{apiKey:i,signServer:"none",reflector:"overridden"};if(pc)return{apiKey:i,signServer:`${fc.replace(/^ws/,"http")}/clients`,reflector:"depin"};return{apiKey:i,signServer:"https://api.croquet.io/sign",reflector:r?"overridden":"wss://api.croquet.io/reflector/v1"}}async verifyApiKey(t,e,s){const{signServer:n,apiKey:i}=this.getBackend(t);if("none"===n)return{developerId:"unknown_dev_id"};try{const t=2,o=await this.fetchWithRetries("verifying API key",[403],t,(()=>fetch(`${n}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":i,"X-Croquet-App":e,"X-Croquet-Id":s,"X-Croquet-Version":ic,"X-Croquet-Path":new URL(Ot.referrerURL()).pathname},referrer:Ot.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"}))),r=await o.json(),{developerId:a,error:l}=r;if(l)throw Error(l);return cc.session&&console.log(`${pc?"Multisynq":"Croquet"}: verified API key for developer ${a}`),r}catch(t){throw Error(`${pc?"Multisynq":"Croquet"} API key validation failed for "${i}": ${t.message}`)}}async fetchWithRetries(t,e,s,n){const i=1+s;let o,r=0;for(;;){let s,a;try{if(s=await n(),s.ok)return s}catch(t){a=t}r++;let l="";const c=s&&e.includes(s.status);if(c?l="fatal ":r===i&&(l="final "),o=s?`${l}status ${s.status} ${s.statusText} - "${await s.text()}"`:`${l}error "${a?.message}"`,r===i||c)break;const d=1===r?100:2===r?1e3:5e3;console.warn(`${o} while ${t}; retrying in ${d}ms`),await new Promise((t=>{setTimeout(t,d)}))}throw console.warn(`${o} while ${t}; giving up`),Error(o)}lastKnownTime(t){return Math.max(t.time,t.externalTime)}takeSnapshot(){const t=this.vm.snapshot(),e=this.lastKnownTime(t),s=t.externalSeq;return t.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:e,seq:s,date:(new globalThis.CroquetViewDate).toISOString(),host:oc?"localhost":window.location.hostname,sdk:ic},delete t.meta.hash,t}takeSnapshotHandleErrors(){let t,e,s;try{t=xt.begin("snapshot"),s=this.takeSnapshot()}catch(t){return Vt("snapshot",t),null}finally{e=xt.end("snapshot")-t}return cc.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(e)}ms`),s}setDebug(t){return hc(t)}requestDebugSnapshot(){hc("snapshot"),this.triggeringCpuTime=1e-10,this.scheduleSnapshot(this.viewId)}scheduleSnapshot(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.connected||!this.vm||this.viewOnly)return;const e=this.vm.time,s=e-this.vm.lastSnapshotPoll;if(s<5e3&&!t)return void(cc.snapshot&&console.log(`not requesting snapshot poll (${s}ms since poll scheduled)`));if(this.migratingOldSnapshot)return void alert("Snapshot is due but hashOverride is set. Ignoring.");if(t){const e=Object.keys(this.vm.views);if(e.sort(),t!==this.viewId&&e[0]!==this.viewId&&e[1]!==this.viewId&&e[2]!==this.viewId)return void(cc.snapshot&&console.log("not forcing snapshot poll (not one of the three)"));cc.snapshot&&console.log("forcing snapshot poll")}const n=new gd(e,0,"_","handlePollForSnapshot",[]);this.sendTagged(n,{debounce:5e3,msgID:"pollForSnapshot"}),cc.snapshot&&console.log(this.id,`requesting snapshot poll via ${bc}`)}handlePollForSnapshot(t){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const e=this.triggeringCpuTime||this.cpuTime;let s,n,i;this.triggeringCpuTime=null,this.cpuTime=0;try{s=xt.begin("snapshot"),n={cpuTime:e,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(t){return void Vt("snapshot",t)}finally{i=xt.end("snapshot")-s,this.cpuTime-=i}cc.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(i)}ms`),queueMicrotask((()=>this.pollForSnapshot(t,n)))}pollForSnapshot(t,e){e.cpuTime+=Math.random(),cc.snapshot&&console.log(this.id,"sending snapshot vote",e),this.sendTutti({time:t,topic:"snapshot",data:e,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(t){const{tally:e}=t;cc.snapshot&&console.log(this.id,"received snapshot votes",e);const{numberOfGroups:s,shouldUpload:n,dissidentFlag:i}=this.analyzeTally(e,"cpuTime");if(s>1){this.diverged=!0;const t=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${t})! Snapshots fall into ${s} groups`)}if(!0!==this.synced)cc.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync");else if(n){const t={...this.auditStats},e=this.takeSnapshotHandleErrors();e&&queueMicrotask((()=>this.uploadSnapshot(e,t,i)))}}analyzeTally(t,e){let s=!1,n=null;const i=[],o={};let r=null;Object.keys(t).forEach(((t,e)=>{const s=JSON.parse(t);i.push(s);const{hash:n,viewId:a}=s;a===this.viewId&&(r=e),o[n]||(o[n]=[]),o[n].push(e)}));const a=Object.keys(o),l=a.length;let c=0;l>1&&(a.sort(((t,e)=>o[e].length-o[t].length)),o[a[0]].length===o[a[1]].length&&(cc.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==r){const t=i[r].hash,a=o[t];a.length>1&&a.sort(((t,s)=>i[t][e]-i[s][e])),a[0]===r&&(s=!0,t!==d&&(n={groupVotes:a.length,allVotes:i.length}))}return{numberOfGroups:l,shouldUpload:s,dissidentFlag:n}}snapshotPath(t,e,s){const n=Math.ceil(t).toString().padStart(10,"0"),{appId:i,persistentId:o,codeHash:r,apiKey:a}=this.sessionSpec;return a?`apps/${i}/snap/${r}/${o}.${this.id}/${n}_${e}.${s}`:`snapshots/${this.id}/${n}_${e}-${s}.snap`}hashSnapshot(t){return t.meta.hash?t.meta.hash:(t.meta.hashPromise||(t.meta.hashPromise=new Promise((e=>{const s={...t};delete s.meta,O(JSON.stringify(s)).then((s=>{t.meta.hash=s,delete t.meta.hashPromise,e(s)}))}))),t.meta.hashPromise)}uploadServer(t){if("string"==typeof h.files){let t=new URL(h.files,window.location).href;return t.endsWith("/")&&(t=t.slice(0,-1)),{url:t,apiKey:null}}const{apiKey:e,signServer:s}=this.getBackend(t);if("none"===s&&!cc.offline)throw Error("no file server configured");return{url:s,apiKey:e}}async uploadSnapshot(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;await this.hashSnapshot(t);const n=xt.begin("snapshot"),i=JSON.stringify(t),o=xt.end("snapshot")-n;cc.snapshot&&console.log(this.id,`snapshot stringified (${i.length} bytes) in ${Math.ceil(o)}ms`);const{time:r,seq:a,hash:l}=t.meta,c=this.connection.socket;try{const t=await this.uploadEncrypted({content:i,path:this.snapshotPath(r,a,l),key:this.key,gzip:!0,debug:cc.snapshot,what:"snapshot"});return this.connection.socket!==c?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(r,a,l,t,e,s),!0)}catch(t){return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(t,e,s,n,i,o){if(cc.snapshot){let i=`time: ${t}, seq: ${e}, hash: ${s}`;o&&(i+=", as dissident; "+JSON.stringify(o)),console.log(this.id,`sending snapshot url to ${bc} (${i}): ${n}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:t,seq:e,hash:s,url:n,auditStats:i,dissident:o}}))}catch(t){console.error("ERROR while sending",t)}this.diverged&&this.vm.publishFromView("__VM__","__diverged__",{key:`@${t}#${e}`,url:n,dissident:o})}async diffDivergedSnapshots(t){const e=await Promise.all(t.map((t=>this.downloadEncrypted({url:t,gzip:!0,key:this.key,debug:cc.snapshot,json:!0,what:"diverged snapshot"}))));for(const t of e)delete t.meta;let s=0;!function t(e,n,i){if(typeof e!=typeof n)console.log(`${i} diverged (${typeof e} vs ${typeof n}):`,e,n),s++;else if(Array.isArray(e)!==Array.isArray(n))console.log(`${i} diverged (array vs object):`,e,n),s++;else if("object"==typeof e){const o=e?Object.keys(e):[],r=n?Object.keys(n):[],a=o.filter((t=>!r.includes(t))),l=r.filter((t=>!o.includes(t)));(a.length||l.length)&&(console.log(`${i} diverged (keys mismatch):`,a,l),s++);for(const s of o)r.includes(s)&&t(e[s],n[s],`${i}${Jc(e,s)}`)}else e!==n&&(console.log(`${i} diverged (value mismatch):`,e,n),s++)}(e[0],e[1],"CROQUETVM"),s?console.log(`Total ${s} differences between diverged snapshots:`,e.slice(0,2)):console.log("... but diverged snapshots are identical?!")}async downloadEncrypted(t){let{url:e,gzip:s,key:n,debug:i,json:o,what:r}=t;e.startsWith(rc)&&(e=e.replace(rc,ac));const a=e.startsWith("offline:"),l=a?1:3;let c=Date.now();const d=await this.fetchWithRetries(`fetching ${r}`,[],l,(()=>a?this.fetchOffline(e,r,i):fetch(e,{method:"GET",mode:"cors",referrer:Ot.referrerURL()}))),h=await d.arrayBuffer();i&&console.log(this.id,`${r} fetched (${h.byteLength} bytes) in ${-c+(c=Date.now())}ms`),xt.addNetworkTraffic(`${r}_in`,h.byteLength);const u=this.decryptBinary(h,n);i&&console.log(this.id,`${r} decrypted (${u.length} bytes) in ${-c+(c=Date.now())}ms`);const m=s?Bl.inflate(u):u;return i&&s&&console.log(this.id,`${r} inflated (${m.length} bytes) in ${-c+(c=Date.now())}ms`),o?JSON.parse((new TextDecoder).decode(m)):m}async fetchOffline(t,e,s){const n=++xc;return new Promise(((i,o)=>{const r=oc?"addListener":"addEventListener",a=oc?"removeListener":"removeEventListener";Xc.postMessage({job:n,cmd:"getOfflineFile",url:t,id:this.id,what:e,debug:s,offline:cc.offline});const l=t=>{if(n!==t.data.job)return;const{ok:s,status:r,statusText:c,body:d,bytes:h}=t.data;xt.addNetworkTraffic(`${e}_out`,h),Xc[a]("message",l),s?i({arrayBuffer:()=>d}):o(Error(`${r}: ${c}`))};try{Xc[r]("message",l)}catch(t){console.log("failed to add listener",t)}}))}async uploadEncrypted(t){let{content:e,path:s,key:n,gzip:i,keep:o,debug:r,what:a}=t;const l="string"==typeof e?(new TextEncoder).encode(e).buffer:e,c=o?void 0:[l],d="string"==typeof n?n:eo.stringify(n),{apiKey:h,appId:u,persistentId:m}=this.sessionSpec,p=++xc;return new Promise(((t,e)=>{const n=oc?"addListener":"addEventListener",o=oc?"removeListener":"removeEventListener";Xc.postMessage({job:p,cmd:"uploadEncrypted",server:this.uploadServer(h),path:s,buffer:l,keyBase64:d,gzip:i,referrer:Ot.referrerURL(),id:this.id,appId:u,persistentId:m,CROQUET_VERSION:ic,debug:r,what:a,offline:cc.offline},c);const f=s=>{if(p!==s.data.job)return;const{url:n,ok:i,status:r,statusText:l,bytes:c}=s.data;xt.addNetworkTraffic(`${a}_out`,c),Xc[o]("message",f),i?t(n):e(Error(`${r}: ${l}`))};try{Xc[n]("message",f)}catch(t){console.log("failed to add listener",t)}}))}persistentPath(t){const{appId:e,persistentId:s}=this.sessionSpec;return`apps/${e}/${s}/save/${t}`}pollForPersist(t,e,s,n,i){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");if(cc.offline)return;const o={viewId:this.viewId,hash:n,ms:i+.001*Math.random()},r={persistTime:e,persistentHash:n,persistentString:s};cc.snapshot&&console.log(this.id,`sending persistence vote for time @${e}`,o),this.sendTutti({time:t,topic:"persist",data:o,localContext:r,tallyTarget:["handlePersistVote"]})}async handlePersistVote(t){const{tally:e,localContext:s}=t;if(cc.snapshot){const t=!!s?`for time @${s.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${t}`,e)}const{numberOfGroups:n,shouldUpload:i,dissidentFlag:o}=this.analyzeTally(e,"ms");if(n>1&&console.warn(this.id,`Persistence records fall into ${n} groups`),!i||!s)return;const{persistTime:r,persistentHash:a,persistentString:l}=s;this.doPersist(r,l,a,o)}async doPersist(t,e,s,n){const i=await this.uploadEncrypted({path:this.persistentPath(s),content:e,key:this.key,gzip:!0,debug:cc.snapshot,what:"persistence"});if(cc.snapshot){const t=n?` (as dissident; ${JSON.stringify(n)})`:"";console.log(this.id,`sending persistent data url to ${bc}${t}: ${i}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:t,url:i,dissident:n}}))}catch(t){console.error("ERROR while sending",t)}}async forcePersist(t,e,s){this.didForcePersist?console.warn(this.id,"forcePersist called more than once, ignoring"):(console.warn(this.id,`forcePersist, will upload ${e.length} bytes`),"alert"===h.forcePersist&&confirm("forcePersist triggered. Do it?"),await this.doPersist(t,e,s),console.warn(this.id,"forcePersist completed"),this.didForcePersist=!0)}convertReflectorMessage(t){let e="noop",s=[];switch(t[2].what){case"users":{const{joined:n,left:i,active:o,total:r}=t[2];this.users=o,this.usersTotal=r;const a="__VM__",l="__peers__",c={entered:n||[],exited:i||[],count:o,total:r};for(const t of c.entered.concat(c.exited))t.data&&(t.data=this.decryptPayload(t.data));e="publishFromModelOnly",s=[a,l,c],$t.handleEvent(this.viewId+":__views__",c.count);break}case"tally":{const{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r,missingClients:a}=t[2];(cc.messages||cc.snapshot)&&a&&console.log(`${a} ${1===a?"client":"clients"} failed to participate in tally ${i||n}`),e="handleTuttiResult",s=[{tuttiSeq:n,tuttiKey:i,tally:o,tallyTarget:r}];break}case"audit":{const n=t[0];cc.messages&&console.log(`audit request at time ${n}`),e="handleAuditRequest",s=[{time:n}];break}}const n=new gd(0,0,"_",e,s);t[2]=n.asState()[2]}handleTuttiResult(t){const{tuttiSeq:e,tuttiKey:s,tally:n,tallyTarget:i}=t,o=s?t=>t.tuttiKey===s:t=>t.dummyTuttiSeq===e,r=this.tuttiHistory.findIndex(o),a=-1!==r&&this.tuttiHistory.splice(r,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),i){const[t,...e]=i,s=[...e,{tally:n,localPayload:l,localContext:c}],o=new gd(0,0,"_",t,s);this.vm.verifyExternal(o),o.executeOn(this.vm,!0)}}handleAuditRequest(t){const{time:e}=t;this.vm.time!==e&&console.error(`time ${this.vm.time} cf audit time ${e}`);const{auditStats:s}=this,{lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,sessionTimeAtDispatch:a}=s;if(s.payloadTally=0,this.vm.time>a&&(s.minUsers=s.maxUsers=n),!this.fastForwardHandler){const t=xt.networkTraffic.audit_reflector_in||0,s=xt.networkTraffic.audit_reflector_out||0;xt.resetAuditStats();const{clientId:a}=this.connection.socket;queueMicrotask((()=>{cc.session&&console.log(this.id,`handling audit request at ${e} after ${t} bytes in, ${s} out`);const l=encodeURIComponent(JSON.stringify({time:e,clientId:a,lastUsers:n,minUsers:i,maxUsers:o,payloadTally:r,bytesIn:t,bytesOut:s})),c=`${fc}/clients/report?session=${this.id}&stats=${l}`.replace("ws","http");fetch(c,{mode:"no-cors"})}))}}handleUserTotalForAccounting(t){if(pc){const{auditStats:e}=this;if(e.lastUsers=t,this.vm.time<=e.sessionTimeAtDispatch)return;(-1===e.minUsers||t<e.minUsers)&&(e.minUsers=t),t>e.maxUsers&&(e.maxUsers=t)}}messageSizeForAccounting(t){let e="string"==typeof t[2]?t[2].length:t[2]._size||0;return e+=16,e}async receive(t,e){const s=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,t){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),Lc.add(this);const{progressReporter:t}=this.sessionSpec,s=t||(()=>{}),{messages:n,url:i,persisted:o,time:r,seq:a,snapshotSeq:l,tove:c,reflector:d,flags:h,auditStatsInitializer:u}=e;if(c&&c!==this.tove)try{if(this.decrypt(c)!==this.id)throw Error("wrong sessionId in tove?!")}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`session password check: ${t.message}`),4200),void s(-1)}const m=e.timeline;this.flags=h||{};const p=o?"persistence":"snapshot";cc.session&&console.log(this.id,`received SYNC from ${d} ${bc}: time ${r}, ${n.length} messages, ${p} ${i||"<none>"}`);let f=!!this.vm;if(f){this.networkQueue.length=0;const t=!!m&&m===this.timeline,e=n[0],s=a,i=void 0!==l?l:e?e[1]:s;cc.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${i}-#${s}`);let o=t&&yd(i,this.vm.seq)&&yd(this.vm.seq,s)&&r>=this.reflectorTime;if(o){let t=0;e&&yd(e[1],this.vm.seq)&&(t=this.vm.seq-e[1]+1>>>0);for(let e=t;o&&e<n.length;e++){const t=n[e][2];"string"!=typeof t&&"users"===t.what&&t.left&&t.left.includes(this.viewId)&&(cc.session&&console.log(this.id,`${bc} reports that this view has left`),o=!1)}o&&t&&(cc.messages&&console.log(this.id,`rejoin: discarding ${t} messages #${e[1]}-#${this.vm.seq}`),n.splice(0,t))}if(o){if(this.sendBuffer.length>0){const t=this.sendBuffer;this.sendBuffer=[],cc.session&&console.log(this.id,`rejoin: sending ${t.length} messages buffered while disconnected`);for(const e of t)e()}}else cc.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),f=!1}const b=this.networkQueue;this.networkQueue=[];for(const t of n){const e=this.messageSizeForAccounting(t);if("string"!=typeof t[2])this.convertReflectorMessage(t);else try{t[2]=this.decryptPayload(t[2])[0]}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`session password decrypt: ${t.message}`),4200),void s(-1)}cc.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(t)),this.networkQueue.push([t,e])}if(this.networkQueue.push(...b),r>this.reflectorTime&&this.timeFromReflector(r,"reflector"),f)return cc.session&&console.log(this.id,"seamless rejoin successful"),void(this.syncCompleted=!0);let y;if(this.timeline=m||"",cc.snapshot&&i&&console.log(this.id,`fetching ${p} ${i}`),i)try{y=await this.downloadEncrypted({url:i,gzip:!0,key:this.key,debug:cc.snapshot,json:!0,what:p})}catch(t){return this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${p}: ${t.message}`),4200),void s(-1)}if(!this.connected)return console.log(this.id,"disconnected during SYNC"),void s(-1);if(o){if(this.migratingOldSnapshot)throw Error("hashOverride is enabled but got persisted data instead of snapshot");this.install(y)}else y&&(this.sessionSpec.snapshot=y),this.install();u&&(cc.session&&console.log(this.id,`installing audit stats: ${JSON.stringify(u)}`),this.auditStats=u),cc.session&&console.log(this.id,`fast-forwarding from ${Math.round(this.vm.time)} to at least ${r}`);const g=this.vm.time,w=await new Promise((t=>{const{port1:e,port2:n}=new MessageChannel;e.onmessage=()=>{let e=!0;if(this.vm)if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(s(1),t(!0),e=!1);else{const t=(this.vm.time-g)/(this.reflectorTime-g);s(t)}else cc.session&&console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),t(!1),e=!1;e&&this.stepSession("fastForward",{budget:gc})};this.fastForwardHandler=e=>{this.connected&&this.vm?"error"===e?(s(-1),t(!1)):n.postMessage("tick"):(console.log(this.id,"disconnected during SYNC fast-forwarding"),s(-1),t(!1))},queueMicrotask((()=>this.stepSession("fastForward",{budget:gc})))}));return delete this.fastForwardHandler,void(w&&(cc.session&&console.log(this.id,`fast-forwarded to ${Math.round(this.vm.time)}`),this.vm.diverged&&Ot.showMessage(`${Ot.libName}: session had diverged. Try CROQUETVM.debugDiverged()`,{level:"warning",only:"once"}),this.sessionSpec.sessionJoined()))}case"RECV":{const t=e;t[1]>>>=0;const s=this.messageSizeForAccounting(t);if("string"!=typeof t[2])cc.messages&&console.log(this.id,"received META "+JSON.stringify(t)),this.convertReflectorMessage(t),cc.messages&&console.log(this.id,"converted to "+JSON.stringify(t));else try{const[e,s,n]=this.decryptPayload(t[2]);t[2]=e,s===this.viewId&&this.addToStatistics(n,this.lastReceived),cc.messages&&console.log(this.id,"received "+JSON.stringify(t))}catch(t){return void this.connection.closeConnectionWithError("RECV",Error(`session password decrypt: ${t.message}`),4200)}let n;return this.networkQueue.push([t,s]),this.flags.rawtime&&(n=t[t.length-1]),this.timeFromReflector(t[0],"reflector",n),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"TICK":{if(!this.vm)return;const t="number"==typeof e?e:e.time;if(cc.ticks){const e=s&&this.lastReceived-s-this.msPerTick*this.tickMultiplier|0,n=t-this.vm.time;console.log(this.id,`received TICK ${t} ${Math.abs(e)<5?"on time":e<0?"early":"late"} (${n} ms, jitter ${e>0?"+":""}${e} ms)`)}return this.timeFromReflector(t,"reflector"),this.tickMultiplier>1&&this.multiplyTick(t),void(this.simulateIfNeeded&&queueMicrotask((()=>this.simulateIfNeeded())))}case"INFO":{const{msg:t,options:s}=e,n=pc?"Multisynq Synchronizer":"Croquet Reflector";return void Ot.showMessage(`${n}: ${t}`,s)}case"REQU":return cc.snapshot&&console.log(`received REQU (snapshot request) from ${bc}`),void(this.reflectorNeedsSnapshot=!0);case"RECONNECT":this.connection.socket?.synchronizerDisconnected(4003,"told to reconnect");break;default:console.warn("Unknown action:",t,e)}}install(t){const e=Date.now(),{snapshot:s,initFn:n,options:i,debugEvents:o}=this.sessionSpec,[r,a]=s.models?["deserializ","snapshot"]:["initializ","root model"];cc.session&&console.log(this.id,`${r}ing ${a}`);let l=new fd(s,o,(()=>{try{return n(i,t)}catch(t){throw Vt("init",t,"fatal"),t}}),this.migratingOldSnapshot);if((cc.session||cc.snapshot&&s.models)&&console.log(this.id,`${a} ${r}ed in ${Date.now()-e}ms`),cc.initsnapshot&&!s.models){cc.snapshot&&console.log(this.id,"exercising snapshot and restore after init()");let t=null;try{t=JSON.stringify(l.snapshot())}catch(t){throw Vt("initial snapshot",t,"fatal"),t}try{l=new fd(JSON.parse(t),o,(()=>n(i)))}catch(t){throw Vt("initial snapshot resume",t,"fatal"),t}}const c=this.lastKnownTime(l);this.reflectorTime=Math.max(this.reflectorTime,c),this.setVM(l)}setVM(t){this.vm=t,this.vm.controller=this}sendJoin(){this.syncReceived=!1,this.syncCompleted=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),cc.session&&console.log(this.id,"Controller sending JOIN");const{tick:t,delay:e}=this.getTickAndMultiplier(),{name:s,codeHash:n,appId:i,apiKey:o,persistentId:r,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,location:u,flags:m}=this.sessionSpec,p=pc?"hiddenName":s,f=pc?"hiddenApiKey":this.getBackend(o).apiKey,b=pc?"hiddenAppId":i,y=pc?"hiddenUrl":Ot.referrerURL(),g=this.viewDataEncrypted?{id:this.viewId,data:this.viewDataEncrypted}:u?[this.viewId]:this.viewId,w={name:p,apiKey:f,appId:b,url:y,persistentId:r,sdk:ic,developerId:a,version:1,user:g,location:u,ticks:{tick:t,delay:e},dormantDelay:d,tove:this.tove,codeHash:n};l&&Object.assign(w,{heraldUrl:l}),c&&Object.assign(w,{leaveDelay:c+250}),h!==n&&Object.assign(w,{computedCodeHash:h}),m&&Object.assign(w,{flags:m}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:w})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("JOIN",Error("Initial reflector connection timed out"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{this.leaving?cc.session&&console.log(this.id,"abandoning rejoin; session is defunct"):(cc.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave())}),this.sessionSpec.rejoinLimit)))}leave(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{rebootModelView:e}=this.sessionSpec;if(this.reset(),cc.session&&console.log(this.id,`resetting ${t?"(but keeping)":"and discarding"} controller`),t||Lc.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");e()}async encrypt(t){const e=H.random(16),s=ko.encrypt(t,this.key,{iv:e}),n=Ro(t,this.key);return`${eo.stringify(e)}${eo.stringify(n)}${s}`}get deprecatedDefaultKey(){return vc||(vc=po("THIS SHOULDN'T BE IN LOGS","",{keySize:8,hasher:so.algo.SHA1,iterations:1})),vc}decrypt(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.key;const s=eo.parse(t.slice(0,24)),n=eo.parse(t.slice(24,68)),i=t.slice(68),o=ko.decrypt(i,e,{iv:s});let r="";try{r=ro.stringify(o)}catch(t){}const a=Ro(r,this.key);if(this.compareHmacs(n.words,a.words))return r;if(e!==this.deprecatedDefaultKey)return this.decrypt(t,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(t,e){const s=(new TextDecoder).decode(new Uint8Array(t,0,4));let n,i,o,r,a;switch("string"==typeof e&&(e=eo.parse(e)),s){case"CRQ0":n=(new TextDecoder).decode(t),i=eo.parse(n.slice(4,28)),o=eo.parse(n.slice(28,72)),r=n.slice(72),a=ko.decrypt(r,e,{iv:i});break;case"CRQ1":n=new Uint8Array(t),i=H.create(n.subarray(4,20)),o=H.create(n.subarray(20,52)),r=H.create(n.subarray(52)),a=ko.decrypt({ciphertext:r},e,{iv:i});break;default:throw Error(`${this.id} unknown encryption version ${s}`)}a.clamp();const l=Ro(a,e);if(this.compareHmacs(o.words,l.words))return E(a);if(e!==this.deprecatedDefaultKey)return this.decryptBinary(t,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(t,e,s){const[n,i,o]=t.asState();return[n,i,await this.encryptPayload([o,e,s])]}async encryptPayload(t){return this.encrypt(JSON.stringify(t))}decryptPayload(t){return JSON.parse(this.decrypt(t))}compareHmacs(t,e){let s=t.length===e.length;for(let n=0;n<t.length;n++)t[n]!==e[n]&&(s=!1);return s}sendMessage(t){if(this.viewOnly||!this.vm)return;const e=t.asState()[2].length;if(e>16384)return void console.warn(this.id,`Message with payload of ${e} bytes exceeds maximum 16384 and will not be sent to ${bc}.`);!this.payloadSizeWarned&&e>Zc&&(console.log(this.id,`Message with payload of ${e} bytes being sent to ${bc}. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const s=Date.now(),n=this.rateLimitedSendTimes,i=this.rateLimitBuffer;if(xt.perSecondTally({requestedMessages:1}),i.length)return void this.addToRateLimitBuffer(t);let o=0;if(n.length&&this.synced){const t=n[n.length-1],e=1e3/this.eventRateLimit-(s-t);e>1&&(o=Math.ceil(e))}o?(this.addToRateLimitBuffer(t),setTimeout((()=>this.serviceRateLimitBuffer()),o)):(this.recordRateLimitedSend(s),this.socketSendMessage(t),xt.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:e}))}recordRateLimitedSend(t){const e=this.rateLimitedSendTimes;!this.synced&&e.length&&e[e.length-1]===t||(e.push(t),e.length>this.eventHistoryLimit&&e.shift()),!this.rateLimitSoftWarned&&e.length===this.eventHistoryLimit&&t-e[0]<1010&&(console.warn(this.id,`Sends to ${bc} are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(t){xt.perSecondTally({bundledMessages:1});const e=Date.now(),s=t.asState(),n=s[2].length,i=this.rateLimitBuffer;if(i.length){const t=i[i.length-1],{msgStates:o,totalPayload:r}=t;if(r<Zc)return o.push({msgState:s,bufferTime:e}),void(t.totalPayload+=n)}xt.perSecondTally({newBundles:1}),i.push({msgStates:[{msgState:s,bufferTime:e}],totalPayload:n});const o=i.length;cc.session&&o%5==0&&o!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer grew to ${o} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=o),o>this.eventMaxBundles?(console.error(this.id,"Disconnecting after overflow of SEND rate-limit buffer."),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&o>this.eventMaxBundles/2&&(console.warn(this.id,"SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected."),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const t=this.rateLimitBuffer;if(!t.length)return;const e=Date.now(),s=1e3/this.eventRateLimit,n=this.rateLimitedSendTimes;if(n.length){const t=n[n.length-1];if(s-(e-t)>0)return}const i=t.shift(),{msgStates:o,totalPayload:r}=i,a=[];let l=0;if(o.forEach((t=>{a.push(t.msgState),l+=e-t.bufferTime})),1===a.length){const t=gd.fromState(a[0],this.vm);this.socketSendMessage(t)}else{const t=new gd(this.vm.time,0,"_","handleBundledEvents",[a]);this.socketSendMessage(t)}if(this.recordRateLimitedSend(e),xt.perSecondTally({sentBundles:1,sentMessagesTotal:o.length,sendDelay:l,sentBundlePayload:r,sentPayloadTotal:r}),cc.session&&this.connected){const e=t.length;e&&e%5==0&&e!==this.rateLimitLastLogged&&(console.log(this.id,`SEND rate-limit buffer dropped to ${e} event bundles`),this.rateLimitLastLogged=e)}t.length&&setTimeout((()=>this.serviceRateLimitBuffer()),s)}async socketSendMessage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const s=await this.encryptMessage(t,this.viewId,Date.now()),n=cc.sends&&(e?`tagged SEND ${t.asState()} with tags ${JSON.stringify(e)}`:`SEND ${t.asState()}`);if(!this.connected||!this.syncCompleted)return void(this.vm&&(cc.sends&&console.log(this.id,`buffering ${n}`),this.sendBuffer.push((()=>this.socketSendMessage(t,e)))));cc.sends&&console.log(this.id,`sending ${n}`);const i={id:this.id,action:"SEND",args:[...s,this.latency]};e&&(i.tags=e),this.lastSent=Date.now(),this.connection.send(JSON.stringify(i))}async sendTagged(t,e){this.viewOnly||this.socketSendMessage(t,e)}async sendTutti(t){let{time:e,topic:s,data:n,localContext:i=null,firstMessage:o=null,wantsVote:r=!0,tallyTarget:a=null}=t;if(this.viewOnly)return;const l=o&&await this.encryptMessage(o,this.viewId,Date.now()),c=k(n);if(!this.connected||!this.syncCompleted)return void(this.vm&&(cc.sends&&console.log(this.id,`buffering "${s}" TUTTI ${c} ${o&&o.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:e,topic:s,data:n,localContext:i,firstMessage:o,wantsVote:r,tallyTarget:a})))));cc.sends&&console.log(this.id,`sending "${s}" TUTTI ${c} ${o&&o.asState()}`),this.lastSent=Date.now();const d=`${s}@${e}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[e,0,c,l,r,a,d]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:e,tuttiKey:d,dummyTuttiSeq:0,payload:c,localContext:i})}sendLog(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];this.connected&&this.syncCompleted?(cc.sends&&console.log(this.id,"sending LOG"),e.length<2&&(e=e[0]),this.connection.send(JSON.stringify({action:"LOG",args:e}))):this.vm&&(cc.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push((()=>this.sendLog(...e))))}addToStatistics(t,e){this.latency=e-t,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:e,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const t=this.sessionSpec.options,e=["number","string"].includes(typeof t.tps)?t.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[s,n]=(e+"x").split("x").map((t=>Number.parseFloat("0"+t))),i=1e3/Math.max(1/30,Math.min(60,s)),o=Math.max(1,n);let r=i,a=0;return o>1&&!yc&&(r=i/o,a=Math.ceil(r*(o-1))),{msPerTick:r,multiplier:o,tick:i,delay:a}}simulate(t){if(!this.vm)return!0;try{let e=!0;if(this.networkQueue.length+this.vm.messages.size===0)e=this.vm.advanceTo(this.reflectorTime,t);else{const s=xt.begin("simulate");for(;e;){const s=this.networkQueue[0];if(!s)break;const[n,i]=s;if(e=this.vm.advanceTo(n[0],t),!e)break;this.networkQueue.shift(),pc&&(this.auditStats.payloadTally+=i);const o=this.vm.scheduleExternalMessage(n);e=this.vm.advanceTo(o.time,t),this.cpuTime+=5}e&&(e=this.vm.advanceTo(this.reflectorTime,t)),this.cpuTime+=Math.max(.01,xt.end("simulate")-s)}xt.backlog(this.backlog);const s=this.lag,n=Math.max(200,.1*this.msPerTick),i=Math.max(2e3,.2*this.msPerTick);if("boolean"==typeof this.synced&&this.viewed&&(this.synced&&s>i||!this.synced&&s<n)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<n&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}if(!cc.offline)if(this.synced&&e&&this.vm.time-this.lastSnapshotRequest>5e3){let t=!1;this.cpuTime>5e3?(cc.snapshot&&console.log(this.id,`due for snapshot: cpuTime is ${Math.round(this.cpuTime)}ms`),t=!0):pc&&this.vm.time-this.vm.lastSnapshotPoll>3e5&&(cc.snapshot&&console.log(this.id,`due for snapshot: time since last is ${this.vm.time-this.vm.lastSnapshotPoll}ms`),t=!0),t&&(this.lastSnapshotRequest=this.vm.time,this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot())}else this.reflectorNeedsSnapshot&&(this.triggeringCpuTime=this.synced?this.cpuTime:12345,this.scheduleSnapshot(!0),this.reflectorNeedsSnapshot=!1);return e}catch(t){return Vt("simulate",t),this.connection.closeConnectionWithError("simulate",t),"error"}}stepSession(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const s=xt.stepSession(e.frameTime,!0);s&&console.log(s);const{backlog:n,latency:i,starvation:o,activity:r}=this;if("animation"===t){xt.animationFrame(e.frameTime,{backlog:n,starvation:o,latency:i,activity:r,users:this.users});const t=Date.now();if(this.lastAnimationEnd){const e=t-this.lastAnimationEnd;if(!0===this.animationGapCheck&&e>200&&(this.animationGapCheck=[],cc.session&&console.log(this.id,"animation has stopped (too long between steps)")),!0!==this.animationGapCheck){const t=this.animationGapCheck;t.push(e),t.length>4&&t.shift(),4===t.length&&t.reduce(((t,e)=>t+e),0)<=400&&(this.animationGapCheck=!0,cc.session&&console.log(this.id,"animation has started"))}}this.lastAnimationEnd=t}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(t){case"animation":{const t=e.expectedSimFPS,s=Date.now(),n=wc.reduce(((t,e)=>t+e),0)/wc.length;if(a=this.simulate(s+Math.min(n,gc)),!1===a){const e=0===t?0:1e3/t*4;this.backlog>e&&(a=this.simulate(s+gc-n))}"error"!==a&&(wc.push(Date.now()-s),wc.length>4&&wc.shift());break}case"fastForward":case"background":a=this.simulate(Date.now()+e.budget);break;default:console.warn(t)}this.fastForwardHandler&&this.fastForwardHandler(a),"error"!==a&&(xt.begin("update"),this.processModelViewEvents("animation"===t),xt.end("update"),this.vm&&(this.serviceRateLimitBuffer(),"animation"===t&&(e.view&&(xt.begin("render"),this.inViewRealm((()=>e.view.update(e.frameTime))),xt.end("render")),this.lastAnimationEnd=Date.now())))}applySyncChange(t){cc.session&&console.log(this.id,`synced=${t}`),this.synced=t,Ot.showSyncWait(!t),this.vm.publishFromView(this.viewId,"synced",t)}inViewRealm(t){return oe(this.vm,(()=>t(this.vm)))}processModelViewEvents(t){return this.vm?this.vm.processModelViewEvents(t):0}timeFromReflector(t,e,s){t<this.reflectorTime?("controller"!==e||cc.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${t} from ${e}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=t,this.extrapolatedTimeBase=Date.now()-t,this.vm&&xt.backlog(this.backlog),this.tickHook&&this.tickHook(t,s))}multiplyTick(t){this.localTicker&&globalThis.clearInterval(this.localTicker);const e=this.msPerTick,s=this.tickMultiplier;let n=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(t+n*e),"controller"),cc.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,n),++n>=s&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),e)}startStepping(t){const e=s=>{this.leaving||(this.isOutOfSight()||t(s),window.requestAnimationFrame(e))};window.requestAnimationFrame(e)}setUpActivityChecks(){let t=null;if(this.isOutOfSight=()=>!(oc||"hidden"!==document.visibilityState&&t),this.isBeingAnimated=()=>{const t=!0===this.animationGapCheck,e=Date.now()-this.lastAnimationEnd<200;return t&&!e&&(this.animationGapCheck=[],cc.session&&console.log(this.id,"animation has stopped (too long since last step)")),t&&e},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated(),!oc){new IntersectionObserver(((e,s)=>t=e[0].isIntersecting)).observe(document.body)}const e=this.sessionSpec.autoSleep;let s;if(e){const t=1e3*e;let n=0,i=0;s=()=>{const e=Date.now();e-n<980||(n=e,this.isOutOfSight()?i?e-i>t&&(this.dormantDisconnect(),i=0):i=e:i=0)}}const n=()=>{this.leaving?i&&(clearInterval(i),i=null):this.connected&&this.vm&&(s&&s(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let i=setInterval(n,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(n(),!this.fastForwardHandler&&this.connected)){let t=.9*this.msPerTick;e&&(t=Math.min(t,gc));const s=this.synced?"background":"fastForward";this.stepSession(s,{budget:t})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class Tc{constructor(t){this.controller=t,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(t){this.missingTickThreshold=Math.min(3*t,45e3)}get connected(){return!(!this.socket||!this.socket.isConnected())}checkForConnection(t){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!t||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let t;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;const e=()=>{cc.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,xt.connected(!0),this.controller.sendJoin()};if(cc.offline)t=new Al,t.isConnected=()=>t.readyState===WebSocket.OPEN;else if(pc){const{synchSpec:s,developSpec:n}=h;if(s&&n)throw Error("Cannot handle both synchSpec and developSpec options");let i="";const o=s||n;o&&(i+=`&synch=${encodeURIComponent(o)}`);const r=this.id,{persistentId:a,appId:l,developerId:c}=this.controller.sessionSpec;t=new tc(`${fc}/clients/connect?session=${r}&persist=${a}&app=${encodeURIComponent(l)}&developer=${c}${i}`),t.isConnected=()=>"open"===t.dataChannel?.readyState,t.onconnected=e}else{let e=this.controller.getBackend(this.controller.sessionSpec.apiKey).reflector;const s=oc?void 0:window.location.href,n={},i=this.controller.sessionSpec.token;if(i&&(n.token=i),h.reflector){const t=h.reflector.toUpperCase();"CF"===t||t.match(/^[A-Z]{3}$/)?(e=cc.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",3===t.length&&(n.colo=t)):h.reflector.match(/^[-a-z0-9]+$/i)?n.region=h.reflector:e=new URL(h.reflector,s).href.replace(/^http/,"ws")}if(!e.match(/^wss?:/))throw Error("Cannot interpret reflector address "+e);e.endsWith("/")||(e+="/");const o=new URL(e+this.id,s);for(const[t,e]of Object.entries(n))o.searchParams.append(t,e);t=new WebSocket(o),t.isConnected=()=>t.readyState===WebSocket.OPEN}t.onopen=s=>{const n=this.socket;n&&(n.onopen=n.onmessage=n.onerror=n.onclose=null),this.socket=t,this.connectHasBeenCalled=!1,t.twoStageConnection||e()},t.onmessage=e=>{if(t!==this.socket)return;const{data:s}=e,n="_CHUNK";if(s.startsWith(n)){const e="1"===s.charAt(6),n="1"===s.charAt(7),i=s.slice(8);if(e&&(t.chunkCollector=[]),t.chunkCollector.push(i),n){const e="".concat(...t.chunkCollector);t.chunkCollector=[],xt.addNetworkTraffic("reflector_in",e.length,!!pc),this.receive(e)}}else xt.addNetworkTraffic("reflector_in",s.length,!!pc),this.receive(s)},t.onerror=e=>{cc.session&&console.log(this.id,t.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},t.onclose=e=>{this.socket&&t!==this.socket||this.socketClosed(e.code,e.reason)}}socketClosed(t,e){cc.session&&console.log(this.id,`socketClosed with code=${t} message="${e}"`),t>=4100&&4110!==t&&(cc.session&&console.warn("resuming this session will require a new Session.join()"),this.controller.leaving||(this.controller.leaving=()=>{}),this.reconnectDelay=0);const s=!!!this.controller.leaving&&1e3!==t&&t<4100,n=4110===t;n||1e3===t||this.reconnectDelay||setTimeout((()=>{if(this.connected||this.socket?.isConnecting?.())return;const n=s?"Reconnecting":"Connection closed";Ot.showMessage(`${n}: ${t} ${e}`,{level:s?"warning":"fatal"})}),500),cc.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${t} ${e}`),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout(),xt.connected(!1),xt.resetAuditStats(),n?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),s&&(cc.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(t){this.socketLastSent=Date.now(),this.socket.send(t),xt.addNetworkTraffic("reflector_out",t.length,!!pc)}receive(t){this.lastReceived=Date.now();const{id:e,action:s,args:n}=JSON.parse(t);if(e)try{this.controller.receive(s,n)}catch(t){this.closeConnectionWithError("receive",t)}else if("PONG"===s){if(cc.pong&&console.log("PONG after",Date.now()-n,"ms"),this.pongHook)try{this.pongHook(n)}catch(t){console.error(t)}}else console.warn("Unknown action",s)}dormantDisconnect(){this.connected&&(cc.session&&console.log(this.id,`dormant; disconnecting from ${bc}`),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4e3;console.error(s,e),this.closeConnection(s,`Error in ${t}: ${e.message||e}`)}closeConnection(t,e){if(this.socket){this.socket.onclose=null;try{this.socket.close(t,e)}catch(s){console.error(`Error in socket.close(${t}, ${JSON.stringify(e)}):`,s)}}this.socketClosed(t,e)}PULSE(t){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&t-this.stalledSince>500?console.log(this.id,`Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${t-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(t){0!==this.lastReceived&&(t-this.socketLastSent>25e3?this.PULSE(t):t-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error((pc?"Synchronizer":"Reflector")+" has gone away")):t-this.lastReceived>this.missingTickThreshold&&this.PULSE(t))}PING(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Date.now();this.connected&&this.send(JSON.stringify({action:"PING",args:t}))}}globalThis.setInterval((()=>{for(const t of Lc)t.connected&&t.vm&&t.connection.keepAlive(Date.now())}),100);const Wc=Symbol("hash"),kc=Symbol("key"),Cc=Symbol("url"),Pc=new Map;let Rc=0;function Ic(t){return h.has("debug",t,!1)}function Vc(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Yc(t){return t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+3&-4,"=")}function Mc(t,e){return t||(t="*"),e.replace(/[\s\S]/g,(e=>String.fromCharCode(e.charCodeAt(0)^t.charCodeAt(0))))}class Hc{async store(){throw Error("Data.store() needs to be called from session.data")}async fetch(){throw Error("Data.fetch() needs to be called from session.data")}static async store(t,e,s){if(fd.hasCurrent())throw Error(`${Ot.libName}.Data.store() called from Model code`);let n,i,o;if("string"==typeof t?(n=t,t=e,i=!0,o=s):(n=e&&e.sessionId,i=e&&e.shareable,o=e&&e.keep),!(t instanceof ArrayBuffer))throw Error(`${Ot.libName}.Data.store() called with non-ArrayBuffer data`);const{appId:r,persistentId:a,key:l,uploadEncrypted:c}=Sc(n),d=i?H.random(32).toString(eo):eo.stringify(l),h=`apps/${r}/${a}/data/%HASH%`,u="data#"+ ++Rc;Ic("data")&&console.log(`${Ot.libName}.Data: storing ${u} ${t.byteLength} bytes`);const m=await c({path:h,content:t,key:d,keep:o,debug:Ic("data"),what:u}),p=function(t){return t.replace(/.*\//,"")}(m),f=new Kc(p,i&&d,m);return Ic("data")&&console.log(`${Ot.libName}.Data: stored ${u} as ${this.toId(f)}`),f}static async fetch(t,e){let s;if(e&&e[Cc]?(s=t,t=e):s=e&&e.sessionId,fd.hasCurrent())throw Error(`${Ot.libName}.Data.fetch() called from Model code`);const{downloadEncrypted:n,key:i}=Sc(s),o=t&&t[Wc],r=t&&t[kc]||eo.stringify(i),a=t&&t[Cc];if("string"!=typeof o||"string"!=typeof r||"string"!=typeof a)throw Error(`${Ot.libName}.Data.fetch() called with invalid handle`);const l="data#"+ ++Rc;return Ic("data")&&console.log(`${Ot.libName}.Data: fetching ${l} ${this.toId(t)}`),n({url:a,key:r,debug:Ic("data"),what:l})}static hash(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"base64url";"function"==typeof t&&(t=Function.prototype.toString.call(t)),"string"==typeof t?t=(new TextEncoder).encode(t):t&&t.constructor===DataView?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t&&t.constructor===ArrayBuffer?t=new Uint8Array(t):ArrayBuffer.isView(t)||(t=(new TextEncoder).encode(k(t)));const s=N(H.create(t));switch(e){case"hex":return s.toString();case"base64":return s.toString(eo);case"base64url":return Vc(s.toString(eo));default:throw Error(`${Ot.libName}.Data: unknown hash output "${e}", expected "hex"/"base64"/"base64url"`)}}static fromId(t){const e=t.slice(0,1);let s,n,i,o;switch(e){case"0":s=t.slice(1,44),n=t.slice(44),i=`${lc}/sessiondata/${s}`;break;case"1":s=t.slice(1,44),n=t.slice(44,87)+"=",o=t.slice(87),i=`${lc}/apps/${o}/data/${s}`;break;case"2":s=t.slice(1,44),n=Yc(t.slice(44,87)),o=Mc(n,atob(Yc(t.slice(87)))),i=`${lc}/apps/${o}/data/${s}`;break;case"3":n=Yc(t.slice(1,44)),i=Mc(n,atob(Yc(t.slice(44)))),s=i.slice(-43);break;case"4":n=null,i=Mc(n,atob(Yc(t.slice(1)))),s=i.slice(-43);break;default:throw Error(`${Ot.libName}.Data expected handle v0-v4 got v${e}`)}return new this(s,n,i)}static toId(t){if(!t)return"";const e=t[Wc],s=t[kc],n=t[Cc];if(n.slice(-43)!==e)throw Error(`${Ot.libName} Data: malformed URL`);const i=s&&Vc(s),o=Vc(btoa(Mc(s,n)));return s?`3${i}${o}`:`4${o}`}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2?arguments[2]:void 0;const n=Pc.get(t);if(n)return n;if(s.slice(-43)!==t)throw Error(`${Ot.libName} Data: malformed URL`);Object.defineProperty(this,Wc,{value:t}),e&&Object.defineProperty(this,kc,{value:e}),Object.defineProperty(this,Cc,{value:s}),Pc.set(t,this)}}class Kc extends Hc{}const zc={cls:Kc,write:t=>Kc.toId(t),read:t=>Kc.fromId(t)};let Nc=null,_c=null;const Fc=Symbol("DEBUG_WRITE_TARGET");let Ec=null;function Jc(t,e){return Array.isArray(t)||"string"!=typeof e?`[${e}]`:e.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${e}`:`["${e}"]`}class Qc extends Error{}function jc(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>Nc.random(),globalThis.CroquetViewMath={};for(const[t,e]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[t]=e.value;for(const[s,n]of Object.entries(globalThis.CroquetMath)){const i=Math[s];Math[s]=1===n.length?t=>Nc?n(t):i(t):(t,e)=>Nc?n(t,e):i(t,e)}}if(!globalThis.CroquetViewDate){const o=globalThis.Date;let r=!1;function a(t,e){return r||(r=!0,console.warn(new Qc(`${t} used in Model code`))),e}function l(t,e,s,n,i,r,c){const d=this instanceof l,h=[t,e,s,n,i,r,c];if(h.length=arguments.length,Nc)switch(a(d?"new Date()":"Date()"),arguments.length){case 0:h.push(Nc.time);break;case 1:break;default:h[0]=o.UTC(...h),h.length=1}const u=new o(...h);return d?u:""+u}l.prototype=o.prototype,l.UTC=o.UTC,l.now=()=>Nc?a("Date.now()",Nc.time):o.now(),l.parse=function(){return Nc?a("Date.parse()",0):o.parse(...arguments)},globalThis.CroquetViewDate=o,globalThis.Date=l}}Object.defineProperty(Qc.prototype,"name",{value:`${Ot.libName}Warning`});const Uc=Symbol("QFUNC");function Dc(t,e,s,n){const i=new Bc(t,e,s,n),o=i.compile();return o[Uc]=i,o}function Oc(t,e,s,n){const i=[],o=[];let r,a,l,c;if(s){if("this"in s){for(e=s.this,r="_this";r in s;)r="_"+r;delete(s={...s,[r]:e}).this}if(l=[...Object.keys(s).sort()],c=[...l.map((t=>s[t]))],l.length){for(a="env";a in s||a===n;)a="_"+a;i.push(a),o.push(c)}}t.match(/\bCroquet\b/)&&!l?.includes("Croquet")&&(i.push("Croquet"),o.push(Id.Croquet)),t.match(/\bMultisynq\b/)&&!l?.includes("Multisynq")&&(i.push("Multisynq"),o.push(Id.Croquet));let d=n||"qFunc";for(;l?.includes(d);)d="_"+d;let h='"use strict"\n\n';h+="// Croquet QFunc Compiler by Codefrau\n\n",h+="//////////////// Start Compiler /////////////////\n",h+="try { const ",l?.length&&(h+=`[${l.join(", ")}] = ${a}, `);let u=t.split("\n");const m=u.slice(1),p=Math.min(...m.map((t=>t.match(/^\s*/)[0].length)));if(p>0){u.some((t=>(t.match(/`/g)||[]).length%2==1))||(u=[u[0],...m.map((t=>t.slice(p)))],t=u.join("\n"))}const f=u[u.length-1].match(/^\s*/)[0];f&&(t=f+t),h+=`${d} =\n`,h+="//////////////// Start User Code ////////////////\n\n",h+=t,h+="\n\n///////////////// End User Code /////////////////\n",h+=`return ${d}`,r&&(h+=`.bind(${r})`),h+=" } catch (compileError) { return compileError; }\n",h+="///////////////// End Compiler //////////////////";try{const t=new Function(...i,h).call(e,...o);if(t instanceof Error)throw console.warn("rethrowing error",t),t;return t}catch(e){throw console.warn(`createQFunc compiling:\n\n${t}`),Error(`createQFunc(): ${e.message}`)}}class Bc{constructor(t,e,s,n){if(this.thisVal=t,this.env=e,this.selfRef=n,this.source=s,void 0===n){this.selfRef="","function"==typeof s&&(this.source=s.toString());const t=Object.keys(e);for(const n of t)if(s===e[n]){if(this.selfRef)throw Error(`createQFunc: env.${this.selfRef} and env.${n} cannot both reference the function`);this.selfRef=n}this.selfRef&&(this.env={...e},delete this.env[this.selfRef])}Object.freeze(this.env)}compile(){return Oc(this.source,this.thisVal,this.env,this.selfRef)}}const Ac={cls:Uc,write:t=>{let{[Uc]:{thisVal:e,env:s,source:n,selfRef:i}}=t;return[e,n,i,...Object.entries(s).flat()]},read:t=>{let[e,s,n,...i]=t;const o={};for(let t=0;t<i.length;t+=2)o[i[t]]=i[t+1];return Dc(e,o,s,n)}},$c="future message",qc="message in cancelFuture",td="subscription handler";function ed(t){return`qFunc~${t.split(" ")[0]}~`}const sd=ed($c),nd=ed(td);function id(t){return t===$c||t===td}function od(t){return t.startsWith(sd)}function rd(t){return`${nd}${t}`}function ad(t,e){return!!t.startsWith(nd)&&t.slice(nd.length)===e}function ld(t,e){if(Nc)throw Error("VirtualMachine confusion");if(!(t instanceof fd))throw Error("not a VM: "+t);const s=Nc;try{Nc=t,globalThis.CROQUETVM=t,e()}finally{Nc=s}}const cd="#reflected",dd=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop","handleAuditRequest"],hd={};for(let t=0;t<dd.length;t++)hd[dd[t]]=t;const ud=new WeakMap;function md(t){ud.set(t,null)}class pd{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}}class fd{static current(){return Nc||console.warn("VirtualMachine.current() called from outside the vm!"),Nc}static hasCurrent(){return!!Nc}static evaluate(t){if(Nc)return t();jc();const e=Nc;try{return Nc=new pd,t()}finally{Nc=e}}constructor(t,e,s,n){jc(),_c={snapshot:h.has("debug","snapshot",!1),session:h.has("debug","session",!1),write:h.has("debug","write",!1)},md(this),ld(this,(()=>{ie(this,(()=>{if(this.models={},this.namedModels={},this.messages=new Bi(((t,e)=>t.before(e))),this.subscriptions={},this.subscribers=new Map,this.genericSubscriptions=[],this.currentEvent="",this.currentEventFromModel=!1,this.debugEvents=e,this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=t.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.diverged=null,this.controller=null,t.models){const e=xd.newOrRecycled(this).readVM(t,"VM",n);let s=[],i=[];for(const t of Object.keys(e))"meta"!==t&&("staticInitializers"===t?s=e[t]:t in this?"_random"===t?this[t]=new S(null,{state:e[t]}):"messages"===t?i=e.messages:this[t]=e[t]:console.warn(`Ignoring property snapshot.${t}`));for(const t of s)t();for(const t of i)this.messages.add(t);for(const[t,e]of Object.entries(this.subscriptions))for(const s of e){const[e]=s.split(".");let n=this.subscribers.get(e);n||this.subscribers.set(e,n=new Set),n.add(t)}}else this._random=new S(t.id,{state:!0}),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit),this.addSubscription(this,"__VM__","__diverged__",this.handleSessionDiverged),s(this)}))}))}registerModel(t,e){if(Nc!==this)throw Error("You can only create models from model code!");return e||(e="M"+ ++this.modelsId),this.models[e]=t,e}deregisterModel(t){if(Nc!==this)throw Error("You can only destroy models from model code!");const e=this.models;delete this.models[t];for(const[t,s]of Object.entries(this.namedModels))e===s&&delete this.namedModels[t];this.messages.removeMany((e=>e.hasReceiver(t)))}lookUpModel(t){if("_"===t)return this;let e=this.models[t];if(e)return e;const[s,n,i]=t.match(/^([^#]+)#(.*)$/)||[];return e=this.models[n],e&&e.lookUp(i)}get(t){const e=this.namedModels[t];return Nc!==this&&_c.write&&e?this.debugWriteProxy(this,e,e.id):e}set(t,e){if(Nc!==this)throw Error("You can only make a model well-known from model code!");this.namedModels[t]=e}debugWriteProxy(t,e,s){if("object"!=typeof e||null===e||e[Fc])return e;if(e instanceof Id&&(s=e.id),!this.$debugWriteProxyHandler){function i(t,e,s){s&&(t+=` ${s} of`);const n=Ec.get(e).path;if(console.warn(`write-debug: non-model code is ${t} ${n}:`,e),s&&"$"!==s[0])throw Error(`write-debug: Attempt to modify ${Ot.libName} model state from outside!`)}Ec||(Ec=new WeakMap),this.$debugWriteProxyHandler={set(e,s,n){Nc!==t?i("assigning",e,s):console.warn(`${Ot.libName} debug write protection inside model - this should not happen!`),e[s]=n},deleteProperty(e,s){Nc!==t?i("deleting",e,s):console.warn(`${Ot.libName} debug write protection inside model - this should not happen!`),delete e[s]},get(e,s){if(s===Fc)return e;const n=e[s];if(n&&n[Fc])return n;if(Nc!==t){if("object"==typeof n&&null!==n){const o=Ec.get(e).path;if(n instanceof Map){const e=new Map([...n.entries()].map(((e,s)=>{let[n,i]=e;return[t.debugWriteProxy(t,n,`${o}.key#${s}`),t.debugWriteProxy(t,i,`${o}.value#${s}`)]})));return e[Fc]=n,e.set=()=>i("setting an item in",n),e.delete=()=>i("deleting from",n),e.clear=()=>i("clearing",n),Ec.set(n,{proxy:e,path:o+Jc(n,s)}),e}if(n instanceof Set){const e=new Set([...n.values()].map(((e,s)=>t.debugWriteProxy(t,e,`${o}.item#${s}`))));return e[Fc]=n,e.add=()=>i("adding to",n),e.delete=()=>i("deleting from",n),e.clear=()=>i("clearing",n),Ec.set(n,{proxy:e,path:o+Jc(n,s)}),e}return t.debugWriteProxy(t,n,o+Jc(n,s))}}else console.warn(`${Ot.libName} debug write protection inside model - this should not happen!`);return n}}}let n=Ec.get(e);return n||(n={proxy:new Proxy(e,this.$debugWriteProxyHandler),path:s},Ec.set(e,n)),n.proxy}noop(){}generateJoinExit(t){let{entered:e,exited:s,count:n,total:i}=t;this.controller.handleUserTotalForAccounting(i);const o={};for(const t of e){if("string"==typeof t)continue;let e,s,n;Array.isArray(t)?[e,s]=t:(e=t.id,n=t.data,s=t.location),o[e]={},n&&(o[e].data=n),s&&(s.region&&(s.country=s.region.slice(0,2),s.region=s.region.slice(2)),o[e].loc=s)}if(e=e.map((t=>"string"==typeof t?t:Array.isArray(t)?t[0]:t.id)),s=s.map((t=>"string"==typeof t?t:Array.isArray(t)?t[0]:t.id)),e.length===n){s=Object.keys(this.views);for(const t of s)this.views[t].extraConnections=0}if(e.length>0&&s.length>0&&e.some((t=>s.includes(t)))){for(let t=0;t<e.length;t++){const n=e[t],i=s.indexOf(n);i>=0&&(e.splice(t,1),s.splice(i,1),t--)}if(e.length+s.length===0)return}const r=t=>{const{data:e,loc:s}=this.views[t];if(!e)return t;const n={viewId:t,viewData:e};return s&&(n.location=s),n};for(const t of s)if(this.views[t]){if(this.views[t].extraConnections){this.views[t].extraConnections--,_c.session&&console.log(this.id,`@${this.time}#${this.seq} view ${t} closed extra connection`);continue}const e=r(t);delete this.views[t],this.publishFromModelOnly(this.id,"view-exit",e)}else{const{time:e,seq:s}=this;console.error(`${this.id} @${e}#${s} view ${t} exited without being present - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${e}#${s} ${t} left without being present`)}))}for(const t of e)if(this.views[t])_c.session&&console.log(this.id,`@${this.time}#${this.seq} view ${t} opened another connection`),this.views[t].extraConnections=(this.views[t].extraConnections||0)+1;else{this.views[t]=o[t]||{};const e=r(t);this.publishFromModelOnly(this.id,"view-join",e)}const a=Object.values(this.views).reduce(((t,e)=>t+1+(e.extraConnections||0)),0);if(n!==a){const{time:t,seq:e}=this;console.error(`@${t}#${e} view count mismatch (model: ${a}, reflector: ${n}) - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${t}#${e} connections model: ${a} reflector: ${n}`)}))}}scheduleExternalMessage(t){const e=gd.fromState(t,this);if(e.time<this.time)throw Error("past message from reflector "+t);const s=this.externalSeq+1>>>0;if(e.seq!==s)throw Error(`External message error. Expected message #${s} got #${e.seq}`);return this.externalTime=e.time,this.externalSeq=e.seq,e.seq=2*e.seq+1,this.verifyExternal(e),this.messages.add(e),e}verifyExternal(t){if("_"!==t.receiver)throw Error(`invalid receiver in external message: ${t}`);if(!(t.selector in hd))throw Error(`unexpected external message: ${t.selector}`)}futureSend(t,e,s,n){if(t.every)return this.futureRepeat(t.every,e,s,n);if(t<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const i=new gd(this.time+t,2*this.futureSeq,e,s,n);return this.messages.add(i),{time:i.time,seq:i.seq}}cancelFuture(t,e){const s=this.messages;let n;if("number"==typeof e.time){const{time:t,seq:i}=e;n=s.removeOne((e=>e.time===t&&e.seq===i))}else{if("*"===e)return n=s.removeMany((e=>e.receiver===t.id)),n.length>0;{const i=this.asMethodName(t,e,qc),o=t.id;n=s.removeOne((t=>t.receiver===o&&t.selector===i||"_"===t.receiver&&"futureExecAndRepeat"===t.selector&&t.args[1]===o&&t.args[2]===i)),od(i)&&delete t[i]}}return void 0!==n}futureRepeat(t,e,s,n){this.futureSend(t,"_","futureExecAndRepeat",[t,e,s,n])}futureExecAndRepeat(t,e,s,n){const i=this.lookUpModel(e);if(i){if("function"==typeof i[s])try{i[s](...n)}catch(t){Vt(`future message ${i}.${s}`,t)}else{const t=this.compileFuncString(s,i);try{t(...n)}catch(e){Vt(`future message ${i} ${t}`,e)}}this.futureRepeat(t,e,s,n)}}future(t,e,s,n){if(!this.lookUpModel(t.id))throw Error(`future send to unregistered model ${t}`);if(void 0===s){const s=this;return new Proxy(t,{get:(n,i)=>function(){for(var n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return s.future(t,e,i,o)}})}const i=this.asMethodName(t,s,$c);if("string"!=typeof i)throw Error(`future message to ${t} ${i} is not a string`);if("function"!=typeof t[i]&&i.indexOf(".")<0&&"{"!==i[0])throw Error(`future send to ${t} with unknown method ${i}()`);return this.futureSend(e,t.id,i,n)}advanceTo(t,e){if(Nc)throw Error("cannot advance time from model code");let s;for(;(s=this.messages.peek())&&s.time<=t;){const{time:t,seq:n}=s;if(t<this.time)throw Error("past message encountered: "+s);if(1&n&&(this.seq=this.seq+1>>>0,n/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${n/2>>>0} in ${s}`);if(this.messages.poll(),this.time=s.time,s.executeOn(this),globalThis.CroquetViewDate.now()>=e)return!1}return this.time=t,!0}asMethodName(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if("string"==typeof e)return e;if("function"==typeof e){if(t[e.name]===e)return e.name;if(e[Uc]&&n){const s=rd(n);if(t[s]===e)return s}let o=t;for(;null!==o;){for(const[t,n]of Object.entries(Object.getOwnPropertyDescriptors(o)))if(n.value===e){if(e[Uc]&&((i=s)!==$c&&i!==qc||!od(t)))continue;return t}if(o===t&&e[Uc]){if(!id(s))return Rt(`${s} is not a registered QFunc: ${e}`,{only:"once"}),null;let i;if(n)i=rd(n);else{const e=sd;let s=0;do{i=`${e}${s++}`}while(t[i])}return t[i]=e,i}o=Object.getPrototypeOf(o)}Rt(`${s} is not a method of ${t} and not a QFunc: ${e}\n`,{only:"once"});const r=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,a=e.toString().match(r);return!a||a[3]&&a[3]!==a[1]?this.asFuncString(e):a[2]}var i;return null}asFuncString(t){const e=t.toString();return`{${btoa(JSON.stringify(e))}}`}compileFuncString(t,e){this.$compiledFuncs||(this.$compiledFuncs={});const s=e.id+":"+t;let n=this.$compiledFuncs[s];if(!n){const i=JSON.parse(atob(t.slice(1,-1)));n=Oc(i,e),i.startsWith("function")&&(n=n.bind(e)),this.$compiledFuncs[s]=n}return n}addSubscription(t,e,s,n){if(Nc!==this)throw Error("Cannot add a model subscription from outside model code");if(e.includes(":"))throw Error(`Invalid subscription scope "${e}" (must not contain ':')`);const i=e+":"+s,o=this.asMethodName(t,n,td,i);if("string"!=typeof o)throw Error(`Subscription handler for "${s}" must be a method name`);if(o.indexOf(".")<0&&"function"!=typeof t[o]&&"{"!==o[0])throw Error(`Subscriber method for "${s}" not found: ${t}.${o}()`);const r=t===this?"_":t.id,a=r+"."+o;if("*"===e||"*"===s)return void this.addGenericSubscription(i,a);if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(a))throw Error(`${t}.${o} already subscribed to ${s}`)}else this.subscriptions[i]=[];this.subscriptions[i].push(a);let l=this.subscribers.get(r);l||this.subscribers.set(r,l=new Set),l.add(i)}removeSubscription(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";if(Nc!==this)throw Error("Cannot remove a model subscription from outside model code");if("*"===e||"*"===s)return void this.removeGenericSubscription(t,e,s,n);const i=e+":"+s,o=this.subscriptions[i];if(o){const e=t.id+".";if("*"===n){for(let s=o.length-1;s>=0;s--)if(o[s].startsWith(e)){const n=o[s].slice(e.length);ad(n,i)&&delete t[n],o.splice(s,1)}0===o.length&&delete this.subscriptions[i]}else{const r=this.asMethodName(t,n,"unsubscribe argument",i);if("string"!=typeof r)throw Error(`Invalid unsubscribe args for "${s}" in ${t}: ${n}`);const a=e+r,l=o.indexOf(a);if(-1!==l&&(o.splice(l,1),0===o.length&&delete this.subscriptions[i],ad(r,i)&&delete t[r]),o.find((t=>t.startsWith(e))))return}const r=this.subscribers.get(t.id);r.delete(i),0===r.size&&this.subscribers.delete(t.id)}}addGenericSubscription(t,e){this.genericSubscriptions.push({topic:t,handler:e})}removeGenericSubscription(t,e,s){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"*";const i=e+":"+s,o=t.id+".";for(let e=this.genericSubscriptions.length-1;e>=0;e--){const s=this.genericSubscriptions[e];s.topic===i&&s.handler.startsWith(o)&&("*"!==n&&s.handler!==o+n||(this.genericSubscriptions.splice(e,1),ad(n,i)&&delete t[n]))}}removeAllSubscriptionsFor(t){const e=this.subscribers.get(t.id);if(e){const s=t.id+".";for(const n of e){const e=this.subscriptions[n];for(let i=e.length-1;i>=0;i--)if(e[i].startsWith(s)){const o=e[i].slice(s.length);ad(o,n)&&delete t[o],e.splice(i,1)}0===e.length&&delete this.subscriptions[n]}this.subscribers.delete(t.id)}}publishFromModel(t,e,s){if(Nc!==this)throw Error("Cannot publish a model event from outside model code");if(t.includes(":"))throw Error(`Invalid publish scope "${t}" (must not contain ':')`);const n=e.endsWith(cd);n&&(e=e.slice(0,e.length-10));const i=this.currentEventFromModel;this.currentEventFromModel=!0;const o=t+":"+e;this.handleModelEventInModel(o,s,n),this.handleModelEventInView(o,s),this.currentEventFromModel=i}publishFromModelOnly(t,e,s){if(Nc!==this)throw Error("Cannot publish a model event from outside model code");const n=t+":"+e;this.handleModelEventInModel(n,s)}publishFromView(t,e,s){if(Nc)throw Error("Cannot publish a view event from model code");if(t.includes(":"))throw Error(`Invalid publish scope "${t}" (must not contain ':')`);const n=t+":"+e;this.handleViewEventInModel(n,s),this.handleViewEventInView(n,s)}handleBundledEvents(t){for(const e of t){const t=gd.fromState(e,this);this.verifyExternal(t),t.executeOn(this,!0)}}handleModelEventInModel(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Nc!==this)throw Error("handleModelEventInModel called from outside model code");if(s){if(!0!==this.controller.synced)return;const s=t+"#__vote",n=t+"#divergence",i=!!$t.subscriptions[s],o=!!this.subscriptions[t],r=!!this.subscriptions[n];i&&r&&console.log(`divergence subscription for ${t} overridden by vote subscription`);const a=o?new gd(this.time,0,"_","handleModelEventInModel",[t,e]):null;let l;l=i?["handleModelEventInView",s]:["handleTuttiDivergence",n],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:t,data:e,firstMessage:a,wantsVote:i,tallyTarget:l})))}else this.genericSubscriptions.length>0&&this.invokeGenericHandlers(t,e),this.subscriptions[t]&&this.invokeHandlers(this.subscriptions[t],t,e)}invokeHandlers(t,e,s){const n=t.slice();for(let i=0;i<n.length;i++){const o=n[i];(o===t[i]||t.includes(o))&&this.invokeHandler(o,e,s)}}invokeGenericHandlers(t,e){const[s,n]=t.split(":");if(!(s.startsWith("__")&&s.endsWith("__")||n.startsWith("__")&&n.endsWith("__")))for(const i of this.genericSubscriptions){const[o,r]=i.topic.split(":");("*"===o&&r===n||o===s&&"*"===r||"*"===o&&"*"===r)&&this.invokeHandler(i.handler,t,e)}}invokeHandler(t,e,s){const n=this.currentEvent;this.currentEvent=e;try{const[n,...i]=t.split("."),o=i.join("."),r=this.lookUpModel(n);if(!r)return void Rt(`event ${e} .${o}(): subscriber not found`);if("{"===o[0]){const t=this.compileFuncString(o,r);try{t(s)}catch(s){Vt(`event ${e} ${r} ${t}`,s)}return}if(o.indexOf(".")>=0){const t=o.indexOf("."),n=o.slice(0,t),i=o.slice(t+1);try{r.call(n,i,s)}catch(t){Vt(`event ${e} ${r}.call(${JSON.stringify(n)}, ${JSON.stringify(i)})`,t)}return}if("function"!=typeof r[o])return void Vt(`event ${e} ${r}.${o}(): method not found`);try{r[o](s)}catch(t){Vt(`event ${e} ${r}.${o}()`,t)}}finally{this.currentEvent=n}}handleViewEventInModel(t,e){if(this.subscriptions[t]){const s=[t];void 0!==e&&s.push(e);const n=new gd(this.time,0,"_","handleModelEventInModel",s);this.controller.sendMessage(n)}}handleModelEventInView(t,e){_c.write&&(e=this.debugWriteProxy(this,e,`event ${t} arg`)),$t.handleEvent(t,e,(t=>function(t){if(!Nc)throw Error("VirtualMachine confusion");const e=Nc;try{Nc=null,t()}finally{Nc=e}}((()=>oe(this,t,!0)))))}handleViewEventInView(t,e){$t.handleEvent(t,e)}handleTuttiDivergence(t,e){if(this.subscriptions[t])this.handleModelEventInModel(t,e);else{const s=t.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${s}:`,e)}}handleSessionDiverged(t){const{key:e,url:s}=t;this.diverged||(this.diverged=new Map);let n=this.diverged.get(e);n||this.diverged.set(e,n=[]),n.push(s),2===n.length&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(e)}debugDiverged(t){t||(t=this.diverged.keys().next().value);const e=this.diverged.get(t);if(!e||e.length<2)throw Error(`no diverged urls for snapshot ${t}`);Promise.resolve().then((()=>this.controller.diffDivergedSnapshots(e)))}processModelViewEvents(t){if(Nc)throw Error("cannot process view events in model code");return oe(this,(()=>$t.processFrameEvents(t,!!this.controller.synced)))}handlePollForSnapshot(){const t=this.time,e=t-this.lastSnapshotPoll;e<5e3?console.log(`rejecting snapshot poll ${e}ms after previous`):(this.lastSnapshotPoll=t,this.controller.handlePollForSnapshot(t))}handleTuttiResult(t){this.controller.handleTuttiResult(t)}handleSnapshotVote(t){this.controller.handleSnapshotVote(t)}handlePersistVote(t){this.controller.handlePersistVote(t)}handleAuditRequest(t){this.controller.handleAuditRequest(t)}snapshot(){return vd.newOrRecycled(this).snapshot(this,"VM")}getSummaryHash(){return k((new Zd).getHash(this))}debug(t){return this.controller.setDebug(t)}forceSnapshot(){this.controller.requestDebugSnapshot()}persist(t,e){this.controller&&"no.appId"===this.controller.sessionSpec.appId&&console.warn(`${Ot.libName}: appId should be provided in Session.join() to not overwrite another apps's persistent data`);const s=xt.begin("snapshot"),n="function"==typeof e?e.call(t):e;if("object"!=typeof n)throw Error(`${Ot.libName}: persistSession() can only persist objects (got ${typeof n})`);const i=k(n),o=Kc.hash(i),r=xt.end("snapshot")-s,a=this.persisted===o,l=this.time;var c,d;if(_c.snapshot&&console.log(this.id,`persistent data @${l} collected, stringified and hashed in ${Math.ceil(r)}ms${a?" (unchanged, ignoring)":""}`),h.forcePersist&&queueMicrotask((()=>this.controller.forcePersist(l,i,o))),!a)if(c=this,d={persistTime:l,persistentString:i,persistentHash:o,ms:r},ud.set(c,d),this.persisted=o,this.inPersistenceCoolOff)_c.snapshot&&console.log(this.id,"persistence poll postponed by cooloff");else{const t=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;t>0?(_c.snapshot&&console.log(this.id,`postponing persistence poll by ${t}ms`),this.futureSend(t,"_","triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const t=(e=this,ud.get(e));var e;if(!t)return;const{persistTime:s,persistentString:n,persistentHash:i,ms:o}=t;if(md(this),this.controller&&this.controller.synced){_c.snapshot&&console.log(this.id,`asking controller to poll for persistence @${s}`);const t=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(t,s,n,i,o)))}}random(){if(Nc!==this)throw Error("synchronized random accessed from outside the model");return this._random()}randomID(){if(Nc!==this)throw Error("synchronized random accessed from outside the model");let t="";for(let e=0;e<4;e++)t+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return t}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function bd(t,e,s){let n;if("_"===t){const t=hd[e];"number"==typeof t&&(n=t.toString(36))}if(void 0===n&&(n=`${t}>${e}`),s.length>0){const t=Ld.newOrRecycled();n+=JSON.stringify(t.encode(s))}return n}function yd(t,e){return(e-t|0)>=0}class gd{constructor(t,e,s,n,i){this.time=t,this.seq=e,this.receiver=s,this.selector=n,this.args=i}before(t){return this.time!==t.time?this.time<t.time:this.isExternal()!==t.isExternal()?t.isExternal():this.isExternal()?yd(this.externalSeq,t.externalSeq):yd(this.internalSeq,t.internalSeq)}hasReceiver(t){return this.receiver===t}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(t){this.seq=2*t+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(t){this.seq=2*t}asState(){return[this.time,this.seq,bd(this.receiver,this.selector,this.args)]}static fromState(t,e){const[s,n,i]=t,{receiver:o,selector:r,args:a}=function(t,e){let s,n,i;if(1===t.length||"["===t[1]){const e=parseInt(t[0],36);s="_",n=dd[e],i=t.slice(1)}else{const e=t.indexOf(">");let o=t.indexOf("[");-1===o&&(o=t.length),s=t.slice(0,e),n=t.slice(e+1,o),i=t.slice(o)}let o=[];i&&(o=Sd.newOrRecycled(e).decode(JSON.parse(i)));return{receiver:s,selector:n,args:o}}(i,e);return new gd(s,n,o,r,a)}executeOn(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.currentEventFromModel=!this.isExternal();const s=e?t=>t():e=>ld(t,(()=>ie(t,e))),{receiver:n,selector:i,args:o}=this,r=t.lookUpModel(n);if(r)if("{"===i[0]){const e=t.compileFuncString(i,r);s((()=>{try{e(...o)}catch(t){Vt(`${this.shortString()} ${e}`,t)}}))}else i.indexOf(".")>=0?s((()=>{const t=i.indexOf("."),e=i.slice(0,t),s=i.slice(t+1);try{r.call(e,s,...o)}catch(t){Vt(`${this.shortString()} ${r}.call(${JSON.stringify(e)}, ${JSON.stringify(s)})`,t)}})):"function"!=typeof r[i]?Rt(`${this.shortString()} ${r}.${i}(): method not found`):s((()=>{try{if(od(i)){const t=r[i];delete r[i],t(...o)}else r[i](...o)}catch(t){Vt(`${this.shortString()} ${r}.${i}()`,t)}}));else Rt(`${this.shortString()} ${i}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){const{receiver:t,selector:e,args:s}=this,n=this.isExternal(),i=n?this.externalSeq:this.internalSeq;return`${n?"External":"Future"}Message[${this.time}${":#"[+n]}${i} ${t}.${e}(${s.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const wd=(()=>{const t=new ArrayBuffer(8),e=new DataView(t);return t=>(e.setFloat64(0,t,!0),e.getInt32(0,!0)+e.getInt32(4,!0))})();class Zd{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",gd),this.addHasher("Teatime:Data",zc),this.addHasher("Teatime:QFunc",Ac);for(const[t,e]of Id.allClassTypes())this.addHasher(t,e)}addHasher(t,e){const{cls:s,write:n}=Object.getPrototypeOf(e)===Object.prototype?e:{cls:e,write:t=>({...t})};n&&this.hashers.set(s,(t=>this.hashStructure(t,n(t))))}getHash(t){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[e,s]of Object.entries(t))if("controller"!==e&&"meta"!==e)if("_random"===e)this.hash(s.state(),!1);else if("messages"===e){const t=s.asArray();(this.hashState.fC=t.length)&&this.hash(t,!1)}else this.hashEntry(e,s);return this.hashDeferred(),this.hashState}hashDeferred(){let t=0;for(;t<this.todo.length;){const{key:e,value:s}=this.todo[t++];this.hashEntry(e,s,!1)}this.todo.length=0}hash(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];switch(typeof t){case"number":return void(Number.isNaN(t)?this.hashState.nanC++:Number.isFinite(t)?0===t?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=wd(t)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=t.length);case"boolean":case"undefined":return;case"bigint":if(0n===t)this.hashState.zC++;else{this.hashState.nC++;const e=t<0?-1n:0n;for(;t!==e;)this.hashState.nH+=Number(0xFFFFFFFFn&t),t>>=32n}return;default:{if(this.done.has(t))return;if(null===t)return;if(this.hashers.has(t.constructor))return void this.hashers.get(t.constructor)(t);const s=Object.prototype.toString.call(t).slice(8,-1);if(this.hashers.has(s))return void this.hashers.get(s)(t);switch(s){case"Array":return void this.hashArray(t,e);case"ArrayBuffer":return void this.hashIntArray(new Uint8Array(t));case"Set":return void this.hashStructure(t,[...t]);case"Map":return void this.hashStructure(t,[...t],!1);case"DataView":return void this.hashIntArray(new Uint8Array(t.buffer,t.byteOffset,t.byteLength));case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":return void this.hashIntArray(t);case"Float32Array":case"Float64Array":return void this.hashArray(t,!1);case"Object":t instanceof Id?this.hashModel(t):t.constructor===Object&&this.hashObject(t,e)}}}}hashModel(t){this.hashState.mC++,this.done.add(t);for(const[e,s]of Object.entries(t))"__realm"!==e&&void 0!==s&&this.hashEntry(e,s)}hashObject(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.hashState.oC++,this.done.add(t);for(const[s,n]of Object.entries(t))void 0!==n&&this.hashEntry(s,n,e)}hashArray(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.done.add(t);for(let s=0;s<t.length;s++)this.hashEntry(s,t[s],e)}hashIntArray(t){this.done.add(t);for(let e=0;e<t.length;e++){const s=t[e];0===s?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=s)}}hashStructure(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];void 0!==e&&(this.done.add(t),this.hash(e,s))}hashEntry(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];"$"!==t[0]&&(s&&"object"==typeof e?this.todo.push({key:t,value:e}):this.hash(e,s))}}class vd{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.vm=t,e.nextRef=1,e.refs=new Map,e.todo=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.vm=t,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",gd),this.addWriter("Teatime:Data",zc),this.addWriter("Teatime:QFunc",Ac);for(const[t,e]of Id.allClassTypes())this.addWriter(t,e);this.okayToIgnore={$debugWriteProxyHandler:!0};for(const t of Id.allClasses())if(Object.prototype.hasOwnProperty.call(t,"okayToIgnore")){const e=t.okayToIgnore();if(!Array.isArray(e))throw new Error("okayToIgnore() must return an array");for(const t of e){if("$"!==t[0])throw Error(`okayToIgnore: ignored prop "${t}" must start with '$'`);this.okayToIgnore[t]=!0}}}addWriter(t,e){const s=Object.getPrototypeOf(e)===Object.prototype,{cls:n,write:i}=s?e:{cls:e,write:t=>({...t})};if(n===Object)throw Error(`${Ot.libName} types: '${t}' is the Object class itself, must be a user class`);if(n===Array)throw Error(`${Ot.libName} types: '${t}' is the Array class, must be a user class`);i?this.writers.set(n,((e,o)=>this.writeAs(t,e,i(e),s?`${o}.write(${n.name})`:o))):e.writeStatic||console.warn(`${Ot.libName} types: ${t} does not implement write() or writeStatic()`)}snapshot(t,e){const s={_random:t._random.state(),messages:this.write(t.messages.asArray(),"FutureMessages"),subscribers:void 0,controller:void 0,$compiledFuncs:void 0};this.writeAllStaticInto(s);for(const[n,i]of Object.entries(t))n in s||this.writeInto(s,n,i,e);return this.writeDeferred(),delete s.controller,delete s.subscribers,delete s.$compiledFuncs,s}writeAllStaticInto(t){for(const e of Id.allClasses())if(e!==Id)for(const[s,n]of Object.entries(e)){if("$"===s[0])continue;const i=Id.classToID(e);t.staticModelProps||(t.staticModelProps={}),i in t.staticModelProps||(t.staticModelProps[i]={}),this.writeInto(t.staticModelProps[i],s,n,`Model(${i}).static`),Wd("Model",i)}for(const[e,s]of Id.allClassTypes())if("object"==typeof s){const{writeStatic:n}=s;if(n){const s=n();s&&(t.staticTypeProps||(t.staticTypeProps={}),t.staticTypeProps[e]=this.write(s,`Type(${e}).writeStatic()`),Wd("Type",e))}}}writeDeferred(){let t=0;for(;t<this.todo.length;){const{state:e,key:s,value:n,path:i}=this.todo[t++];this.writeInto(e,s,n,i,!1)}this.todo.length=0}write(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(typeof t){case"number":return Object.is(t,-0)?{$class:"NegZero"}:Number.isFinite(t)?t:Number.isNaN(t)?{$class:"NaN"}:{$class:"Infinity",$value:Math.sign(t)};case"string":case"boolean":return t;case"undefined":return{$class:"Undefined"};case"bigint":return{$class:"BigInt",$value:t.toString()};default:{if(this.refs.has(t))return this.writeRef(t);if(null===t)return t;if(this.writers.has(t.constructor))return this.writers.get(t.constructor)(t,e);const n=Object.prototype.toString.call(t).slice(8,-1);if(this.writers.has(n))return this.writers.get(n)(t,e);switch(n){case"Array":return this.writeArray(t,e,s);case"ArrayBuffer":return this.writeArrayBuffer(t);case"Set":return this.writeAs(n,t,[...t],e);case"Map":return this.writeAs(n,t,[...t].flat(),e);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(n,t);case"Object":if(t instanceof Id)return this.writeModel(t,e);if(t.constructor===Object||"function"!=typeof t.constructor)return this.writeObject(t,e,s);throw console.warn(`${Ot.libName}: unknown class at ${e}:`,t),Error(`${Ot.libName}: class not registered in Model.types(): ${t.constructor.name}`);case"Function":if(t[Uc])return this.writers.get(Uc)(t,e);throw console.warn(`${Ot.libName}: found function at ${e}:`,t),Error(`${Ot.libName}: cannot serialize functions except for QFuncs`);default:throw console.warn(`${Ot.libName}: unsupported property at ${e}:`,t),Error(`${Ot.libName}: serialization of ${n}s is not supported`)}}}}writeModel(t,e){const s={};this.refs.set(t,s);try{s.$model=Id.classToID(t.constructor)}catch(s){throw console.error(`unregistered model class at ${e}:`,t),s}for(const e of Object.keys(t).sort()){if("__realm"===e)continue;const n=t[e];("number"==typeof n&&Number.isFinite(n)&&!Object.is(n,-0)||"string"==typeof n||"boolean"==typeof n)&&"$"!==e[0]?s[e]=n:this.writeInto(s,e,n,`${t}`,!0)}return s}writeObject(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n={};this.refs.set(t,n);for(const i of Object.keys(t).sort()){const o=t[i];("number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o)&&"$"!==i[0]?n[i]=o:this.writeInto(n,i,o,e,s)}return n}writeArray(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=[];this.refs.set(t,n);for(let i=0;i<t.length;i++){const o=t[i];"number"==typeof o&&Number.isFinite(o)&&!Object.is(o,-0)||"string"==typeof o||"boolean"==typeof o?n[i]=o:this.writeInto(n,i,o,e,s)}return n}writeArrayBuffer(t){const e={$class:"ArrayBuffer",$value:kd(t)};return this.refs.set(t,e),e}writeTypedArray(t,e){const s={$class:t,$value:[this.write(e.buffer),e.byteOffset,"DataView"===t?e.byteLength:e.length]};return this.refs.set(e,s),s}writeAs(t,e,s,n){const i={$class:t};this.refs.set(e,i);const o=this.write(s,n,!1);return"object"!=typeof o||null===o||o.$class||Array.isArray(o)?i.$value=o:Object.assign(i,o),i}writeRef(t){const e=this.refs.get(t);if("object"!=typeof e)throw Error("Non-object in refs: "+t);Array.isArray(e)&&(e.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}});return{$ref:e.$id||(e.$id=this.nextRef++)}}writeInto(t,e,s,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if("$"===e[0])return void(this.okayToIgnore[e]||(Rt(`snapshot: ignoring property ${e} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[e]=!0));if(i&&"object"==typeof s)return void this.todo.push({state:t,key:e,value:s,path:n});const o=this.write(s,n+Jc(t,e));t[e]=o}}const Xd=Symbol("croquet:unresolved");class xd{static newOrRecycled(t){let e=this.reusableInstance;return e?(e.vm=t,e.refs=new Map,e.todo=[],e.unresolved=[],e.postprocess=[]):e=this.reusableInstance=new this(t),e}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(t){this[this.name+"-instance"]=t}static resetInstance(){this.reusableInstance=null}constructor(t){this.vm=t,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader("Teatime:Message",gd),this.addReader("Teatime:Data",zc),this.addReader("Teatime:QFunc",Ac),this.readers.set("Undefined",(()=>{})),this.readers.set("NaN",(()=>NaN)),this.readers.set("Infinity",(t=>t*(1/0))),this.readers.set("NegZero",(()=>-0)),this.readers.set("BigInt",(t=>BigInt(t))),this.readers.set("ArrayBuffer",(t=>function(t){const e=globalThis.atob(t),s=e.length,n=new Uint8Array(s);for(let t=0;t<s;t++)n[t]=e.charCodeAt(t);return n.buffer}(t))),this.readers.set("DataView",(t=>new DataView(...t))),this.readers.set("Int8Array",(t=>new Int8Array(...t))),this.readers.set("Uint8Array",(t=>new Uint8Array(...t))),this.readers.set("Uint8ClampedArray",(t=>new Uint8ClampedArray(...t))),this.readers.set("Int16Array",(t=>new Int16Array(...t))),this.readers.set("Uint16Array",(t=>new Uint16Array(...t))),this.readers.set("Int32Array",(t=>new Int32Array(...t))),this.readers.set("Uint32Array",(t=>new Uint32Array(...t))),this.readers.set("Float32Array",(t=>new Float32Array(...t))),this.readers.set("Float64Array",(t=>new Float64Array(...t)));for(const[t,e]of Id.allClassTypes())this.addReader(t,e)}addReader(t,e){let s=t=>Object.assign(Object.create(e.prototype),t);"object"==typeof e&&(s=e.read),this.readers.set(t,s)}enableBackwardCompatibility(t){const e=t?.meta?.sdk;if(!e)return;const[s,n,i,o]=e.split(/[-.+]/).map((t=>+t));let r=`${s}.${n}`;i&&(r+=`.${i}`),o&&(r+=`-${o}`),console.warn(`${Ot.libName}: reading snapshot version ${r}`),this.compatMaps=s<1||1===s&&(n<1||1===n&&i<7)}readVM(t,e,s){if("VM"!==e)throw Error("VirtualMachine must be root object");s&&this.enableBackwardCompatibility(t);const n=this.read(t,e,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),this.readAllStatic(n),n}readDeferred(){let t=0;for(;t<this.todo.length;){const{object:e,key:s,value:n,path:i}=this.todo[t++];this.readInto(e,s,n,i,!1)}this.todo.length=0}resolveRefs(){for(const{object:t,key:e,ref:s,path:n}of this.unresolved){if(!this.refs.has(s))throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(e)}]`);t[e]=this.refs.get(s)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(const t of this.postprocess)t();this.postprocess.length=0}readAllStatic(t){const{staticModelProps:e,staticTypeProps:s}=t,n=[];if(e){for(const[t,s]of Object.entries(e)){const e=Id.classFromID(t);n.push((()=>Object.assign(e,s))),Wd("Model",t)}delete t.staticModelProps}if(s){const e=Object.fromEntries(Id.allClassTypes());for(const[t,i]of Object.entries(s)){const s=e[t];if("object"==typeof s){const t=s;n.push((()=>t.readStatic(i)))}else{const t=s;n.push((()=>Object.assign(t,i)))}Wd("Type",t)}delete t.staticTypeProps}n.length&&(t.staticInitializers=n)}read(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];switch(typeof t){case"number":case"string":case"boolean":return t;default:{const n=Object.prototype.toString.call(t).slice(8,-1);switch(n){case"Array":return this.readArray(t,e,s);case"Null":return null;case"Object":{const{$class:n,$model:i,$ref:o}=t;if(o)throw Error("refs should have been handled in readInto()");return i?this.readModel(t,e):n?this.readAs(n,t,e):this.readObject(Object,t,e,s)}default:throw Error(`Don't know how to deserialize ${n} at ${e}`)}}}}readModel(t,e){const s=Id.instantiateClassID(t.$model,t.id);t.$id&&this.refs.set(t.$id,s);for(const[n,i]of Object.entries(t))"id"!==n&&"$"!==n[0]&&this.readInto(s,n,i,e);return s}readObject(t,e,s){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new t;e.$id&&this.refs.set(e.$id,i);for(const[t,o]of Object.entries(e))"$"!==t[0]&&this.readInto(i,t,o,s,n);return i}readArray(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=[];t.$id&&this.refs.set(t.$id,n);for(let i=0;i<t.length;i++)void 0!==t[i]&&this.readInto(n,i,t[i],e,s);return n}readAsArray(t,e){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=t.$value;return t.$id&&(n.$id=t.$id),this.readArray(n,e,s)}readAsSet(t,e){const s=new Set;t.$id&&this.refs.set(t.$id,s);const n=this.unresolved.length,i=this.read(t.$value,e,!1),o=()=>{for(const t of i)s.add(t)};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsMap(t,e){const s=new Map;t.$id&&this.refs.set(t.$id,s);const n=this.unresolved.length,i=this.read(t.$value,e,!1),o=this.compatMaps?()=>{if(i.some((t=>2!==t.length)))console.warn("Deferring map resolution at",e),this.postprocess.push(o);else for(const[t,e]of i)s.set(t,e)}:()=>{for(let t=0;t<i.length;t+=2)s.set(i[t],i[t+1])};return this.unresolved.length===n?o():this.postprocess.push(o),s}readAsClass(t,e,s){let n={};const i=new Map;if("$value"in e)n=this.read(e.$value,s,!1);else for(const[t,o]of Object.entries(e)){if("$"===t[0])continue;const e=o&&o.$ref;e?this.refs.has(e)?n[t]=this.refs.get(e):(n[t]=Xd,i.set(e,t)):this.readInto(n,t,o,s,!1)}const o=this.readers.get(t)(n,s);o||"Undefined"===t||"BigInt"===t||"NaN"===t||"NegZero"===t||console.warn(`Reading "${t}" returned ${o} at ${s}`),e.$id&&this.refs.set(e.$id,o);for(const[t,e]of i.entries())this.unresolved.push({object:o,key:e,ref:t,path:s});return o}readAs(t,e,s){switch(t){case"Array":return this.readAsArray(e,s);case"Set":return this.readAsSet(e,s);case"Map":return this.readAsMap(e,s);default:return this.readAsClass(t,e,s)}}readRef(t,e,s,n){if(!s||!s.$ref)return!1;const i=s.$ref;return this.refs.has(i)?t[e]=this.refs.get(i):(t[e]=Xd,this.unresolved.push({object:t,key:e,ref:i,path:n})),!0}readInto(t,e,s,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.readRef(t,e,s,n)||(i&&"object"==typeof s?this.todo.push({object:t,key:e,value:s,path:n}):t[e]=this.read(s,n+Jc(t,e)))}}class Ld extends vd{encode(t){const e=this.writeArray(t,"args");return this.writeDeferred(),e}writeModel(t){return{$ref:t.id}}}class Sd extends xd{decode(t){const e=this.readArray(t,"args");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),e}resolveRefs(){for(const{object:t,key:e,ref:s,path:n}of this.unresolved)if(this.refs.has(s))t[e]=this.refs.get(s);else{const i=this.vm.lookUpModel(s);if(!i)throw Error(`Unresolved ref: ${s} at ${n}[${JSON.stringify(e)}]`);t[e]=i}}}const Gd=[Object,Array,Map,Set,BigInt,ArrayBuffer,DataView,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];function Td(t,e,s,n){const i=Array.isArray(t)?t:t.constructor===Set?t.values():t.constructor===Map?t.entries():Object.values(t),o=[];for(const t of i)"object"!=typeof t||null===t||n.has(t)||(n.add(t),o.push(t));for(const t of o){if(Gd.includes(t.constructor))continue;const n=e+"."+t.constructor.name;if(s[n]){if(s[n]!==t.constructor)throw new Error("Class with name "+n+" already gathered, but new one has different identity")}else s[n]=t.constructor}for(const t of o)Td(t,e,s,n)}function Wd(t,e){const s=$t.controllers.size;s>1&&Rt(`Static properties in shared ${t} ${e} can lead to divergence because ${s} ${Ot.libName} sessions are running simultaneaously. Consider using wellKnownModel() instead.`,{only:"once"})}function kd(t){const e=new Uint8Array(t),s=[];for(let t=0;t<e.byteLength;t+=4096){const n=e.subarray(t,t+4096);s.push(String.fromCharCode.apply(null,n))}return globalThis.btoa(s.join(""))}const Cd={classes:h.has("debug","classes")};let Pd=Symbol("SECRET");const Rd=new WeakSet;class Id{static create(){if(!Hd(this))throw Error(`Model class "${this.name}" not registered`);const t=this,e=this.createNoInit();return!this.wellKnownModel("modelRoot")&&(e.beWellKnownAs("modelRoot"),e.__realm.vm.debugEvents&&this.eventDebugInit(e)),Rd.add(e),e.init(...arguments),Rd.has(e)&&(Rd.delete(e),Object.getPrototypeOf(t)!==Id&&console.warn(`${e} did not call super.init(options)`)),e}static createNoInit(t){const e=ne(),s=new this(Pd);return t||(t=e.register(s)),void 0===Cd.write&&(Cd.write=h.has("debug","write"),Cd.publish=h.has("debug","publish"),Cd.events=h.has("debug","events")),Object.defineProperty(s,"__realm",{value:e,writable:Cd.write}),Object.defineProperty(s,"id",{value:t,enumerable:!0}),s}static allowConstructors(){Pd=void 0,console.warn("disabling error reporting for Model constructors")}static register(t){return t||(t=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),xd.resetInstance(),vd.resetInstance(),Ld.resetInstance(),Sd.resetInstance(),function(t,e){const s=J(t),n=O(`${e}:${s}`);B.push(n),n.then((t=>U[t].what=`Class ${e}`))}(this,t),function(t,e){const s=Vd[e];if(s&&s!==t)throw Error(`Registering model class ${t.name} failed, id "${e}" already used by ${s.name}`);Hd(t)?Cd.classes&&!s&&console.warn(`ignoring re-exported model class ${e}`):(Cd.classes&&console.log(`registering model class ${e}`),t[Yd]=e);Vd[e]=t}(this,t),Id.lastRegistered=this,this}static wellKnownModel(t){if(!fd.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return fd.current().get(t)}static evaluate(t){return fd.evaluate(t)}static isExecuting(){return fd.hasCurrent()}static types(){return{}}static gatherClassTypes(t,e){const s={};return Td({root:t},e,s,new Set),s}static eventDebugOptions(){return Cd}static eventDebugInit(t){t.subscribe("*","*",t.createQFunc('\n        function logEvents(data) {\n            // do this now to have no side effects below\n            const { scope, event, source } = this.activeSubscription;\n            // below stuff is outside the model. Must not have any side effects!\n            const debug = this.constructor.eventDebugOptions();\n            if (!debug.events && !debug.publish) return;\n            const action = source === "model" ? "publish" : "receive";\n            const emoji = source === "model" ? "" : "";\n            console.log(`${emoji} @${this.now()} Model ${action} ${scope}:${event}`, data);\n        }\n        '))}static okayToIgnore(){return[]}static classToID(t){return function(t){if(Hd(t))return t[Yd];const e=t.name||"ClassName";throw Error(`Model class not registered, did you call ${e}.register("${e}")?`)}(t)}static classFromID(t){return Kd(t)}static allClasses(){return Md()}static allClassTypes(){return function(){const t={};for(const e of Md())Object.assign(t,e.types());return Object.entries(t)}()}static instantiateClassID(t,e){return Kd(t).createNoInit(e)}constructor(t){if(t!==Pd)throw Error(`You must create ${App.libName} Models using create() not "new"!`)}init(t,e){Rd.delete(this)}destroy(){ne().unsubscribeAll(this),ne().deregister(this)}publish(t,e,s){this.__realm||this.__realmError(),this.__realm.publish(e,s,t)}subscribe(t,e,s){return this.__realm||this.__realmError(),this.__realm.subscribe(this,t,e,s)}unsubscribe(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"*";this.__realm||this.__realmError(),this.__realm.unsubscribe(this,t,e,s)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}get activeSubscription(){if(!fd.hasCurrent())return;const{currentEvent:t,currentEventFromModel:e}=fd.current();if(!t)return;const[s,n]=t.split(":");return{scope:s,event:n,source:e?"model":"view"}}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.__realm||this.__realmError();for(var s=arguments.length,n=new Array(s>2?s-2:0),i=2;i<s;i++)n[i-2]=arguments[i];return this.__realm.future(this,t,e,n)}cancelFuture(t){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,t)}random(){return ne().random()}now(){return ne().now()}beWellKnownAs(t){ne().vm.set(t,this)}getModel(t){return this.__realm.vm.lookUpModel(t)}wellKnownModel(t){return this.__realm.vm.get(t)}modelOnly(t){if(fd.current()===this.__realm.vm)return!0;const e=Error(t||`${this}.modelOnly() called from outside a model!`);throw Vt("view code",e),e}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}createQFunc(t,e){return void 0===e&&(e=t,t={}),Dc(this,t,e)}persistSession(t){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,t)}[Symbol.toPrimitive](){return`${this.constructor[Yd]||this.constructor.name}#${this.id}`}}const Vd={},Yd=Symbol("CLASS_ID");function Md(){return Object.values(Vd)}function Hd(t){return Object.prototype.hasOwnProperty.call(t,Yd)}function Kd(t){if(Vd[t])return Vd[t];throw Error(`Model class "${t}" in snapshot, but not registered?`)}const zd="Croquet.Model";let Nd;Id[Yd]=zd,Vd[zd]=Id;class _d{static displayStatus(t,e){return It(t,e)}static displayWarning(t,e){return Rt(t,e)}static displayError(t,e){return function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t&&Ot.showMessage(t,{...e,level:"error"})}(t,e)}constructor(t){"object"==typeof t&&"__realm"in t||console.warn(`${Ot.libName}: argument to View constructor needs to be a Model`);let e=ne("");e&&e.isViewRealm()||(e=oe(t.__realm.vm,(()=>ne()),!0)),Object.defineProperty(this,"realm",{value:e}),Object.defineProperty(this,"id",{value:e.register(this),configurable:!0});const s=e.controller.session;if(s.view||(s.view=this),Nd||(Nd={events:h.has("debug","events"),publish:h.has("debug","publish")}),s.view===this&&(Nd.events||Nd.publish)){const t=t=>{if(!e.vm.debugEvents)return;const{scope:s,event:n,source:i,subscribed:o}=this.activeSubscription;if(!o&&!Nd.publish)return;const r="view"===i?"publish":"receive",a="view"===i?"":"",l=o||"publish"===r?"":" (no subscribers)";console.log(`${a} View ${r} ${s}:${n}${l}`,t)},s=e=>"view"===this.activeSubscription.source&&t(e),n=e=>"model"===this.activeSubscription.source&&t(e);s.__CROQUET__=!0,n.__CROQUET__=!0,this.subscribe("*",{event:"*",handling:"queued"},n),this.subscribe("*",{event:"*",handling:"immediate"},s)}}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(t,e,s){this.realm.publish(e,s,t)}subscribe(t,e,s){if("string"==typeof s&&(s=this[s]),"function"!=typeof s)throw Error(`${Ot.libName}: subscribe() handler is not a function`);const n=s;(s=n.bind(this)).unbound=n;const{event:i,handling:o}=e.event?e:{event:e};this.realm.subscribe(i,this.id,s,t,o)}unsubscribe(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;"string"==typeof s&&(s=this[s]),this.realm.unsubscribe(e,this.id,s,t)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}get activeSubscription(){const{currentEvent:t,currentEventFromModel:e,currentEventOnlyGeneric:s}=$t;if(!t)return;const[n,i]=t.split(":");return{scope:n,event:i,source:e?"model":"view",subscribed:!s}}future(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.realm.future(this,t)}random(){return ne().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(t){}wellKnownModel(t){return this.realm.vm.get(t)}get sessionId(){return this.realm.controller.sessionSpec.id}get session(){if(this.id&&this.realm.valid())return this.realm.controller.session}get viewId(){return this.realm.controller.viewId}[Symbol.toPrimitive](){const t=this.constructor.name;return t.includes("View")?t:`${t}[View]`}}const Fd=new class{constructor(){this.ready=!1,this.isInIframe=window.top!==window,this.subscriptions={},this.enumerator=null}setReceiver(t){this.receiver=t,this.ready=!0}setIframeEnumerator(t){this.enumerator=t}on(t,e){if(!this.receiver)throw Error("setReceiver() has not been called");if("string"==typeof e&&(e=this.receiver[e]),!e)throw Error("Messenger.on: the second argument must be a method name or a function");if(this.subscriptions[t]){if(this.findIndex(this.subscriptions[t],e)>=0)throw Error(`${e} is already subscribed`)}else this.subscriptions[t]=[];this.subscriptions[t].push(e),this.listener||(this.listener=t=>this.receive(t),window.addEventListener("message",this.listener))}detach(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=null),this.stopPublishingPointerMove(),this.receiver=null,this.subscriptions={},this.enumerator=null,this.ready=!1}removeSubscription(t,e){"string"==typeof e&&(e=this.receiver[e]);const s=this.subscriptions[t];if(s){const n=this.findIndex(s,e);s.splice(n,1),0===s.length&&delete this.subscriptions[t]}}removeAllSubscriptions(){this.subscriptions={}}receive(t){const{event:e,data:s}=t.data,n=t.source;this.handleEvent(e,s,n)}handleEvent(t,e,s){const n=this.subscriptions[t];n&&n.forEach((t=>{t.call(this.receiver,e,s)}))}send(t,e,s){if(this.isInIframe)return void window.top.postMessage({event:t,data:e},"*");if(s)return void s.postMessage({event:t,data:e},"*");if(!this.enumerator)return;this.enumerator().forEach((s=>{s.contentWindow.postMessage({event:t,data:e},"*")}))}findIndex(t,e){const s=e.name;return t.findIndex((t=>{const n=t.name;return s||n?s===n:e===t}))}startPublishingPointerMove(){this._moveHandler||(this._moveHandler=t=>this.send("pointerPosition",{x:t.clientX,y:t.clientY,type:t.type}),window.document.addEventListener("pointermove",this._moveHandler,!0))}stopPublishingPointerMove(){this._moveHandler&&(window.document.removeEventListener("pointermove",this._moveHandler,!0),this._moveHandler=null)}},Ed="node"===r.CROQUET_PLATFORM;let Jd=60;class Qd{static async join(t){try{return await this.join_impl(t)}catch(t){throw Ot.showMessage(t.message||t,{level:"fatal"}),t}}static async join_impl(t){t.appId||(t.appId="no.appId"),t.name||(t.name=Ot.autoSession(),t.password||(t.password=Ot.autoPassword())),t.model||(t.model=Id.lastRegistered),t.view||(t.view=_d);const e=[];for(const[m,p]of Object.entries(t))p instanceof Promise&&e.push(p.then((e=>t[m]=e)));function s(t,e){return t===e||t.prototype instanceof e}if(await Promise.all(e),t.box){if("string"!=typeof t.box)throw Error(`${Ot.libName}: box must be a string in Session.join()!`);if(!t.box.includes("/"))throw Error(`${Ot.libName}: box must be a (partial) URL in Session.join()!`)}else if(!t.reflector||!t.files){if("string"!=typeof t.apiKey)throw Error(`${Ot.libName}: no apiKey provided in Session.join()!`);if(t.apiKey.length>128)throw Error(`${Ot.libName}: apiKey > 128 characters in Session.join()!`)}if("string"!=typeof t.name)throw Error(`${Ot.libName}: no session name provided in Session.join()!`);if(t.name.length>128)throw Error(`${Ot.libName}: session name > 128 characters in Session.join()!`);const n=t.model;if("function"!=typeof n||!s(n,Id))throw Error(`${Ot.libName}: bad model class in Session.join()`);const i=t.view||_d;if("function"!=typeof i||!s(i,_d))throw Error(`${Ot.libName}: bad view class in Session.join()`);if("string"!=typeof t.appId)throw Error(`${Ot.libName}: no appId provided in Session.join()`);if(!t.appId.length>128)throw Error(`${Ot.libName}: appId > 128 characters in Session.join()`);if(!t.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(`${Ot.libName}: malformed appId in Session.join()`);if("string"!=typeof t.password||!t.password)throw Error(`${Ot.libName}: no password provided in Session.join()`);for(const f of["reflector","synchronizer","files","backend","box"]){const b=h[f]||t[f];void 0!==b&&(h[f]=b)}if(Ed&&"manual"!==t.step)throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in t){if("number"!=typeof t.rejoinLimit||t.rejoinLimit<0||t.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else t.rejoinLimit=1e3;if("eventRateLimit"in t){if("number"!=typeof t.eventRateLimit||t.eventRateLimit<1||t.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else t.eventRateLimit=20;if(t.heraldUrl){if(t.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!t.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(t.hashOverride){if(43!==t.hashOverride.length)throw Error("hashOverride must be 43 characters");if(-1!==t.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error("hashOverride must be base64url encoded")}if(t.debug){function y(t){return"string"==typeof t&&(t=t.split(",")),t?Array.isArray(t)?t:[t]:[]}h.debug=[...y(t.debug),...y(h.debug)].join(",")}if("autoSleep"in t){const g=t.autoSleep,w=typeof g;if("number"===w){if(g<0)throw Error("an autoSleep value must be >= 0")}else{if("boolean"!==w)throw Error("autoSleep must be numeric or boolean");t.autoSleep=g?10:0}}else t.autoSleep=10;if(t.flags){let Z=t.flags;"string"==typeof Z&&(Z=Z.split(",")),Z=Z?Array.isArray(Z)?Z:[Z]:[],Z=Z.filter((t=>"object"!=typeof t)),Z.length?(t.flags={},Z.forEach((e=>t.flags[e]=!0))):t.flags=null}"expectedSimFPS"in t&&(Jd=Math.min(t.expectedSimFPS,120));const o=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","persistentIdOptions","viewOptions","viewData","viewIdDebugSuffix","hashOverride","location","flags","progressReporter"];!function(){if(Object.isFrozen(jd))return;Ud(jd),function(t){const e=JSON.stringify(t,((t,e)=>"function"==typeof e?J(e):e));if("{}"===e)return;const s=JSON.parse(e),n=O(k(s));B.push(n),n.then((t=>U[t].what=`${Ot.libName} Constants`))}(jd)}();const r=new Gc,a=JSON.parse(JSON.stringify({...t.options}));if(t.persistentIdOptions){if(!Array.isArray(t.persistentIdOptions))throw Error("persistentIdOptions must be an array");for(const v of t.persistentIdOptions)if(!(v in a))throw Error(`persistentIdOptions key "${v}" not found in options`)}const l={id:"",persistentId:"",versionId:"",name:t.name,model:null,view:null,step(t){r.stepSession("animation",{frameTime:t,view:l.view,expectedSimFPS:Jd})},leave:()=>Qd.leave(l.id),data:{store:(t,e)=>Kc.store(t,{...e,sessionId:l.id}),fetch:(t,e)=>Kc.fetch(t,{...e,sessionId:l.id}),hash:t=>Kc.hash(t),toId:t=>Kc.toId(t),fromId:t=>Kc.fromId(t)},get latency(){return r.latency},get latencies(){return r.latencies}};"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("session",{detail:{session:l,controller:r}}));const c={options:a,initFn:(t,e)=>n.create(t,e),rebootModelView:u};for(const[X,x]of Object.entries(t))o.includes(X)&&(c[X]=x);await r.initFromSessionSpec(c);let d=!1;return await u(),"manual"!==t.step&&r.startStepping(l.step),l;async function u(){!function(){l.model=null,l.view&&(h.has("debug","session",!1)&&console.log(l.id,"detaching root view"),l.view.detach(),""!==l.view.id&&console.warn(`${Ot.libName}: ${l.view} did not call super.detach()`),l.view=null);Ot.clearSessionMoniker(),Fd.ready&&Fd.detach()}(),r.leaving?r.leaving(!0):d||(d=!0,await r.establishSession(c),d=!1,l.model=r.vm.get("modelRoot"),l.id=r.id,l.persistentId=r.persistentId,l.versionId=r.versionId,r.session=l,Ot.makeSessionWidgets(l.id),r.inViewRealm((()=>{h.has("debug","session",!1)&&console.log(l.id,"creating root view"),new i(l.model,c.viewOptions)})))}}static async leave(t){const e=function(t){for(const e of Lc)if(e.id===t)return e;return null}(t);if(!e)return!1;e.reconnectTimeout&&(clearTimeout(e.reconnectTimeout),delete e.reconnectTimeout);const s=new Promise((t=>e.leaving=t)),n=e.connection;return!!n.connected&&(n.closeConnection(1e3),s)}static thisSession(){const t=fd.current();return t?t.id:""}get id(){return""}get persistentId(){return""}get versionId(){return""}get name(){return""}get data(){return{}}step(t){}leave(){}}const jd={};function Ud(t){if(!Object.isFrozen(t)){Object.freeze(t);for(const e of Object.values(t))!e||"object"!=typeof e&&"function"!=typeof e||Ud(e)}}const Dd={Model:Id,View:_d,Session:Qd,Data:Kc,Constants:jd,App:Ot,Messenger:Fd,VERSION:ic};return Id.Croquet=Dd,_d.Croquet=Dd,"undefined"!=typeof __CROQUET_DEVTOOLS__&&__CROQUET_DEVTOOLS__.dispatchEvent(new CustomEvent("load",{detail:{version:ic}})),"undefined"!=typeof globalThis&&(globalThis.__CROQUET__?console.warn("WARNING: Multiple instances of Croquet being imported."):globalThis.__CROQUET__=ic),t.App=Ot,t.Constants=jd,t.Data=Kc,t.Messenger=Fd,t.Model=Id,t.Session=Qd,t.VERSION=ic,t.View=_d,t}({});
//# sourceMappingURL=croquet.min.js.map
