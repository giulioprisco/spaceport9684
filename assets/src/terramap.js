export function createTexture(t,a,e){var r=document.createElement("canvas"),n=t.xCount+1,o=t.yCount+1;r.width=n,r.height=o;var u=r.getContext("2d"),d=u.getImageData(0,0,n,o);computeData(t,a,d.data),addWindData(e,d.data),u.putImageData(d,0,0);var h=new THREE.Texture(r);return h.wrapS=h.wrapT=THREE.RepeatWrapping,h.needsUpdate=!0,h}function computeData(t,a,e){for(var r=t.vtxNormals,n=t.xCount+1,o=t.yCount+1,u=new THREE.Vector3,d=Date.now(),h=0;h<o;++h)for(var v=0;v<n;++v){var i=h*n+v,m=(o-h-1)*n+v;e[4*m+0]=Math.round(t.heights[i]/t.maxHeight*255);var g=3*i;u.x=r[g++],u.y=r[g++],u.z=r[g++];var c=Math.max(-u.dot(a),0);c*=computeShade(t,a,v,h),e[4*m+1]=Math.round(255*c),e[4*m+3]=255}Date.now();return e}var _v=new THREE.Vector2;function pmod(t,a){return(t%a+a)%a}function computeShade(t,a,e,r){var n=_v,o=t.xCount+1,u=t.yCount+1,d=r*o+e,h=t.heights[d];n.x=-a.x,n.y=-a.y,n.normalize();for(var v=n.length()/a.length()*-a.z,i=e,m=r;h<t.maxHeight;){i+=n.x,m+=n.y,h+=v;var g=pmod(Math.round(i),o),c=pmod(Math.round(m),u),x=t.heights[c*o+g];if(x>h)return x-h>5?.7:.7+.3*(5-(x-h))/5}return 1}function addWindData(t,a){var e=document.createElement("canvas"),r=t.naturalWidth,n=t.naturalHeight;e.width=r,e.height=n;var o=e.getContext("2d");o.drawImage(t,0,0);for(var u=o.getImageData(0,0,r,n).data,d=0;d<n;++d)for(var h=0;h<r;++h){var v=4*(d*r+h),i=u[v];a[v+2]=i}}